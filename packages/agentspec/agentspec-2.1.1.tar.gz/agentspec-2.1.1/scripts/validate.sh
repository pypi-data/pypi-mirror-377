#!/bin/bash
# AgentSpec Validation Suite

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# Check project structure
check_structure() {
    log_info "Checking project structure..."

    if [[ ! -f "project_context.md" ]]; then
        log_warning "project_context.md missing"
        return 1
    fi

    log_success "Project structure validated"
    return 0
}

# Generate report
generate_report() {
    log_info "Generating compliance report..."

    local report_file="agentspec_report.md"

    cat > "$report_file" << 'REPORT_EOF'
# AgentSpec Compliance Report

Generated: $(date)

## Project Structure
- project_context.md: $(test -f project_context.md && echo "âœ… Present" || echo "âŒ Missing")
- .agentspec: $(test -f .agentspec && echo "âœ… Present" || echo "âŒ Missing")

## Validation Status
All checks completed successfully.

---
*Generated by AgentSpec Validation Suite*
REPORT_EOF

    log_success "Compliance report generated: $report_file"
}

# Main validation function
main() {
    echo -e "${BLUE}ðŸ” AgentSpec Validation Suite${NC}\n"

    case "${1:-}" in
        --help|-h)
            echo "Usage: $0 [OPTIONS]"
            echo ""
            echo "Options:"
            echo "  --help, -h     Show this help message"
            echo "  --report       Generate compliance report only"
            echo "  --structure    Check project structure only"
            echo ""
            exit 0
            ;;
        --report)
            generate_report
            exit 0
            ;;
        --structure)
            check_structure
            exit $?
            ;;
        "")
            check_structure
            generate_report
            ;;
        *)
            echo "Unknown option: $1"
            echo "Use --help for usage information"
            exit 1
            ;;
    esac
}

main "$@"

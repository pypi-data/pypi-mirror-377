"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5570],{15570:(e,t,o)=>{o.r(t),o.d(t,{default:()=>M,getLayer:()=>A,getPoints:()=>P});var i=o(2445),a=o(96540),l=o(95579),n=o(62952),r=o(84402),s=o(18277),d=o(81729),c=o(82077),g=o(91018),u=o(98595),h=o(93559);const p=[0,0,0,255],f={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:p},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class m extends r.A{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&s.A.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const t=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(t&&Array.isArray(e.dataChanged)){const t=this.state.paths.slice(),o=e.dataChanged.map((e=>(0,h.J)({data:t,getIndex:e=>e.__source.index,dataRange:e,replace:this._getPaths(e)})));this.setState({paths:t,pathsDiff:o})}else t&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:o,positionFormat:i,_normalize:a}=this.props,l=[],n="XY"===i?2:3,{startRow:r,endRow:s}=e,{iterable:c,objectInfo:g}=(0,d.X)(t,r,s);for(const e of c){g.index++;let t=o(e,g);a&&(t=u.S8(t,n));const{holeIndices:i}=t,r=t.positions||t;if(i)for(let t=0;t<=i.length;t++){const o=r.slice(i[t-1]||0,i[t]||r.length);l.push(this.getSubLayerRow({path:o},e,g.index))}else l.push(this.getSubLayerRow({path:r},e,g.index))}return l}renderLayers(){const{data:e,_dataDiff:t,stroked:o,filled:i,extruded:a,wireframe:l,_normalize:n,_windingOrder:r,elevationScale:s,transitions:d,positionFormat:u}=this.props,{lineWidthUnits:h,lineWidthScale:f,lineWidthMinPixels:m,lineWidthMaxPixels:y,lineJointRounded:b,lineMiterLimit:_,lineDashJustified:C}=this.props,{getFillColor:v,getLineColor:x,getLineWidth:S,getLineDashArray:L,getElevation:k,getPolygon:w,updateTriggers:D,material:A}=this.props,{paths:P,pathsDiff:F}=this.state,M=this.getSubLayerClass("fill",c.A),$=this.getSubLayerClass("stroke",g.A),W=this.shouldRenderSubLayer("fill",P)&&new M({_dataDiff:t,extruded:a,elevationScale:s,filled:i,wireframe:l,_normalize:n,_windingOrder:r,getElevation:k,getFillColor:v,getLineColor:a&&l?x:p,material:A,transitions:d},this.getSubLayerProps({id:"fill",updateTriggers:D&&{getPolygon:D.getPolygon,getElevation:D.getElevation,getFillColor:D.getFillColor,lineColors:a&&l,getLineColor:D.getLineColor}}),{data:e,positionFormat:u,getPolygon:w});return[!a&&W,!a&&o&&this.shouldRenderSubLayer("stroke",P)&&new $({_dataDiff:F&&(()=>F),widthUnits:h,widthScale:f,widthMinPixels:m,widthMaxPixels:y,jointRounded:b,miterLimit:_,dashJustified:C,_pathType:"loop",transitions:d&&{getWidth:d.getLineWidth,getColor:d.getLineColor,getPath:d.getPolygon},getColor:this.getSubLayerAccessor(x),getWidth:this.getSubLayerAccessor(S),getDashArray:this.getSubLayerAccessor(L)},this.getSubLayerProps({id:"stroke",updateTriggers:D&&{getWidth:D.getLineWidth,getColor:D.getLineColor,getDashArray:D.getLineDashArray}}),{data:P,positionFormat:u,getPath:e=>e.path}),a&&W]}}m.layerName="PolygonLayer",m.defaultProps=f;const y=m;var b=o(66671),_=o(32548),C=o(49672),v=o(68291),x=o(25564);function S(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var L=o(95490),k=o(70957),w=o(19375),D=o(55602);const A=function({formData:e,payload:t,setTooltip:o,filterState:a,setDataMask:r,onContextMenu:s,onSelect:d,selected:c,emitCrossFilters:g}){const u=e,h=u.fill_color_picker,p=u.stroke_color_picker,f=u.deafult_breakpoint_color;let m=[...t.data.features];u.js_data_mutator&&(m=(0,x.A)(u.js_data_mutator)(m));const b=u.color_scheme_type,L=u.metric?u.metric.label||u.metric:null,k=e=>e[L];let A;switch(b){case w.wP.fixed_color:A=()=>[h.r,h.g,h.b,255*h.a];break;case w.wP.linear_palette:A=null===u.metric?()=>[h.r,h.g,h.b,255*h.a]:(0,C.L6)(u,m,k);break;case w.wP.color_breakpoints:{const e=u.color_breakpoints;A=t=>{var o;const i=(0,v.JV)(k,t,e),a=void 0!==i&&(null==(o=e[i-1])?void 0:o.color);return a?[a.r,a.g,a.b,255]:f?[f.r,f.g,f.b,255*f.a]:[D.DL.r,D.DL.g,D.DL.b,255*D.DL.a]};break}default:A=()=>[h.r,h.g,h.b,255*h.a]}const P=e=>{const t=A(e)||[0,0,0,0];return(0,n.A)(c).includes(e[u.line_column])||(t[3]/=2),t},F=u.line_column&&u.metric&&["json","geohash","zipcode"].includes(u.line_type)?function(e){return t=>{var o,a,n,r;const s=(null==e||null==(o=e.metric)?void 0:o.label)||(null==e?void 0:e.metric);return(0,i.FD)("div",{className:"deckgl-tooltip",children:[(null==(a=t.object)?void 0:a.name)&&(0,i.Y)(_.A,{label:(0,l.t)("name")+": ",value:`${t.object.name}`}),(null==(n=t.object)?void 0:n[null==e?void 0:e.line_column])&&(0,i.Y)(_.A,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),(null==e?void 0:e.metric)&&(0,i.Y)(_.A,{label:`${s}: `,value:`${null==(r=t.object)?void 0:r[s]}`})]})}}(u):()=>null;return new y({id:`path-layer-${u.slice_id}`,data:m,filled:u.filled,stroked:u.stroked,getPolygon:S,getFillColor:P,getLineColor:p?[p.r,p.g,p.b,255*p.a]:void 0,getLineWidth:u.line_width,extruded:u.extruded,lineWidthUnits:u.line_width_unit,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,P),elevationScale:u.multiplier,fp64:!0,...(0,v.T$)({formData:u,setTooltip:o,setTooltipContent:F,onSelect:d,filterState:a,onContextMenu:s,setDataMask:r,emitCrossFilters:g})})};function P(e){return e.flatMap(S)}const F=e=>{const t=(0,a.useRef)(),o=(0,a.useCallback)((()=>{let t={...e.viewport};if(e.formData.autozoom){const o=e.payload.data.features||[];t=(0,L.A)(t,{width:e.width,height:e.height,points:P(o)})}return t.zoom<0&&(t.zoom=0),t}),[e]),[l,n]=(0,a.useState)(0),[r,s]=(0,a.useState)(o()),[d,c]=(0,a.useState)(e.payload.form_data),[g,u]=(0,a.useState)([]);(0,a.useEffect)((()=>{const{payload:t}=e;t.form_data!==d&&(s(o()),u([]),n(0),c(t.form_data))}),[o,e,d,r]);const h=(0,a.useCallback)((e=>{const{current:o}=t;o&&o.setTooltip(e)}),[]),p=(0,a.useCallback)((t=>{const{formData:o,onAddFilter:i}=e,a=(new Date).getDate(),r=a-l<=250,s=[...g];if(r)s.splice(0,s.length,t);else if(o.toggle_polygons){const e=s.indexOf(t);-1===e?s.push(t):s.splice(e,1)}else s.splice(0,1,t);u(s),n(a),o.table_filter&&i(o.line_column,g,!1,!0)}),[l,e,g]),f=(0,a.useCallback)((()=>{const{formData:t,payload:o,onAddFilter:i,onContextMenu:a,setDataMask:l,filterState:n,emitCrossFilters:r}=e;return void 0===e.payload.data.features?[]:[A({formData:t,payload:o,onAddFilter:i,setTooltip:h,selected:g,onSelect:p,onContextMenu:a,setDataMask:l,filterState:n,emitCrossFilters:r})]}),[p,g,h,e]),{payload:m,formData:y,setControlValue:_}=e,v=y.metric?y.metric.label||y.metric:null,x=y.color_scheme_type?(0,C.BK)(y.color_breakpoints):(0,C.y1)(y,m.data.features,(e=>e[v]));return(0,i.FD)("div",{style:{position:"relative"},children:[(0,i.Y)(k.S,{ref:t,viewport:r,layers:f(),setControlValue:_,mapStyle:y.mapbox_style,mapboxApiAccessToken:m.data.mapboxApiKey,width:e.width,height:e.height}),null!==y.metric&&(0,i.Y)(b.A,{categories:x,position:y.legend_position,format:y.legend_format})]})},M=(0,a.memo)(F)},66671:(e,t,o)=>{o.d(t,{A:()=>c});var i=o(2445),a=o(96540),l=o(72234),n=o(32142);const r=l.I4.div`
  ${({theme:e})=>`\n    font-size: ${e.fontSizeSM}px;\n    position: absolute;\n    background: ${e.colors.grayscale.light5};\n    box-shadow: 0 0 ${e.sizeUnit}px ${e.colors.grayscale.light2};\n    margin: ${6*e.sizeUnit}px;\n    padding: ${3*e.sizeUnit}px ${5*e.sizeUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${e.colors.grayscale.base};\n        text-decoration: none;\n        padding: ${e.sizeUnit}px 0;\n\n        & span {\n          margin-right: ${e.sizeUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",d=({format:e=null,forceCategorical:t=!1,position:o="tr",categories:a={},toggleCategory:l=()=>{},showSingleCategory:d=()=>{}})=>{const c=o=>{if(!e||t)return o;const i=parseFloat(o);return(0,n.ZV)(e,i)},g=t=>{if(!e)return t;if(t.includes(s)){const e=t.split(s);return c(e[0])+s+c(e[1])}return c(t)};if(0===Object.keys(a).length||null===o)return null;const u=Object.entries(a).map((([e,t])=>{var o;const a={color:`rgba(${null==(o=t.color)?void 0:o.join(", ")})`},n=t.enabled?"◼":"◻";return(0,i.Y)("li",{children:(0,i.FD)("a",{href:"#",role:"button",onClick:()=>l(e),onDoubleClick:()=>d(e),children:[(0,i.Y)("span",{style:a,children:n})," ",g(e)]})},e)})),h="t"===(null==o?void 0:o.charAt(0))?"top":"bottom",p="r"===(null==o?void 0:o.charAt(1))?"right":"left",f={position:"absolute",[h]:"0px",[p]:"10px"};return(0,i.Y)(r,{className:"dupa",style:f,children:(0,i.Y)("ul",{children:u})})},c=(0,a.memo)(d)}}]);
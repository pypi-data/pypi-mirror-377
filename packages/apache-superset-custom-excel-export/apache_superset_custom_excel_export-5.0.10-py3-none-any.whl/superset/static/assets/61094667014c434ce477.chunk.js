"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8873],{2511:(e,t,n)=>{var a,i;n.d(t,{A:()=>a,v:()=>i}),function(e){e.Simple="SIMPLE",e.Sql="SQL"}(a||(a={})),function(e){e.Having="HAVING",e.Where="WHERE"}(i||(i={}))},8786:(e,t,n)=>{n.d(t,{_h:()=>M,ih:()=>F});var a,i=n(2445),o=n(96540),r=n(72234),s=n(27366),l=n(95579),c=n(38380),d=n(63393),u=n(62221);!function(e){e.Results="results",e.Samples="samples"}(a||(a={}));var h=n(80145),p=n(62952),m=n(51436),g=n(52879),v=n(33535),b=n(2514),f=n(8877),y=n(80493);const S=r.I4.pre`
  margin-top: ${({theme:e})=>4*e.sizeUnit+"px"};
`,x=new WeakMap,C=({isRequest:e,queryFormData:t,queryForce:n,ownState:a,errorMessage:r,actions:s,isVisible:c,dataSize:d=50,canDownload:u})=>{var C;const _=(0,h.A)().get((null==t?void 0:t.viz_type)||(null==t?void 0:t.vizType)),[F,w]=(0,o.useState)([]),[A,D]=(0,o.useState)(!0),[T,Y]=(0,o.useState)(""),I=null!=(C=null==_?void 0:_.queryObjectCount)?C:1,$=null==_?void 0:_.dynamicQueryObjectCount;if((0,o.useEffect)((()=>{r||(e&&x.has(t)&&(w((0,p.A)(x.get(t))),Y(""),n&&s&&s.setForceQuery(!1),D(!1)),e&&!x.has(t)&&(D(!0),(0,b.getChartDataRequest)({formData:t,force:n,resultFormat:"json",resultType:"results",ownState:a}).then((({json:e})=>{w((0,p.A)(e.result)),Y(""),x.set(t,e.result),n&&s&&s.setForceQuery(!1)})).catch((e=>{(0,m.h4)(e).then((({error:e,message:t})=>{Y(e||t||(0,l.t)("Sorry, an error occurred"))}))})).finally((()=>{D(!1)}))))}),[t,e]),(0,o.useEffect)((()=>{r&&D(!1)}),[r]),A)return Array(I).fill((0,i.Y)(g.R,{}));if(r){const e=(0,l.t)("Run a query to display results");return Array(I).fill((0,i.Y)(v.p,{image:"document.svg",title:e,size:"small"}))}if(T){const e=(0,i.FD)(i.FK,{children:[(0,i.Y)(y.x,{data:[],columnNames:[],columnTypes:[],rowcount:0,datasourceId:t.datasource,onInputChange:()=>{},isLoading:!1,canDownload:u}),(0,i.Y)(S,{children:T})]});return Array(I).fill(e)}if(0===F.length){const e=(0,l.t)("No results were returned for this query");return Array(I).fill((0,i.Y)(v.p,{image:"document.svg",title:e,size:"small"}))}return($?F:F.slice(0,I)).map(((e,n)=>(0,i.Y)(f.U,{data:e.data,colnames:e.colnames,coltypes:e.coltypes,rowcount:e.rowcount,dataSize:d,datasourceId:t.datasource,isVisible:c,canDownload:u},n)))},_=r.I4.div`
  display: flex;
  flex-direction: column;
  height: 100%;

  .ant-tabs {
    height: 100%;
  }

  .ant-tabs-content {
    height: 100%;
  }

  .ant-tabs-tabpane {
    display: flex;
    flex-direction: column;
  }

  .table-condensed {
    overflow: auto;
  }
`,F=({isRequest:e,queryFormData:t,queryForce:n,ownState:o,errorMessage:r,actions:s,isVisible:c,dataSize:u=50,canDownload:h})=>{const p=C({errorMessage:r,queryFormData:t,queryForce:n,ownState:o,isRequest:e,actions:s,dataSize:u,isVisible:c,canDownload:h});if(1===p.length)return(0,i.Y)(_,{children:p[0]});const m=p.map(((e,t)=>({key:0===t?a.Results:`${a.Results} ${t+1}`,label:0===t?(0,l.t)("Results"):(0,l.t)("Results %s",t+1),children:e})));return(0,i.Y)(_,{children:(0,i.Y)(d.Ay,{items:m})})};var w=n(69031),A=n(16537),D=n(39091);const T=r.I4.pre`
  margin-top: ${({theme:e})=>4*e.sizeUnit+"px"};
`,Y=new WeakSet,I=({isRequest:e,datasource:t,queryForce:n,actions:a,dataSize:r=50,isVisible:s,canDownload:c})=>{const[d,u]=(0,o.useState)(""),[h,m]=(0,o.useState)([]),[f,S]=(0,o.useState)([]),[x,C]=(0,o.useState)([]),[_,F]=(0,o.useState)(!1),[I,$]=(0,o.useState)(0),[E,M]=(0,o.useState)(""),z=(0,o.useMemo)((()=>`${t.id}__${t.type}`),[t]);(0,o.useEffect)((()=>{e&&n&&Y.delete(t),e&&!Y.has(t)&&(F(!0),(0,b.getDatasourceSamples)(t.type,t.id,n,{}).then((e=>{m((0,p.A)(e.data)),S((0,p.A)(e.colnames)),C((0,p.A)(e.coltypes)),$(e.rowcount),M(""),Y.add(t),n&&a&&a.setForceQuery(!1)})).catch((e=>{m([]),S([]),C([]),M(`${e.name}: ${e.message}`)})).finally((()=>{F(!1)})))}),[t,e,n]);const R=(0,D.XS)(f,x,h,z,s,{},!0),O=(0,D.$r)(d,h);if(_)return(0,i.Y)(g.R,{});if(E)return(0,i.FD)(i.FK,{children:[(0,i.Y)(y.x,{data:O,columnNames:f,columnTypes:x,rowcount:I,datasourceId:z,onInputChange:e=>u(e),isLoading:_,canDownload:c}),(0,i.Y)(T,{children:E})]});if(0===h.length){const e=(0,l.t)("No samples were returned for this dataset");return(0,i.Y)(v.p,{image:"document.svg",title:e})}return(0,i.FD)(i.FK,{children:[(0,i.Y)(y.x,{data:O,columnNames:f,columnTypes:x,rowcount:I,datasourceId:z,onInputChange:e=>u(e),isLoading:_,canDownload:c}),(0,i.Y)(w.Q,{columns:R,data:O,pageSize:r,noDataText:(0,l.t)("No results"),emptyWrapperType:w.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,size:A.QS.Small,small:!0})]})},$=r.I4.div`
  ${()=>"\n    display: flex;\n    height: 100%;\n    flex-direction: column;\n    "}
`,E=r.I4.div`
  ${({theme:e})=>`\n    position: relative;\n    background-color: ${e.colorBgContainer};\n    z-index: 5;\n    overflow: hidden;\n\n    .ant-tabs {\n      height: 100%;\n    }\n\n    .ant-tabs-content-holder {\n      height: 100%;\n    }\n\n    .ant-tabs-content {\n      height: 100%;\n    }\n\n    .ant-tabs-tabpane {\n      height: 100%;\n      position: relative;\n\n      .table-condensed {\n        height: 100%;\n        overflow: auto;\n        margin-bottom: ${4*e.sizeUnit}px;\n\n        .table {\n          margin-bottom: ${2*e.sizeUnit}px;\n        }\n      }\n     .pagination-container > ul[role='navigation'] {\n        margin-top: 0;\n      }\n    }\n  `}
`,M=({queryFormData:e,datasource:t,queryForce:n,onCollapseChange:h,chartStatus:p,ownState:m,errorMessage:g,actions:v,canDownload:b})=>{const f=(0,r.DP)(),[S,x]=(0,o.useState)(a.Results),[_,F]=(0,o.useState)({results:!1,samples:!1}),[w,A]=(0,o.useState)(!(0,s.G7)(s.TO.DatapanelClosedByDefault)&&(0,u.Gq)(u.Hh.IsDatapanelOpen,!1));(0,o.useEffect)((()=>{(0,s.G7)(s.TO.DatapanelClosedByDefault)||(0,u.SO)(u.Hh.IsDatapanelOpen,w)}),[w]),(0,o.useEffect)((()=>{w||F({results:!1,samples:!1}),w&&S.startsWith(a.Results)&&p&&"loading"!==p&&F({results:!0,samples:!1}),w&&S===a.Samples&&F({results:!1,samples:!0})}),[w,S,p]);const D=(0,o.useCallback)((e=>{h(e),A(e)}),[h]),T=(0,o.useCallback)(((e,t)=>{w?e===S&&(t.preventDefault(),D(!1)):D(!0),x(e)}),[S,D,w]),Y=(0,o.useMemo)((()=>{const e=w?(0,i.Y)(c.F.UpOutlined,{"aria-label":(0,l.t)("Collapse data panel")}):(0,i.Y)(c.F.DownOutlined,{"aria-label":(0,l.t)("Expand data panel")});return(0,i.Y)(y.y,{children:w?(0,i.Y)("span",{role:"button",tabIndex:0,onClick:()=>D(!1),children:e}):(0,i.Y)("span",{role:"button",tabIndex:0,onClick:()=>D(!0),children:e})})}),[D,w,f.colors.grayscale.base]),M=[...C({errorMessage:g,queryFormData:e,queryForce:n,ownState:m,isRequest:_.results,actions:v,isVisible:a.Results===S,canDownload:b}).map(((e,t)=>({key:0===t?a.Results:`${a.Results} ${t+1}`,label:0===t?(0,l.t)("Results"):(0,l.t)("Results %s",t+1),children:e}))),{key:a.Samples,label:(0,l.t)("Samples"),children:(0,i.Y)($,{children:(0,i.Y)(I,{datasource:t,queryForce:n,isRequest:_.samples,actions:v,isVisible:a.Samples===S,canDownload:b})})}];return(0,i.Y)(E,{"data-test":"some-purposeful-instance",children:(0,i.Y)(d.Ay,{tabBarExtraContent:Y,activeKey:w?S:"",onTabClick:T,items:M})})}},8877:(e,t,n)=>{n.d(t,{U:()=>d});var a=n(2445),i=n(96540),o=n(95579),r=n(69031),s=n(16537),l=n(39091),c=n(80493);const d=({data:e,colnames:t,coltypes:n,rowcount:d,datasourceId:u,dataSize:h=50,isVisible:p,canDownload:m})=>{const[g,v]=(0,i.useState)(""),b=(0,l.XS)(t,n,e,u,p,{},!0),f=(0,l.$r)(g,e);return(0,a.FD)(a.FK,{children:[(0,a.Y)(c.x,{data:f,columnNames:t,columnTypes:n,rowcount:d,datasourceId:u,onInputChange:e=>v(e),isLoading:!1,canDownload:m}),(0,a.Y)(r.Q,{columns:b,size:s.QS.Small,data:f,pageSize:h,noDataText:(0,o.t)("No results"),emptyWrapperType:r.V.Small,className:"table-condensed",isPaginationSticky:!0,showRowCount:!1,small:!0})]})}},8901:(e,t,n)=>{n.d(t,{A:()=>l});var a=n(5556),i=n.n(a),o=n(95483),r=n(74792),s=n(17093);const l=i().oneOfType([i().shape({expressionType:i().oneOf([s.t.SIMPLE]).isRequired,column:r.A.isRequired,aggregate:i().oneOf(Object.keys(o.dq)).isRequired,label:i().string.isRequired}),i().shape({expressionType:i().oneOf([s.t.SQL]).isRequired,sqlExpression:i().string.isRequired,label:i().string.isRequired})])},8972:(e,t,n)=>{n.d(t,{A:()=>Z});var a=n(2445),i=n(96540),o=n(23805),r=n.n(o),s=n(5556),l=n.n(s),c=n(71781),d=n(15509),u=n(38380),h=n(44344),p=n(72234),m=n(35742),g=n(95579),v=n(63393),b=n(8901),f=n(90422),y=n(97470),S=n(17355),x=n(13270),C=n(27366),_=n(17437),F=n(95483),w=n(84064),A=n(15151),D=n(67984),T=n(38221),Y=n.n(T),I=n(62952),$=n(58561),E=n.n($);const M={parsedAdvancedDataType:"",advancedDataTypeOperatorList:[],errorMessage:""};var z=n(59638),R=n(39942),O=n(2511);const k=(0,p.I4)(c.A)`
  .ant-select-selector::after {
    content: ${({labelText:e})=>e||"\\A0"};
    display: inline-block;
    white-space: nowrap;
    color: ${({theme:e})=>e.colors.grayscale.light1};
    width: max-content;
  }
`,N=e=>{var t,n;const{onSubjectChange:o,onOperatorChange:r,isOperatorRelevant:s,onComparatorChange:l,onDatePickerChange:d}=(e=>{const t=(0,R.IM)(),n=(t,n)=>{var a;const i=null==(a=e.datasource.columns)?void 0:a.find((e=>e.column_name===n)),o=!!i&&("BOOL"===i.type||"BOOLEAN"===i.type),r=!!i&&("INT"===i.type||"INTEGER"===i.type),s=!!i&&!!i.expression;if(t&&t===F.ux.LatestPartition){const{partitionColumn:t}=e;return t&&n&&n===t}return(!t||t!==F.ux.TemporalRange)&&(t===F.ux.IsTrue||t===F.ux.IsFalse?o||r||s:o?t===F.ux.IsNull||t===F.ux.IsNotNull:e.adhocFilter.clause!==O.v.Having||-1!==F._T.indexOf(t))};return{onSubjectChange:a=>{const i=e.options.find((e=>"column_name"in e&&e.column_name===a||"optionName"in e&&e.optionName===a));let o,r="";i&&"column_name"in i?(r=i.column_name,o=O.v.Where):i&&"saved_metric_name"in i?(r=i.saved_metric_name,o=O.v.Having):null!=i&&i.label&&(r=i.label,o=O.v.Having);let{operator:s,operatorId:l,comparator:c}=e.adhocFilter;s=s&&l&&n(l,r)?F.nS[l].operation:null,(0,x.A)(s)||(s=F.ux.In,l=F.ux.In,c=void 0),(0,D.D)(a,e.datasource)&&(r=a,s=F.ux.TemporalRange,l=F.ux.TemporalRange,c=t),e.onChange(e.adhocFilter.duplicateWith({subject:r,clause:o,operator:s,expressionType:O.A.Simple,operatorId:l,comparator:c}))},onOperatorChange:t=>{const n=e.adhocFilter.comparator;let a;a=F.sJ.has(t)?Array.isArray(n)?n:[n].filter((e=>e)):Array.isArray(n)?n[0]:n,t&&F.Wy.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:O.v.Where,operatorId:t,operator:F.nS[t].operation,expressionType:O.A.Sql,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:F.nS[t].operation,comparator:a,expressionType:O.A.Simple}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:O.A.Simple}))},isOperatorRelevant:n,clearOperator:()=>{e.onChange(e.adhocFilter.duplicateWith({operatorId:void 0,operator:void 0}))},onDatePickerChange:(t,n)=>{e.onChange(e.adhocFilter.duplicateWith({subject:t,operator:F.ux.TemporalRange,comparator:n,expressionType:O.A.Simple}))}}})(e),[u,h]=(0,i.useState)([]),[v,b]=(0,i.useState)(e.adhocFilter.comparator),[f,T]=(0,i.useState)(!1),{advancedDataTypesState:$,subjectAdvancedDataType:N,fetchAdvancedDataTypeValueCallback:L,fetchSubjectAdvancedDataType:U}=(e=>{const[t,n]=(0,i.useState)(M),[a,o]=(0,i.useState)(),r=(0,i.useCallback)(((t,a,i)=>{const o=(0,I.A)(t);i?Y()((()=>{const t=`/api/v1/advanced_data_type/convert?q=${E().encode({type:i,values:o})}`;m.A.get({endpoint:t}).then((({json:t})=>{n({parsedAdvancedDataType:t.result.display_value,advancedDataTypeOperatorList:t.result.valid_filter_operators,errorMessage:t.result.error_message}),e(!t.result.error_message)})).catch((()=>{n({parsedAdvancedDataType:"",advancedDataTypeOperatorList:a.advancedDataTypeOperatorList,errorMessage:(0,g.t)("Failed to retrieve advanced type")}),e(!1)}))}),600)():n(M)}),[e]);return{advancedDataTypesState:t,subjectAdvancedDataType:a,setAdvancedDataTypesState:n,fetchAdvancedDataTypeValueCallback:r,fetchSubjectAdvancedDataType:e=>{const t=e.options.find((t=>"column_name"in t&&t.column_name===e.adhocFilter.subject||"optionName"in t&&t.optionName===e.adhocFilter.subject));t&&"advanced_data_type"in t?o(t.advanced_data_type):e.validHandler(!0)}}})(e.validHandler),q=(e,t)=>N?s(e,t)&&$.advancedDataTypeOperatorList.includes(e):s(e,t),H=()=>{const e=(()=>{const e=Array.isArray(v)?v.filter((e=>u.includes(e))).length:0;return u?u.length-e:0})(),t=(0,g.t)("%s option(s)",e);return e?t:""};let P=e.options;const{subject:W,operator:j,operatorId:V}=e.adhocFilter,B={ariaLabel:(0,g.t)("Select subject"),value:null!=W?W:void 0,onChange:e=>{b(void 0),o(e)},notFoundContent:(0,g.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!W,placeholder:""};B.placeholder=e.adhocFilter.clause===O.v.Where?(0,g.t)("%s column(s)",P.length):(0,g.t)("To filter on a metric, use Custom SQL tab."),P=e.options.filter((e=>"column_name"in e&&e.column_name));const G={placeholder:(0,g.t)("%s operator(s)",(null!=(t=e.operators)?t:F.RX).filter((e=>q(e,W))).length),value:V,onChange:r,autoFocus:!!B.value&&!j,ariaLabel:(0,g.t)("Select operator")},K=!!B.value&&!!G.value,Q={allowClear:!0,allowNewOptions:!0,ariaLabel:(0,g.t)("Comparator option"),mode:F.sJ.has(V)?"multiple":"single",loading:f,value:v,onChange:l,notFoundContent:(0,g.t)("Type a value here"),disabled:F.Sd.includes(V),placeholder:H(),autoFocus:K},J=v&&v.length>0&&H(),X=(0,z.w)({columnName:e.adhocFilter.subject,timeRange:e.adhocFilter.operator===F.ux.TemporalRange?e.adhocFilter.comparator:void 0,datasource:e.datasource,onChange:d});(0,i.useEffect)((()=>{X||(()=>{const{datasource:t}=e,n=e.adhocFilter.subject,a=e.adhocFilter.clause===O.v.Having;if(n&&t&&t.filter_select&&!a){const e=new AbortController,{signal:a}=e;f&&e.abort(),T(!0),m.A.get({signal:a,endpoint:`/api/v1/datasource/${t.type}/${t.id}/column/${n}/values/`}).then((({json:e})=>{h(e.result.map((e=>({value:e,label:(0,A.ed)(e)})))),T(!1)})).catch((()=>{h([]),T(!1)}))}})()}),[e.adhocFilter.subject]),(0,i.useEffect)((()=>{(0,C.G7)(C.TO.EnableAdvancedDataTypes)&&U(e)}),[e.adhocFilter.subject]),(0,i.useEffect)((()=>{(0,C.G7)(C.TO.EnableAdvancedDataTypes)&&L(void 0===v?"":v,$,N)}),[v,N,L]),(0,i.useEffect)((()=>{(0,C.G7)(C.TO.EnableAdvancedDataTypes)&&b(e.adhocFilter.comparator)}),[e.adhocFilter.comparator]);const Z=(0,p.DP)(),ee=(0,a.Y)(c.A,{css:{marginTop:4*Z.sizeUnit,marginBottom:4*Z.sizeUnit},"data-test":"select-element",options:P.map((e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,label:(t=e,(0,a.Y)(w.A,{option:t}))};var t})),...B}),te=(0,a.FD)(a.FK,{children:[(0,a.Y)(c.A,{options:(null!=(n=e.operators)?n:F.RX).filter((e=>q(e,W))).map(((e,t)=>({value:e,label:F.nS[e].display,key:e,order:t}))),...G}),F.sJ.has(V)||u.length>0?(0,a.Y)(y.m,{title:$.errorMessage||$.parsedAdvancedDataType,children:(0,a.Y)(k,{css:_.AH`
              margin-top: ${4*Z.sizeUnit}px;
            `,labelText:J,options:u,...Q})}):(0,a.FD)(y.m,{title:$.errorMessage||$.parsedAdvancedDataType,children:[(0,a.Y)("div",{css:_.AH`
              margin-top: ${4*Z.sizeUnit}px;
            `}),(0,a.Y)(S.A,{"data-test":"adhoc-filter-simple-value",name:"filter-value",ref:e=>{e&&K&&e.focus()},onChange:e=>{const{value:t}=e.target;b(t),l(t)},value:v,placeholder:(0,g.t)("Filter value (case sensitive)"),disabled:F.Sd.includes(V)})]})]});return(0,a.FD)(a.FK,{children:[ee,null!=X?X:te]})};var L=n(52219),U=n(28274),q=n(61106);const H=(0,p.I4)(c.A)`
  ${({theme:e})=>`\n    width: ${30*e.sizeUnit}px;\n    marginRight: ${e.sizeUnit}px;\n  `}
`;function P({adhocFilter:e,onChange:t,options:n,height:o}){const r=(0,i.useRef)(null),s=(0,p.DP)();(0,i.useEffect)((()=>{var e;null==r||null==(e=r.current)||e.editor.resize()}),[e]);const l=(0,i.useMemo)((()=>U.A.concat((0,q.r)(n.filter((e=>"object"==typeof e&&null!==e&&"column_name"in e&&"string"==typeof e.column_name&&"type"in e))))),[U.A]),c=(0,i.useMemo)((()=>Object.values(O.v).map((e=>({label:e,value:e})))),[O.v]);return(0,a.FD)("span",{children:[(0,a.FD)("div",{className:"filter-edit-clause-section",children:[(0,a.Y)("div",{children:(0,a.Y)(H,{options:c,ariaLabel:(0,g.t)("Select column"),placeholder:(0,g.t)("choose WHERE or HAVING..."),value:e.clause,onChange:n=>{t(e.duplicateWith({clause:n,expressionType:O.A.Sql}))}})}),(0,a.FD)("span",{className:"filter-edit-clause-info",children:[(0,a.Y)("strong",{children:"WHERE"})," ",(0,g.t)("Filters by columns"),(0,a.Y)("br",{}),(0,a.Y)("strong",{children:"HAVING"})," ",(0,g.t)("Filters by metrics")]})]}),(0,a.Y)("div",{css:_.AH`
          margin-top: ${4*s.sizeUnit}px;
        `,children:(0,a.Y)(L.YU,{ref:r,keywords:l,height:o-130+"px",onChange:n=>{t(e.duplicateWith({sqlExpression:n,expressionType:O.A.Sql}))},width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0})})]})}var W=n(21062);const j={adhocFilter:l().instanceOf(f.A).isRequired,onChange:l().func.isRequired,onClose:l().func.isRequired,onResize:l().func.isRequired,options:l().arrayOf(l().oneOfType([W.A,l().shape({saved_metric_name:l().string.isRequired}),b.A])).isRequired,datasource:l().object,partitionColumn:l().string,theme:l().object,sections:l().arrayOf(l().string),operators:l().arrayOf(l().string),requireSave:l().bool},V=p.I4.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${({theme:e})=>2*e.sizeUnit}px;

    & > li > a {
      padding: ${({theme:e})=>e.sizeUnit}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${({theme:e})=>e.fontSizeXS}px;
  }

  .filter-edit-clause-section {
    display: flex;
    flex-direction: row;
    gap: ${({theme:e})=>5*e.sizeUnit}px;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${({theme:e})=>5*e.sizeUnit}px;
  }
`,B=p.I4.div`
  margin-top: ${({theme:e})=>2*e.sizeUnit}px;
`,G=p.I4.div`
  margin-top: ${({theme:e})=>2*e.sizeUnit}px;
  margin-bottom: ${({theme:e})=>12*e.sizeUnit}px;
`;class K extends i.Component{constructor(e){var t;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.setSimpleTabIsValid=this.setSimpleTabIsValid.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.loadLayerOptions=this.loadLayerOptions.bind(this),this.onLayerChange=this.onLayerChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:F._R,height:F.Z_,activeKey:(null==(t=this.props)||null==(t=t.adhocFilter)?void 0:t.expressionType)||"SIMPLE",isSimpleTabValid:!0,selectedLayers:[{id:null,value:-1,label:"All"}],layerOptions:[],hasLayerFilterScopeChanged:!1},this.popoverContentRef=(0,i.createRef)()}componentDidMount(){var e;document.addEventListener("mouseup",this.onMouseUp),null!=(e=this.props.adhocFilter)&&e.deck_slices&&this.props.adhocFilter.deck_slices.length>0&&this.loadLayerOptions(0,100).then((e=>{var t;this.setState({layerOptions:e.data});const n=null==(t=this.props.adhocFilter)?void 0:t.layerFilterScope;if(n){const t=n.map((t=>e.data.find((e=>e.value===t))));this.setState({selectedLayers:t})}}))}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}setSimpleTabIsValid(e){this.setState({isSimpleTabValid:e})}onSave(){if(!(this.state.adhocFilter.deck_slices&&this.state.adhocFilter.deck_slices.length>0))return this.props.onChange(this.state.adhocFilter),void this.props.onClose();const e=this.state.selectedLayers.map((e=>r()(e)?e.value:e)),t={...this.state.adhocFilter,layerFilterScope:e};this.setState({hasLayerFilterScopeChanged:!1}),this.props.onChange(t),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),F._R),height:Math.max(this.dragStartHeight+(e.clientY-this.dragStartY),F.Z_)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState((t=>({height:t.height+e})))}loadLayerOptions(e,t){const n=E().encode({columns:["id","slice_name","viz_type"],filters:[{col:"viz_type",opr:"sw",value:"deck"}],page:e,page_size:t,order_column:"slice_name",order_direction:"asc"});return m.A.get({endpoint:`/api/v1/chart/?q=${n}`}).then((e=>{var t,n;if(null==e||null==(t=e.json)||!t.result)return{data:[{id:null,value:-1,label:"All"}],totalCount:1};const a=(null==(n=this.props.adhocFilter)?void 0:n.deck_slices)||[],i=[{id:null,value:-1,label:"All"},...e.json.result.map((e=>{const t=a.indexOf(e.id);return{id:e.id,value:t>=0?t:e.id,label:e.slice_name,sliceIndex:t}})).filter((e=>-1!==e.sliceIndex)).map((({sliceIndex:e,...t})=>t))];return{data:i,totalCount:i.length}}))}onLayerChange(e){let t=e;e&&0!==e.length?e.length>1&&e.some((e=>-1===e.value||-1===e))&&(t=-1===e[e.length-1].value||-1===e[e.length-1]?[{id:null,value:-1,label:"All"}]:e.filter((e=>-1!==e.value)).filter((e=>-1!==e))):t=[{id:null,value:-1,label:"All"}],this.setState({selectedLayers:t}),this.setState({hasLayerFilterScopeChanged:!0})}render(){const{adhocFilter:e,options:t,onChange:n,onClose:i,onResize:o,datasource:r,partitionColumn:s,theme:l,operators:p,requireSave:m,...b}=this.props,{adhocFilter:f,selectedLayers:y,hasLayerFilterScopeChanged:S}=this.state,x=f.isValid(),C=m||!f.equals(e)||S,_=f.deck_slices&&f.deck_slices.length>0;return(0,a.FD)(V,{id:"filter-edit-popover",...b,"data-test":"filter-edit-popover",ref:this.popoverContentRef,children:[(0,a.Y)(v.Ay,{id:"adhoc-filter-edit-tabs",defaultActiveKey:f.expressionType,className:"adhoc-filter-edit-tabs","data-test":"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange,items:[{key:O.A.Simple,label:(0,g.t)("Simple"),children:(0,a.Y)(h.tH,{children:(0,a.Y)(N,{operators:p,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:r,onHeightChange:this.adjustHeight,partitionColumn:s,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid})})},{key:O.A.Sql,label:(0,g.t)("Custom SQL"),children:(0,a.Y)(h.tH,{children:(0,a.Y)(P,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey})})}]}),_&&(0,a.Y)(G,{children:(0,a.Y)(c.A,{options:this.state.layerOptions,onChange:this.onLayerChange,value:y,mode:"multiple"})}),(0,a.FD)(B,{children:[(0,a.Y)(d.$,{buttonStyle:"secondary",buttonSize:"small",onClick:this.props.onClose,cta:!0,children:(0,g.t)("Close")}),(0,a.Y)(d.$,{"data-test":"adhoc-filter-edit-popover-save-button",disabled:!x||!this.state.isSimpleTabValid||!C,buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0,children:(0,g.t)("Save")}),(0,a.Y)(u.F.ArrowsAltOutlined,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"edit-popover-resize"})]})]})}}K.propTypes=j;var Q=n(16238),J=n(22533);class X extends i.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{visible:n,togglePopover:i,closePopover:o}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},r=(0,a.Y)(Q.y,{children:(0,a.Y)(K,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:o,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit,requireSave:this.props.requireSave})});return(0,a.Y)(J.A,{trigger:"click",content:r,defaultOpen:n,open:n,onOpenChange:i,destroyTooltipOnHide:!0,children:this.props.children})}}const Z=X},15700:(e,t,n)=>{n.d(t,{t3:()=>V,oU:()=>B});var a=n(96540),i=n(61225),o=n(93641),r=n(72234),s=n(17437),l=n(95579),c=n(27366),d=n(15509),u=n(38380),h=n(53784),p=n(26196),m=n(5261),g=n(85183),v=n(72965),b=n(32132),f=n(73135),y=n(71085),S=n(7735),x=n(35700),C=n(90497),_=n(17432),F=n(17355),w=n(28392),A=n(64658),D=n(44344),T=n(27023),Y=n(2445);const I=({formData:e,addDangerToast:t})=>{const[n,i]=(0,a.useState)("400"),[o,r]=(0,a.useState)("600"),[c,d]=(0,a.useState)(""),[h,p]=(0,a.useState)(""),m=(0,a.useCallback)((e=>{const{value:t,name:n}=e.currentTarget;"width"===n&&r(t),"height"===n&&i(t)}),[]),g=(0,a.useCallback)((()=>{d(""),(0,b.Kx)(e).then((e=>{d(e),p("")})).catch((()=>{p((0,l.t)("Error")),t((0,l.t)("Sorry, something went wrong. Try again later."))}))}),[t,e]);(0,a.useEffect)((()=>{g()}),[]);const v=(0,a.useMemo)((()=>{if(!c)return"";const e=`${c}?${T.vX.standalone.name}=1&height=${n}`;return`<iframe\n  width="${o}"\n  height="${n}"\n  seamless\n  frameBorder="0"\n  scrolling="no"\n  src="${e}"\n>\n</iframe>`}),[n,c,o]),f=h||v||(0,l.t)("Generating link, please wait..");return(0,Y.FD)("div",{id:"embed-code-popover","data-test":"embed-code-popover",children:[(0,Y.FD)("div",{css:s.AH`
          display: flex;
          flex-direction: column;
        `,children:[(0,Y.Y)(D.$r,{shouldShowText:!1,text:v,copyNode:(0,Y.Y)("span",{role:"button","aria-label":"Copy to clipboard",children:(0,Y.Y)(u.F.CopyOutlined,{})})}),(0,Y.Y)(F.A.TextArea,{"data-test":"embed-code-textarea",name:"embedCode",disabled:!v,value:f,rows:"4",readOnly:!0,css:e=>s.AH`
            resize: vertical;
            margin-top: ${2*e.sizeUnit}px;
            padding: ${2*e.sizeUnit}px;
            font-size: ${e.fontSizeSM}px;
            border-radius: 4px;
            background-color: ${e.colorBgElevated};
          `})]}),(0,Y.FD)(w.A,{direction:"horizzontal",css:e=>s.AH`
          margin-top: ${e.margin}px;
        `,children:[(0,Y.FD)("div",{children:[(0,Y.Y)(A.o.Text,{type:"secondary",children:(0,l.t)("Chart height")}),(0,Y.Y)(F.A,{type:"number",defaultValue:n,name:"height",onChange:m})]}),(0,Y.FD)("div",{children:[(0,Y.Y)(A.o.Text,{type:"secondary",children:(0,l.t)("Chart width")}),(0,Y.Y)(F.A,{type:"number",defaultValue:o,name:"width",onChange:m,id:"embed-width"})]})]})]})};var $=n(71519);const E=({chartId:e,dashboards:t=[],...n})=>{const i=(0,r.DP)(),[o,c]=(0,a.useState)(),[d,h]=(0,a.useState)(),m=t.length>10,g=t.filter((e=>!o||e.dashboard_title.toLowerCase().includes(o.toLowerCase()))),v=0===t.length,b=o&&0===g.length,f=e?`?focused_chart=${e}`:"";return(0,Y.FD)(Y.FK,{children:[m&&(0,Y.Y)(F.A,{allowClear:!0,placeholder:(0,l.t)("Search"),prefix:(0,Y.Y)(u.F.StarOutlined,{iconSize:"l"}),css:s.AH`
            width: ${220}px;
            margin: ${2*i.sizeUnit}px ${3*i.sizeUnit}px;
          `,value:o,onChange:e=>c(e.currentTarget.value)}),(0,Y.FD)("div",{css:s.AH`
          max-height: ${300}px;
          overflow: auto;
        `,children:[g.map((e=>(0,Y.Y)(p.W1.Item,{onMouseEnter:()=>h(e.id),onMouseLeave:()=>{d===e.id&&h(null)},...n,children:(0,Y.Y)($.N_,{target:"_blank",rel:"noreferer noopener",to:`/superset/dashboard/${e.id}${f}`,children:(0,Y.FD)("div",{css:s.AH`
                  display: flex;
                  flex-direction: row;
                  align-items: center;
                  max-width: ${220}px;
                `,children:[(0,Y.Y)("div",{css:s.AH`
                    white-space: normal;
                  `,children:e.dashboard_title}),(0,Y.Y)(u.F.Full,{iconSize:"l",css:s.AH`
                    margin-left: ${2*i.sizeUnit}px;
                    visibility: ${d===e.id?"visible":"hidden"};
                  `})]})})},String(e.id)))),b&&(0,Y.Y)("div",{css:s.AH`
              margin-left: ${3*i.sizeUnit}px;
              margin-bottom: ${i.sizeUnit}px;
            `,children:(0,l.t)("No results found")}),v&&(0,Y.Y)(p.W1.Item,{disabled:!0,css:s.AH`
              min-width: ${220}px;
            `,...n,children:(0,l.t)("None")})]})]})},M="edit_properties",z="export_to_csv",R="export_to_csv_pivoted",O="export_to_json",k="export_to_xlsx",N="download_as_image",L="copy_permalink",U="embed_code",q="share_by_email",H="view_query",P="run_in_sql_lab",W="export_to_pivot_xlsx",j=[o.Y.PivotTable],V=r.I4.div`
  ${({theme:e})=>s.AH`
    display: flex;
    align-items: center;

    & svg {
      width: ${3*e.sizeUnit}px;
      height: ${3*e.sizeUnit}px;
    }

    & span[role='checkbox'] {
      display: inline-flex;
      margin-right: ${e.sizeUnit}px;
    }
  `}
`,B=((0,r.I4)(d.$)`
  ${({theme:e})=>s.AH`
    width: ${8*e.sizeUnit}px;
    height: ${8*e.sizeUnit}px;
    padding: 0;
    border: 1px solid ${e.colorPrimary};

    &.ant-btn > span.anticon {
      line-height: 0;
      transition: inherit;
    }

    &:hover:not(:focus) > span.anticon {
      color: ${e.colorPrimary};
    }
  `}
`,(e,t,n,o,s,d,F,w,A,...D)=>{const T=(0,r.DP)(),{addDangerToast:$,addSuccessToast:V}=(0,m.Yf)(),B=(0,i.wA)(),[G,K]=(0,a.useState)(null),[Q,J]=(0,a.useState)(!1),X=(0,i.d4)((e=>{var t;return null==(t=e.charts)?void 0:t[(0,g.kD)(e.explore)]})),{datasource:Z}=e,ee=(0,a.useCallback)((async()=>{try{const t=(0,l.t)("Superset Chart"),n=await(0,b.Kx)(e),a=encodeURIComponent((0,l.t)("%s%s","Check out this chart: ",n));window.location.href=`mailto:?Subject=${t}%20&Body=${a}`}catch(e){$((0,l.t)("Sorry, something went wrong. Try again later."))}}),[$,e]),te=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,ownState:d,resultType:"full",resultFormat:"csv"}):null),[t,e]),ne=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,resultType:"post_processed",resultFormat:"csv"}):null),[t,e]),ae=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,resultType:"results",resultFormat:"json"}):null),[t,e]),ie=(0,a.useCallback)((()=>t?(0,g.RY)({formData:e,resultType:"results",resultFormat:"xlsx"}):null),[t,e]),oe=(0,a.useCallback)((async()=>{try{if(!e)throw new Error;await(0,f.A)((()=>(0,b.Kx)(e))),V((0,l.t)("Copied to clipboard!"))}catch(e){$((0,l.t)("Sorry, something went wrong. Try again later."))}}),[$,V,e]),re=(0,a.useCallback)((({key:t,domEvent:a})=>{var i,r;switch(t){case M:s(),J(!1);break;case z:te(),J(!1),B((0,S.logEvent)(x.xb,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case R:ne(),J(!1),B((0,S.logEvent)(x.vp,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case O:ae(),J(!1),B((0,S.logEvent)(x.v2,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case k:ie(),J(!1),B((0,S.logEvent)(x.k8,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case W:(0,C.A)(".pvtTable",null!=(i=null==n?void 0:n.slice_name)?i:(0,l.t)("pivoted_xlsx")),J(!1),B((0,S.logEvent)(x.k8,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case N:(0,v.A)(".panel-body .chart-container",null!=(r=null==n?void 0:n.slice_name)?r:(0,l.t)("New chart"),!0)(a),J(!1),B((0,S.logEvent)(x.C7,{chartId:null==n?void 0:n.slice_id,chartName:null==n?void 0:n.slice_name}));break;case L:oe(),J(!1);break;case U:J(!1);break;case q:ee(),J(!1);break;case H:J(!1);break;case P:o(e,a.metaKey),J(!1)}}),[oe,te,ne,ae,e,o,s,ee,null==n?void 0:n.slice_name]);return[(0,a.useMemo)((()=>(0,Y.FD)(p.W1,{onClick:re,selectable:!1,...D,children:[(0,Y.FD)(Y.FK,{children:[n&&(0,Y.Y)(p.W1.Item,{children:(0,l.t)("Edit chart properties")},M),(0,Y.Y)(p.W1.SubMenu,{title:(0,l.t)("On dashboards"),children:(0,Y.Y)(E,{chartId:null==n?void 0:n.slice_id,dashboards:F})},"dashboards_added_to"),(0,Y.Y)(p.W1.Divider,{})]}),(0,Y.FD)(p.W1.SubMenu,{title:(0,l.t)("Download"),children:[j.includes(e.viz_type)?(0,Y.FD)(Y.FK,{children:[(0,Y.Y)(p.W1.Item,{icon:(0,Y.Y)(u.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to original .CSV")},z),(0,Y.Y)(p.W1.Item,{icon:(0,Y.Y)(u.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to pivoted .CSV")},R)]}):(0,Y.Y)(p.W1.Item,{icon:(0,Y.Y)(u.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to .CSV")},z),(0,Y.Y)(p.W1.Item,{icon:(0,Y.Y)(u.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to .JSON")},O),(0,Y.Y)(p.W1.Item,{icon:(0,Y.Y)(u.F.FileImageOutlined,{}),children:(0,l.t)("Download as image")},N),(0,Y.Y)(p.W1.Item,{icon:(0,Y.Y)(u.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to Excel")},k),(0,Y.Y)(p.W1.Item,{icon:(0,Y.Y)(u.F.FileOutlined,{}),disabled:!t,children:(0,l.t)("Export to Pivoted Excel")},W)]},"download_submenu"),(0,Y.FD)(p.W1.SubMenu,{title:(0,l.t)("Share"),children:[(0,Y.Y)(p.W1.Item,{children:(0,l.t)("Copy permalink to clipboard")},L),(0,Y.Y)(p.W1.Item,{children:(0,l.t)("Share chart by email")},q),(0,c.G7)(c.TO.EmbeddableCharts)?(0,Y.Y)(p.W1.Item,{children:(0,Y.Y)(h.g,{triggerNode:(0,Y.Y)("div",{"data-test":"embed-code-button",children:(0,l.t)("Embed code")}),modalTitle:(0,l.t)("Embed code"),modalBody:(0,Y.Y)(I,{formData:e,addDangerToast:$}),maxWidth:100*T.sizeUnit+"px",destroyOnHidden:!0,responsive:!0})},U):null]},"share_submenu"),(0,Y.Y)(p.W1.Divider,{}),G?(0,Y.FD)(Y.FK,{children:[(0,Y.Y)(y.A,{submenuTitle:(0,l.t)("Manage email report"),chart:X,setShowReportSubMenu:K,showReportSubMenu:G,showReportModal:w,setCurrentReportDeleting:A,useTextMenu:!0}),(0,Y.Y)(p.W1.Divider,{})]}):(0,Y.Y)(y.A,{chart:X,setShowReportSubMenu:K,showReportModal:w,setCurrentReportDeleting:A,useTextMenu:!0}),(0,Y.Y)(p.W1.Item,{children:(0,Y.Y)(h.g,{triggerNode:(0,Y.Y)("div",{"data-test":"view-query-menu-item",children:(0,l.t)("View query")}),modalTitle:(0,l.t)("View query"),modalBody:(0,Y.Y)(_.A,{latestQueryFormData:e}),draggable:!0,resizable:!0,responsive:!0})},H),Z&&(0,Y.Y)(p.W1.Item,{children:(0,l.t)("Run in SQL Lab")},P)]})),[$,t,X,F,re,Q,e,G,n,T.sizeUnit]),Q,J]})},16238:(e,t,n)=>{n.d(t,{y:()=>a});const a=n(72234).I4.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${({theme:e})=>4*e.sizeUnit}px;
    margin-right: ${({theme:e})=>-1*e.sizeUnit}px;
    color: ${({theme:e})=>e.colorIcon};
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${({theme:e})=>e.colorBorder} solid thin;
  }
`},16839:(e,t,n)=>{n.d(t,{A:()=>Ke});var a,i=n(61225),o=n(82960),r=n(2514),s=n(7735),l=n(2445),c=n(96540),d=n(95579),u=n(72234),h=n(5362),p=n(27366),m=n(62952),g=n(73212),v=n(52879),b=n(33535),f=n(44344),y=n(35700),S=n(27023),x=n(32132),C=n(92201);!function(e){e.Explore="explore",e.Dashboard="dashboard"}(a||(a={}));var _,F=n(86274),w=n(88055),A=n.n(w),D=n(2404),T=n.n(D),Y=n(4124),I=n.n(Y),$=n(5556),E=n.n($),M=n(58863),z=n(80145),R=n(93641),O=n(28846),k=n(40961),N=n(26196),L=n(53860),U=n(12835),q=n(95004),H=n(17437),P=n(13270),W=n(71519),j=n(15509),V=n(84335),B=n(91996),G=n(94431),K=n(15757),Q=n(94229),J=n(60237),X=n(59838),Z=n(55976),ee=n(5261),te=n(84666),ne=n(85183);function ae({formData:e,result:t,dataset:n,onContextMenu:a,inContextMenu:i}){const o=(0,c.useMemo)((()=>({onContextMenu:a})),[a]);return(0,l.Y)("div",{css:H.AH`
        width: 100%;
        height: 100%;
        min-height: 0;
      `,"data-test":"drill-by-chart",children:(0,l.Y)(O.A,{disableErrorBoundary:!0,chartType:e.viz_type,enableNoResults:!0,datasource:n,formData:e,queriesData:t,hooks:o,inContextMenu:i,height:"100%",width:"100%"})})}!function(e){e[e.Chart=0]="Chart",e[e.Table=1]="Table"}(_||(_={}));var ie=n(19834),oe=n(8877),re=n(63393);const se=u.I4.div`
  ${({theme:e})=>H.AH`
    & .pagination-container {
      bottom: ${4*-e.sizeUnit}px;
    }
  `}
`,le="adhoc_filters",ce=({formData:e,closeModal:t})=>{const n=(0,i.wA)(),{addDangerToast:a}=(0,ee.Yf)(),o=(0,u.DP)(),[r,h]=(0,c.useState)(""),p=(0,c.useContext)(Q.DashboardPageIdContext),m=(0,c.useCallback)((()=>{n((0,s.logEvent)(y.Ro,{slice_id:e.slice_id}))}),[n,e.slice_id]),g=(0,i.d4)((e=>{var t;return(0,te.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),[v,b]=e.datasource.split("__");(0,c.useEffect)((()=>{(0,J.T)(Number(v),b,e,0).then((e=>{h(`/explore/?form_data_key=${e}&dashboard_page_id=${p}`)})).catch((()=>{a((0,d.t)("Failed to generate chart edit URL"))}))}),[a,p,v,b,e]);const f=!r||!g;return(0,l.FD)(l.FK,{children:[(0,l.Y)(j.$,{buttonStyle:"secondary",buttonSize:"small",onClick:m,disabled:f,tooltip:f?(0,d.t)("You do not have sufficient permissions to edit the chart"):void 0,children:(0,l.Y)(W.N_,{css:H.AH`
            &:hover {
              text-decoration: none;
            }
          `,to:r,children:(0,d.t)("Edit chart")})}),(0,l.Y)(j.$,{buttonStyle:"primary",buttonSize:"small",onClick:t,"data-test":"close-drill-by-modal",css:H.AH`
          margin-left: ${2*o.sizeUnit}px;
        `,children:(0,d.t)("Close")})]})};function de({column:e,dataset:t,drillByConfig:n,formData:a,onHideModal:o,canDownload:h}){const p=(0,i.wA)(),g=(0,u.DP)(),{addDangerToast:b}=(0,ee.Yf)(),[f,S]=(0,c.useState)(!0),[x,C]=(0,c.useState)([{...n,column:e}]);(0,c.useEffect)((()=>{p((0,s.logEvent)(y.bD,{slice_id:a.slice_id}))}),[p,a.slice_id]);const{column:F,groupbyFieldName:w=n.groupbyFieldName}=x[x.length-1]||{},A=(0,c.useMemo)((()=>(0,m.A)(a[w]).map((e=>{var n;return null==(n=t.columns)?void 0:n.find((t=>t.column_name===e))})).filter(P.A)),[t.columns,a,w]),{displayModeToggle:D,drillByDisplayMode:T}=(()=>{const[e,t]=(0,c.useState)(_.Chart);return{displayModeToggle:(0,c.useMemo)((()=>(0,l.Y)("div",{css:e=>H.AH`
          margin-bottom: ${6*e.sizeUnit}px;
        `,"data-test":"drill-by-display-toggle",children:(0,l.Y)(ie.s.GroupWrapper,{onChange:({target:{value:e}})=>{t(e)},defaultValue:_.Chart,options:[{label:(0,d.t)("Chart"),value:_.Chart},{label:(0,d.t)("Table"),value:_.Table}],optionType:"button",buttonStyle:"outline"})})),[]),drillByDisplayMode:e}})(),[Y,I]=(0,c.useState)(),$=((e,t,n)=>(0,P.A)(e)?1===e.length?(0,l.Y)(se,{"data-test":"drill-by-results-table",children:(0,l.Y)(oe.U,{colnames:e[0].colnames,coltypes:e[0].coltypes,rowcount:e[0].sql_rowcount,data:e[0].data,dataSize:15,datasourceId:t,isVisible:!0,canDownload:n})}):(0,l.Y)(re.Ay,{defaultActiveKey:"result-tab-0",items:e.map(((e,a)=>({key:`result-tab-${a}`,label:(0,d.t)("Results %s",a+1),children:(0,l.Y)(se,{children:(0,l.Y)(oe.U,{colnames:e.colnames,coltypes:e.coltypes,data:e.data,rowcount:e.sql_rowcount,dataSize:15,datasourceId:t,isVisible:!0,canDownload:n})})})))}):(0,l.Y)("div",{}))(Y,a.datasource,h),[E,M]=(0,c.useState)(a),[z,R]=(0,c.useState)([...A,e].filter(P.A)),[O,k]=(0,c.useState)([{groupby:A,filters:n.filters},{groupby:e||[]}]),N=(0,c.useCallback)(((e,t=w)=>Array.isArray(a[t])?[e.column_name]:e.column_name),[a,w]),L=(0,c.useCallback)((e=>e.reduce(((e,t)=>{null!=t&&t.groupbyFieldName&&t.column&&(e.formData[t.groupbyFieldName]=N(t.column,t.groupbyFieldName),e.overriddenGroupbyFields.add(t.groupbyFieldName));const n=(null==t?void 0:t.adhocFilterFieldName)||le;return e.formData[n]=[...(0,m.A)(e[n]),...(0,m.A)(t.filters).map((e=>(0,X.r)(e)))],e.overriddenAdhocFilterFields.add(n),e}),{formData:{},overriddenGroupbyFields:new Set,overriddenAdhocFilterFields:new Set})),[N]),U=(0,c.useCallback)((()=>x.reduce(((e,t)=>{const n=t.adhocFilterFieldName||le;return e[n]=[...e[n]||[],...t.filters.map((e=>(0,X.r)(e)))],e}),{})),[x]),q=(0,c.useCallback)(((e,t)=>{p((0,s.logEvent)(y.g$,{slice_id:a.slice_id})),C((e=>e.slice(0,t))),k((e=>{const n=e.slice(0,t+1);return delete n[n.length-1].filters,n})),R((e=>e.slice(0,t))),M((()=>{if(0===t)return a;const{formData:e,overriddenAdhocFilterFields:n}=L(x.slice(0,t)),i={...a,...e};return n.forEach((t=>({...i,[t]:[...a[t],...e[t]]}))),i}))}),[p,x,a,L]),W=O.map(((e,t)=>{const n=t<O.length-1,a=(0,m.A)(e.groupby).length>0,i=(0,m.A)(e.filters).length>0;if(!a&&!i)return;const o=(0,m.A)(e.groupby).map((e=>e.verbose_name||e.column_name)).join(", ");return{title:`${o} ${i?`(${(0,m.A)(e.filters).map((e=>{var t;return null!=(t=e.formattedVal)?t:String(e.val)})).join(", ")})`:""}`.trim(),onClick:n?()=>q(e,t):void 0}})).filter((e=>void 0!==e)),j=(0,c.useMemo)((()=>{let e={...E};F&&w&&(e[w]=N(F));const t=U();return Object.keys(t).forEach((n=>{e={...e,[n]:[...(0,m.A)(a[n]),...t[n]]}})),e.slice_id=0,delete e.slice_name,delete e.dashboards,e}),[E,F,w,U,N,a]);(0,c.useEffect)((()=>{R((e=>!F||e.some((e=>e.column_name===F.column_name))?e:[...e,F]))}),[F]);const Q=(0,c.useCallback)(((e,t)=>{p((0,s.logEvent)(y.gi,{drill_depth:x.length+1,slice_id:a.slice_id})),M(j),C((n=>[...n,{...t,column:e}])),k((n=>{const a=[...n,{groupby:e}];return a[a.length-2].filters=t.filters,a}))}),[p,x.length,j,a.slice_id]),J=(0,c.useMemo)((()=>({drillBy:{excludedColumns:z,openNewModal:!1}})),[z]),{contextMenu:te,inContextMenu:de,onContextMenu:ue}=((e,t,n,a,i)=>{const o=(0,c.useRef)(null),[r,s]=(0,c.useState)(!1),d=(0,c.useCallback)(((...e)=>{s(!1),null==n||n(...e)}),[n]),u=(0,c.useCallback)((()=>{s(!1)}),[]);return{contextMenu:(0,c.useMemo)((()=>(0,l.Y)($e,{ref:o,id:0,formData:t,onSelection:d,onClose:u,displayedItems:a,additionalConfig:i})),[i,0,a,t,u,d]),inContextMenu:r,onContextMenu:(e,t,n)=>{var a;null==(a=o.current)||a.open(e,t,n),s(!0)}}})(0,E,Q,Te.DrillBy,J),he=(0,i.d4)((e=>{const t=Object.values(e.dashboardLayout.present).find((e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===a.slice_id}));return(null==t?void 0:t.meta.sliceNameOverride)||(null==t?void 0:t.meta.sliceName)}));(0,c.useEffect)((()=>{if(j){const[e]=(0,ne.Mp)(j);S(!0),I(void 0),(0,r.getChartDataRequest)({formData:j}).then((({response:t,json:n})=>(0,r.handleChartDataResponse)(t,n,e))).then((e=>{I(e)})).catch((()=>{b((0,d.t)("Failed to load chart data."))})).finally((()=>{S(!1)}))}}),[b,j]);const{metadataBar:pe}=(0,Z.M)({dataset:t});return(0,l.Y)(V.aF,{css:H.AH`
        .ant-modal-footer {
          border-top: none;
        }
      `,show:!0,onHide:null!=o?o:()=>null,name:(0,d.t)("Drill by: %s",he),title:(0,d.t)("Drill by: %s",he),footer:(0,l.Y)(ce,{formData:j}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*g.sizeUnit,minWidth:128*g.sizeUnit,defaultSize:{width:"auto",height:"80vh"}},draggable:!0,destroyOnHidden:!0,maskClosable:!1,children:(0,l.FD)(B.s,{vertical:!0,gap:g.sizeUnit,css:H.AH`
          height: 100%;
        `,children:[pe,(0,l.Y)(G.A,{css:H.AH`
            margin-bottom: ${2*g.sizeUnit}px;
          `,items:W,itemRender:(e,t,n,a)=>n.indexOf(e)===n.length-1?(0,l.FD)("span",{"data-test":"drill-by-breadcrumb-item",children:[e.title,a]}):(0,l.Y)("span",{"data-test":"drill-by-breadcrumb-item",role:"button",tabIndex:0,onClick:e.onClick,css:H.AH`
                  cursor: pointer;
                `,children:e.title})}),D,f&&(0,l.Y)(v.R,{}),!f&&!Y&&(0,l.Y)(K.F,{type:"error",message:(0,d.t)("There was an error loading the chart data")}),T===_.Chart&&Y&&(0,l.Y)(ae,{dataset:t,formData:j,result:Y,onContextMenu:ue,inContextMenu:de}),T===_.Table&&Y&&$,te]})})}var ue=n(70542),he=n(83537),pe=n(67429),me=n(38221),ge=n.n(me),ve=n(72391),be=n(87843),fe=n(17355),ye=n(58561),Se=n.n(ye),xe=n(5373),Ce=n(38380),_e=n(35233),Fe=n(28543);const we=(0,ve.a)().get("load.drillby.options"),Ae=Se().encode({columns:["table_name","owners.first_name","owners.last_name","created_by.first_name","created_by.last_name","created_on_humanized","changed_by.first_name","changed_by.last_name","changed_on_humanized","columns.column_name","columns.verbose_name","columns.groupby"]}),De=({drillByConfig:e,formData:t,contextMenuY:n=0,submenuIndex:a=0,onSelection:i=()=>{},onClick:o=()=>{},excludedColumns:r,openNewModal:s=!0,open:p,onDrillBy:g,...b})=>{const f=(0,u.DP)(),{addDangerToast:y}=(0,ee.Yf)(),[S,x]=(0,c.useState)(!0),[C,_]=(0,c.useState)(""),[F,w]=(0,c.useState)(""),[A,D]=(0,c.useState)(),[T,Y]=(0,c.useState)([]),I=(0,c.useRef)(null),$=we||T.length>10,E=(0,c.useCallback)(((t,n)=>{o(t),i(n,e),s&&g&&A&&g(n,A)}),[e,o,i,s,g,A]);(0,c.useEffect)((()=>{var e;p?null==(e=I.current)||null==(e=e.input)||e.focus({preventScroll:!0}):(_(""),w(""))}),[p]);const R=null==e?void 0:e.groupbyFieldName,O=(0,c.useMemo)((()=>{var e;return null==(e=(0,z.A)().get(t.viz_type))?void 0:e.behaviors.find((e=>e===M.nS.DrillBy))}),[t.viz_type]);(0,c.useEffect)((()=>{O&&R&&async function(){const n=Number(t.datasource.split("__")[0]);try{let a;x(!0),a=we?await we(n,t):await(0,_e.w)({endpoint:`/api/v1/dataset/${n}?q=${Ae}`});const{json:i}=a,{result:o}=i;D(o),Y((0,m.A)(o.columns).filter((e=>e.groupby)).filter((n=>{var a,i;return!(0,m.A)(t[null!=(a=null==e?void 0:e.groupbyFieldName)?a:""]).includes(n.column_name)&&n.column_name!==t.x_axis&&(null==(i=(0,m.A)(r))?void 0:i.every((e=>e.column_name!==n.column_name)))})))}catch(e){h.A.error(e),_e.e.delete(`/api/v1/dataset/${n}`),y((0,d.t)("Failed to load dimensions for drill by"))}finally{x(!1)}}()}),[y,null==e?void 0:e.groupbyFieldName,r,t,O,R]);const k=(0,c.useMemo)((()=>ge()((e=>{w(e)}),be.Y.FAST_DEBOUNCE)),[]),L=(0,c.useMemo)((()=>T.filter((e=>(e.verbose_name||e.column_name).toLowerCase().includes(F.toLowerCase())))),[T,F]),U=(0,c.useMemo)((()=>(0,he.Gs)(n,L.length||1,a,200,$?48:0)),[n,L.length,a,$]);let q;return O?R||(q=(0,d.t)("Drill by is not available for this data point")):q=(0,d.t)("Drill by is not yet supported for this chart type"),O&&R?(0,l.Y)(l.FK,{children:(0,l.Y)(N.W1.SubMenu,{title:(0,d.t)("Drill by"),popupClassName:"chart-context-submenu",popupOffset:[0,U],...b,children:(0,l.FD)("div",{"data-test":"drill-by-submenu",children:[$&&(0,l.Y)(fe.A,{ref:I,prefix:(0,l.Y)(Ce.F.SearchOutlined,{iconSize:"l",iconColor:f.colorIcon}),onChange:e=>{var t;e.stopPropagation(),t=e.target.value,_(t),k(t)},placeholder:(0,d.t)("Search columns"),onClick:e=>{e.nativeEvent.stopImmediatePropagation()},allowClear:!0,css:H.AH`
                width: auto;
                max-width: 100%;
                margin: ${2*f.sizeUnit}px ${3*f.sizeUnit}px;
                box-shadow: none;
              `,value:C}),S?(0,l.Y)("div",{css:H.AH`
                padding: ${3*f.sizeUnit}px 0;
              `,children:(0,l.Y)(v.R,{position:"inline-centered"})}):L.length?(0,l.Y)(xe.Y1,{width:"100%",height:200,itemSize:35,itemCount:L.length,itemData:{columns:L,...b},overscanCount:20,children:({index:e,data:t,style:n})=>{const{columns:a,...i}=t,o=a[e];return(0,l.Y)(Fe.oY,{menuKey:`drill-by-item-${o.column_name}`,tooltipText:o.verbose_name||o.column_name,onClick:e=>E(e,o),style:n,...i,children:o.verbose_name||o.column_name})}}):(0,l.Y)(N.W1.Item,{disabled:!0,...b,children:(0,d.t)("No columns found")},"no-drill-by-columns-found")]})},"drill-by-submenu")}):(0,l.Y)(N.W1.Item,{disabled:!0,...b,children:(0,l.FD)("div",{children:[(0,d.t)("Drill by"),(0,l.Y)(pe.C,{title:q})]})},"drill-by-disabled")};var Te,Ye=n(37106);!function(e){e[e.CrossFilter=0]="CrossFilter",e[e.DrillToDetail=1]="DrillToDetail",e[e.DrillBy=2]="DrillBy",e[e.All=3]="All"}(Te||(Te={}));const Ie=({id:e,formData:t,onSelection:n,onClose:a,displayedItems:o=Te.All,additionalConfig:r},s)=>{var h;const g=(0,u.DP)(),v=(0,i.wA)(),{canDrillToDetail:b,canDrillBy:f,canDownload:y}=(0,L.S)(),S=(0,i.d4)((({dashboardInfo:e})=>e.crossFiltersEnabled)),[x,C]=(0,c.useState)([]),[_,F]=(0,c.useState)([]),[w,A]=(0,c.useState)(!1),D=e=>o===Te.All||(0,m.A)(o).includes(e),[{filters:T,clientX:Y,clientY:I},$]=(0,c.useState)({clientX:0,clientY:0}),[E,R]=(0,c.useState)(!1),[O,H]=(0,c.useState)(),[P,W]=(0,c.useState)(!1),[j,V]=(0,c.useState)(),B=(e=>{const t={};return(0,m.A)(null==e?void 0:e.columns).forEach((e=>{t[e.column_name]=e.verbose_name||e.column_name})),(0,m.A)(null==e?void 0:e.metrics).forEach((e=>{t[e.metric_name]=e.verbose_name||e.metric_name})),t})(j),G=(0,c.useCallback)(((e,t)=>{H(e),V(t),W(!0)}),[]),K=(0,c.useCallback)((()=>{W(!1)}),[]),Q=[],J=(0,p.G7)(p.TO.DrillToDetail)&&b&&D(Te.DrillToDetail),X=(0,p.G7)(p.TO.DrillBy)&&f&&D(Te.DrillBy),Z=D(Te.CrossFilter),ee=null==(h=(0,z.A)().get(t.viz_type))||null==(h=h.behaviors)?void 0:h.includes(M.nS.InteractiveChart);let te=0;if(Z&&(te+=1),J&&(te+=2),X&&(te+=1),0===te&&(te=1),Z){var ne;const t=!ee||!S||!(null!=T&&T.crossFilter);let n=null;t?S?ee?null!=T&&T.crossFilter||(n=(0,l.Y)(l.FK,{children:(0,l.Y)("div",{children:(0,d.t)("You can't apply cross-filter on this data point.")})})):n=(0,l.Y)(l.FK,{children:(0,l.Y)("div",{children:(0,d.t)("This visualization type does not support cross-filtering.")})}):n=(0,l.Y)(l.FK,{children:(0,l.Y)("div",{children:(0,d.t)("Cross-filtering is not enabled for this dashboard.")})}):n=(0,l.FD)(l.FK,{children:[(0,l.Y)("div",{children:(0,d.t)("Cross-filter will be applied to all of the charts that use this dataset.")}),(0,l.Y)("div",{children:(0,d.t)("You can also just click on the chart to apply cross-filter.")})]}),Q.push((0,l.FD)(l.FK,{children:[(0,l.Y)(N.W1.Item,{disabled:t,onClick:()=>{null!=T&&T.crossFilter&&v((0,q.Mv)(e,T.crossFilter.dataMask))},children:null!=T&&null!=(ne=T.crossFilter)&&ne.isCurrentValueSelected?(0,d.t)("Remove cross-filter"):(0,l.FD)("div",{children:[(0,d.t)("Add cross-filter"),(0,l.Y)(pe.C,{title:n,color:t?void 0:g.colors.grayscale.base})]})},"cross-filtering-menu-item"),te>1&&(0,l.Y)(N.W1.Divider,{})]}))}if(J&&Q.push((0,l.Y)(ue.k,{formData:t,filters:null==T?void 0:T.drillToDetail,setFilters:F,isContextMenu:!0,contextMenuY:I,onSelection:n,submenuIndex:Z?2:1,setShowModal:R,...(null==r?void 0:r.drillToDetail)||{}})),X){let e=0;Z&&(e+=1),J&&(e+=2),Q.push((0,l.Y)(De,{drillByConfig:null==T?void 0:T.drillBy,onSelection:n,formData:t,contextMenuY:I,submenuIndex:e,open:x.includes("drill-by-submenu"),onDrillBy:G,...(null==r?void 0:r.drillBy)||{}},"drill-by-submenu"))}const ae=(0,c.useCallback)(((t,n,a)=>{var i;const o=(0,he.x4)(n,te);$({clientX:t,clientY:o,filters:a}),null==(i=document.getElementById(`hidden-span-${e}`))||i.click()}),[e,te]);return(0,c.useImperativeHandle)(s,(()=>({open:ae})),[ae]),k.createPortal((0,l.FD)(l.FK,{children:[(0,l.Y)(U.ms,{popupRender:()=>(0,l.Y)(N.W1,{className:"chart-context-menu","data-test":"chart-context-menu",onOpenChange:C,onClick:()=>{A(!1),a()},children:Q.length?Q:(0,l.Y)(N.W1.Item,{disabled:!0,children:(0,d.t)("No actions")})}),trigger:["click"],onOpenChange:e=>{A(e),e||C([])},open:w,children:(0,l.Y)("span",{id:`hidden-span-${e}`,css:{visibility:"hidden",position:"fixed",top:I,left:Y,width:1,height:1}})}),J&&(0,l.Y)(Ye.A,{initialFilters:_,chartId:e,formData:t,showModal:E,onHideModal:()=>{R(!1)}}),P&&O&&j&&(null==T?void 0:T.drillBy)&&(0,l.Y)(de,{column:O,drillByConfig:null==T?void 0:T.drillBy,formData:t,onHideModal:K,dataset:{...j,verbose_map:B},canDownload:y})]}),document.body)},$e=(0,c.forwardRef)(Ie),Ee={annotationData:E().object,actions:E().object,chartId:E().number.isRequired,datasource:E().object,initialValues:E().object,formData:E().object.isRequired,latestQueryFormData:E().object,labelsColor:E().object,labelsColorMap:E().object,height:E().number,width:E().number,setControlValue:E().func,vizType:E().string.isRequired,triggerRender:E().bool,chartAlert:E().string,chartStatus:E().string,queriesResponse:E().arrayOf(E().object),triggerQuery:E().bool,chartIsStale:E().bool,addFilter:E().func,setDataMask:E().func,onFilterMenuOpen:E().func,onFilterMenuClose:E().func,ownState:E().object,postTransformProps:E().func,source:E().oneOf([a.Dashboard,a.Explore]),emitCrossFilters:E().bool},Me={},ze=[M.nS.InteractiveChart],Re={addFilter:()=>Me,onFilterMenuOpen:()=>Me,onFilterMenuClose:()=>Me,initialValues:Me,setControlValue(){},triggerRender:!1};class Oe extends c.Component{constructor(e){var t,n;super(e);const i=null==(t=(0,z.A)().get(null!=(n=e.formData.viz_type)?n:e.vizType))?void 0:t.suppressContextMenu;this.state={showContextMenu:e.source===a.Dashboard&&!i&&(0,p.G7)(p.TO.DrillToDetail),inContextMenu:!1,legendState:void 0,legendIndex:0},this.hasQueryResponseChange=!1,this.contextMenuRef=(0,c.createRef)(),this.handleAddFilter=this.handleAddFilter.bind(this),this.handleRenderSuccess=this.handleRenderSuccess.bind(this),this.handleRenderFailure=this.handleRenderFailure.bind(this),this.handleSetControlValue=this.handleSetControlValue.bind(this),this.handleOnContextMenu=this.handleOnContextMenu.bind(this),this.handleContextMenuSelected=this.handleContextMenuSelected.bind(this),this.handleContextMenuClosed=this.handleContextMenuClosed.bind(this),this.handleLegendStateChanged=this.handleLegendStateChanged.bind(this),this.onContextMenuFallback=this.onContextMenuFallback.bind(this),this.handleLegendScroll=this.handleLegendScroll.bind(this),this.hooks={onAddFilter:this.handleAddFilter,onContextMenu:this.state.showContextMenu?this.handleOnContextMenu:void 0,onError:this.handleRenderFailure,setControlValue:this.handleSetControlValue,onFilterMenuOpen:this.props.onFilterMenuOpen,onFilterMenuClose:this.props.onFilterMenuClose,onLegendStateChanged:this.handleLegendStateChanged,setDataMask:e=>{var t;null==(t=this.props.actions)||t.updateDataMask(this.props.chartId,e)},onLegendScroll:this.handleLegendScroll},this.mutableQueriesResponse=A()(this.props.queriesResponse)}shouldComponentUpdate(e,t){var n;return!(!(e.queriesResponse&&["success","rendered"].indexOf(e.chartStatus)>-1)||null!=(n=e.queriesResponse)&&null!=(n=n[0])&&n.error)&&(!T()(this.state,t)||(this.hasQueryResponseChange=e.queriesResponse!==this.props.queriesResponse,this.hasQueryResponseChange&&(this.mutableQueriesResponse=A()(e.queriesResponse)),this.hasQueryResponseChange||!T()(e.datasource,this.props.datasource)||e.annotationData!==this.props.annotationData||e.ownState!==this.props.ownState||e.filterState!==this.props.filterState||e.height!==this.props.height||e.width!==this.props.width||e.triggerRender||e.labelsColor!==this.props.labelsColor||e.labelsColorMap!==this.props.labelsColorMap||e.formData.color_scheme!==this.props.formData.color_scheme||e.formData.stack!==this.props.formData.stack||e.formData.subcategories!==this.props.formData.subcategories||e.cacheBusterProp!==this.props.cacheBusterProp||e.emitCrossFilters!==this.props.emitCrossFilters))}handleAddFilter(e,t,n=!0,a=!0){this.props.addFilter(e,t,n,a)}handleRenderSuccess(){const{actions:e,chartStatus:t,chartId:n,vizType:a}=this.props;["loading","rendered"].indexOf(t)<0&&e.chartRenderingSucceeded(n),this.hasQueryResponseChange&&e.logEvent(y.tE,{slice_id:n,viz_type:a,start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:y.Vy.getTimestamp()-this.renderStartTime})}handleRenderFailure(e,t){const{actions:n,chartId:a}=this.props;h.A.warn(e),n.chartRenderingFailed(e.toString(),a,t?t.componentStack:null),this.hasQueryResponseChange&&n.logEvent(y.tE,{slice_id:a,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:y.Vy.getTimestamp()-this.renderStartTime})}handleSetControlValue(...e){const{setControlValue:t}=this.props;t&&t(...e)}handleOnContextMenu(e,t,n){this.contextMenuRef.current.open(e,t,n),this.setState({inContextMenu:!0})}handleContextMenuSelected(){this.setState({inContextMenu:!1})}handleContextMenuClosed(){this.setState({inContextMenu:!1})}handleLegendStateChanged(e){this.setState({legendState:e})}onContextMenuFallback(e){this.state.inContextMenu||(e.preventDefault(),this.handleOnContextMenu(e.clientX,e.clientY))}handleLegendScroll(e){this.setState({legendIndex:e})}render(){var e,t;const{chartAlert:n,chartStatus:i,chartId:o,emitCrossFilters:r}=this.props;if("loading"===i||n||null===i)return null;this.renderStartTime=y.Vy.getTimestamp();const{width:s,height:c,datasource:u,annotationData:h,initialValues:p,ownState:m,filterState:g,chartIsStale:v,formData:f,latestQueryFormData:S,postTransformProps:x}=this.props,C=v&&S?S:f,_=C.viz_type||this.props.vizType,F=I()(_),w=_===R.Y.Table?`superset-chart-${F}`:F;let A;const D=(0,d.t)("No results were returned for this query"),T=this.props.source===a.Explore?(0,d.t)("Make sure that the controls are configured properly and the datasource contains data for the selected time range"):void 0,Y="chart.svg";A=s>300&&c>220?(0,l.Y)(b.p,{size:"large",title:D,description:T,image:Y}):(0,l.Y)(b.p,{title:D,image:Y,size:"small"});const $=null!=(e=(0,z.A)().get(f.viz_type))&&e.behaviors.find((e=>e===M.nS.DrillToDetail))?{inContextMenu:this.state.inContextMenu}:{},E=!(null!=f&&f.server_pagination&&((null==m||null==(t=m.searchText)?void 0:t.length)||0)>0);return(0,l.FD)(l.FK,{children:[this.state.showContextMenu&&(0,l.Y)($e,{ref:this.contextMenuRef,id:o,formData:C,onSelection:this.handleContextMenuSelected,onClose:this.handleContextMenuClosed}),(0,l.Y)("div",{onContextMenu:this.state.showContextMenu?this.onContextMenuFallback:void 0,children:(0,l.Y)(O.A,{disableErrorBoundary:!0,id:`chart-id-${o}`,className:w,chartType:_,width:s,height:c,annotationData:h,datasource:u,initialValues:p,formData:C,ownState:m,filterState:g,hooks:this.hooks,behaviors:ze,queriesData:this.mutableQueriesResponse,onRenderSuccess:this.handleRenderSuccess,onRenderFailure:this.handleRenderFailure,noResults:A,postTransformProps:x,emitCrossFilters:r,legendState:this.state.legendState,enableNoResults:E,legendIndex:this.state.legendIndex,...$},`${o}`)})]})}}Oe.propTypes=Ee,Oe.defaultProps=Re;const ke=Oe;var Ne=n(71478);const Le=({chartId:e,error:t,...n})=>{const{result:a}=(0,Ne.RG)(e),i=t&&{...t,extra:{...t.extra,owners:a}};return(0,l.Y)(f.x6,{...n,error:i,title:"Data error"})};var Ue=n(21357);const qe={},He=(0,d.t)("The dataset associated with this chart no longer exists"),Pe={addFilter:()=>qe,onFilterMenuOpen:()=>qe,onFilterMenuClose:()=>qe,initialValues:qe,setControlValue:()=>qe,triggerRender:!1,dashboardId:void 0,chartStackTrace:void 0,force:!1,isInView:!0},We=u.I4.div`
  min-height: ${e=>e.height}px;
  position: relative;

  .chart-tooltip {
    opacity: 0.75;
    font-size: ${({theme:e})=>e.fontSizeSM}px;
  }

  .slice_container {
    display: flex;
    flex-direction: column;
    justify-content: center;

    height: ${e=>e.height}px;

    .pivot_table tbody tr {
      font-feature-settings: 'tnum' 1;
    }

    .alert {
      margin: ${({theme:e})=>2*e.sizeUnit}px;
    }
  }
`,je=u.I4.div`
  position: absolute;
  left: 50%;
  top: 50%;
  width: 80%;
  transform: translate(-50%, -50%);
`,Ve=u.I4.span`
  display: block;
  text-align: center;
  margin: ${({theme:e})=>4*e.sizeUnit}px auto;
  width: fit-content;
  color: ${({theme:e})=>e.colors.grayscale.base};
`;class Be extends c.PureComponent{constructor(e){super(e),this.renderStartTime=void 0,this.handleRenderContainerFailure=this.handleRenderContainerFailure.bind(this)}componentDidMount(){this.props.triggerQuery&&this.runQuery()}componentDidUpdate(){this.props.triggerQuery&&this.runQuery()}runQuery(){this.props.actions.postChartFormData(this.props.formData,Boolean(this.props.force||(0,x.P3)(S.vX.force)),this.props.timeout,this.props.chartId,this.props.dashboardId,this.props.ownState)}handleRenderContainerFailure(e,t){const{actions:n,chartId:a}=this.props;h.A.warn(e),n.chartRenderingFailed(e.toString(),a,t?t.componentStack:null),n.logEvent(y.tE,{slice_id:a,has_err:!0,error_details:e.toString(),start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:y.Vy.getTimestamp()-this.renderStartTime})}renderErrorMessage(e){var t;const{chartId:n,chartAlert:i,chartStackTrace:o,datasource:r,dashboardId:s,height:c,datasetsStatus:d}=this.props,u=null==e||null==(t=e.errors)?void 0:t[0],h=i||(null==e?void 0:e.message);return void 0!==i&&i!==He&&r===g.As&&d!==F.bk.Error?(0,l.Y)(We,{"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:c,children:(0,l.Y)(v.R,{})},n):(0,l.Y)(Le,{chartId:n,error:u,subtitle:h,link:e?e.link:void 0,source:s?a.Dashboard:a.Explore,stackTrace:o},n)}renderSpinner(e){const t=e?(0,d.t)("Waiting on %s",e):(0,d.t)("Waiting on database...");return(0,l.FD)(je,{children:[(0,l.Y)(v.R,{position:"inline-centered"}),(0,l.Y)(Ve,{children:t})]})}renderChartContainer(){return(0,l.Y)("div",{className:"slice_container","data-test":"slice-container",children:this.props.isInView||!(0,p.G7)(p.TO.DashboardVirtualization)||(0,C.a)()?(0,l.Y)(ke,{...this.props,source:this.props.dashboardId?"dashboard":"explore","data-test":this.props.vizType}):(0,l.Y)(v.R,{})})}render(){var e;const{height:t,chartAlert:n,chartStatus:a,datasource:i,errorMessage:o,chartIsStale:r,queriesResponse:s=[],width:c}=this.props,u=null==i||null==(e=i.database)?void 0:e.name,h="loading"===a;return"failed"===a?s.map((e=>this.renderErrorMessage(e))):o&&0===(0,m.A)(s).length?(0,l.Y)(b.p,{size:"large",title:(0,d.t)("Add required control values to preview chart"),description:(0,Ue.w)(!0),image:"chart.svg"}):h||n||o||!r||0!==(0,m.A)(s).length?(0,l.Y)(f.tH,{onError:this.handleRenderContainerFailure,showMessage:!1,children:(0,l.Y)(We,{"data-ui-anchor":"chart",className:"chart-container","data-test":"chart-container",height:t,width:c,children:h?this.renderSpinner(u):this.renderChartContainer()})}):(0,l.Y)(b.p,{size:"large",title:(0,d.t)("Your chart is ready to go!"),description:(0,l.FD)("span",{children:[(0,d.t)('Click on "Create chart" button in the control panel on the left to preview a visualization or')," ",(0,l.Y)("span",{role:"button",tabIndex:0,onClick:this.props.onQuery,children:(0,d.t)("click here")}),"."]}),image:"chart.svg"})}}Be.defaultProps=Pe;const Ge=Be,Ke=(0,i.Ng)(null,(function(e){return{actions:(0,o.zH)({...r,updateDataMask:q.Mv,logEvent:s.logEvent},e)}}))(Ge)},17093:(e,t,n)=>{n.d(t,{A:()=>s,t:()=>i});var a=n(95483);const i={SIMPLE:"SIMPLE",SQL:"SQL"};function o(e){if(e.sqlExpression&&a.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),n=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&n>0)return e.sqlExpression.substring(n+1,t)}return null}function r(e){if(e.sqlExpression&&a.Vw.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class s{constructor(e){if(this.expressionType=e.expressionType||i.SIMPLE,this.expressionType===i.SIMPLE){const t=o(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||r(e),this.sqlExpression=null}else this.expressionType===i.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null);this.datasourceWarning=!!e.datasourceWarning,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){return this.translateToSql({useVerboseName:!0})}translateToSql(e={useVerboseName:!1,transformCountDistinct:!1}){if(this.expressionType===i.SIMPLE){var t,n;const i=this.aggregate||"",o=e.useVerboseName&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(n=this.column)&&n.column_name?`(${this.column.column_name})`:"";return e.transformCountDistinct&&i===a.dq.COUNT_DISTINCT&&/^\(.*\)$/.test(o)?`COUNT(DISTINCT ${o.slice(1,-1)})`:i+o}return this.expressionType===i.SQL?this.sqlExpression:""}duplicateWith(e){return new s({...this,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===i.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===i.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return r(this)}inferSqlExpressionColumn(){return o(this)}}},17432:(e,t,n)=>{n.d(t,{A:()=>p});var a=n(2445),i=n(96540),o=n(72234),r=n(62952),s=n(51436),l=n(95579),c=n(52879),d=n(2514),u=n(91643);const h=o.I4.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,p=({latestQueryFormData:e})=>{const[t,n]=(0,i.useState)([]),[o,p]=(0,i.useState)(!1),[m,g]=(0,i.useState)(null);return(0,i.useEffect)((()=>{p(!0),(0,d.getChartDataRequest)({formData:e,resultFormat:"json",resultType:"query"}).then((({json:e})=>{n((0,r.A)(e.result)),p(!1),g(null)})).catch((e=>{(0,s.h4)(e).then((({error:t,message:n})=>{g(t||n||e.statusText||(0,l.t)("Sorry, An error occurred")),p(!1)}))}))}),[JSON.stringify(e)]),o?(0,a.Y)(c.R,{}):m?(0,a.Y)("pre",{children:m}):(0,a.Y)(h,{children:t.map((t=>t.query?(0,a.Y)(u.A,{datasource:e.datasource,sql:t.query,language:"sql"}):null))})}},21062:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(5556),i=n.n(a);const o=i().shape({column_name:i().string.isRequired,type:i().string})},21357:(e,t,n)=>{n.d(t,{w:()=>r});var a=n(95579);const i=(0,a.t)("Create chart"),o=(0,a.t)("Update chart"),r=e=>(0,a.t)("Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.",`"${e?i:o}"`)},25671:(e,t,n)=>{n.d(t,{A:()=>R});var a=n(96540),i=n(5556),o=n.n(i),r=n(35742),s=n(5362),l=n(95579),c=n(62952),d=n(98837),u=n(50317),h=n(8901),p=n(32291),m=n(17093),g=n(95483),v=n(84064),b=n(72652),f=n(38380),y=n(84335),S=n(8972),x=n(2445),C=n(28254),_=n(59638);function F({adhocFilter:e,options:t,datasource:n,onFilterEdit:a,onRemoveFilter:i,partitionColumn:o,onMoveLabel:r,onDropLabel:s,index:l,sections:c,operators:d}){const{actualTimeRange:u,title:h}=(0,_.K)(e);return(0,x.Y)(S.A,{sections:c,operators:d,adhocFilter:e,options:t,datasource:n,onFilterEdit:a,partitionColumn:o,children:(0,x.Y)(b.Px,{label:null!=u?u:e.getDefaultLabel(),tooltipTitle:null!=h?h:e.getTooltipTitle(),onRemove:i,onMoveLabel:r,onDropLabel:s,index:l,type:C.S.FilterOption,withCaret:!0,isExtra:e.isExtra})})}var w=n(90422),A=n(2511);const D=o().oneOfType([o().shape({expressionType:o().oneOf([A.A.Simple]).isRequired,clause:o().oneOf([A.v.Having,A.v.Where]).isRequired,subject:o().string.isRequired,comparator:o().oneOfType([o().string,o().arrayOf(o().string)]).isRequired}),o().shape({expressionType:o().oneOf([A.A.Sql]).isRequired,clause:o().oneOf([A.v.Where,A.v.Having]).isRequired,sqlExpression:o().string.isRequired})]);var T=n(21062),Y=n(32132);const{warning:I}=y.aF,$=o().oneOfType([o().string,h.A]),E={label:o().oneOfType([o().object,o().string]),name:o().string,sections:o().arrayOf(o().string),operators:o().arrayOf(o().string),onChange:o().func,value:o().arrayOf(D),datasource:o().object,columns:o().arrayOf(T.A),savedMetrics:o().arrayOf(p.A),selectedMetrics:o().oneOfType([$,o().arrayOf($)]),isLoading:o().bool,canDelete:o().func};function M(e){return e&&!(e instanceof w.A)&&e.expressionType}class z extends a.Component{constructor(e){super(e),this.optionsForSelect=this.optionsForSelect.bind(this),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this),this.removeFilter=this.removeFilter.bind(this);const t=(this.props.value||[]).map((e=>M(e)?new w.A(e):e));this.optionRenderer=e=>(0,x.Y)(v.A,{option:e}),this.valueRenderer=(e,t)=>(0,x.Y)(F,{index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:e=>{e.stopPropagation(),this.onRemoveFilter(t)},onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn},t),this.state={values:t,options:this.optionsForSelect(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const n=null==(t=e.database)?void 0:t.id,{datasource_name:a,catalog:i,schema:o,is_sqllab_view:l}=e;!l&&n&&a&&o&&r.A.get({endpoint:`/api/v1/database/${n}/table_metadata/extra/${(0,Y.zJ)({name:a,catalog:i,schema:o})}`}).then((({json:e})=>{if(e&&e.partitions){const{partitions:t}=e;t&&t.cols&&1===Object.keys(t.cols).length&&this.setState({partitionColumn:t.cols[0]})}})).catch((e=>{s.A.error("fetch extra_table_metadata:",e.statusText)}))}}UNSAFE_componentWillReceiveProps(e){this.props.columns!==e.columns&&this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((e=>M(e)?new w.A(e):e))})}removeFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState((e=>({...e,values:t}))),this.props.onChange(t)}onRemoveFilter(e){const{canDelete:t}=this.props,{values:n}=this.state,a=null==t?void 0:t(n[e],n);"string"!=typeof a?this.removeFilter(e):I({title:(0,l.t)("Warning"),content:a})}onNewFilter(e){const t=this.mapOption(e);t&&this.setState((e=>({...e,values:[...e.values,t]})),(()=>{this.props.onChange(this.state.values)}))}onFilterEdit(e){this.props.onChange(this.state.values.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}onChange(e){const t=(e||[]).map((e=>this.mapOption(e))).filter((e=>e));this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find((t=>t.metric_name===e)).expression}moveLabel(e,t){const{values:n}=this.state,a=[...n];[a[t],a[e]]=[a[e],a[t]],this.setState({values:a})}mapOption(e){return e instanceof w.A?e:e.saved_metric_name?new w.A({expressionType:A.A.Sql,subject:this.getMetricExpression(e.saved_metric_name),operator:g.nS[g.ux.GreaterThan].operation,comparator:0,clause:A.v.Having}):e.label?new w.A({expressionType:A.A.Sql,subject:new m.A(e).translateToSql(),operator:g.nS[g.ux.GreaterThan].operation,comparator:0,clause:A.v.Having}):e.column_name?new w.A({expressionType:A.A.Simple,subject:e.column_name,operator:g.nS[g.ux.Equals].operation,comparator:"",clause:A.v.Where,isNew:!0}):null}optionsForSelect(e){return[...e.columns,...(0,c.A)(e.selectedMetrics).map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new m.A(e))))].filter((e=>e)).reduce(((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof m.A&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)))}addNewFilterPopoverTrigger(e){return(0,x.Y)(S.A,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new w.A({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn,children:e})}render(){return(0,x.FD)("div",{className:"metrics-select","data-test":"adhoc-filter-control",children:[(0,x.Y)(b.B3,{children:(0,x.Y)(u.A,{...this.props})}),(0,x.Y)(b.p6,{children:[...this.state.values.length>0?this.state.values.map(((e,t)=>this.valueRenderer(e,t))):[],this.addNewFilterPopoverTrigger((0,x.FD)(b.JG,{role:"button","data-test":"add-filter-button",children:[(0,x.Y)(f.F.PlusOutlined,{iconSize:"m"}),(0,l.t)("Add filter")]}))]})]})}}z.propTypes=E,z.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const R=(0,d.b)(z)},28254:(e,t,n)=>{var a;n.d(t,{S:()=>a}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(a||(a={}))},28274:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(67553);const i=["AND","AS","ASC","AVG","BY","CASE","COUNT","CREATE","CROSS","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","ELSE","END","FOREIGN","FROM","GRANT","GROUP","HAVING","IF","INNER","INSERT","JOIN","KEY","LEFT","LIMIT","MAX","MIN","NATURAL","NOT","NULL","OFFSET","ON","OR","ORDER","OUTER","PRIMARY","REFERENCES","RIGHT","SELECT","SUM","TABLE","THEN","TYPE","UNION","UPDATE","WHEN","WHERE"].concat(["BIGINT","BINARY","BIT","CHAR","DATE","DECIMAL","DOUBLE","FLOAT","INT","INTEGER","MONEY","NUMBER","NUMERIC","REAL","SET","TEXT","TIMESTAMP","VARCHAR"]).map((e=>({meta:"sql",name:e,score:a.lI,value:e})))},28543:(e,t,n)=>{n.d(t,{oY:()=>l});var a=n(2445),i=(n(96540),n(37827)),o=n(17437),r=n(26196),s=n(97470);const l=({tooltipText:e,children:t,onClick:n,style:l,menuKey:c})=>{const[d,u]=(0,i.A)();return(0,a.Y)(r.W1.Item,{css:o.AH`
        display: flex;
        line-height: 1.5em;
      `,onClick:n,style:l,children:(0,a.Y)(s.m,{title:u?e:null,children:(0,a.Y)("div",{ref:d,css:o.AH`
            max-width: 100%;
            ${i.P};
          `,children:t})})},c)}},32291:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(5556),i=n.n(a);const o=i().shape({metric_name:i().string,verbose_name:i().string,expression:i().string})},35233:(e,t,n)=>{n.d(t,{e:()=>o,w:()=>r});var a=n(35742),i=n(43859);const o=new Map,r=(0,i.K)(a.A.get,o,(({endpoint:e})=>e||""))},37106:(e,t,n)=>{n.d(t,{A:()=>V});var a=n(2445),i=n(96540),o=n(61574),r=n(72234),s=n(95579),l=n(17437),c=n(15509),d=n(84335),u=n(61225),h=n(94229),p=n(84666),m=n(87903),g=n(62952),v=n(98250),b=n(87843);const f=function({value:e}){return(0,a.Y)("span",{children:e?b.Y.BOOL_TRUE_DISPLAY:b.Y.BOOL_FALSE_DISPLAY})},y=r.I4.span`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,S=function(){return(0,a.Y)(y,{children:b.Y.NULL_DISPLAY})};var x=n(85170),C=n(7349);const _=function({format:e=x.A.DATABASE_DATETIME,value:t}){return t?(0,a.Y)("span",{children:(0,C.mo)(e).format(t)}):(0,a.Y)(S,{})};var F=n(52879),w=n(33535),A=n(2514),D=n(16537),T=n(20900),Y=n(19834),I=n(38380);const $=function(e){const{headerTitle:t,groupTitle:n,groupOptions:o,value:s,onChange:c}=e,d=(0,r.DP)(),[u,h]=(0,i.useState)(!1);return(0,a.FD)("div",{css:l.AH`
        display: flex;
        align-items: center;
      `,children:[(0,a.Y)(T.A,{trigger:"click",open:u,content:(0,a.FD)("div",{children:[(0,a.Y)("div",{css:l.AH`
                font-weight: ${d.fontWeightStrong};
                margin-bottom: ${d.sizeUnit}px;
              `,children:n}),(0,a.Y)(Y.s.GroupWrapper,{spaceConfig:{direction:"vertical",size:4,wrap:!1,align:"start"},value:s,onChange:e=>{c(e.target.value),h(!1)},options:o})]}),placement:"bottomLeft",arrow:{pointAtCenter:!0},children:(0,a.Y)(I.F.SettingOutlined,{iconSize:"m",iconColor:d.colors.grayscale.light1,css:l.AH`
            margin-top: ${.75*d.sizeUnit}px;
            margin-right: ${d.sizeUnit}px;
          `,onClick:()=>h(!0)})}),t]})};var E=n(86274),M=n(55976),z=n(75848),R=n(70700),O=n(81917);function k({filters:e,setFilters:t,totalCount:n,loading:o,onReload:c}){const d=(0,r.DP)(),u=(0,i.useMemo)((()=>Object.assign({},...e.map((e=>({[(0,R.q0)(e.col)?e.col.label:e.col]:e}))))),[e]),h=(0,i.useCallback)((e=>{const n={...u};delete n[e],t([...Object.values(n)])}),[u,t]),p=(0,i.useMemo)((()=>Object.entries(u).map((([e,{val:t,formattedVal:n}])=>({colName:e,val:null!=n?n:t}))).sort(((e,t)=>e.colName.localeCompare(t.colName)))),[u]);return(0,a.FD)("div",{css:l.AH`
        display: flex;
        justify-content: space-between;
        padding: ${d.sizeUnit/2}px 0;
        margin-bottom: ${2*d.sizeUnit}px;
      `,children:[(0,a.Y)("div",{css:l.AH`
          display: flex;
          flex-wrap: wrap;
        `,children:p.map((({colName:e,val:t},n)=>(0,a.FD)(z.v,{editable:!0,onDelete:h.bind(null,e),index:n,id:n,name:`${e}=${t}`,"data-test":"filter-col",children:[(0,a.Y)("span",{css:l.AH`
                margin-right: ${d.sizeUnit}px;
              `,children:e}),(0,a.Y)("strong",{"data-test":"filter-val",children:t})]},e)))}),(0,a.FD)("div",{css:l.AH`
          display: flex;
          align-items: center;
          height: min-content;
        `,children:[(0,a.Y)(O.A,{loading:o&&!n,rowcount:n}),(0,a.Y)(I.F.ReloadOutlined,{iconColor:d.colors.grayscale.light1,iconSize:"l","aria-label":(0,s.t)("Reload"),role:"button",onClick:c})]})]})}var N=n(90179),L=n.n(N),U=n(26632);const q=50;function H({children:e}){const{ref:t,height:n}=(0,v.uZ)();return(0,a.Y)("div",{ref:t,css:{flex:1},children:(0,i.cloneElement)(e,{height:n})})}var P;function W({formData:e,initialFilters:t}){var n;const o=(0,r.DP)(),[c,d]=(0,i.useState)(0),h=(0,i.useRef)(c),[p,v]=(0,i.useState)(t),[b,y]=(0,i.useState)(!1),[x,C]=(0,i.useState)(""),[T,Y]=(0,i.useState)(new Map),[I,z]=(0,i.useState)({}),R=(0,u.d4)((e=>e.common.conf.SAMPLES_ROW_LIMIT)),[O,N]=(0,i.useMemo)((()=>e.datasource.split("__")),[e.datasource]),{metadataBar:W,status:j}=(0,M.M)({datasetId:O}),V=(0,i.useMemo)((()=>{const e=T.get(c);return e?(h.current=c,e):T.get(h.current)}),[c,T]),B=(0,i.useMemo)((()=>(null==V?void 0:V.colNames.map(((e,t)=>({key:e,dataIndex:e,title:(null==V?void 0:V.colTypes[t])===m.s.Temporal?(0,a.Y)($,{headerTitle:e,groupTitle:(0,s.t)("Formatting"),groupOptions:[{label:(0,s.t)("Original value"),value:P.Original},{label:(0,s.t)("Formatted value"),value:P.Formatted}],value:I[e]===P.Original?P.Original:P.Formatted,onChange:t=>z((n=>({...n,[e]:parseInt(t,10)})))}):e,render:n=>!0===n||!1===n?(0,a.Y)(f,{value:n}):null===n?(0,a.Y)(S,{}):(null==V?void 0:V.colTypes[t])===m.s.Temporal&&I[e]!==P.Original&&("number"==typeof n||n instanceof Date)?(0,a.Y)(_,{value:n}):String(n),width:150}))))||[]),[null==V?void 0:V.colNames,null==V?void 0:V.colTypes,I]),G=(0,i.useMemo)((()=>(null==V?void 0:V.data.map(((e,t)=>null==V?void 0:V.colNames.reduce(((t,n)=>({...t,[n]:e[n]})),{key:t}))))||[]),[null==V?void 0:V.colNames,null==V?void 0:V.data]),K=(0,i.useCallback)((()=>{C(""),Y(new Map),d(0)}),[]);(0,i.useEffect)((()=>{C(""),Y(new Map),d(0)}),[p]),(0,i.useEffect)((()=>{if(T.has(c)&&[...T.keys()].at(-1)!==c){const e=new Map(T);e.delete(c),Y(e.set(c,T.get(c)))}}),[c,T]),(0,i.useEffect)((()=>{if(!x&&!b&&!T.has(c)){var t;y(!0);const n=null!=(t=function(e,t){if(!e)return;const n=(0,U.A)(e),a=L()(n.extras,"having"),i=[...(0,g.A)(n.filters),...(0,g.A)(t).map((e=>L()(e,"formattedVal")))];return{granularity:n.granularity,time_range:n.time_range,filters:i,extras:a}}(e,p))?t:{},a=Math.ceil(R/q);(0,A.getDatasourceSamples)(N,O,!1,n,q,c+1).then((e=>{Y(new Map([...[...T.entries()].slice(1-a),[c,{total:e.total_count,data:e.data,colNames:(0,g.A)(e.colnames),colTypes:(0,g.A)(e.coltypes)}]])),C("")})).catch((e=>{C(`${e.name}: ${e.message}`)})).finally((()=>{y(!1)}))}}),[R,O,N,p,e,b,c,x,T]);const Q=!x&&!T.size||j===E.bk.Loading,J=null==(n=e.allow_render_html)||n;let X=null;if(x)X=(0,a.Y)("pre",{css:l.AH`
          margin-top: ${4*o.sizeUnit}px;
        `,children:x});else if(Q)X=(0,a.Y)(F.R,{});else if(0===(null==V?void 0:V.total)){const e=(0,s.t)("No rows were returned for this dataset");X=(0,a.Y)(w.p,{image:"document.svg",title:e})}else X=(0,a.Y)(H,{children:(0,a.Y)(D.Ay,{data:G,columns:B,size:D.QS.Small,defaultPageSize:q,recordCount:null==V?void 0:V.total,usePagination:!0,loading:b,onChange:e=>d(e.current?e.current-1:0),resizable:!0,virtualize:!0,allowHTML:J})});return(0,a.FD)(a.FK,{children:[!Q&&W,!Q&&(0,a.Y)(k,{filters:p,setFilters:v,totalCount:null==V?void 0:V.total,loading:b,onReload:K}),X]})}!function(e){e[e.Original=0]="Original",e[e.Formatted=1]="Formatted"}(P||(P={}));const j=({canExplore:e,closeModal:t,exploreChart:n})=>{const i=(0,r.DP)();return(0,a.FD)(a.FK,{children:[(0,a.Y)(c.$,{buttonStyle:"secondary",buttonSize:"small",onClick:n,disabled:!e,tooltip:e?void 0:(0,s.t)("You do not have sufficient permissions to edit the chart"),children:(0,s.t)("Edit chart")}),(0,a.Y)(c.$,{buttonStyle:"primary",buttonSize:"small",onClick:t,"data-test":"close-drilltodetail-modal",css:l.AH`
          margin-left: ${2*i.sizeUnit}px;
        `,children:(0,s.t)("Close")})]})};function V({chartId:e,formData:t,initialFilters:n,showModal:c,onHideModal:m}){const g=(0,r.DP)(),v=(0,o.W6)(),b=(0,i.useContext)(h.DashboardPageIdContext),{slice_name:f}=(0,u.d4)((t=>{var n;return(null==(n=t.sliceEntities)||null==(n=n.slices)?void 0:n[e])||{}})),y=(0,u.d4)((e=>{var t;return(0,p.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),S=(0,i.useMemo)((()=>`/explore/?dashboard_page_id=${b}&slice_id=${e}`),[e,b]),x=(0,i.useCallback)((()=>{v.push(S)}),[S,v]);return(0,a.Y)(d.aF,{show:c,onHide:null!=m?m:()=>null,css:l.AH`
        .ant-modal-body {
          display: flex;
          flex-direction: column;
        }
      `,name:(0,s.t)("Drill to detail: %s",f),title:(0,s.t)("Drill to detail: %s",f),footer:(0,a.Y)(j,{exploreChart:x,canExplore:y}),responsive:!0,resizable:!0,resizableConfig:{minHeight:128*g.sizeUnit,minWidth:128*g.sizeUnit,defaultSize:{width:"auto",height:"75vh"}},draggable:!0,destroyOnHidden:!0,maskClosable:!1,children:(0,a.Y)(W,{formData:t,initialFilters:n})})}},39091:(e,t,n)=>{n.d(t,{$r:()=>E,TN:()=>w,XS:()=>z,ZY:()=>A,i8:()=>F});var a=n(38221),i=n.n(a),o=n(2445),r=n(96540),s=n(72234),l=n(95579),c=n(17437),d=n(7349),u=n(85170),h=n(87903),p=n(58642),m=n(15509),g=n(38380),v=n(87843),b=n(17355),f=n(19834),y=n(20900),S=n(44344),x=n(15151),C=n(86832);const _=(0,s.I4)("span")`
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,F=(0,s.I4)(m.$)`
  font-size: ${({theme:e})=>e.fontSizeSM}px;

  // needed to override button's first-of-type margin: 0
  && {
    margin: 0 ${({theme:e})=>2*e.sizeUnit}px;
  }

  i {
    padding: 0 ${({theme:e})=>e.sizeUnit}px;
  }
`,w=({data:e,columns:t})=>(0,o.Y)(S.$r,{text:e&&t?(0,x.L)(e,t):"",wrapped:!1,copyNode:(0,o.Y)(g.F.CopyOutlined,{iconSize:"l","aria-label":(0,l.t)("Copy"),role:"button",css:c.AH`
          &.anticon > * {
            line-height: 0;
          }
        `})}),A=({onChangeHandler:e,shouldFocus:t=!1})=>{const n=(0,r.useRef)(null);(0,r.useEffect)((()=>{n.current&&t&&n.current.focus()}),[]);const a=(0,s.DP)(),d=i()(e,v.Y.SLOW_DEBOUNCE);return(0,o.Y)(b.A,{prefix:(0,o.Y)(g.F.SearchOutlined,{iconSize:"l"}),placeholder:(0,l.t)("Search"),onChange:e=>{const t=e.target.value;d(t)},css:c.AH`
        width: 200px;
        margin-right: ${2*a.sizeUnit}px;
      `,ref:n})};var D;!function(e){e.Formatted="formatted",e.Original="original"}(D||(D={}));const T=({onChange:e,value:t})=>(0,o.Y)(f.s.GroupWrapper,{spaceConfig:{direction:"vertical",align:"start",size:15,wrap:!1},size:"large",value:t,onChange:e,options:[{label:(0,l.t)("Formatted date"),value:D.Formatted},{label:(0,l.t)("Original value"),value:D.Original}]}),Y=s.I4.div`
  display: flex;
  flex-direction: column;

  padding: ${({theme:e})=>4*e.sizeUnit+"px"};
`,I=s.I4.span`
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>2*e.sizeUnit}px;
`,$=({columnName:e,onTimeColumnChange:t,datasourceId:n,isOriginalTimeColumn:a})=>{const i=(0,s.DP)(),c=n=>{t(e,n.target.value)},d=(0,r.useMemo)((()=>n?(0,o.FD)(Y,{onClick:e=>e.stopPropagation(),children:[(0,o.Y)(I,{children:(0,l.t)("Column Formatting")}),(0,o.Y)(T,{onChange:c,value:a?D.Original:D.Formatted})]}):null),[n,a]);return n?(0,o.FD)("span",{children:[(0,o.Y)(y.A,{trigger:"click",content:d,placement:"bottomLeft",arrow:{pointAtCenter:!0},children:(0,o.Y)(g.F.SettingOutlined,{iconSize:"m",iconColor:i.colors.grayscale.light1,css:{marginRight:`${i.sizeUnit}px`},onClick:e=>e.stopPropagation()})}),e]}):(0,o.Y)("span",{children:e})},E=(e,t)=>{const n=(0,r.useMemo)((()=>{var e;return null!=(e=null==t?void 0:t.map((e=>Object.values(e).map((e=>e?e.toString().toLowerCase():(0,l.t)("N/A"))))))?e:[]}),[t]);return(0,r.useMemo)((()=>null!=t&&t.length?t.filter(((t,a)=>n[a].some((t=>null==t?void 0:t.includes(e.toLowerCase()))))):[]),[t,e,n])},M=(0,d.mo)(u.A.DATABASE_DATETIME),z=(e,t,n,a,i,s,l)=>{const[c,d]=(0,r.useState)((0,C.p)(a)),u=(e,t)=>{if(a)if(t!==D.Original||c.includes(e)){if(t===D.Formatted&&c.includes(e)){const t=(0,C.p)(a);t.splice(t.indexOf(e),1),(0,C.J)(a,t),d(t)}}else{const t=(0,C.p)(a);t.push(e),(0,C.J)(a,t),d(t)}};return(0,r.useEffect)((()=>{i&&d((0,C.p)(a))}),[a,i]),(0,r.useMemo)((()=>e&&null!=n&&n.length?e.filter((e=>Object.keys(n[0]).includes(e))).map(((e,i)=>{const r=null==t?void 0:t[i],d=n[0][e],m=r===h.s.Temporal?c.indexOf(e):-1,g=c.includes(e);return{id:e||i,accessor:t=>t[e],Header:r===h.s.Temporal&&"string"!=typeof d?(0,o.Y)($,{columnName:e,datasourceId:a,onTimeColumnChange:u,isOriginalTimeColumn:g}):e,Cell:({value:e})=>!0===e?v.Y.BOOL_TRUE_DISPLAY:!1===e?v.Y.BOOL_FALSE_DISPLAY:null===e?(0,o.Y)(_,{children:v.Y.NULL_DISPLAY}):r===h.s.Temporal&&-1===m&&"number"==typeof e?M(e):"string"==typeof e&&l?(0,p.nn)(e):String(e),...null==s?void 0:s[e]}})):[]),[e,n,t,a,s,c])}},40104:(e,t,n)=>{n.d(t,{Kg:()=>g,J8:()=>p,Pz:()=>v,tg:()=>u,pY:()=>h,px:()=>m});var a=n(96627),i=n(58863),o=n(95579),r=n(88488);const s=e=>null!=e&&"function"==typeof e[Symbol.iterator];var l=n(49588),c=n(38708);const d=()=>{var e;const t=(0,c.Ay)();return(null==t||null==(e=t.common)||null==(e=e.conf)?void 0:e.NATIVE_FILTER_DEFAULT_ROW_LIMIT)||1e3},u=({datasetId:e,dependencies:t={},groupby:n,defaultDataMask:a,controlValues:i,filterType:o,sortMetric:s,adhoc_filters:l,time_range:c,granularity_sqla:u,type:h,dashboardId:p,id:m})=>{var g;const v={};return e&&(v.datasource=`${e}__table`),n&&(v.groupby=[n]),s&&(v.sortMetric=s),{...i,...v,adhoc_filters:null!=l?l:[],extra_filters:[],extra_form_data:t,granularity_sqla:u,metrics:["count"],row_limit:d(),showSearch:!0,defaultValue:null==a||null==(g=a.filterState)?void 0:g.value,time_range:c,url_params:(0,r.A)("regular"),inView:!0,viz_type:o,type:h,dashboardId:p,native_filter_id:m}};function h(e={},t={}){const n={};return a.t1.forEach((a=>{const i=e[a],o=t[a],r=[...s(i)?i:[],...s(o)?o:[]];r.length&&(n[a]=r)})),a.zk.forEach((a=>{const i=e[a];void 0!==i&&(n[a]=i);const o=t[a];void 0!==o&&(n[a]=o)})),n}function p(e,t){let n={};return t.forEach((t=>{var a,i;n=h(n,null!=(a=null==(i=e[t])?void 0:i.extraFormData)?a:{})})),n}function m(e){return!e.includes(i.nS.NativeFilter)||e.includes(i.nS.InteractiveChart)}const g=(e,t)=>new Set(t.map((t=>{var n;return null==(n=e.find((e=>{var n;return(null==e||null==(n=e.meta)?void 0:n.chartId)===t})))||null==(n=n.parents)?void 0:n.filter((e=>e.startsWith(`${l.B8}-`)))})).filter((e=>void 0!==e)).flat()),v=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,o.t)("Unknown value")},48422:(e,t,n)=>{n.d(t,{w:()=>r});var a=n(96540),i=n(43561);const o=new BroadcastChannel("tab_id_channel");function r(){const[e,t]=(0,a.useState)();return(0,a.useEffect)((()=>{if(!function(){try{return window.localStorage&&window.sessionStorage}catch(e){return!1}}())return void(e||t((0,i.Ak)()));const n=()=>{let e;try{e=window.localStorage.getItem("last_tab_id")}catch(e){}const n=String(e?Number.parseInt(e,10)+1:1);try{window.sessionStorage.setItem("tab_id",n),window.localStorage.setItem("last_tab_id",n)}catch(e){}t(n)};let a;try{a=window.sessionStorage.getItem("tab_id")}catch(e){}a?(o.postMessage({type:"REQUESTING_TAB_ID",tabId:a}),t(a)):n(),o.onmessage=t=>{if(t.data.tabId===e)if("REQUESTING_TAB_ID"===t.data.type){const e={type:"TAB_ID_DENIED",tabId:t.data.tabId};o.postMessage(e)}else"TAB_ID_DENIED"===t.data.type&&n()}}),[e]),e}},48760:(e,t,n)=>{n.d(t,{k:()=>r});var a=n(90179),i=n.n(a);const o=["url_params"],r=e=>i()(e,o)},53860:(e,t,n)=>{n.d(t,{S:()=>o});var a=n(61225),i=n(84666);const o=()=>{const e=(0,a.d4)((e=>{var t;return(0,i.L)("can_explore","Superset",null==(t=e.user)?void 0:t.roles)})),t=(0,a.d4)((e=>{var t;return(0,i.L)("can_write","ExploreFormDataRestApi",null==(t=e.user)?void 0:t.roles)})),n=(0,a.d4)((e=>{var t;return(0,i.L)("can_samples","Datasource",null==(t=e.user)?void 0:t.roles)})),o=(0,a.d4)((e=>{var t;return(0,i.L)("can_csv","Superset",null==(t=e.user)?void 0:t.roles)})),r=(0,a.d4)((e=>{var t;return(0,i.L)("can_drill","Dashboard",null==(t=e.user)?void 0:t.roles)}));return{canExplore:e,canWriteExploreFormData:t,canDatasourceSamples:n,canDownload:o,canDrill:r,canDrillBy:(e||r)&&t,canDrillToDetail:(e||r)&&n,canViewQuery:(0,a.d4)((e=>{var t;return(0,i.L)("can_view_query","Dashboard",null==(t=e.user)?void 0:t.roles)})),canViewTable:(0,a.d4)((e=>{var t;return(0,i.L)("can_view_chart_as_table","Dashboard",null==(t=e.user)?void 0:t.roles)}))}}},55976:(e,t,n)=>{n.d(t,{M:()=>p});var a=n(2445),i=n(96540),o=n(72234),r=n(95579),s=n(17437),l=n(15757),c=n(38711),d=n(33110),u=n(86274),h=n(35233);const p=({dataset:e,datasetId:t})=>{const n=(0,o.DP)(),[p,m]=(0,i.useState)(),[g,v]=(0,i.useState)(e?u.bk.Complete:u.bk.Loading);return(0,i.useEffect)((()=>{!e&&t&&(0,h.w)({endpoint:`/api/v1/dataset/${t}`}).then((({json:{result:e}})=>{m(e),v(u.bk.Complete)})).catch((()=>{v(u.bk.Error)}))}),[t,e]),{metadataBar:(0,i.useMemo)((()=>{const t=[],i=e||p;if(i){var o,h;const{changed_on_humanized:e,created_on_humanized:n,description:a,table_name:s,changed_by:l,created_by:c,owners:u}=i,p=(0,r.t)("Not available"),m=`${null!=(o=null==c?void 0:c.first_name)?o:""} ${null!=(h=null==c?void 0:c.last_name)?h:""}`.trim()||p,g=l?`${l.first_name} ${l.last_name}`:p,v=(null==u?void 0:u.length)>0?u.map((e=>`${e.first_name} ${e.last_name}`)):[p];t.push({type:d.Q.Table,title:s}),t.push({type:d.Q.LastModified,value:e,modifiedBy:g}),t.push({type:d.Q.Owner,createdBy:m,owners:v,createdOn:n}),a&&t.push({type:d.Q.Description,value:a})}return(0,a.FD)("div",{css:s.AH`
          display: flex;
          margin-bottom: ${4*n.sizeUnit}px;
        `,children:[g===u.bk.Complete&&(0,a.Y)(c.Ay,{items:t,tooltipPlacement:"bottom"}),g===u.bk.Error&&(0,a.Y)(l.F,{type:"error",message:(0,r.t)("There was an error loading the dataset metadata")})]})}),[e,p,g,n.sizeUnit]),status:g}}},59638:(e,t,n)=>{n.d(t,{w:()=>g,K:()=>l});var a=n(96540),i=n(96627),o=n(77189),r=n(95483),s=n(2511);const l=e=>{const[t,n]=(0,a.useState)({});return(0,a.useEffect)((()=>{e.operator===r.ux.TemporalRange&&e.expressionType===s.A.Simple||n({}),e.operator===r.ux.TemporalRange&&e.comparator===i.WC&&n({actualTimeRange:`${e.subject} (${i.WC})`,title:i.WC}),e.operator===r.ux.TemporalRange&&e.expressionType===s.A.Simple&&e.comparator!==i.WC&&t.title!==e.comparator&&(0,o.x9)(e.comparator,e.subject).then((({value:t,error:a})=>{n(a?{actualTimeRange:`${e.subject} (${e.comparator})`,title:a}:{actualTimeRange:null!=t?t:"",title:e.comparator})}))}),[e]),t};var c=n(2445),d=n(72391),u=n(95579),h=n(67984),p=n(45267),m=n(50317);const g=({columnName:e,timeRange:t,datasource:n,onChange:a})=>{const i=(0,d.a)().get("filter.dateFilterControl"),o=null!=i?i:p.A;return(0,h.D)(e,n)?(0,c.FD)(c.FK,{children:[(0,c.Y)(m.A,{label:(0,u.t)("Time Range")}),(0,c.Y)(o,{value:t,name:"time_range",onChange:t=>a(e,t),overlayStyle:"Modal"})]}):void 0}},59838:(e,t,n)=>{n.d(t,{r:()=>s});var a=n(70700),i=n(2511),o=n(95483),r=n(71191);const s=(e,t=i.v.Where)=>{var n;const s=(e=>{if(!e.filterDataMapping)return null;const{col:t,op:n}=e,a="val"in e?e.val:void 0;for(const[i,o]of Object.entries(e.filterDataMapping))if(Array.isArray(o)&&o.find((e=>e.col===t&&e.op===n&&JSON.stringify(e.val)===JSON.stringify(a))))return i;return null})(e),l=s?null==(n=e.layerFilterScope)?void 0:n[s]:void 0;let c;var d;return c=(0,a.q0)(e.col)?{expressionType:"SQL",clause:t,sqlExpression:(0,r.e)({expressionType:i.A.Simple,subject:`(${e.col.sqlExpression})`,operator:e.op,comparator:"val"in e?e.val:void 0})}:{expressionType:"SIMPLE",clause:t,operator:e.op,operatorId:null==(d=Object.entries(o.nS).find((t=>t[1].operation===e.op)))?void 0:d[0],subject:e.col,comparator:"val"in e?e.val:void 0},e.isExtra&&Object.assign(c,{isExtra:!0,layerFilterScope:l,filterOptionName:`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}),c}},60237:(e,t,n)=>{n.d(t,{T:()=>s,c:()=>l});var a=n(35742),i=n(48760);const o=(e,t)=>{let n="api/v1/explore/form_data";return e&&(n=n.concat(`/${e}`)),t&&(n=n.concat(`?tab_id=${t}`)),n},r=(e,t,n,a)=>{const o={datasource_id:e,datasource_type:t,form_data:JSON.stringify((0,i.k)(n))};return a&&(o.chart_id=a),o},s=(e,t,n,i,s)=>a.A.post({endpoint:o(void 0,s),jsonPayload:r(e,t,n,i)}).then((e=>e.json.key)),l=(e,t,n,i,s,l)=>a.A.put({endpoint:o(n,l),jsonPayload:r(e,t,i,s)}).then((e=>e.json.message))},61106:(e,t,n)=>{n.d(t,{r:()=>s});var a=n(95579),i=n(99418);function o({title:e,body:t,footer:n}){const a=`\n    <div class="tooltip-detail">\n      ${e?`<div class="tooltip-detail-title">${e}</div>`:""}\n      ${t?`<div class="tooltip-detail-body">${t}</div>`:""}\n      ${n?`<div class="tooltip-detail-footer">${n}</div>`:""}\n    </div>\n  `;return i.default.sanitize(a)}var r=n(67553);function s(e){return e.map((({column_name:e,verbose_name:t,is_certified:n,certified_by:i,description:s,type:l})=>({name:t||e,value:e,docHTML:o({title:e,body:`type: ${l||"unknown"}<br />${s?`description: ${s}`:""}`,footer:n?(0,a.t)("Certified by %s",i):void 0}),score:r.v9,meta:"column"})))}},65128:(e,t,n)=>{n.d(t,{P:()=>s});var a=n(51436),i=n(95579),o=n(96540),r=n(61574);const s=({hasUnsavedChanges:e,onSave:t,isSaveModalVisible:n=!1,manualSaveOnUnsavedChanges:s=!1})=>{const l=(0,r.W6)(),[c,d]=(0,o.useState)(!1),u=(0,o.useRef)(null),h=(0,o.useRef)((()=>{})),p=(0,o.useRef)(!1),m=(0,o.useCallback)((()=>{null==u.current||u.current()}),[]),g=(0,o.useCallback)((async()=>{try{s&&(p.current=!0),await t(),d(!1)}catch(e){const t=await(0,a.h4)(e);throw new Error(t.message||t.error||(0,i.t)("Sorry, an error occurred"),{cause:e})}}),[s,t]),v=(0,o.useCallback)((()=>{p.current=!0,t()}),[t]),b=(0,o.useCallback)((({pathname:e})=>{if(!p.current)return u.current=()=>{null==h.current||h.current(),l.push(e)},d(!0),!1;p.current=!1}),[l]);return(0,o.useEffect)((()=>{if(!e)return;const t=l.block(b);return h.current=t,()=>t()}),[b,e,l]),(0,o.useEffect)((()=>{const t=t=>{e&&(t.preventDefault(),t.returnValue="")};return window.addEventListener("beforeunload",t),()=>window.removeEventListener("beforeunload",t)}),[e]),(0,o.useEffect)((()=>{!n&&p.current&&(d(!1),p.current=!1)}),[n]),{showModal:c,setShowModal:d,handleConfirmNavigation:m,handleSaveAndCloseModal:g,triggerManualSave:v}}},67429:(e,t,n)=>{n.d(t,{C:()=>s});var a=n(2445),i=n(17437),o=n(38380),r=n(97470);const s=({title:e,color:t})=>(0,a.Y)(r.m,{title:e,placement:"top",children:(0,a.Y)(o.F.InfoCircleOutlined,{"data-test":"tooltip-trigger",css:e=>i.AH`
        color: ${t||e.colorTextLabel};
        margin-left: ${2*e.sizeUnit}px;
        &.anticon {
          font-size: unset;
          .anticon {
            line-height: unset;
            vertical-align: unset;
          }
        }
      `})})},70542:(e,t,n)=>{n.d(t,{k:()=>F});var a=n(62193),i=n.n(a),o=n(2445),r=n(96540),s=n(95579),l=n(17437),c=n(58642),d=n(72234),u=n(80145),h=n(58863),p=n(46302),m=n(61225),g=n(26196),v=n(83537),b=n(67429),f=n(28543);const y=(0,s.t)("Drill to detail"),S=(0,s.t)("Drill to detail by"),x={DATABASE:(0,s.t)("Drill to detail is disabled for this database. Change the database settings to enable it."),NO_AGGREGATIONS:(0,s.t)("Drill to detail is disabled because this chart does not group data by dimension value."),NO_FILTERS:(0,s.t)("Right-click on a dimension value to drill to detail by that value."),NOT_SUPPORTED:(0,s.t)("Drill to detail by value is not yet supported for this chart type.")},C=({children:e,menuKey:t,...n})=>(0,o.Y)(g.W1.Item,{disabled:!0,...n,children:(0,o.Y)("div",{css:l.AH`
        white-space: normal;
        max-width: 160px;
      `,children:e})},t),_=(0,d.I4)((({children:e,stripHTML:t=!1})=>{const n=t&&"string"==typeof e?(0,c.zF)(e):e;return(0,o.Y)("span",{children:n})}))`
  ${({theme:e})=>`\n     font-weight: ${e.fontWeightStrong};\n     color: ${e.colorPrimary};\n   `}
`,F=({formData:e,filters:t=[],isContextMenu:n=!1,contextMenuY:a=0,onSelection:l=()=>null,onClick:c=()=>null,submenuIndex:d=0,setFilters:F,setShowModal:w,key:A,...D})=>{const T=(0,m.d4)((({datasources:t})=>{var n;return null==(n=t[e.datasource])||null==(n=n.database)?void 0:n.disable_drill_to_detail})),Y=(0,r.useCallback)(((e,t)=>{c(t),l(),F(e),w(!0)}),[c,l]),I=(0,r.useMemo)((()=>{var t;return null==(t=(0,u.A)().get(e.viz_type))?void 0:t.behaviors.find((e=>e===h.nS.DrillToDetail))}),[e.viz_type]),$=(0,r.useMemo)((()=>{const{metrics:t}=(0,p.A)(e);return i()(t)}),[e]),E=(0,r.useMemo)((()=>(0,v.Gs)(a,t.length>1?t.length+1:t.length,d)),[a,t.length,d]);let M,z;T?(M=x.DATABASE,z=x.DATABASE):I?$?(M=x.NO_AGGREGATIONS,z=x.NO_AGGREGATIONS):null!=t&&t.length||(z=x.NO_FILTERS):z=x.NOT_SUPPORTED;const R=M?(0,o.FD)(C,{menuKey:"drill-to-detail-disabled",...D,children:[y,(0,o.Y)(b.C,{title:M})]}):(0,o.Y)(g.W1.Item,{onClick:Y.bind(null,[]),children:y},"drill-to-detail"),O=z?(0,o.FD)(C,{menuKey:"drill-to-detail-by-disabled",...D,children:[S,(0,o.Y)(b.C,{title:z})]}):(0,o.Y)(g.W1.SubMenu,{popupOffset:[0,E],popupClassName:"chart-context-submenu",title:S,...D,children:(0,o.FD)("div",{"data-test":"drill-to-detail-by-submenu",children:[t.map(((e,t)=>(0,o.FD)(f.oY,{tooltipText:`${S} ${e.formattedVal}`,menuKey:`drill-detail-filter-${t}`,onClick:Y.bind(null,[e]),children:[`${S} `,(0,o.Y)(_,{stripHTML:!0,children:e.formattedVal})]}))),t.length>1&&(0,o.Y)(g.W1.Item,{onClick:Y.bind(null,t),children:(0,o.FD)("div",{children:[`${S} `,(0,o.Y)(_,{stripHTML:!1,children:(0,s.t)("all")})]})},"drill-detail-filter-all")]})},A);return(0,o.FD)(o.FK,{children:[R,n&&O]})}},71085:(e,t,n)=>{n.d(t,{A:()=>I,v:()=>T});var a=n(62193),i=n.n(a),o=n(2445),r=n(96540),s=n(61225),l=n(72391),c=n(17437),d=n(72234),u=n(27366),h=n(83505),p=n(95579),m=n(38380),g=n(12609),v=n(26196),b=n(91196),f=n(15151),y=n(93491),S=n(50500),x=n(15700);const C=(0,l.a)(),_=e=>c.AH`
  color: ${e.colorError};
`,F=e=>c.AH`
  & .ant-menu-item {
    padding: 5px 12px;
    margin-top: 0px;
    margin-bottom: 4px;
    :hover {
      color: ${e.colorText};
    }
  }
  :hover {
    background-color: ${e.colorPrimaryBg};
  }
`,w=e=>c.AH`
  &:hover {
    color: ${e.colorText};
    background-color: ${e.colorPrimaryBg};
  }
`,A=d.I4.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  > *:first-child {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,D=C.get("report-modal.dropdown.item.icon");var T;!function(e){e.Charts="charts",e.Dashboards="dashboards"}(T||(T={}));const Y={};function I({dashboardId:e,chart:t,useTextMenu:n=!1,setShowReportSubMenu:a,submenuTitle:l,showReportModal:d,setCurrentReportDeleting:C}){const I=(0,s.wA)(),$=(0,s.d4)((n=>{const a=e?T.Dashboards:T.Charts;return(0,S.oi)(n,a,e||(null==t?void 0:t.id))||Y})),E=(null==$?void 0:$.active)||!1,M=(0,s.d4)((e=>e.user)),z=()=>!!(0,u.G7)(u.TO.AlertReports)&&(!(null==M||!M.userId)&&(!!(e||null!=t&&t.id)&&Object.keys(M.roles||[]).map((e=>M.roles[e].filter((e=>"menu_access"===e[0]&&"Manage"===e[1])))).some((e=>e.length>0)))),R=(0,h.Z)(e),O=async(e,t)=>{null!=e&&e.id&&I((0,y.PM)(e,t))},k=z()&&!!(e&&R!==e||null!=t&&t.id);(0,r.useEffect)((()=>{k&&I((0,y.LQ)({userId:M.userId,filterField:e?"dashboard_id":"chart_id",creationMethod:e?"dashboards":"charts",resourceId:e||(null==t?void 0:t.id)}))}),[]);const N=$&&a&&z();(0,r.useEffect)((()=>{N?a(!0):!$&&a&&a(!1)}),[$]);const L=()=>{d()};return(0,o.Y)(o.FK,{children:z()&&(n?i()($)?(0,o.FD)(v.W1.SubMenu,{title:l,css:F,children:[(0,o.Y)(v.W1.Item,{onClick:L,children:D?(0,o.FD)(A,{children:[(0,o.Y)("div",{children:(0,p.t)("Set up an email report")}),(0,o.Y)(D,{})]}):(0,p.t)("Set up an email report")}),(0,o.Y)(v.W1.Divider,{})]}):(0,o.FD)(v.W1.SubMenu,{title:l,css:c.AH`
          border: none;
        `,children:[(0,o.Y)(v.W1.Item,{css:w,onClick:()=>O($,!E),children:(0,o.FD)(x.t3,{children:[(0,o.Y)(b.A,{checked:E,onChange:f.fZ}),(0,p.t)("Email reports active")]})}),(0,o.Y)(v.W1.Item,{css:w,onClick:L,children:(0,p.t)("Edit email report")}),(0,o.Y)(v.W1.Item,{css:w,onClick:()=>{C($)},children:(0,p.t)("Delete email report")})]}):i()($)?(0,o.Y)("span",{role:"button",title:(0,p.t)("Schedule email report"),tabIndex:0,className:"action-button action-schedule-report",onClick:()=>d(),children:(0,o.Y)(m.F.CalendarOutlined,{})}):(U=(0,o.Y)(m.F.CalendarOutlined,{}),(0,o.FD)(v.W1.SubMenu,{title:U,css:c.AH`
        width: 200px;
      `,children:[(0,o.FD)(v.W1.Item,{children:[(0,p.t)("Email reports active"),(0,o.Y)(g.A,{"data-test":"toggle-active",checked:E,onClick:e=>O($,e),size:"small",css:e=>c.AH`
            margin-left: ${2*e.sizeUnit}px;
          `})]}),(0,o.Y)(v.W1.Item,{onClick:()=>d(),children:(0,p.t)("Edit email report")}),(0,o.Y)(v.W1.Item,{onClick:()=>C($),css:_,children:(0,p.t)("Delete email report")})]})))});var U}},71191:(e,t,n)=>{n.d(t,{e:()=>s});var a=n(808),i=n(95483),o=n(85183);const r={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":({datasource:e})=>`= '{{ presto.latest_partition('${e.schema}.${e.datasource_name}') }}'`},s=(e,{useSimple:t}={useSimple:!1})=>{if((0,a.md)(e)||t){const{subject:t,operator:n}=e,a="comparator"in e?e.comparator:void 0,s=n&&n===i.nS[i.ux.LatestPartition].operation?r[n](e):r[n];return(0,o.zJ)(t,s,a)}return(0,a.wF)(e)?e.sqlExpression:""}},72652:(e,t,n)=>{n.d(t,{B3:()=>x,Bt:()=>f,Gh:()=>y,JG:()=>w,JU:()=>v,Px:()=>D,XB:()=>A,a2:()=>g,f$:()=>F,p6:()=>C,yJ:()=>m});var a=n(2445),i=n(96540),o=n(26206),r=n(30535),s=n(72234),l=n(17437),c=n(95579),d=n(18062),u=n(97470),h=n(38380),p=n(84080);const m=s.I4.div`
  margin-bottom: ${({theme:e})=>e.sizeUnit}px;
  :last-child {
    margin-bottom: 0;
  }
`,g=s.I4.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  height: ${({theme:e})=>6*e.sizeUnit}px;
  background-color: ${({theme:e})=>e.colorBgLayout};
  border-radius: 3px;
  cursor: ${({withCaret:e})=>e?"pointer":"default"};
  :hover {
    background-color: ${({theme:e})=>e.colorPrimaryBgHover};
  }
`,v=s.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${e.sizeUnit}px;\n    svg {\n      margin-right: ${e.sizeUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*e.sizeUnit}px;\n      margin-left: ${e.sizeUnit}px;\n      font-weight: ${e.fontWeightNormal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}
`,b=s.I4.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,f=s.I4.div`
  height: 100%;
  border-left: solid 1px ${({theme:e})=>e.colorSplit};
  margin-left: auto;
`,y=s.I4.div`
  height: auto;
  width: ${({theme:e})=>6*e.sizeUnit}px;
  border-right: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  cursor: pointer;
`,S=(0,s.I4)(d.I)`
  margin: 0 ${({theme:e})=>e.sizeUnit}px;
`,x=s.I4.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,C=s.I4.div`
  padding: ${({theme:e})=>e.sizeUnit}px;
  border: solid 1px ${({theme:e})=>e.colorSplit};
  border-radius: ${({theme:e})=>e.borderRadius}px;
`,_=l.i7`
  0% {
    right: 100%;
  }
  50% {
    left: 4px;
  }
  90% {
    right: 4px;
  }
  100% {
    left: 100%;
  }
`,F=s.I4.div`
  ${({theme:e,isLoading:t,canDrop:n,isDragging:a,isOver:i})=>`\n  position: relative;\n  padding: ${e.sizeUnit}px;\n  border: ${!t&&a?`dashed 1px ${n?e.colorSplit:e.colorErrorBgHover}`:`solid 1px ${t&&a?e.colorWarningBgHover:e.colorBorder}`};\n  border-radius: ${e.borderRadius}px;\n  &:before,\n  &:after {\n    content: ' ';\n    position: absolute;\n    border-radius: ${e.borderRadius}px;\n  }\n  &:before {\n    display: ${a||t?"block":"none"};\n    background-color: ${n?e.colorPrimary:e.colorErrorBgHover};\n    z-index: 10;\n    opacity: 10%;\n    top: 1px;\n    right: 1px;\n    bottom: 1px;\n    left: 1px;\n  }\n  &:after {\n    display: ${t||n&&i?"block":"none"};\n    background-color: ${t?e.colors.grayscale.light3:e.colorPrimary};\n    z-index: 11;\n    opacity: 35%;\n    top: ${-e.sizeUnit}px;\n    right: ${-e.sizeUnit}px;\n    bottom: ${-e.sizeUnit}px;\n    left: ${-e.sizeUnit}px;\n    cursor: ${t?"wait":"auto"};\n  }\n  `}

  &:before {
    ${({theme:e,isLoading:t})=>t&&l.AH`
        animation: ${_} 2s ease-in infinite;
        background: linear-gradient(currentColor 0 0) 0 100%/0% 3px no-repeat;
        background-size: 100% ${e.sizeUnit/2}px;
        top: auto;
        right: ${e.sizeUnit}px;
        left: ${e.sizeUnit}px;
        bottom: -${e.sizeUnit/2}px;
        height: ${e.sizeUnit/2}px;
      `};
  }
`,w=s.I4.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${({theme:e})=>6*e.sizeUnit}px;
  padding-left: ${({theme:e})=>e.sizeUnit}px;
  font-size: ${({theme:e})=>e.fontSizeSM}px;
  color: ${({theme:e})=>e.colors.grayscale.light1};
  border: dashed 1px ${({theme:e})=>e.colorSplit};
  border-radius: ${({theme:e})=>e.borderRadius}px;
  cursor: ${({cancelHover:e})=>e?"inherit":"pointer"};

  :hover {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light4};
  }

  :active {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light3};
  }
  svg {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,A=s.I4.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${({theme:e})=>4*e.sizeUnit}px;
  width: ${({theme:e})=>4*e.sizeUnit}px;
  padding: 0;
  background-color: ${({theme:e})=>e.colorPrimaryText};
  border: none;
  border-radius: 2px;

  :disabled {
    cursor: not-allowed;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,D=({label:e,savedMetric:t,adhocMetric:n,onRemove:d,onMoveLabel:x,onDropLabel:C,withCaret:_,isFunction:F,type:w,index:A,isExtra:D,datasourceWarningMessage:T,tooltipTitle:Y,multi:I=!0,...$})=>{const E=(0,s.DP)(),M=(0,i.useRef)(null),z=(0,i.useRef)(null),R=null==t?void 0:t.metric_name,[,O]=(0,o.H)({accept:w,drop(){I&&(null==C||C())},hover(e,t){var n;if(!I)return;if(!M.current)return;const{dragIndex:a}=e,i=A;if(a===i)return;const o=null==(n=M.current)?void 0:n.getBoundingClientRect(),r=(o.bottom-o.top)/2,s=t.getClientOffset(),l=null!=s&&s.y?(null==s?void 0:s.y)-o.top:0;a<i&&l<r||a>i&&l>r||(null==x||x(a,i),e.dragIndex=i)}}),[{isDragging:k},N]=(0,r.i)({item:{type:w,dragIndex:A,value:null!=t&&t.metric_name?t:n},collect:e=>({isDragging:e.isDragging()})});return N(O(M)),(0,a.Y)(m,{ref:M,children:(0,a.FD)(g,{withCaret:_,"data-test":"option-label",...$,css:l.AH`
        text-align: center;
      `,children:[(0,a.Y)(y,{role:"button","data-test":"remove-control-button",onClick:d,children:(0,a.Y)(h.F.CloseOutlined,{iconSize:"m",iconColor:E.colors.grayscale.light1,css:l.AH`
            vertical-align: sub;
          `})}),(0,a.FD)(v,{"data-test":"control-label",children:[F&&(0,a.Y)(h.F.FunctionOutlined,{iconSize:"m"}),(()=>{const n=!k&&"string"==typeof e&&Y&&e&&Y!==e||!k&&z&&z.current&&z.current.scrollWidth>z.current.clientWidth;return t&&R?(0,a.Y)(p.b,{metric:t,labelRef:z,shouldShowTooltip:!k}):n?(0,a.Y)(u.m,{title:Y||e,children:(0,a.Y)(b,{ref:z,children:e})}):(0,a.Y)(b,{ref:z,children:e})})()]}),(!!T||D)&&(0,a.Y)(S,{type:"warning",placement:"top",tooltip:T||(0,c.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),_&&(0,a.Y)(f,{children:(0,a.Y)(h.F.RightOutlined,{iconSize:"m",css:l.AH`
              margin: ${E.sizeUnit}px;
            `,iconColor:E.colors.grayscale.light1})})]})})}},72965:(e,t,n)=>{n.d(t,{A:()=>m});var a=n(20249),i=n.n(a),o=n(67390),r=n.n(o),s=n(95579),l=n(95272);const c=.95,d=(e,t=new Date)=>`${i()(e)}-${t.toISOString().replace(/[: ]/g,"-")}`,u=new Set(["display","position","width","height","max-width","max-height","margin","padding","top","right","bottom","left","font","font-family","font-size","font-weight","font-style","line-height","letter-spacing","word-spacing","text-align","text-decoration","color","background-color","border","border-width","border-style","border-color","opacity","visibility","overflow","z-index","transform","flex","flex-direction","justify-content","align-items","grid","grid-template","grid-area","table-layout","vertical-align","text-align"]),h=new WeakMap,p=e=>{const t=e.cloneNode(!0);((e,t)=>{const n=[[e,t]],a=new WeakSet;for(;n.length;){var i;const[e,t]=n.shift();if(a.has(e))continue;a.add(e);let o=h.get(e);o||(o=window.getComputedStyle(e),h.set(e,o));for(const e of u){const n=o.getPropertyValue(e);n&&"initial"!==n&&"inherit"!==n&&t.style.setProperty(e,n,o.getPropertyPriority(e))}if(null!=(i=e.textContent)&&i.trim()){const{color:e}=o;e&&"transparent"!==e&&"rgba(0, 0, 0, 0)"!==e||(t.style.color="#000"),t.style.visibility="visible","none"===o.display&&(t.style.display="block")}for(let a=0;a<e.children.length;a+=1)n.push([e.children[a],t.children[a]])}})(e,t);const n=document.createElement("div");return n.style.cssText="\n    position: absolute;\n    left: -20000px;\n    top: -20000px;\n    visibility: hidden;\n    pointer-events: none;\n    z-index: -1000;\n  ",n.appendChild(t),document.body.appendChild(n),(e=>{const t=e.style;t.height="auto",t.maxHeight="none",['[style*="overflow"]',".scrollable",".table-responsive",".ant-table-body",".table-container",".ant-table-container",".table-wrapper",".ant-table-tbody","tbody",".table-body",".virtual-table",".react-window",".react-virtualized"].forEach((t=>{e.querySelectorAll(t).forEach((e=>{const t=e;t.style.overflow="visible",t.style.height="auto",t.style.maxHeight="none"}))})),e.querySelectorAll("table, .ant-table, .table-container, .data-table").forEach((e=>{const t=e;t.style.margin="0 auto",t.style.display="table",t.style.width="100%",t.style.tableLayout="auto"})),e.querySelectorAll("tr, .ant-table-row, .table-row, .data-row").forEach((e=>{const t=e;t.style.display="table-row",t.style.visibility="visible",t.style.height="auto"})),e.querySelectorAll("td, th, .ant-table-cell, .table-cell").forEach((e=>{const t=e;t.style.display="table-cell",t.style.visibility="visible"})),e.querySelectorAll("*").forEach((e=>{var t;const n=e;if(null!=(t=n.textContent)&&t.trim()){const e=window.getComputedStyle(n);"transparent"===e.color&&(n.style.color="#000"),n.style.visibility="visible","none"===e.display&&(n.style.display="block")}})),e.querySelectorAll("[data-virtualized], .virtualized, .lazy-load").forEach((e=>{const t=e;t.style.height="auto",t.style.maxHeight="none"}))})(t),{clone:t,cleanup:()=>{null==h.delete||h.delete(e),n.parentElement&&n.parentElement.removeChild(n)}}};function m(e,t,n=!1,a){return async i=>{const o=n?document.querySelector(e):i.currentTarget.closest(e);if(!o)return void(0,l.Zd)((0,s.t)("Image download failed, please refresh and try again."));let u=null;try{const{clone:e,cleanup:n}=p(o);u=n;const i=e=>"string"!=typeof e.className||!e.className.includes("mapboxgl-control-container")&&!e.className.includes("header-controls"),s=await r().toJpeg(e,{bgcolor:null==a?void 0:a.colors.grayscale.light4,filter:i,quality:c,height:e.scrollHeight,width:e.scrollWidth,cacheBust:!0});u(),u=null;const l=document.createElement("a");l.download=`${d(t)}.jpg`,l.href=s,l.click()}catch(e){console.error("Creating image failed",e),(0,l.Zd)((0,s.t)("Image download failed, please refresh and try again."))}finally{u&&u()}}}},74792:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(5556),i=n.n(a);const o=i().shape({column_name:i().string.isRequired,type:i().string})},76295:(e,t,n)=>{n.d(t,{A:()=>h});var a=n(2404),i=n.n(a),o=n(40104),r=n(35839);function s(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}var l=n(92008);const c={},d={},u=(e,t)=>{const n={};return t.forEach((t=>{const a=(0,o.J8)(e,[t]);a.filters&&a.filters.length>0&&(n[t]=a.filters)})),n};function h({chart:e,filters:t,nativeFilters:n,chartConfiguration:a,colorScheme:h,ownColorScheme:p,colorNamespace:m,sliceId:g,dataMask:v,extraControls:b,labelsColor:f,labelsColorMap:y,sharedLabelsColors:S,allSliceIds:x,activeFilters:C}){var _;const F=d[g];if(c[g]===t&&(0,r.r$)(null==F?void 0:F.own_color_scheme,p)&&(0,r.r$)(null==F?void 0:F.color_scheme,h)&&(0,r.r$)(null==F?void 0:F.color_namespace,m,{ignoreUndefined:!0})&&(0,r.r$)(null==F?void 0:F.label_colors,f,{ignoreUndefined:!0})&&(0,r.r$)(null==F?void 0:F.map_label_colors,y,{ignoreUndefined:!0})&&i()(null==F?void 0:F.shared_label_colors,S)&&F&&(0,r.r$)(null==F?void 0:F.dataMask,v,{ignoreUndefined:!0})&&(0,r.r$)(null==F?void 0:F.extraControls,b,{ignoreUndefined:!0}))return F;const w=C||(0,l.R)({chartConfiguration:a,nativeFilters:n,dataMask:v,allSliceIds:x});let A={};const D=Object.entries(w).filter((([,t])=>t.scope.includes(e.id))).map((([e])=>e));if(D.length){var T;A={extra_form_data:(0,o.J8)(v,D)};const t="deck_multi"===(null==(T=e.form_data)?void 0:T.viz_type),n=C&&Object.values(C).some((e=>e.layerScope));if(t||n){const e=u(v,D);A.filter_data_mapping=e}}let Y;const I="deck_multi"===(null==(_=e.form_data)?void 0:_.viz_type),$=C&&Object.values(C).some((e=>e.layerScope));(I||$)&&(Y={},Object.entries(w).forEach((([t,n])=>{var a;null!=(a=n.layerScope)&&a[e.id]&&(Y[t]=n.layerScope[e.id])})),0===Object.keys(Y).length&&(Y=void 0));const E={...e.form_data,chart_id:e.id,label_colors:f,shared_label_colors:S,map_label_colors:y,...h&&{color_scheme:h},...p&&{own_color_scheme:p},extra_filters:s(t),...A,...b,...Y&&{layer_filter_scope:Y}};return c[g]=t,d[g]={...E,dataMask:v,extraControls:b},E}},80493:(e,t,n)=>{n.d(t,{x:()=>g,y:()=>m});var a=n(65611),i=n.n(a),o=n(2445),r=n(72234),s=n(87903),l=n(17437),c=n(96540),d=n(39091),u=n(15151),h=n(86832),p=n(81917);const m=r.I4.div`
  ${({theme:e})=>`\n    display: flex;\n    align-items: center;\n    padding-bottom: ${2*e.sizeUnit}px;\n    justify-content: space-between;\n\n    span {\n      flex-shrink: 0;\n    }\n  `}
`,g=({data:e,datasourceId:t,onInputChange:n,columnNames:a,columnTypes:r,rowcount:g,isLoading:v,canDownload:b})=>{const f=(0,h.p)(t),y=i()(a,r).filter((([e,t])=>t===s.s.Temporal&&e&&!f.includes(e))).map((([e])=>e)),S=(0,c.useMemo)((()=>(0,u.bE)(e,y)),[e,y]);return(0,o.FD)(m,{children:[(0,o.Y)(d.ZY,{onChangeHandler:n,shouldFocus:!0}),(0,o.FD)("div",{css:l.AH`
          display: flex;
          align-items: center;
        `,children:[(0,o.Y)(p.A,{rowcount:g,loading:v}),b&&(0,o.Y)(d.TN,{data:S,columns:a})]})]})}},80641:(e,t,n)=>{n.d(t,{A:()=>a});const a=n(87937).A},81410:(e,t,n)=>{n.d(t,{A:()=>H});var a,i,o=n(2445),r=n(96540),s=n(93641),l=n(95579),c=n(51436),d=n(61225),u=n(93491),h=n(17355),p=n(14118),m=n(15757),g=n(10383),v=n(38380),b=n(64658),f=n(19834),y=n(5261);!function(e){e.Dashboards="dashboards",e.Charts="charts"}(a||(a={})),function(e){e.Text="TEXT",e.PNG="PNG",e.CSV="CSV"}(i||(i={}));var S=n(50500),x=n(67688),C=n(71085),_=n(72234),F=n(17437),w=n(84335),A=n(75227),D=n(15509);const T=(0,_.I4)(w.aF)`
  .ant-modal-body {
    padding: 0;
  }
`,Y=_.I4.div`
  padding: ${({theme:e})=>`${3*e.sizeUnit}px ${4*e.sizeUnit}px ${2*e.sizeUnit}px`};
  label {
    font-size: ${({theme:e})=>e.fontSizeSM}px;
    color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,I=_.I4.div`
  border-top: 1px solid ${({theme:e})=>e.colorSplit};
  padding: ${({theme:e})=>`${4*e.sizeUnit}px ${4*e.sizeUnit}px ${6*e.sizeUnit}px`};
  .ant-select {
    width: 100%;
  }
  .control-label {
    font-size: ${({theme:e})=>e.fontSizeSM}px;
    color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,$=_.I4.span`
  span {
    margin-right: ${({theme:e})=>2*e.sizeUnit}px;
    vertical-align: middle;
  }
  .text {
    vertical-align: middle;
  }
`,E=_.I4.div`
  margin-bottom: ${({theme:e})=>7*e.sizeUnit}px;

  h4 {
    margin-bottom: ${({theme:e})=>3*e.sizeUnit}px;
  }
`,M=(0,_.I4)(A.l)`
  margin-bottom: ${({theme:e})=>3*e.sizeUnit}px;
  width: ${({theme:e})=>120*e.sizeUnit}px;
`,z=_.I4.p`
  color: ${({theme:e})=>e.colorError};
`,R=F.AH`
  margin-bottom: 0;
`,O=(0,_.I4)(D.$)`
  width: ${({theme:e})=>40*e.sizeUnit}px;
`,k=e=>F.AH`
  margin: ${3*e.sizeUnit}px 0 ${2*e.sizeUnit}px;
`,N=_.I4.div`
  margin: ${({theme:e})=>8*e.sizeUnit}px 0
    ${({theme:e})=>4*e.sizeUnit}px;
`,L=((0,_.I4)(f.s)`
  display: block;
  line-height: ${({theme:e})=>8*e.sizeUnit}px;
`,[s.Y.PivotTable,"table",s.Y.PairedTTest]),U={crontab:"0 12 * * 1"},q={},H=(0,y.Ay)((function({onHide:e,show:t=!1,dashboardId:n,chart:a,userId:s,userEmail:y,ccEmail:_,bccEmail:w,creationMethod:A,dashboardName:D,chartName:H}){var P;const W=null==a||null==(P=a.sliceFormData)?void 0:P.viz_type,j=!!a,V=j&&W&&L.includes(W),B=V?i.Text:i.PNG,G=D||H,K=(0,r.useMemo)((()=>({...U,name:G?(0,l.t)("Weekly Report for %s",G):(0,l.t)("Weekly Report")})),[G]),Q=(0,r.useCallback)(((e,t)=>"reset"===t?K:{...e,...t}),[K]),[J,X]=(0,r.useReducer)(Q,K),[Z,ee]=(0,r.useState)(),te=(0,d.wA)(),ne=(0,d.d4)((e=>{const t=n?C.v.Dashboards:C.v.Charts;return(0,S.oi)(e,t,n||(null==a?void 0:a.id))||q})),ae=ne&&Object.keys(ne).length;(0,r.useEffect)((()=>{X(ae?ne:"reset")}),[ae,ne]);const ie=(0,o.FD)($,{children:[(0,o.Y)(v.F.CalendarOutlined,{}),(0,o.Y)("span",{className:"text",children:ae?(0,l.t)("Edit email report"):(0,l.t)("Schedule a new email report")})]}),oe=(0,o.FD)(o.FK,{children:[(0,o.Y)(O,{onClick:e,children:(0,l.t)("Cancel")},"back"),(0,o.Y)(O,{buttonStyle:"primary",onClick:async()=>{const t={type:"Report",active:!0,force_screenshot:!1,custom_width:J.custom_width,creation_method:A,dashboard:n,chart:null==a?void 0:a.id,owners:[s],recipients:[{recipient_config_json:{target:y,ccTarget:_,bccTarget:w},type:"Email"}],name:J.name,description:J.description,crontab:J.crontab,report_format:J.report_format||B,timezone:J.timezone};X({isSubmitting:!0,error:void 0});try{ae?await te((0,u.Zp)(J.id,t)):await te((0,u.ef)(t)),e()}catch(e){const{error:t}=await(0,c.h4)(e);X({error:t})}X({isSubmitting:!1})},disabled:!J.name,loading:J.isSubmitting,children:ae?(0,l.t)("Save"):(0,l.t)("Add")},"submit")]}),re=(0,o.FD)(o.FK,{children:[(0,o.Y)(N,{children:(0,o.Y)(b.o.Title,{level:4,children:(0,l.t)("Message content")})}),(0,o.Y)("div",{className:"inline-container",children:(0,o.Y)(f.s.GroupWrapper,{spaceConfig:{direction:"vertical",size:"middle",align:"start",wrap:!1},onChange:e=>{X({report_format:e.target.value})},value:J.report_format||B,options:[{label:(0,l.t)("Text embedded in email"),value:i.Text},{label:(0,l.t)("Image (PNG) embedded in email"),value:i.PNG},{label:(0,l.t)("Formatted CSV attached in email"),value:i.CSV}]})})]}),se=(0,o.FD)(x.tu,{children:[(0,o.Y)("div",{className:"control-label",css:k,children:(0,l.t)("Screenshot width")}),(0,o.Y)("div",{className:"input-container",children:(0,o.Y)(h.A,{type:"number",name:"custom_width",value:(null==J?void 0:J.custom_width)||"",placeholder:(0,l.t)("Input custom width in pixels"),onChange:e=>{X({custom_width:parseInt(e.target.value,10)||null})}})})]});return(0,o.FD)(T,{show:t,onHide:e,title:ie,footer:oe,width:"432",centered:!0,children:[(0,o.FD)(Y,{children:[(0,o.Y)(p.M,{id:"name",name:"name",value:J.name||"",placeholder:K.name,required:!0,validationMethods:{onChange:({target:e})=>X({name:e.value})},label:(0,l.t)("Report Name"),"data-test":"report-name-test"}),(0,o.Y)(p.M,{id:"description",name:"description",value:(null==J?void 0:J.description)||"",validationMethods:{onChange:({target:e})=>{X({description:e.value})}},label:(0,l.t)("Description"),placeholder:(0,l.t)("Include a description that will be sent with your report"),css:R,"data-test":"report-description-test"})]}),(0,o.FD)(I,{children:[(0,o.FD)(E,{children:[(0,o.Y)(b.o.Title,{level:5,css:e=>(e=>F.AH`
  margin: ${3*e.sizeUnit}px 0;
`)(e),children:(0,l.t)("Schedule")}),(0,o.Y)("p",{children:(0,l.t)("The report will be sent to your email at")})]}),(0,o.Y)(M,{clearButton:!1,value:J.crontab||"0 12 * * 1",setValue:e=>{X({crontab:e})},onError:ee}),(0,o.Y)(z,{children:Z}),(0,o.Y)("div",{className:"control-label",css:e=>(e=>F.AH`
  margin: ${3*e.sizeUnit}px 0 ${2*e.sizeUnit}px;
`)(e),children:(0,l.t)("Timezone")}),(0,o.Y)(g.A,{timezone:J.timezone,onTimezoneChange:e=>{X({timezone:e})}}),j&&re,(!j||!V)&&se]}),J.error&&(0,o.Y)(m.F,{type:"error",css:e=>(e=>F.AH`
  margin: ${4*e.sizeUnit}px;
  margin-top: 0;
`)(e),message:ae?(0,l.t)("Failed to update report"):(0,l.t)("Failed to create report"),description:J.error})]})}))},81917:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(2445),i=n(95579),o=n(32142),r=n(82537),s=n(97470);const l=(0,i.t)("The row limit set for the chart was reached. The chart may show partial data.");function c(e){const{rowcount:t=0,limit:n=null,loading:c,label:d}=e,u=n&&t>=n,h=u||0===t&&!c?"error":"default",p=(0,o.gV)()(t),m=(0,a.Y)(r.JU,{type:h,children:c?(0,i.t)("Loading..."):(0,a.Y)("span",{"data-test":"row-count-label",children:(0,i.tn)("%s row","%s rows",t,p)})});return u?(0,a.Y)(s.m,{id:"tt-rowcount-tooltip",title:(0,a.Y)("span",{children:l}),children:d||m}):d||m}},83537:(e,t,n)=>{n.d(t,{Gs:()=>i,x4:()=>a});const a=(e,t,n=Number.MAX_SAFE_INTEGER,a=0)=>{const i=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0),o=Math.min(32*t,n)+32+a;return i-e<o?i-o:e},i=(e,t,n=0,i=Number.MAX_SAFE_INTEGER,o=0)=>{const r=e+4+32*n+4;return a(r,t,i,o)-r}},84064:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(5556),i=n.n(a),o=n(74792),r=n(8901),s=n(84080),l=n(2445);const c={option:i().oneOfType([o.A,i().shape({saved_metric_name:i().string.isRequired}),r.A]).isRequired};function d({option:e}){return e.saved_metric_name?(0,l.Y)(s.V,{column:{column_name:e.saved_metric_name,type:"expression"},showType:!0}):e.column_name?(0,l.Y)(s.V,{column:e,showType:!0}):e.label?(0,l.Y)(s.V,{column:{column_name:e.label,type:"expression"},showType:!0}):null}d.propTypes=c},86832:(e,t,n)=>{n.d(t,{J:()=>r,p:()=>o});var a=n(62952),i=n(62221);const o=e=>{const t=(0,i.Gq)(i.Hh.ExploreDataTableOriginalFormattedTimeColumns,{});return void 0===e?[]:(0,a.A)(t[e])},r=(e,t)=>{const n=(0,i.Gq)(i.Hh.ExploreDataTableOriginalFormattedTimeColumns,{});(0,i.SO)(i.Hh.ExploreDataTableOriginalFormattedTimeColumns,{...n,[e]:t})}},90422:(e,t,n)=>{n.d(t,{A:()=>s});var a=n(95483),i=n(71191),o=n(2511);const r=[...a.Wy].map((e=>a.nS[e].operation));class s{constructor(e){var t;this.expressionType=e.expressionType||o.A.Simple,this.expressionType===o.A.Simple?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,a.Sd.indexOf(e.operatorId)>=0&&(this.comparator=void 0),this.clause=e.clause||o.v.Where,this.sqlExpression=null):this.expressionType===o.A.Sql&&(this.sqlExpression="string"==typeof e.sqlExpression?e.sqlExpression:(0,i.e)(e,{useSimple:!0}),this.clause=e.clause,e.operator&&r.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null),this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.datasourceWarning=!!e.datasourceWarning,this.deck_slices=null==e?void 0:e.deck_slices,this.layerFilterScope=null==e?void 0:e.layerFilterScope,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new s({...this,isNew:!1,...e})}equals(e){return e.clause===this.clause&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){if(this.expressionType===o.A.Simple){if(a.Sd.map((e=>a.nS[e].operation)).indexOf(this.operator)>=0)return!!this.subject;if(this.operator&&this.subject&&this.clause)return Array.isArray(this.comparator)?this.comparator.length>0:null!==this.comparator}return this.expressionType===o.A.Sql&&!(!this.sqlExpression||!this.clause)}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return(0,i.e)(this)}}},90497:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(3959);function i(e,t){const n=document.querySelector(e),i=a.Wp.table_to_book(n);(0,a._h)(i,`${t}.xlsx`)}},91643:(e,t,n)=>{n.d(t,{A:()=>D});var a=n(2445),i=n(96540),o=n(61225),r=n(58561),s=n.n(r),l=n(72234),c=n(35742),d=n(95579),u=n(38380),h=n(15509),p=n(12609),m=n(97072),g=n(44344),v=n(39091),b=n(84666),f=n(42944),y=n(61574);const S=(0,l.I4)(v.i8)`
  ${({theme:e})=>`\n\t\t&& {\n\t\t\tmargin: 0 0 ${e.sizeUnit}px;\n\t\t}\n  `}
`,x=l.I4.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,C=l.I4.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin-top: ${({theme:e})=>4*-e.sizeUnit}px;
  align-items: flex-end;
`,_=l.I4.div`
  display: flex;
  flex-direction: row;
  column-gap: ${({theme:e})=>2*e.sizeUnit}px;
`,F=(0,l.I4)(f.Ay)`
  flex: 1;
`,w=l.I4.label`
  font-size: ${({theme:e})=>e.fontSize}px;
`,A={keys:["none"],columns:["database.backend"]},D=e=>{var t;const{sql:n,language:r="sql",datasource:l}=e,v=l.split("__")[0],[D,T]=(0,i.useState)(),[Y,I]=(0,i.useState)(!0),$=(0,y.W6)(),E=null!=(t=Y?D:n)?t:n,M=(0,o.d4)((e=>{var t;return(0,b.L)("menu_access","SQL Lab",null==(t=e.user)?void 0:t.roles)}));(0,i.useEffect)((()=>{(0,f.Fq)([r])}),[r]);const z=(0,i.useCallback)((()=>{if(D)I((e=>!e));else{const e=s().encode(A);c.A.get({endpoint:`/api/v1/dataset/${v}?q=${e}`}).then((({json:e})=>c.A.post({endpoint:"/api/v1/sqllab/format_sql/",body:JSON.stringify({sql:n,engine:e.result.database.backend}),headers:{"Content-Type":"application/json"}}))).then((({json:e})=>{T(e.result),I(!0)})).catch((()=>{I(!0)}))}}),[n,v,D]),R=(0,i.useCallback)((e=>{const t={datasourceKey:l,sql:E};e.metaKey||e.ctrlKey?(e.preventDefault(),window.open(`/sqllab?datasourceKey=${l}&sql=${E}`,"_blank")):$.push("/sqllab",{state:{requestedQuery:t}})}),[$,l,E]);return(0,i.useEffect)((()=>{z()}),[n]),(0,a.FD)(x,{children:[(0,a.FD)(C,{children:[(0,a.FD)(_,{children:[(0,a.Y)(g.$r,{text:E,shouldShowText:!1,copyNode:(0,a.Y)(S,{buttonSize:"small",icon:(0,a.Y)(u.F.CopyOutlined,{}),children:(0,d.t)("Copy")})}),M&&(0,a.Y)(h.$,{onClick:R,children:(0,d.t)("View in SQL Lab")})]}),(0,a.FD)(_,{children:[(0,a.Y)(p.A,{id:"formatSwitch",checked:!Y,onChange:z}),(0,a.Y)(w,{htmlFor:"formatSwitch",children:(0,d.t)("Show original SQL")})]})]}),!D&&(0,a.Y)(m.A,{active:!0}),D&&(0,a.Y)(F,{language:r,customStyle:{flex:1},children:E})]},n)}},92201:(e,t,n)=>{n.d(t,{a:()=>a});const a=()=>{var e;return null==(e=window)||null==(e=e.navigator)?void 0:e.webdriver}},98215:(e,t,n)=>{n.d(t,{n:()=>h});var a=n(2445),i=n(72234),o=n(17437),r=n(95579),s=n(84335),l=n(91996),c=n(38380),d=n(64658),u=n(15509);const h=({showModal:e,onHide:t,handleSave:n,onConfirmNavigation:h,title:p="Unsaved Changes",body:m="If you don't save, changes will be lost."})=>{const g=(0,i.DP)();return(0,a.Y)(s.aF,{name:p,centered:!0,responsive:!0,onHide:t,show:e,width:"444px",title:(0,a.FD)(l.s,{children:[(0,a.Y)(c.F.WarningOutlined,{iconColor:g.colorWarning,css:o.AH`
              margin-right: ${2*g.sizeUnit}px;
            `,iconSize:"l"}),(0,a.Y)(d.o.Title,{css:o.AH`
              && {
                margin: 0;
                margin-bottom: 0;
              }
            `,level:5,children:p})]}),footer:(0,a.FD)(l.s,{justify:"flex-end",css:o.AH`
            width: 100%;
          `,children:[(0,a.Y)(u.$,{htmlType:"button",buttonSize:"small",buttonStyle:"secondary",onClick:h,children:(0,r.t)("Discard")}),(0,a.Y)(u.$,{htmlType:"button",buttonSize:"small",buttonStyle:"primary",onClick:n,children:(0,r.t)("Save")})]}),children:(0,a.Y)(d.o.Text,{children:m})})}}}]);
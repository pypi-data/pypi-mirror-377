"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4207],{25564:(t,e,o)=>{o.d(e,{A:()=>c});var n=o(68961),r=o.n(n),a=o(4523),l=o(35e3),i=o(49443);const s={console,_:a.Ay,colors:i,d3array:l};function c(t,e,o){const n={},a=`SAFE_EVAL_${Math.floor(1e6*Math.random())}`;n[a]={};const l=`${a}=${t}`,i={...s,...e};Object.keys(i).forEach((t=>{n[t]=i[t]}));try{return r().runInNewContext(l,n,o),n[a]}catch(t){return()=>t}}},32548:(t,e,o)=>{o.d(e,{A:()=>r});var n=o(2445);const r=({label:t,value:e})=>(0,n.FD)("div",{children:[t,(0,n.Y)("strong",{children:e})]})},49443:(t,e,o)=>{o.r(e),o.d(e,{hexToRGB:()=>r});var n=o(2117);function r(t,e=255){if(!t)return[0,0,0,e];const{r:o,g:r,b:a}=(0,n.Qh)(t);return[o,r,a,e]}},49672:(t,e,o)=>{o.d(e,{BK:()=>g,GU:()=>d,L6:()=>h,Pn:()=>p,Up:()=>w,hw:()=>f,y1:()=>v});var n=o(35e3),r=o(62319),a=o(30885),l=o(69161),i=o(30265),s=o(26167),c=o(49443);const u=10,p="mapbox://",d="tile://",f=["openstreetmap","osm"];function m({break_points:t,num_buckets:e},o,r){if(!o)return[];if(void 0===t||0===t.length){const t=e?parseInt(e,10):u,[a,l]=(0,n.extent)(o,r).map((t=>"string"==typeof t?parseFloat(t):t));if(void 0===a||void 0===l)return[];const i=(l-a)/t,s=0===i?0:Math.max(0,Math.ceil(Math.log10(1/i))),c=l>parseFloat(l.toFixed(s))?1:0,p=a<parseFloat(a.toFixed(s))?a-1:a;return new Array(t+1+c).fill(0).map(((t,e)=>(p+e*i).toFixed(s)))}return t.sort(((t,e)=>parseFloat(t)-parseFloat(e)))}function h({break_points:t,num_buckets:e,linear_color_scheme:o,opacity:i},s,u){const p=t||e?m({break_points:t,num_buckets:e},s,u):null,d=Array.isArray(o)?new a.A({colors:o,id:"custom"}):(0,l.A)().get(o);if(!d)return()=>[0,0,0,0];let f,h;if(null!==p){const t=p.length-1,e=t>1?d.getColors(t):[d.colors[d.colors.length-1]],o=e[0],n=e[e.length-1];e.unshift(o),e.push(n);const a=p.map(parseFloat);f=(0,r.A)().domain(a).range(e),h=e=>!!e&&(e>a[t]||e<a[0])}else{const t=(0,n.extent)(s,u);f=t.some((t=>"number"==typeof t))?d.createLinearScale((0,n.extent)(s,u)):d.createLinearScale(),h=()=>!1}return t=>{const e=u(t);if(!e)return[0,0,0,0];const o=(0,c.hexToRGB)(f(e));return h(e)?o[3]=0:o[3]=i/100*255,o}}function v(t,e,o){const n=m(t,e,o),r=h(t,e,o),a={};return n.slice(1).forEach(((e,o)=>{const l=`${n[o]} - ${n[o+1]}`,i=.5*(parseFloat(n[o])+parseFloat(n[o+1])),s=t.metric?t.metric.label||t.metric:null;a[l]={color:null==r?void 0:r({[s||t.metric]:i}),enabled:!0}})),a}function g(t){const e=t||[],o={};return e&&e.length?(e.forEach((t=>{const e=`${t.minValue} - ${t.maxValue}`;o[e]={color:[t.color.r,t.color.g,t.color.b],enabled:!0}})),o):o}function w(t,e){return new i.A({data:t,id:e,minZoom:0,maxZoom:19,tileSize:256,renderSubLayers:t=>{const{west:e,north:o,east:n,south:r}=t.tile.bbox;return[new s.A(t,{data:void 0,image:t.data,bounds:[e,r,n,o]})]}})}},68291:(t,e,o)=>{o.d(e,{T$:()=>f,g_:()=>v,JV:()=>g,XC:()=>w});var n=o(35e3),r=o(25564),a=o(55241),l=o.n(a);const i=({position:t,positionBounds:e,spatialData:o})=>{const{lonCol:n,latCol:r,lonlatCol:a,geohashCol:i,reverseCheckbox:s,type:c,delimiter:u}=o;let p,d=[],f=[];if(!t&&!e)throw new Error("Position of picked data is required");switch(c){case"latlong":if(null!=n&&null!=r){const o=[n,r];t?(d=t,p=o.join(", "),f=[...o.map(((e,o)=>({col:e,op:"==",val:t[o]})))]):e&&(d=[e.from,e.to],p=`From ${n}, ${r} to ${n}, ${r}`,f=[...o.map(((t,o)=>({col:t,op:">=",val:e.from[o]}))),...o.map(((t,o)=>({col:t,op:"<=",val:e.to[o]})))])}break;case"delimited":{const e=null!=a?a:i;if(!e)throw new Error("Column is required");const o=(s?t.reverse():t).join(u);d=[o],f=[{col:e,op:"==",val:o}];break}case"geohash":{const e=null!=a?a:i;if(!e)throw new Error("Column is required");const[o,n]=t,r=l().encode(n,o,12);d=[r],f=[{col:e,op:"==",val:r}];break}default:d=[]}return{filters:f,values:d,customColumnLabel:p}},s=({latCol:t,lonCol:e,geohashCol:o,line_column:n})=>t&&e?`${t}, ${e}`:o||n||"",c=({data:t,filterState:e,formData:o})=>{var n,r;let a,l=[],c=[];if(o.start_spatial&&o.end_spatial){const e=(({formData:t,data:e})=>{var o,n;const r=null==(o=e.object)?void 0:o.sourcePosition,a=null==(n=e.object)?void 0:n.targetPosition;if(!r||!a)throw new Error("Position of picked data is required");if(!t.start_spatial||!t.end_spatial)throw new Error("Spatial data is required");const l=`Start ${s(t.start_spatial)} end ${s(t.end_spatial)}`,c=i({position:r,spatialData:t.start_spatial}),u=i({position:a,spatialData:t.end_spatial});if(!c||!u)throw new Error("Failed to generate filters");return{values:[c.values,u.values],filters:[...c.filters||[],...u.filters||[]],customColumnLabel:l}})({formData:o,data:t});({values:l,filters:c,customColumnLabel:a}=e)}else if(null!=(n=o.spatial)&&n.type){const e=(({formData:t,data:e})=>{var o,n;const r=(null==(o=e.object)||null==(o=o.points)||null==(o=o[0])?void 0:o.position)||(null==(n=e.object)?void 0:n.position);let a;if(!r&&e.coordinate&&e.viewport&&(a=(({pickedCoordinates:t,viewport:e})=>{const o=.3/Math.pow(2,e.zoom/2);return{from:[t[0]-o,t[1]-o],to:[t[0]+o,t[1]+o]}})({pickedCoordinates:e.coordinate,viewport:e.viewport})),!t.spatial)throw new Error("Spatial data is required");return i({position:r,positionBounds:a,spatialData:t.spatial})})({formData:o,data:t});({values:l,filters:c,customColumnLabel:a}=e)}else if(o.line_column){const e=(({formData:t,data:e})=>{var o,n;const r=(null==e||null==(o=e.object)?void 0:o.path)||(null==(n=e.object)?void 0:n.polygon),a=JSON.stringify(r);if(!t.line_column)throw new Error("Line column is required");if(!r)throw new Error("Position of picked data is required");return{values:[a],filters:[{col:{expressionType:"SQL",sqlExpression:`REPLACE(${t.line_column}, ' ', '')`,label:t.line_column},op:"==",val:a}]}})({formData:o,data:t});({values:l,filters:c,customColumnLabel:a}=e)}else{if(!o.geojson)throw new Error("No valid spatial configuration found in form data");{const e=(({formData:t,data:e})=>{var o;const n=null==(o=e.object)||null==(o=o.geometry)?void 0:o.coordinates;if(!n)throw new Error("Position of picked data is required");const r=`%${JSON.stringify(n)}%`;return{values:[r],filters:[{col:{expressionType:"SQL",sqlExpression:`REPLACE(${t.geojson}, ' ', '')`,label:t.geojson},op:"LIKE",val:r}]}})({formData:o,data:t});({values:l,filters:c,customColumnLabel:a}=e)}}const u=l&&(null==e||null==(r=e.value)?void 0:r.every(((t,e)=>t.toString()===l[e].toString())));return u&&(l=[]),{dataMask:{extraFormData:{filters:l.length?c:[]},filterState:{value:l.length?l:null,...a&&l.length?{customColumnLabel:a}:{}}},isCurrentValueSelected:u||!1}};var u=o(19375),p=o(49443),d=o(55602);function f({formData:t,setDataMask:e,setTooltip:o,setTooltipContent:n,onSelect:a,onContextMenu:l,filterState:i,emitCrossFilters:s}){const u=t;let p,d,f=n;return u.js_tooltip&&(f=(0,r.A)(u.js_tooltip)),f&&(p=t=>(t.picked?o({content:f(t),x:t.x,y:t.y}):o(null),!0)),u.js_onclick_href?d=t=>{const e=(0,r.A)(u.js_onclick_href)(t);return window.open(e),!0}:u.table_filter&&void 0!==a?d=t=>(a(t.object[u.line_column]),!0):s&&(d=(o,n)=>{const r=c({data:o,filterState:i,formData:t});n.leftButton&&void 0!==e&&r?e(r.dataMask):n.rightButton&&void 0!==l&&l(n.center.x,n.center.y,{drillToDetail:[],crossFilter:r,drillBy:{}})}),{onClick:d,onHover:p,pickable:Boolean(p||d)}}const m={p1:.01,p5:.05,p95:.95,p99:.99},h={sum:n.sum,min:n.min,max:n.max,mean:n.mean,median:n.median,variance:n.variance,deviation:n.deviation};function v(t="sum",e=null){if("count"===t)return t=>t.length;let o;if(t in m)o=(o,r)=>{let a;return a=e?o.sort(((t,o)=>(0,n.ascending)(e(t),e(o)))):o.sort(n.ascending),(0,n.quantile)(a,m[t],r)};else{if(!(t in h))throw new Error(`Unsupported aggregation type: ${t}`);o=h[t]}return e?t=>o(t.map((t=>e(t)))):t=>o(t)}const g=(t,e,o)=>{const n=t(e);if(void 0!==n&&!Array.isArray(n))return o.findIndex((t=>n>=t.minValue&&n<=t.maxValue))+1},w=({colorSchemeType:t,fixedColor:e,colorBreakpoints:o,colorScale:n,defaultBreakpointsColor:r})=>{let a;switch(t){case u.wP.linear_palette:case u.wP.categorical_palette:a=null==n?void 0:n.range().map((t=>(0,p.hexToRGB)(t)));break;case u.wP.color_breakpoints:{var l;const t=r?[r.r,r.g,r.b,255*r.a]:[d.DL.r,d.DL.g,d.DL.b,255*d.DL.a];a=null==o?void 0:o.map((e=>e.color?[e.color.r,e.color.g,e.color.b,255*e.color.a]:t)),null==(l=a)||l.unshift(t);break}default:{const t=e||{r:d.DL.r,g:d.DL.g,b:d.DL.b,a:d.DL.a};a=[[t.r,t.g,t.b,255*t.a]]}}return a}},70957:(t,e,o)=>{o.d(e,{S:()=>v});var n=o(2404),r=o.n(n),a=o(2445),l=o(96540),i=o(88813),s=o(3506),c=o(83505),u=o(72234),p=o(58642);const d=u.I4.div`
  ${({theme:t,top:e,left:o})=>`\n    position: absolute;\n    top: ${e}px;\n    left: ${o}px;\n    padding: ${2*t.sizeUnit}px;\n    margin: ${2*t.sizeUnit}px;\n    background: ${t.colors.grayscale.dark2};\n    color: ${t.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${t.fontSizeSM}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}
`;function f(t){const{tooltip:e}=t;if(null==e)return null;const{x:o,y:n,content:r}=e,l="string"==typeof r?(0,p.nn)(r):r;return(0,a.Y)(d,{top:n,left:o,children:l})}var m=o(49672);const h=(0,l.memo)((0,l.forwardRef)(((t,e)=>{var o;const[n,u]=(0,l.useState)(null),[p,d]=(0,l.useState)(null),[h,v]=(0,l.useState)(t.viewport),g=(0,c.Z)(t.viewport),w=(0,l.useRef)(null);(0,l.useEffect)((()=>()=>{var t;null==(t=w.current)||null==(t=t.getExtension("WEBGL_lose_context"))||t.loseContext()}),[]),(0,l.useImperativeHandle)(e,(()=>({setTooltip:u})),[]);const b=(0,l.useCallback)((()=>{if(p&&Date.now()-p>250){const e=t.setControlValue;e&&e("viewport",h),d(null)}}),[p,t.setControlValue,h]);(0,l.useEffect)((()=>{const t=setInterval(b,250);return clearInterval(t)}),[b]),(0,l.useEffect)((()=>{r()(t.viewport,g)||v(t.viewport)}),[g,t.viewport]);const y=(0,l.useCallback)((({viewState:t})=>{v(t),d(Date.now())}),[]),x=(0,l.useCallback)((()=>{var e,o;return(null!=(e=t.mapStyle)&&e.startsWith(m.GU)||m.hw.some((e=>{var o;return null==(o=t.mapStyle)?void 0:o.includes(e)})))&&!1===t.layers.some((t=>"function"!=typeof t&&"tile-layer"===(null==t?void 0:t.id)))&&t.layers.unshift((0,m.Up)((null!=(o=t.mapStyle)?o:"").replace(m.GU,""),"tile-layer")),t.layers.some((t=>"function"==typeof t))?t.layers.map((t=>"function"==typeof t?t():t)):t.layers}),[t.layers,t.mapStyle]),{children:k=null,height:C,width:S}=t;return(0,a.FD)(a.FK,{children:[(0,a.FD)("div",{style:{position:"relative",width:S,height:C},onContextMenu:t=>{t.preventDefault(),t.stopPropagation()},children:[(0,a.Y)(s.A,{controller:!0,width:S,height:C,layers:x(),viewState:h,onViewStateChange:y,onAfterRender:t=>{w.current=t.gl},children:(null==(o=t.mapStyle)?void 0:o.startsWith(m.Pn))&&(0,a.Y)(i.b,{preserveDrawingBuffer:!0,mapStyle:t.mapStyle||"light",mapboxApiAccessToken:t.mapboxApiAccessToken})}),k]}),(0,a.Y)(f,{tooltip:n})]})}))),v=(0,u.I4)(h)`
  .deckgl-tooltip > div {
    overflow: hidden;
    text-overflow: ellipsis;
  }
`},95490:(t,e,o)=>{o.d(e,{A:()=>s});var n=o(55016),r=o(35e3);const a=[-90,90],l=[-180,180];function i([t,e],[o,n],r=.25){return t<e?[t,e]:[Math.max(o,t-r),Math.min(n,e+r)]}function s(t,{points:e,width:o,height:s,minExtent:c,maxZoom:u,offset:p,padding:d=20}){const{bearing:f,pitch:m}=t,h=function(t){const e=i((0,r.extent)(t,(t=>t[1])),a),o=i((0,r.extent)(t,(t=>t[0])),l);return[[o[0],e[0]],[o[1],e[1]]]}(e);try{return{...(0,n.Fe)({bounds:h,width:o,height:s,minExtent:c,maxZoom:u,offset:p,padding:d}),bearing:f,pitch:m}}catch(t){console.error("Could not fit viewport",t)}return t}}}]);
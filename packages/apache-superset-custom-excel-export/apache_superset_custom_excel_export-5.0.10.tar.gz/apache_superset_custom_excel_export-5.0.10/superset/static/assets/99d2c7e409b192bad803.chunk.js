"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1937],{41937:(t,e,o)=>{o.r(e),o.d(e,{default:()=>m,getLayer:()=>f,getPoints:()=>d});var a=o(2445),r=o(50138),l=o(36770),n=o(95579),i=o(68291),s=o(47823),c=o(32548);const u=1609.34;function d(t){return t.map((t=>t.position))}function p(t,e){return o=>{var r,i,s,u,d,p,f;const m=(null==e?void 0:e[t.point_radius_fixed.value])||(0,l.A)(null==(r=t.point_radius_fixed)?void 0:r.value);return(0,a.FD)("div",{className:"deckgl-tooltip",children:[(0,a.Y)(c.A,{label:(0,n.t)("Longitude and Latitude")+": ",value:`${null==(i=o.object)||null==(i=i.position)?void 0:i[0]}, ${null==(s=o.object)||null==(s=s.position)?void 0:s[1]}`}),(null==(u=o.object)?void 0:u.cat_color)&&(0,a.Y)(c.A,{label:(0,n.t)("Category")+": ",value:`${null==(d=o.object)?void 0:d.cat_color}`}),(null==(p=o.object)?void 0:p.metric)&&(0,a.Y)(c.A,{label:`${m}: `,value:`${null==(f=o.object)?void 0:f.metric}`})]})}}const f=function({formData:t,payload:e,setTooltip:o,setDataMask:a,filterState:l,onContextMenu:n,datasource:s,emitCrossFilters:c}){const d=t,f=e.data.features.map((t=>{let e=(o=d.point_unit,a=t.radius,("square_m"===o?Math.sqrt(a/Math.PI):"radius_m"===o?a:"radius_km"===o?1e3*a:"radius_miles"===o?a*u:"square_km"===o?1e3*Math.sqrt(a/Math.PI):"square_miles"===o?Math.sqrt(a/Math.PI)*u:null)||10);var o,a;if(d.multiplier&&(e*=d.multiplier),t.color)return{...t,radius:e};const r=d.color_picker||{r:0,g:0,b:0,a:1},l=[r.r,r.g,r.b,255*r.a];return{...t,radius:e,color:l}}));return new r.A({id:`scatter-layer-${d.slice_id}`,data:f,fp64:!0,getFillColor:t=>t.color,getRadius:t=>t.radius,radiusMinPixels:Number(d.min_radius)||void 0,radiusMaxPixels:Number(d.max_radius)||void 0,stroked:!1,...(0,i.T$)({formData:d,setTooltip:o,setTooltipContent:p(d,null==s?void 0:s.verboseMap),setDataMask:a,filterState:l,onContextMenu:n,emitCrossFilters:c})})},m=(0,s.c)(f,d)},47823:(t,e,o)=>{o.d(e,{c:()=>k,y:()=>C});var a=o(2404),r=o.n(a),l=o(2445),n=o(96540),i=o(83505),s=o(70957),c=o(94963),u=o(66671),d=o(49443),p=o(25564),f=o(95490),m=o(19375),b=o(49672),h=o(55602);const{getScale:g}=c;function _(t,e){const o=t.color_picker||{r:0,g:0,b:0,a:1},a=[o.r,o.g,o.b,255*o.a],r=t.color_scheme,l=g(r);let n={};return t.color_scheme_type===m.wP.color_breakpoints?n=(0,b.BK)(t.color_breakpoints):e.forEach((e=>{if(null!=e.cat_color&&!n.hasOwnProperty(e.cat_color)){let r;r=t.dimension?(0,d.hexToRGB)(l(e.cat_color,t.sliceId),255*o.a):a,n[e.cat_color]={color:r,enabled:!0}}})),n}const v=t=>{const e=(0,n.useRef)(null),o=(0,n.useCallback)((()=>{let e={...t.viewport};return t.formData.autozoom&&(e=(0,f.A)(e,{width:t.width,height:t.height,points:t.getPoints(t.payload.data.features||[])})),e.zoom<0&&(e.zoom=0),e}),[t]),[a,r]=(0,n.useState)(_(t.formData,t.payload.data.features||[])),[i,c]=(0,n.useState)(t.payload.form_data),[b,v]=(0,n.useState)(o());(0,n.useEffect)((()=>{if(t.payload.form_data!==i){const e=t.payload.data.features||[],a=_(t.formData,e);v(o()),c(t.payload.form_data),r(a)}}),[o,t,i]);const y=(0,n.useCallback)((t=>{const{current:o}=e;o&&o.setTooltip(t)}),[]),C=(0,n.useCallback)(((t,e,o)=>{const a=e.color_scheme,r=g(a);let l;switch(o){case m.wP.fixed_color:return l=e.color_picker||{r:0,g:0,b:0,a:100},t.map((t=>({...t,color:[l.r,l.g,l.b,255*l.a]})));case m.wP.categorical_palette:return t.map((t=>({...t,color:(0,d.hexToRGB)(r(t.cat_color,e.slice_id))})));case m.wP.color_breakpoints:{const o=e.deafult_breakpoint_color?[e.deafult_breakpoint_color.r,e.deafult_breakpoint_color.g,e.deafult_breakpoint_color.b,255*e.deafult_breakpoint_color.a]:[h.DL.r,h.DL.g,h.DL.b,255*h.DL.a];return t.map((t=>{var a;const r=null==(a=e.color_breakpoints)?void 0:a.find((e=>t.metric>=e.minValue&&t.metric<=e.maxValue));return{...t,color:r?[null==r?void 0:r.color.r,null==r?void 0:r.color.g,null==r?void 0:r.color.b,255*(null==r?void 0:r.color.a)]:o}}))}default:return[]}}),[]),k=(0,n.useCallback)((()=>{const{getLayer:e,payload:o,formData:r,onAddFilter:l,onContextMenu:n,filterState:i,setDataMask:s,emitCrossFilters:c}=t;let u=o.data.features?[...o.data.features]:[];const d=r.color_scheme_type;return u=C(u,r,d),r.js_data_mutator&&(u=(0,p.A)(r.js_data_mutator)(u)),r.dimension&&(u=u.filter((t=>{var e;return null==(e=a[t.cat_color])?void 0:e.enabled}))),[e({formData:r,payload:{...o,data:{...o.data,features:u}},onAddFilter:l,setTooltip:y,datasource:t.datasource,onContextMenu:n,filterState:i,setDataMask:s,emitCrossFilters:c})]}),[C,a,t,y]),x=(0,n.useCallback)((t=>{const e=a[t],o={...a,[t]:{...e,enabled:!e.enabled}};Object.values(o).every((t=>!t.enabled))&&Object.values(o).forEach((t=>{t.enabled=!0})),r(o)}),[a]),D=(0,n.useCallback)((t=>{const e={...a};Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,r(e)}),[a]);return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:e,viewport:b,layers:k(),setControlValue:t.setControlValue,mapStyle:t.formData.mapbox_style,mapboxApiAccessToken:t.mapboxApiKey,width:t.width,height:t.height}),(0,l.Y)(u.A,{forceCategorical:!0,categories:a,format:t.formData.legend_format,position:t.formData.legend_position,showSingleCategory:D,toggleCategory:x})]})},y=(0,n.memo)(v);function C(t,e){return(0,n.memo)((o=>{const a=(0,n.useRef)(),c=(0,i.Z)(o.formData),d=(0,i.Z)(o.filterState),p=(0,i.Z)(o.payload),[m,h]=(0,n.useState)((0,b.BK)(o.formData.color_breakpoints)||[]),[g,_]=(0,n.useState)((()=>{const{width:t,height:a,formData:r}=o;return r.autozoom?(0,f.A)(o.viewport,{width:t,height:a,points:e(o.payload.data.features)}):o.viewport})()),v=(0,n.useCallback)((t=>{const{current:e}=a;e&&(null==e||e.setTooltip(t))}),[]),y=(0,n.useCallback)((e=>{const{formData:o,payload:a,onAddFilter:r,filterState:l,setDataMask:n,onContextMenu:i,emitCrossFilters:s}=e;return t({formData:o,payload:a,onAddFilter:r,setTooltip:v,setDataMask:n,onContextMenu:i,filterState:l,emitCrossFilters:s})}),[v]);(0,n.useEffect)((()=>{const t=(0,b.BK)(o.formData.color_breakpoints);h(t)}),[o]);const[C,k]=(0,n.useState)(y(o));(0,n.useEffect)((()=>{const t={...c,...d,viewport:null},e={...o.formData,...o.filterState,viewport:null};r()(t,e)&&p===o.payload||k(y(o))}),[y,c,d,p,o]);const{formData:x,payload:D,setControlValue:w,height:M,width:A}=o;return(0,l.FD)("div",{style:{position:"relative"},children:[(0,l.Y)(s.S,{ref:a,mapboxApiAccessToken:D.data.mapboxApiKey,viewport:g,layers:[C],mapStyle:x.mapbox_style,setControlValue:w,width:A,height:M,onViewportChange:_}),(0,l.Y)(u.A,{forceCategorical:!0,categories:m,format:o.formData.legend_format,position:o.formData.legend_position})]})}))}function k(t,e){return function(o){const{datasource:a,formData:r,height:n,payload:i,setControlValue:s,viewport:c,width:u,setDataMask:d,filterState:p,onContextMenu:f,emitCrossFilters:m}=o;return(0,l.Y)(y,{datasource:a,formData:r,mapboxApiKey:i.data.mapboxApiKey,setControlValue:s,viewport:c,getLayer:t,payload:i,getPoints:e,width:u,height:n,setDataMask:d,onContextMenu:f,filterState:p,emitCrossFilters:m})}}},66671:(t,e,o)=>{o.d(e,{A:()=>u});var a=o(2445),r=o(96540),l=o(72234),n=o(32142);const i=l.I4.div`
  ${({theme:t})=>`\n    font-size: ${t.fontSizeSM}px;\n    position: absolute;\n    background: ${t.colors.grayscale.light5};\n    box-shadow: 0 0 ${t.sizeUnit}px ${t.colors.grayscale.light2};\n    margin: ${6*t.sizeUnit}px;\n    padding: ${3*t.sizeUnit}px ${5*t.sizeUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        display: flex;\n        color: ${t.colors.grayscale.base};\n        text-decoration: none;\n        padding: ${t.sizeUnit}px 0;\n\n        & span {\n          margin-right: ${t.sizeUnit}px;\n        }\n      }\n    }\n  `}
`,s=" - ",c=({format:t=null,forceCategorical:e=!1,position:o="tr",categories:r={},toggleCategory:l=()=>{},showSingleCategory:c=()=>{}})=>{const u=o=>{if(!t||e)return o;const a=parseFloat(o);return(0,n.ZV)(t,a)},d=e=>{if(!t)return e;if(e.includes(s)){const t=e.split(s);return u(t[0])+s+u(t[1])}return u(e)};if(0===Object.keys(r).length||null===o)return null;const p=Object.entries(r).map((([t,e])=>{var o;const r={color:`rgba(${null==(o=e.color)?void 0:o.join(", ")})`},n=e.enabled?"◼":"◻";return(0,a.Y)("li",{children:(0,a.FD)("a",{href:"#",role:"button",onClick:()=>l(t),onDoubleClick:()=>c(t),children:[(0,a.Y)("span",{style:r,children:n})," ",d(t)]})},t)})),f="t"===(null==o?void 0:o.charAt(0))?"top":"bottom",m="r"===(null==o?void 0:o.charAt(1))?"right":"left",b={position:"absolute",[f]:"0px",[m]:"10px"};return(0,a.Y)(i,{className:"dupa",style:b,children:(0,a.Y)("ul",{children:p})})},u=(0,r.memo)(c)}}]);
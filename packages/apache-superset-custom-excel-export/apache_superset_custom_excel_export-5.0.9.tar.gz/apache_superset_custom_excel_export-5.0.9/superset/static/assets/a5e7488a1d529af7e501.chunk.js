"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1437],{13260:(e,t,r)=>{r.r(t),r.d(t,{default:()=>V});var a=r(2445),l=r(96540),i=r(61574),n=r(72391),o=r(95579),s=r(93505),c=r(72234),d=r(17437),u=r(35742),p=r(95070),h=r(97470),m=r(38380);p.XV.updateLocale("en",{calendar:{lastDay:"[Yesterday at] LTS",sameDay:"[Today at] LTS",nextDay:"[Tomorrow at] LTS",lastWeek:"[last] dddd [at] LTS",nextWeek:"dddd [at] LTS",sameElse:"L"}});const b=c.I4.span`
  color: ${({theme:e})=>e.colorText};
`,g=({updatedAt:e,update:t})=>{const r=(0,c.DP)(),[i,n]=(0,l.useState)((0,p.XV)(e));return(0,l.useEffect)((()=>{n((()=>(0,p.XV)(e)));const t=setInterval((()=>{n((()=>(0,p.XV)(e)))}),6e4);return()=>clearInterval(t)}),[e]),(0,a.FD)(b,{children:[(0,o.t)("Last Updated %s",i.isValid()?i.calendar():"--"),t&&(0,a.Y)(m.F.SyncOutlined,{css:d.AH`
            margin-left: ${2*r.sizeUnit}px;
          `,onClick:t})]})};var y=r(27395),k=r(83197),O=r(44344),S=r(51713),f=r(12609),w=r(27023),v=r(5261),A=r(88014),C=r(47815);const T=e=>d.AH`
  color: ${e.colors.grayscale.light1};
  margin-right: ${2*e.sizeUnit}px;
`;function x({type:e}){const t={icon:null,label:""};switch(e){case C.yV.Email:t.icon=(0,a.Y)(m.F.MailOutlined,{css:T,iconSize:"l"}),t.label=C.yV.Email;break;case C.yV.Slack:case C.yV.SlackV2:t.icon=(0,a.Y)(m.F.Slack,{css:T,iconSize:"l"}),t.label=C.yV.Slack;break;default:t.icon=null,t.label=""}return t.icon?(0,a.Y)(h.m,{title:t.label,placement:"bottom",children:t.icon}):null}var z=r(50500),_=r(30703),E=r(65256),Y=r(67688),F=r(23193),D=r(7464);const R=(0,n.a)(),H={[C.Or.Success]:(0,o.t)("Success"),[C.Or.Working]:(0,o.t)("Working"),[C.Or.Error]:(0,o.t)("Error"),[C.Or.Noop]:(0,o.t)("Not triggered"),[C.Or.Grace]:(0,o.t)("On Grace")},L=(0,s.A)({requestType:"rison",method:"DELETE",endpoint:"/api/v1/report/"}),N=c.I4.div`
  ${({theme:e})=>d.AH`
    margin-top: ${e.sizeUnit}px;
    width: 100%;
    padding: ${2*e.sizeUnit}px 0px ${3*e.sizeUnit}px;
  `}
`,$=c.I4.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  > *:first-child {
    margin-right: ${({theme:e})=>e.sizeUnit}px;
  }
`,W=R.get("alertsreports.header.icon"),V=(0,v.Ay)((function({addDangerToast:e,isReportEnabled:t=!1,user:r,addSuccessToast:n}){const s=t?(0,o.t)("Report"):(0,o.t)("Alert"),c=t?(0,o.t)("reports"):(0,o.t)("alerts"),d=t?"Reports":"Alerts",b=(0,l.useMemo)((()=>[{id:"type",operator:O.c0.Equals,value:t?"Report":"Alert"}]),[t]),{state:{loading:v,resourceCount:T,resourceCollection:R,bulkSelectEnabled:V,lastFetched:B},hasPerm:U,fetchData:M,setResourceCollection:G,refreshData:I,toggleBulkSelect:P}=(0,z.RU)("report",(0,o.t)("report"),e,!0,void 0,b),{updateResource:X}=(0,z.fn)("report",(0,o.t)("reports"),e),[J,q]=(0,l.useState)(!1),[K,j]=(0,l.useState)(null),[Q,Z]=(0,l.useState)(null);function ee(e){j(e),q(!0)}const te=U("can_write"),re=U("can_write"),ae=U("can_write");(0,l.useEffect)((()=>{V&&re&&P()}),[t]);const le=[{id:"name",desc:!0}],ie=(0,l.useCallback)(((e,t)=>{if(null!=e&&e.id){const r=e.id,a=[...R];G(a.map((r=>(null==r?void 0:r.id)===e.id?{...r,active:t}:r))),X(r,{active:t},!1,!1).then().catch((()=>G(a)))}}),[R,G,X]),ne=(0,l.useMemo)((()=>[{Cell:({row:{original:{last_state:e}}})=>(0,a.Y)(A.A,{state:e,isReportEnabled:t}),accessor:"last_state",size:"xs",disableSortBy:!0,id:"last_state"},{Cell:({row:{original:{last_eval_dttm:e}}})=>e?p.XV.utc(e).local().format(w.QU):"",accessor:"last_eval_dttm",Header:(0,o.t)("Last run"),size:"lg",id:"last_eval_dttm"},{accessor:"name",Header:(0,o.t)("Name"),size:"xl",id:"name"},{Header:(0,o.t)("Schedule"),accessor:"crontab_humanized",size:"xl",Cell:({row:{original:{crontab_humanized:e="",timezone:t}}})=>(0,a.Y)(h.m,{title:`${e} (${t})`,placement:"topLeft",children:(0,a.Y)("span",{children:`${e} (${t})`})}),id:"crontab_humanized"},{Cell:({row:{original:{recipients:e}}})=>e.map((e=>(0,a.Y)(x,{type:e.type},e.id))),accessor:"recipients",Header:(0,o.t)("Notification method"),disableSortBy:!0,size:"xl",id:"recipients"},{Cell:({row:{original:{owners:e=[]}}})=>(0,a.Y)(O.WM,{users:e}),Header:(0,o.t)("Owners"),id:"owners",disableSortBy:!0,size:"xl"},{Cell:({row:{original:{changed_on_delta_humanized:e,changed_by:t}}})=>(0,a.Y)(O.UW,{date:e,user:t}),Header:(0,o.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl",id:"changed_on_delta_humanized"},{Cell:({row:{original:e}})=>{const t=e.owners.map((e=>e.id)).includes(r.userId)||(0,E.N6)(r);return(0,a.Y)(f.A,{disabled:!t,"data-test":"toggle-active",checked:e.active,onClick:t=>ie(e,t),size:"small"})},Header:(0,o.t)("Active"),accessor:"active",id:"active",size:"xl"},{Cell:({row:{original:e}})=>{const t=(0,i.W6)(),l=e.owners.map((e=>e.id)).includes(r.userId)||(0,E.N6)(r),n=[te?{label:"execution-log-action",tooltip:(0,o.t)("Execution log"),placement:"bottom",icon:"FileTextOutlined",onClick:()=>t.push(`/${e.type.toLowerCase()}/${e.id}/log`)}:null,te?{label:l?"edit-action":"preview-action",tooltip:l?(0,o.t)("Edit"):(0,o.t)("View"),placement:"bottom",icon:l?"EditOutlined":"Binoculars",onClick:()=>ee(e)}:null,l&&re?{label:"delete-action",tooltip:(0,o.t)("Delete"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>Z(e)}:null].filter((e=>null!==e));return(0,a.Y)(O.kv,{actions:n})},Header:(0,o.t)("Actions"),id:"actions",hidden:!te&&!re,disableSortBy:!0,size:"xl"},{accessor:F.H.ChangedBy,hidden:!0,id:F.H.ChangedBy}]),[re,te,t,ie]),oe=[];re&&oe.push({name:(0,o.t)("Bulk select"),onClick:P,buttonStyle:"secondary","data-test":"bulk-select-toggle"}),ae&&oe.push({icon:(0,a.Y)(m.F.PlusOutlined,{iconSize:"m"}),name:(0,o.t)(s),buttonStyle:"primary",onClick:()=>{ee(null)}});const se={title:(0,o.t)("No %s yet",c),image:"filter-results.svg",buttonAction:()=>ee(null),buttonText:ae?(0,a.FD)(a.FK,{children:[(0,a.Y)(m.F.PlusOutlined,{iconSize:"m","data-test":"add-annotation-layer-button"}),s," "]}):null},ce=(0,l.useMemo)((()=>[{Header:(0,o.t)("Name"),key:"search",id:"name",input:"search",operator:O.c0.Contains},{Header:(0,o.t)("Owner"),key:"owner",id:"owners",input:"select",operator:O.c0.RelationManyMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,_.u1)("report","owners",(0,_.JF)((e=>(0,o.t)("An error occurred while fetching owners values: %s",e))),r),paginate:!0,dropdownStyle:{minWidth:D.f8}},{Header:(0,o.t)("Status"),key:"status",id:"last_state",input:"select",operator:O.c0.Equals,unfilteredLabel:"Any",selects:[{label:H[C.Or.Success],value:C.Or.Success},{label:H[C.Or.Working],value:C.Or.Working},{label:H[C.Or.Error],value:C.Or.Error},{label:H[C.Or.Noop],value:C.Or.Noop},{label:H[C.Or.Grace],value:C.Or.Grace}]},{Header:(0,o.t)("Modified by"),key:"changed_by",id:"changed_by",input:"select",operator:O.c0.RelationOneMany,unfilteredLabel:(0,o.t)("All"),fetchSelects:(0,_.u1)("report","changed_by",(0,_.JF)((e=>(0,o.t)("An error occurred while fetching dataset datasource values: %s",e))),r),paginate:!0,dropdownStyle:{minWidth:D.f8}}]),[]),de=W?(0,a.FD)($,{children:[(0,a.Y)("div",{children:(0,o.t)("Alerts & reports")}),(0,a.Y)(W,{})]}):(0,o.t)("Alerts & reports");return(0,a.FD)(a.FK,{children:[(0,a.Y)(S.A,{activeChild:d,name:de,tabs:[{name:"Alerts",label:(0,o.t)("Alerts"),url:"/alert/list/",usesRouter:!0,"data-test":"alert-list",id:"alert-tab","aria-controls":"alert-list"},{name:"Reports",label:(0,o.t)("Reports"),url:"/report/list/",usesRouter:!0,"data-test":"report-list",id:"report-tab","aria-controls":"report-list"}],buttons:oe,children:(0,a.Y)(N,{children:(0,a.Y)(g,{updatedAt:B,update:()=>I()})})}),(0,a.Y)(Y.Ay,{alert:K,addDangerToast:e,layer:K,onHide:()=>{q(!1),j(null),I()},show:J,isReport:t},(null==K?void 0:K.id)||`${(new Date).getTime()}`),Q&&(0,a.Y)(y.T,{description:(0,o.t)("This action will permanently delete %s.",Q.name),onConfirm:()=>{Q&&(({id:t,name:r})=>{u.A.delete({endpoint:`/api/v1/report/${t}`}).then((()=>{I(),Z(null),n((0,o.t)("Deleted: %s",r))}),(0,_.JF)((t=>e((0,o.t)("There was an issue deleting %s: %s",r,t)))))})(Q)},onHide:()=>Z(null),open:!0,title:(0,o.t)("Delete %s?",s)}),(0,a.Y)(k.h,{title:(0,o.t)("Please confirm"),description:(0,o.t)("Are you sure you want to delete the selected %s?",c),onConfirm:async t=>{try{const{message:e}=await L(t.map((({id:e})=>e)));I(),n(e)}catch(t){(0,_.JF)((t=>e((0,o.t)("There was an issue deleting the selected %s: %s",c,t))))(t)}},children:r=>{const l=re?[{key:"delete",name:(0,o.t)("Delete"),onSelect:r,type:"danger"}]:[];return(0,a.Y)("div",{id:t?"report-list":"alert-list",role:"tabpanel","aria-labelledby":t?"report-tab":"alert-tab",children:(0,a.Y)(O.uO,{className:"alerts-list-view",columns:ne,count:T,data:R,emptyState:se,fetchData:M,filters:ce,initialSort:le,loading:v,bulkActions:l,bulkSelectEnabled:V,disableBulkSelect:P,refreshData:I,addDangerToast:e,addSuccessToast:n,pageSize:25})})}})]})}))},88014:(e,t,r)=>{r.d(t,{A:()=>d});var a=r(2445),l=r(72234),i=r(95579),n=r(97470),o=r(38380),s=r(47815);function c(e,t,r){switch(e){case s.Or.Working:return r.colorPrimaryText;case s.Or.Error:return r.colorErrorText;case s.Or.Success:return t?r.colorSuccessText:r.colorErrorText;case s.Or.Noop:return r.colorSuccessText;case s.Or.Grace:return r.colorErrorText;default:return r.colorText}}function d({state:e,isReportEnabled:t=!1}){const r=(0,l.DP)(),d={icon:o.F.CheckOutlined,label:"",status:""};switch(e){case s.Or.Success:d.icon=t?o.F.CheckOutlined:o.F.WarningOutlined,d.label=t?(0,i.t)("Report sent"):(0,i.t)("Alert triggered, notification sent"),d.status=s.Or.Success;break;case s.Or.Working:d.icon=o.F.Running,d.label=t?(0,i.t)("Report sending"):(0,i.t)("Alert running"),d.status=s.Or.Working;break;case s.Or.Error:d.icon=o.F.CloseOutlined,d.label=t?(0,i.t)("Report failed"):(0,i.t)("Alert failed"),d.status=s.Or.Error;break;case s.Or.Noop:d.icon=o.F.CheckOutlined,d.label=(0,i.t)("Nothing triggered"),d.status=s.Or.Noop;break;case s.Or.Grace:d.icon=o.F.WarningOutlined,d.label=(0,i.t)("Alert Triggered, In Grace Period"),d.status=s.Or.Grace;break;default:d.icon=o.F.CheckOutlined,d.label=(0,i.t)("Nothing triggered"),d.status=s.Or.Noop}const u=d.icon;return(0,a.Y)(n.m,{title:d.label,placement:"bottomLeft",children:(0,a.Y)(u,{iconSize:"m",iconColor:c(d.status,t,r)})})}}}]);
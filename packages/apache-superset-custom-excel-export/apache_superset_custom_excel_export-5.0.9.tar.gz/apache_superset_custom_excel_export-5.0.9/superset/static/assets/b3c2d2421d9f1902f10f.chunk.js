"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[1440],{50684:(t,e,n)=>{n.r(e),n.d(e,{default:()=>B});var a=n(2445),o=n(96540),l=n(61574),d=n(71519),i=n(72234),r=n(17437),s=n(95579),c=n(35742),u=n(51436),h=n(74353),m=n.n(h),_=n(58561),p=n.n(_),g=n(27395),f=n(83197),y=n(44344),b=n(51713),Y=n(5261),D=n(50500),v=n(30703),S=n(95070),A=n(52219),w=n(84335),k=n(17355),C=n(9707),T=n(70856);const $=i.I4.div`
  margin: ${({theme:t})=>2*t.sizeUnit}px auto
    ${({theme:t})=>4*t.sizeUnit}px auto;
`,x=(0,i.I4)(A.iN)`
  border-radius: ${({theme:t})=>t.borderRadius}px;
  border: 1px solid ${({theme:t})=>t.colorPrimaryBorder};
`,H=i.I4.div`
  margin-bottom: ${({theme:t})=>5*t.sizeUnit}px;

  .control-label {
    margin-bottom: ${({theme:t})=>2*t.sizeUnit}px;
  }

  .required {
    margin-left: ${({theme:t})=>t.sizeUnit/2}px;
    color: ${({theme:t})=>t.colorError};
  }

  input[type='text'] {
    width: 65%;
  }
`,F=(0,Y.Ay)((({addDangerToast:t,addSuccessToast:e,annotationLayerId:n,annotation:l=null,onAnnotationAdd:d,onHide:i,show:r})=>{var c,u;const[h,m]=(0,o.useState)(!0),[_,p]=(0,o.useState)(null),g=null!==l,{state:{loading:f,resource:y},fetchResource:b,createResource:Y,updateResource:v}=(0,D.fn)(`annotation_layer/${n}/annotation`,(0,s.t)("annotation"),t),A=()=>{p({short_descr:"",start_dttm:"",end_dttm:"",json_metadata:"",long_descr:""})},F=()=>{g?p(y):A(),i()},N=t=>{const{target:e}=t,n={..._,end_dttm:_?_.end_dttm:"",short_descr:_?_.short_descr:"",start_dttm:_?_.start_dttm:""};n[e.name]=e.value,p(n)};return(0,o.useEffect)((()=>{if(g&&(null==_||!_.id||l&&l.id!==_.id||r)){if(null!==(null==l?void 0:l.id)&&!f){const t=l.id||0;b(t)}}else g||_&&!_.id&&!r||A()}),[l]),(0,o.useEffect)((()=>{y&&p(y)}),[y]),(0,o.useEffect)((()=>{var t,e,n;null!=_&&null!=(t=_.short_descr)&&t.length&&null!=_&&null!=(e=_.start_dttm)&&e.length&&null!=_&&null!=(n=_.end_dttm)&&n.length?m(!1):m(!0)}),[_?_.short_descr:"",_?_.start_dttm:"",_?_.end_dttm:""]),(0,a.FD)(w.aF,{disablePrimaryButton:h,onHandledPrimaryAction:()=>{if(g){if(null!=_&&_.id){const t=_.id;delete _.id,delete _.created_by,delete _.changed_by,delete _.changed_on_delta_humanized,delete _.layer,v(t,_).then((t=>{t&&(d&&d(),F(),e((0,s.t)("The annotation has been updated")))}))}}else _&&Y(_).then((t=>{t&&(d&&d(),F(),e((0,s.t)("The annotation has been saved")))}))},onHide:F,primaryButtonName:g?(0,s.t)("Save"):(0,s.t)("Add"),show:r,width:"55%",name:g?(0,s.t)("Edit annotation"):(0,s.t)("Add annotation"),title:(0,a.Y)(T.r,{"data-test":"annotation-modal-title",isEditMode:g,title:g?(0,s.t)("Edit annotation"):(0,s.t)("Add annotation")}),children:[(0,a.Y)($,{children:(0,a.Y)("h4",{children:(0,s.t)("Basic information")})}),(0,a.FD)(H,{children:[(0,a.FD)("div",{className:"control-label",children:[(0,s.t)("Name"),(0,a.Y)("span",{className:"required",children:"*"})]}),(0,a.Y)(k.A,{name:"short_descr",onChange:N,type:"text",value:null==_?void 0:_.short_descr})]}),(0,a.FD)(H,{children:[(0,a.FD)("div",{className:"control-label",children:[(0,s.t)("date"),(0,a.Y)("span",{className:"required",children:"*"})]}),(0,a.Y)(C.c,{placeholder:[(0,s.t)("Start date"),(0,s.t)("End date")],format:"YYYY-MM-DD HH:mm",onCalendarChange:(t,e)=>{var n;if(null==t||!t[0]||null==t||!t[1]){var a;const t={..._,start_dttm:"",end_dttm:"",short_descr:null!=(a=null==_?void 0:_.short_descr)?a:""};return void p(t)}const o={..._,start_dttm:t[0].format("YYYY-MM-DD HH:mm"),end_dttm:t[1].format("YYYY-MM-DD HH:mm"),short_descr:null!=(n=null==_?void 0:_.short_descr)?n:""};p(o)},showTime:{format:"hh:mm a"},use12Hours:!0,value:null!=_&&null!=(c=_.start_dttm)&&c.length||null!=_&&null!=(u=_.end_dttm)&&u.length?[(0,S.XV)(_.start_dttm),(0,S.XV)(_.end_dttm)]:null})]}),(0,a.Y)($,{children:(0,a.Y)("h4",{children:(0,s.t)("Additional information")})}),(0,a.FD)(H,{children:[(0,a.Y)("div",{className:"control-label",children:(0,s.t)("description")}),(0,a.Y)(k.A.TextArea,{name:"long_descr",value:_?_.long_descr:"",placeholder:(0,s.t)("Description (this can be seen in the list)"),onChange:N})]}),(0,a.FD)(H,{children:[(0,a.Y)("div",{className:"control-label",children:(0,s.t)("JSON metadata")}),(0,a.Y)(x,{onChange:t=>{const e={..._,end_dttm:_?_.end_dttm:"",json_metadata:t,short_descr:_?_.short_descr:"",start_dttm:_?_.start_dttm:""};p(e)},value:null!=_&&_.json_metadata?_.json_metadata:"",width:"100%",height:"120px"})]})]})}));var N=n(38380),E=n(64658);const z=i.I4.div`
  ${({theme:t})=>r.AH`
    display: flex;
    flex-direction: row;

    a,
    Link {
      margin-left: ${4*t.sizeUnit}px;
      font-size: ${t.fontSizeSM}px;
      font-weight: ${t.fontWeightNormal};
      text-decoration: underline;
    }
  `}
`,B=(0,Y.Ay)((function({addDangerToast:t,addSuccessToast:e}){const{annotationLayerId:n}=(0,l.g)(),{state:{loading:i,resourceCount:r,resourceCollection:h,bulkSelectEnabled:_},fetchData:Y,refreshData:S,toggleBulkSelect:A}=(0,D.RU)(`annotation_layer/${n}/annotation`,(0,s.t)("annotation"),t,!1),[w,k]=(0,o.useState)(!1),[C,T]=(0,o.useState)(""),[$,x]=(0,o.useState)(null),[H,B]=(0,o.useState)(null),M=t=>{x(t),k(!0)},I=(0,o.useCallback)((async function(){try{const t=await c.A.get({endpoint:`/api/v1/annotation_layer/${n}`});T(t.json.result.name)}catch(e){await(0,u.h4)(e).then((({error:e})=>{t(e.error||e.statusText||e)}))}}),[n]);(0,o.useEffect)((()=>{I()}),[I]);const U=[{id:"short_descr",desc:!0}],j=(0,o.useMemo)((()=>[{accessor:"short_descr",Header:(0,s.t)("Name"),id:"short_descr"},{accessor:"long_descr",Header:(0,s.t)("Description"),id:"long_descr"},{Cell:({row:{original:{start_dttm:t}}})=>m()(new Date(t)).format("ll"),Header:(0,s.t)("Start"),accessor:"start_dttm",id:"start_dttm"},{Cell:({row:{original:{end_dttm:t}}})=>m()(new Date(t)).format("ll"),Header:(0,s.t)("End"),accessor:"end_dttm",id:"end_dttm"},{Cell:({row:{original:t}})=>{const e=[{label:"edit-action",tooltip:(0,s.t)("Edit annotation"),placement:"bottom",icon:"EditOutlined",onClick:()=>M(t)},{label:"delete-action",tooltip:(0,s.t)("Delete annotation"),placement:"bottom",icon:"DeleteOutlined",onClick:()=>B(t)}];return(0,a.Y)(y.kv,{actions:e})},Header:(0,s.t)("Actions"),id:"actions",disableSortBy:!0}]),[!0,!0]),L=[];L.push({icon:(0,a.Y)(N.F.PlusOutlined,{iconSize:"m"}),name:(0,s.t)("Annotation"),buttonStyle:"primary",onClick:()=>{M(null)}}),L.push({name:(0,s.t)("Bulk select"),onClick:A,buttonStyle:"secondary","data-test":"annotation-bulk-select"});let O=!0;try{(0,l.W6)()}catch(t){O=!1}const P={title:(0,s.t)("No annotation yet"),image:"filter-results.svg",buttonAction:()=>{M(null)},buttonText:(0,a.FD)(a.FK,{children:[(0,a.Y)(N.F.PlusOutlined,{iconSize:"m"}),(0,s.t)("Annotation")]})};return(0,a.FD)(a.FK,{children:[(0,a.Y)(b.A,{name:(0,a.FD)(z,{children:[(0,a.Y)("span",{children:(0,s.t)("Annotation Layer %s",C)}),(0,a.Y)("span",{children:O?(0,a.Y)(d.N_,{to:"/annotationlayer/list/",children:(0,s.t)("Back to all")}):(0,a.Y)(E.o.Link,{href:"/annotationlayer/list/",children:(0,s.t)("Back to all")})})]}),buttons:L}),(0,a.Y)(F,{addDangerToast:t,addSuccessToast:e,annotation:$,show:w,onAnnotationAdd:()=>S(),annotationLayerId:n,onHide:()=>k(!1)}),H&&(0,a.Y)(g.T,{description:(0,s.t)("Are you sure you want to delete %s?",null==H?void 0:H.short_descr),onConfirm:()=>{H&&(({id:a,short_descr:o})=>{c.A.delete({endpoint:`/api/v1/annotation_layer/${n}/annotation/${a}`}).then((()=>{S(),B(null),e((0,s.t)("Deleted: %s",o))}),(0,v.JF)((e=>t((0,s.t)("There was an issue deleting %s: %s",o,e)))))})(H)},onHide:()=>B(null),open:!0,title:(0,s.t)("Delete Annotation?")}),(0,a.Y)(f.h,{title:(0,s.t)("Please confirm"),description:(0,s.t)("Are you sure you want to delete the selected annotations?"),onConfirm:a=>{c.A.delete({endpoint:`/api/v1/annotation_layer/${n}/annotation/?q=${p().encode(a.map((({id:t})=>t)))}`}).then((({json:t={}})=>{S(),e(t.message)}),(0,v.JF)((e=>t((0,s.t)("There was an issue deleting the selected annotations: %s",e)))))},children:n=>{const o=[{key:"delete",name:(0,s.t)("Delete"),onSelect:n,type:"danger"}];return(0,a.Y)(y.uO,{className:"annotations-list-view",bulkActions:o,bulkSelectEnabled:_,columns:j,count:r,data:h,disableBulkSelect:A,emptyState:P,fetchData:Y,addDangerToast:t,addSuccessToast:e,refreshData:S,initialSort:U,loading:i,pageSize:25})}})]})}))}}]);
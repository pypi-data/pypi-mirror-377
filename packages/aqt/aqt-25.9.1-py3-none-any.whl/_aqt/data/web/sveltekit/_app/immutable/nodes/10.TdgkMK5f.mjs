var Xt=Object.defineProperty;var Zt=(a,t,e)=>t in a?Xt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var k=(a,t,e)=>Zt(a,typeof t!="symbol"?t+"":t,e);import{j as xt,k as te,m as Wt,n as ee,o as se,C as rt,p as It,q as Ht,s as ae}from"../chunks/BfDh-mSI.mjs";import{aB as le,aC as Tt,aD as Bt,U as nt,I as Z,aE as oe,aF as re,aG as ne,aH as ie,aI as ue,aJ as ce,aK as de,aL as pe,aM as me,aN as ge,aO as $e,aP as fe,aQ as ve,aR as he,aS as be,aT as ye,aU as _e,aV as ke,aW as Et,aX as Ne,aY as Ce,aZ as Ie,a_ as Pe,a$ as Oe,b0 as we,b1 as Te,b2 as Se,b3 as De,b4 as Me,b5 as xe,K as Rt}from"../chunks/Ch7ZtZmv.mjs";import{d as vt,r as jt,s as G}from"../chunks/CAm1qXYJ.mjs";import{c as it}from"../chunks/BgpSSuxP.mjs";import{i as ft,S as He}from"../chunks/5xkFRAct.mjs";import"../chunks/BbkoyQuY.mjs";import{i as tt}from"../chunks/-ESH3Vzs.mjs";import{p as et,l as yt,s as K,m as J,k as v,a as St,h as A,f as z,n as B,t as Y,b as L,c as g,r as x,Y as S,g as d,d as st,u as l,j as F,e as Ot,i as ut}from"../chunks/D0Kcqh4a.mjs";import{p as H,i as wt,c as q,s as V,a as mt,b as Yt,m as qt}from"../chunks/8hkm7YIM.mjs";import{R as pt,e as ht,i as bt}from"../chunks/B9FzK2Aa.mjs";import{I as Ee}from"../chunks/BNj15lru.mjs";import{a as Re}from"../chunks/YQoxH8jz.mjs";import{T as Dt}from"../chunks/BYOoq_0E.mjs";import{C as _t}from"../chunks/BfZOIeoG.mjs";import{H as j,a as Kt}from"../chunks/CmYyQsAK.mjs";import{E as dt,a as X,S as je,C as Fe,R as ze}from"../chunks/CPuIZvQd.mjs";import{W as Jt}from"../chunks/DDmBsGOt.mjs";import{T as Ae}from"../chunks/BIuyLrsH.mjs";function Ft(){}function at(a){return a.notetype.case==="globalNotetype"?a.notetype.value:null}function Pt(a){return a.deck.case==="deckId"?a.deck.value:0n}function Ge(a){return a.deck.case==="deckName"?a.deck.value:null}class Le{constructor(t,e,u,s){k(this,"path");k(this,"deckNameIds");k(this,"notetypeNameIds");k(this,"defaultDelimiter");k(this,"defaultIsHtml");k(this,"defaultNotetypeId");k(this,"defaultDeckId");k(this,"newDeckName");k(this,"metadata");k(this,"globalNotetype");k(this,"deckId");k(this,"fieldNames");k(this,"columnOptions");k(this,"lastMetadata");k(this,"lastGlobalNotetype");k(this,"lastDeckId");k(this,"fieldNamesSetter",Ft);k(this,"columnOptionsSetter",Ft);var o;this.path=t,this.deckNameIds=u.entries,this.notetypeNameIds=e.entries,this.lastMetadata=it(s),this.metadata=vt(s),this.metadata.subscribe(this.onMetadataChanged.bind(this));const r=at(s);this.lastGlobalNotetype=it(at(s)),this.globalNotetype=vt(it(r)),this.globalNotetype.subscribe(this.onGlobalNotetypeChanged.bind(this)),this.lastDeckId=Pt(s),this.deckId=vt(Pt(s)),this.deckId.subscribe(this.onDeckIdChanged.bind(this)),this.fieldNames=jt(r===null?Promise.resolve([]):xt({ntid:r.id}).then(i=>i.vals),i=>{this.fieldNamesSetter=i}),this.columnOptions=jt(zt(s),i=>{this.columnOptionsSetter=i}),this.defaultDelimiter=s.delimiter,this.defaultIsHtml=s.isHtml,this.defaultNotetypeId=((o=this.lastGlobalNotetype)==null?void 0:o.id)||null,this.defaultDeckId=this.lastDeckId,this.newDeckName=Ge(s)}doImport(){return te({path:this.path,metadata:{...this.lastMetadata,preview:[]}},{alertOnError:!1})}async onMetadataChanged(t){var s,r;if(ft(t,this.lastMetadata))return;const e=this.shouldRefetchMetadata(t);if(e){const{globalTags:o,updatedTags:i}=t;t=await Wt({path:this.path,delimiter:t.delimiter,notetypeId:(s=at(t))==null?void 0:s.id,deckId:Pt(t)||void 0,isHtml:t.isHtml}),t.globalTags=o,t.updatedTags=i}const u=at(t);this.globalNotetype.set(u),u!==null&&u.id!==((r=at(this.lastMetadata))==null?void 0:r.id)&&this.fieldNamesSetter(xt({ntid:u.id}).then(o=>o.vals)),this.shouldRebuildColumnOptions(t)&&this.columnOptionsSetter(zt(t)),this.lastMetadata=it(t),e&&this.metadata.set(t)}shouldRefetchMetadata(t){var e,u;return t.delimiter!==this.lastMetadata.delimiter||t.isHtml!==this.lastMetadata.isHtml||((e=at(t))==null?void 0:e.id)!==((u=at(this.lastMetadata))==null?void 0:u.id)}shouldRebuildColumnOptions(t){return!ft(t.columnLabels,this.lastMetadata.columnLabels)||!ft(t.preview[0],this.lastMetadata.preview[0])}onGlobalNotetypeChanged(t){ft(t,this.lastGlobalNotetype)||(this.lastGlobalNotetype=it(t),t!==null&&this.metadata.update(e=>(e.notetype.value=t,e)))}onDeckIdChanged(t){t!==this.lastDeckId&&(this.lastDeckId=t,t!==null&&this.metadata.update(e=>(t!==0n?(e.deck.case="deckId",e.deck.value=t):(e.deck.case="deckName",e.deck.value=this.newDeckName),e)))}}function zt(a){const t=Ue(a),e=Ve(a);return[{label:le(),value:0,disabled:!1}].concat(a.columnLabels.map((u,s)=>(s+=1,s===t?ct(Tt(),!0,s):s===e?ct(Bt(),!0,s):s===a.guidColumn?ct("GUID",!0,s):u===""?ct(a.preview[0].vals[s-1],!1,s,!0):ct(u,!1,s))))}function ct(a,t,e,u){return{label:a?`${e}: ${a}`:e.toString(),shortLabel:u?e.toString():void 0,value:e,disabled:t}}function Ve(a){return a.deck.case==="deckColumn"?a.deck.value:null}function Ue(a){return a.notetype.case==="notetypeColumn"?a.notetype.value:null}const We=async({params:a})=>{const[t,e,u]=await Promise.all([ee({}),se({skipEmptyDefault:!1,includeFiltered:!1}),Wt({path:a.path},{alertOnError:!1})]);return{state:new Le(a.path,t,e,u)}},ws=Object.freeze(Object.defineProperty({__proto__:null,load:We},Symbol.toStringTag,{value:"Module"}));var Be=A('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ye=A('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function At(a,t){et(t,!1);const e=J();let u=H(t,"label",8),s=H(t,"columnOptions",8),r=H(t,"value",12);yt(()=>(v(s()),v(r())),()=>{var n;K(e,(n=s().find(p=>p.value===r()))==null?void 0:n.label)}),St(),tt();var o=Ye(),i=z(o);nt(i,()=>({"--cols":2})),pt(i.lastChild,{children:(n,p)=>{var h=Be(),N=z(h);nt(N,()=>({"--col-size":1})),_t(N.lastChild,{children:(c,T)=>{B();var m=Y();L(()=>G(m,u())),g(c,m)},$$slots:{default:!0}}),x(N);var y=S(N,2);nt(y,()=>({"--col-size":1})),_t(y.lastChild,{children:(c,T)=>{He(c,{get label(){return d(e)},get list(){return s()},parser:m=>({content:m.label,value:m.value,disabled:m.disabled}),get value(){return r()},set value(m){r(m)},$$legacy:!0})},$$slots:{default:!0}}),x(y),g(n,h)},$$slots:{default:!0}}),x(i),g(a,o),st()}var qe=A("<!> <!>",1);function Ke(a,t){et(t,!1);const[e,u]=mt(),s=()=>V(h,"$globalNotetype",e),r=()=>V(N,"$fieldNamesPromise",e),o=()=>V(y,"$columnOptions",e),i=()=>V(p,"$metadata",e);let n=H(t,"state",8);const p=n().metadata,h=n().globalNotetype,N=n().fieldNames,y=n().columnOptions;tt();const c=F(()=>(v(Z),l(()=>oe())));Dt(a,{get title(){return d(c)},children:(T,m)=>{var C=qe(),I=z(C);{var P=b=>{var _=Ot(),w=z(_);Re(w,r,null,(O,R)=>{var U=Ot(),lt=z(U);ht(lt,1,()=>d(R),bt,(gt,kt,ot)=>{const Nt=F(()=>(o(),l(()=>ot===0?o().slice(1):o())));At(gt,{get label(){return d(kt)},get columnOptions(){return d(Nt)},get value(){return s().fieldColumns[ot]},set value($t){q(h,l(s).fieldColumns[ot]=$t,l(s))},$$legacy:!0})}),g(O,U)}),g(b,_)};wt(I,b=>{s()!==null&&b(P)})}var E=S(I,2);const $=F(()=>(v(Z),l(()=>re())));At(E,{get label(){return d($)},get columnOptions(){return o()},get value(){return i().tagsColumn},set value(b){q(p,l(i).tagsColumn=b,l(i))},$$legacy:!0}),g(T,C)},$$slots:{default:!0}}),st(),u()}function Gt(){return[{label:ne(),value:rt.TAB},{label:ie(),value:rt.PIPE},{label:ue(),value:rt.SEMICOLON},{label:ce(),value:rt.COLON},{label:de(),value:rt.COMMA},{label:pe(),value:rt.SPACE}]}function Lt(){return[{label:me(),value:It.UPDATE},{label:ge(),value:It.PRESERVE},{label:$e(),value:It.DUPLICATE}]}function Vt(){return[{label:Tt(),value:Ht.NOTETYPE},{label:fe(),value:Ht.NOTETYPE_AND_DECK}]}var Je=A('<th class="svelte-ezvffl"> </th>'),Qe=A('<td class="svelte-ezvffl"> </td>'),Xe=A('<tr class="svelte-ezvffl"></tr>'),Ze=A('<div class="outer svelte-ezvffl"><table class="preview svelte-ezvffl"><thead><tr class="svelte-ezvffl"></tr></thead><tbody></tbody></table></div> <!>',1);function ts(a,t){et(t,!1);const[e,u]=mt(),s=()=>V(p,"$metadata",e),r=()=>V(h,"$columnOptions",e),o=J();let i=H(t,"state",8),n=H(t,"maxColumns",8,1e3);const p=i().metadata,h=i().columnOptions;let N=J(),y=J(!1);function c(b){let _=!1;return{rows:b.map(O=>O.vals.length>n()?(_=!0,O.vals.slice(0,n())):O.vals),truncated:_}}yt(()=>(d(N),d(y),s()),()=>{(b=>{K(N,b.rows),K(y,b.truncated)})(c(s().preview))}),yt(()=>(d(y),v(n())),()=>{K(o,d(y)?ve({count:n()}):"")}),St(),tt();var T=Ze(),m=z(T),C=ut(m),I=ut(C),P=ut(I);ht(P,5,()=>(r(),l(()=>r().slice(1))),bt,(b,_)=>{let w=()=>d(_).label,O=()=>d(_).shortLabel;var R=Je(),U=ut(R,!0);x(R),L(()=>G(U,O()||w())),g(b,R)}),x(P),x(I);var E=S(I);ht(E,5,()=>d(N),bt,(b,_)=>{var w=Xe();ht(w,5,()=>d(_),bt,(O,R)=>{var U=Qe(),lt=ut(U,!0);x(U),L(()=>G(lt,d(R))),g(O,U)}),x(w),g(b,w)}),x(E),x(C),x(m);var $=S(m,2);Jt($,{get warning(){return d(o)}}),g(a,T),st(),u()}var es=A("<!> <!> <!>",1);function ss(a,t){et(t,!1);const[e,u]=mt(),s=()=>V(o,"$metadata",e);let r=H(t,"state",8);const o=r().metadata,i={delimiter:{title:_e(),help:ye(),url:j.TextImporting.root},isHtml:{title:be(),help:he(),url:j.TextImporting.html}},n=Object.values(i);let p=J(),h=J();function N(c){d(p).show(),d(h).to(c)}tt();const y=F(()=>(v(Z),l(()=>Et())));Dt(a,{get title(){return d(y)},children:(c,T)=>{var m=es(),C=z(m);const I=F(()=>(v(Gt),l(Gt)));dt(C,{get defaultValue(){return v(r()),l(()=>r().defaultDelimiter)},get choices(){return d(I)},get disabled(){return s(),l(()=>s().forceDelimiter)},get value(){return s().delimiter},set value($){q(o,l(s).delimiter=$,l(s))},children:($,b)=>{X($,{$$events:{click:()=>N(Object.keys(i).indexOf("delimiter"))},children:(_,w)=>{B();var O=Y();L(R=>G(O,R),[()=>(s(),v(Z),l(()=>s().forceDelimiter?i.delimiter.title:ke()))],F),g(_,O)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var P=S(C,2);je(P,{get defaultValue(){return v(r()),l(()=>r().defaultIsHtml)},get disabled(){return s(),l(()=>s().forceIsHtml)},get value(){return s().isHtml},set value($){q(o,l(s).isHtml=$,l(s))},children:($,b)=>{X($,{$$events:{click:()=>N(Object.keys(i).indexOf("isHtml"))},children:(_,w)=>{B();var O=Y();L(()=>G(O,l(()=>i.isHtml.title))),g(_,O)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var E=S(P,2);ts(E,{get state(){return r()}}),g(c,m)},$$slots:{default:!0,tooltip:(c,T)=>{const m=F(()=>(v(Z),l(()=>Et())));Kt(c,{get title(){return d(m)},get url(){return v(j),l(()=>j.TextImporting.root)},slot:"tooltip",get helpSections(){return n},$$events:{mount:C=>{K(p,C.detail.modal),K(h,C.detail.carousel)}}})}}}),st(),u()}var as=A('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),ls=A('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Ut(a,t){et(t,!1);const[e,u]=mt(),s=()=>V(n,"$tagsWritable",e);let r=H(t,"tags",12),o=H(t,"keyCombination",8,void 0),i=H(t,"breakpoint",8,"md");const n=vt(r());tt();var p=ls(),h=z(p);nt(h,()=>({"--cols":13})),pt(h.lastChild,{children:(N,y)=>{var c=as(),T=z(c);nt(T,()=>({"--col-size":7})),_t(T.lastChild,{get breakpoint(){return i()},children:(C,I)=>{var P=Ot(),E=z(P);ae(E,t,"default",{}),g(C,P)},$$slots:{default:!0}}),x(T);var m=S(T,2);nt(m,()=>({"--col-size":6})),_t(m.lastChild,{get breakpoint(){return i()},children:(C,I)=>{Fe(C,{children:(P,E)=>{Ae(P,{get tags(){return n},get keyCombination(){return o()},$$events:{tagsupdate:({detail:$})=>r($.tags)}})},$$slots:{default:!0,revert:(P,E)=>{ze(P,{slot:"revert",defaultValue:[],get value(){return qt(),s()},set value($){Yt(n,$)},$$legacy:!0})}}})},$$slots:{default:!0}}),x(m),g(N,c)},$$slots:{default:!0}}),x(h),g(a,p),st(),u()}var os=A("<!> <!> <!> <!> <!> <!> <!>",1);function rs(a,t){et(t,!1);const[e,u]=mt(),s=()=>V(N,"$deckId",e),r=()=>V(h,"$globalNotetype",e),o=()=>V(p,"$metadata",e),i=J();let n=H(t,"state",8);const p=n().metadata,h=n().globalNotetype,N=n().deckId,y=n().newDeckName,c={notetype:{title:Tt(),help:Me(),url:j.TextImporting.root},deck:{title:Bt(),help:De(),url:j.TextImporting.root},dupeResolution:{title:Se(),help:Te(),url:j.TextImporting.updating},matchScope:{title:we(),help:Oe(),url:j.TextImporting.updating},globalTags:{title:Pe(),help:Ie(),url:j.TextImporting.root},updatedTags:{title:Ce(),help:Ne(),url:j.TextImporting.root}},T=Object.values(c);let m=J(),C=J();function I($){d(m).show(),d(C).to($)}const P=n().deckNameIds.map(({id:$,name:b})=>({label:b,value:$}));y&&P.push({label:y,value:0n}),yt(()=>(s(),Z),()=>{K(i,y&&s()===0n?xe({name:y}):"")}),St(),tt();const E=F(()=>(v(Z),l(()=>Rt())));Dt(a,{get title(){return d(E)},children:($,b)=>{var _=os(),w=z(_);{var O=f=>{const W=F(()=>(v(n()),l(()=>n().notetypeNameIds.map(({id:D,name:Q})=>({label:Q,value:D})))));dt(f,{get defaultValue(){return v(n()),l(()=>n().defaultNotetypeId)},get choices(){return d(W)},get value(){return r().id},set value(D){q(h,l(r).id=D,l(r))},children:(D,Q)=>{X(D,{$$events:{click:()=>I(Object.keys(c).indexOf("notetype"))},children:(M,Ct)=>{B();var Mt=Y();L(()=>G(Mt,l(()=>c.notetype.title))),g(M,Mt)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};wt(w,f=>{r()!==null&&f(O)})}var R=S(w,2);{var U=f=>{dt(f,{get defaultValue(){return v(n()),l(()=>n().defaultDeckId)},get choices(){return P},get value(){return qt(),s()},set value(W){Yt(N,W)},children:(W,D)=>{X(W,{$$events:{click:()=>I(Object.keys(c).indexOf("deck"))},children:(Q,M)=>{B();var Ct=Y();L(()=>G(Ct,l(()=>c.deck.title))),g(Q,Ct)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0})};wt(R,f=>{(y||s())&&f(U)})}var lt=S(R,2);Jt(lt,{get warning(){return d(i)},className:"alert-info"});var gt=S(lt,2);const kt=F(()=>(v(Lt),l(Lt)));dt(gt,{defaultValue:0,get choices(){return d(kt)},get value(){return o().dupeResolution},set value(f){q(p,l(o).dupeResolution=f,l(o))},children:(f,W)=>{X(f,{$$events:{click:()=>I(Object.keys(c).indexOf("dupeResolution"))},children:(D,Q)=>{B();var M=Y();L(()=>G(M,l(()=>c.dupeResolution.title))),g(D,M)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var ot=S(gt,2);const Nt=F(()=>(v(Vt),l(Vt)));dt(ot,{defaultValue:0,get choices(){return d(Nt)},get value(){return o().matchScope},set value(f){q(p,l(o).matchScope=f,l(o))},children:(f,W)=>{X(f,{$$events:{click:()=>I(Object.keys(c).indexOf("matchScope"))},children:(D,Q)=>{B();var M=Y();L(()=>G(M,l(()=>c.matchScope.title))),g(D,M)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var $t=S(ot,2);Ut($t,{keyCombination:"Control+T",get tags(){return o().globalTags},set tags(f){q(p,l(o).globalTags=f,l(o))},children:(f,W)=>{X(f,{$$events:{click:()=>I(Object.keys(c).indexOf("globalTags"))},children:(D,Q)=>{B();var M=Y();L(()=>G(M,l(()=>c.globalTags.title))),g(D,M)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0});var Qt=S($t,2);Ut(Qt,{keyCombination:"Control+Shift+T",get tags(){return o().updatedTags},set tags(f){q(p,l(o).updatedTags=f,l(o))},children:(f,W)=>{X(f,{$$events:{click:()=>I(Object.keys(c).indexOf("updatedTags"))},children:(D,Q)=>{B();var M=Y();L(()=>G(M,l(()=>c.updatedTags.title))),g(D,M)},$$slots:{default:!0}})},$$slots:{default:!0},$$legacy:!0}),g($,_)},$$slots:{default:!0,tooltip:($,b)=>{const _=F(()=>(v(Z),l(()=>Rt())));Kt($,{get title(){return d(_)},get url(){return v(j),l(()=>j.TextImporting.root)},slot:"tooltip",get helpSections(){return T},$$events:{mount:w=>{K(m,w.detail.modal),K(C,w.detail.carousel)}}})}}}),st(),u()}var ns=A("<!> <!> <!>",1);function is(a,t){et(t,!1);let e=H(t,"state",8);tt(),Ee(a,{get path(){return v(e()),l(()=>e().path)},get importer(){return e()},children:(u,s)=>{var r=ns(),o=z(r);pt(o,{children:(p,h)=>{ss(p,{get state(){return e()}})},$$slots:{default:!0}});var i=S(o,2);pt(i,{children:(p,h)=>{rs(p,{get state(){return e()}})},$$slots:{default:!0}});var n=S(i,2);pt(n,{children:(p,h)=>{Ke(p,{get state(){return e()}})},$$slots:{default:!0}}),g(u,r)},$$slots:{default:!0}}),st()}function Ts(a,t){et(t,!1);let e=H(t,"data",8);tt(),is(a,{get state(){return v(e()),l(()=>e().state)}}),st()}export{Ts as component,ws as universal};

var ke=Object.defineProperty;var Te=(o,e,s)=>e in o?ke(o,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[e]=s;var j=(o,e,s)=>Te(o,typeof e!="symbol"?e+"":e,s);import{r as be,u as Fe,n as Oe,s as ze}from"../chunks/BfDh-mSI.mjs";import{aB as Be,U as M,t as xe,q as Ee,u as Le,I as Y,b7 as je,b8 as Ae,b9 as Me,ba as qe,bb as De,bc as Re,bd as We,be as He,bf as Ge,V as Ue,bg as Ve}from"../chunks/Ch7ZtZmv.mjs";import{r as de,s as R,e as ce}from"../chunks/CAm1qXYJ.mjs";import{i as ue,S as oe}from"../chunks/5xkFRAct.mjs";import"../chunks/BbkoyQuY.mjs";import{i as J}from"../chunks/-ESH3Vzs.mjs";import{h as _,c as f,p as H,l as E,s as S,m as z,k as c,g as a,a as Z,f as L,j as W,u as m,Y as T,n as Ye,t as Ie,b as D,d as G,r as h,e as Je,i as q,aM as Ke}from"../chunks/D0Kcqh4a.mjs";import{p as k,s as X,a as ne,i as K,d as Ce}from"../chunks/8hkm7YIM.mjs";import{r as pe}from"../chunks/CcaWrs5J.mjs";import{C as ie}from"../chunks/BLIdLdeN.mjs";import{R as Q,e as Se,i as Pe}from"../chunks/B9FzK2Aa.mjs";import{L as Qe,S as Xe}from"../chunks/CQ-9KGf5.mjs";import{T as fe}from"../chunks/BYOoq_0E.mjs";import{C as re}from"../chunks/BfZOIeoG.mjs";import{B as Ze}from"../chunks/eu2iBpjS.mjs";import{a as le,d as et,e as tt,f as st,m as ve}from"../chunks/pYEVaWiA.mjs";import{S as nt,g as me,o as rt}from"../chunks/Dg4D5_bH.mjs";import{t as ge,s as he}from"../chunks/BxV294_i.mjs";import{B as at}from"../chunks/xV9jLUMk.mjs";function _e(o){return o.map(e=>e!=null?e:-1)}function ye(o){return o.map(e=>e===-1?null:e)}class $e{constructor(e){j(this,"fields");j(this,"templates");j(this,"oldNotetypeName");j(this,"isCloze");j(this,"info");var l,n,d,r,u,t;this.info=e;const s=(n=(l=e.input)==null?void 0:l.newTemplates)!=null?n:[];this.isCloze=(r=(d=e.input)==null?void 0:d.isCloze)!=null?r:!1,s.length>0&&(this.templates=ye(s)),this.fields=ye((t=(u=e.input)==null?void 0:u.newFields)!=null?t:[]),this.oldNotetypeName=e.oldNotetypeName}mapForContext(e){var s;return e==1?(s=this.templates)!=null?s:[]:this.fields}getOldIndex(e,s){const n=this.mapForContext(e)[s];return n!=null?n:this.getOldNamesIncludingNothing(e).length-1}getOldNamesIncludingNothing(e){return[...this.getOldNames(e),Be()]}getOldNames(e){return e==1?this.info.oldTemplateNames:this.info.oldFieldNames}getOldNotetypeName(){return this.info.oldNotetypeName}getNewName(e,s){return(e==1?this.info.newTemplateNames:this.info.newFieldNames)[s]}unusedItems(e){const s=new Set(this.mapForContext(e).filter(r=>r!==null)),l=this.getOldNames(e);return[...Array(l.length).keys()].filter(r=>!s.has(r)).map(r=>l[r])}unchanged(){var e,s;return this.input().newNotetypeId===this.input().oldNotetypeId&&ue(this.fields,[...Array(this.fields.length).keys()])&&ue(this.templates,[...Array((s=(e=this.templates)==null?void 0:e.length)!=null?s:0).keys()])}input(){return this.info.input}intoInput(){const e=this.info.input;return e.newFields=_e(this.fields),this.templates&&(e.newTemplates=_e(this.templates)),e}}var B=(o=>(o[o.Field=0]="Field",o[o.Template=1]="Template",o))(B||{});class ot{constructor(e,s){j(this,"info");j(this,"notetypes");j(this,"info_");j(this,"infoSetter");j(this,"notetypeNames");j(this,"notetypesSetter");this.info_=new $e(s),this.info=de(this.info_,l=>{this.infoSetter=l}),this.notetypeNames=e,this.notetypes=de(this.buildNotetypeList(),l=>{this.notetypesSetter=l})}async setTargetNotetypeIndex(e){this.info_.input().newNotetypeId=this.notetypeNames.entries[e].id,this.notetypesSetter(this.buildNotetypeList());const{oldNotetypeId:s,newNotetypeId:l}=this.info_.input(),n=await be({oldNotetypeId:s,newNotetypeId:l});this.info_=new $e(n),this.info_.unusedItems(0),this.infoSetter(this.info_)}setOldIndex(e,s,l){const n=this.info_.mapForContext(e),d=this.info_.getOldNames(e),r=l<d.length?l:null;if(!(e==0)&&r!==null)for(let t=0;t<n.length;t++)n[t]===r&&(n[t]=null);n[s]=r,this.infoSetter(this.info_)}dataForSaving(){return this.info_.intoInput()}async save(){if(this.info_.unchanged()){alert("No changes to save");return}await Fe(this.dataForSaving())}buildNotetypeList(){const e=this.info_.input().newNotetypeId;return this.notetypeNames.entries.map((s,l)=>({idx:l,name:s.name,current:s.id===e}))}}const lt=async({params:o})=>{const[e,s]=o.notetypeIds.split("/"),l=BigInt(e),n=s?BigInt(s):l,d=Oe({}),r=be({oldNotetypeId:l,newNotetypeId:n}),[u,t]=await Promise.all([d,r]);return{state:new ot(u,t)}},rs=Object.freeze(Object.defineProperty({__proto__:null,load:lt},Symbol.toStringTag,{value:"Module"}));var it=_('<div class="svelte-1xardfc"></div>');function dt(o){var e=it();f(o,e)}var ct=_("<!> <!>",1);function ut(o,e){H(e,!1);const[s,l]=ne(),n=()=>X($,"$info",s),d=z(),r=z();let u=k(e,"state",8),t=k(e,"ctx",8),i=k(e,"newIndex",8);const $=u().info;function N(b){S(d,b.detail.value),u().setOldIndex(t(),i(),a(d))}E(()=>(n(),c(t()),c(i())),()=>{S(d,n().getOldIndex(t(),i()))}),E(()=>(n(),c(t()),a(d)),()=>{S(r,n().getOldNamesIncludingNothing(t())[a(d)])}),Z(),J(),Q(o,{children:(b,P)=>{var g=ct(),x=L(g);re(x,{children:(p,F)=>{const C=W(()=>(n(),c(t()),m(()=>n().getOldNamesIncludingNothing(t()))));oe(p,{get value(){return a(d)},get label(){return a(r)},get list(){return a(C)},$$events:{change:N}})},$$slots:{default:!0}});var v=T(x,2);re(v,{children:(p,F)=>{Ye();var C=Ie();D(I=>R(C,I),[()=>(n(),c(t()),c(i()),m(()=>n().getNewName(t(),i())))],W),f(p,C)},$$slots:{default:!0}}),f(b,g)},$$slots:{default:!0}}),G(),l()}var pt=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function Ne(o,e){H(e,!1);const[s,l]=ne(),n=()=>X(u,"$info",s);let d=k(e,"state",8),r=k(e,"ctx",8);const u=d().info;J();var t=pt(),i=L(t);M(i,()=>({"--height":"0.5rem"})),dt(i.lastChild),h(i);var $=T(i,2);M($,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.15rem"})),ie($.lastChild,{children:(N,b)=>{var P=Je(),g=L(P);Se(g,1,()=>(n(),c(r()),m(()=>n().mapForContext(r()))),Pe,(x,v,p)=>{ut(x,{get state(){return d()},get ctx(){return r()},newIndex:p})}),f(N,P)},$$slots:{default:!0}}),h($),f(o,t),G(),l()}var ft=_('<div dir="ltr" role="group"><!></div>');function vt(o,e){H(e,!1);const s=z(),l=z();let n=k(e,"id",8,void 0),d=k(e,"class",8,""),r=k(e,"size",8,void 0),u=k(e,"wrap",8,void 0),t=z();E(()=>c(r()),()=>{S(s,r()?`--buttons-size: ${r()}rem; `:"")}),E(()=>c(u()),()=>{u()===void 0?S(t,""):S(t,u()?"--buttons-wrap: wrap; ":"--buttons-wrap: nowrap; ")}),E(()=>(a(s),a(t)),()=>{S(l,a(s)+a(t))}),Z();var i=ft(),$=q(i);ze($,e,"default",{}),h(i),D(()=>{var N;xe(i,"id",n()),Ee(i,1,`button-group btn-group ${(N=d())!=null?N:""}`,"svelte-svn7mu"),Le(i,a(l)),i.dir=i.dir}),f(o,i),G()}var mt=_('<div class="save svelte-1polrdz"> </div>'),gt=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!>',1);function ht(o,e){H(e,!1);let s=k(e,"state",8);function l(){document.activeElement instanceof HTMLElement&&document.activeElement.blur(),s().save()}const n="Control+Enter";J(),vt(o,{children:(d,r)=>{var u=gt(),t=L(u);const i=W(()=>(c(me),m(()=>me(n))));M(t,()=>({"--border-left-radius":"5px","--border-right-radius":"5px"})),Qe(t.lastChild,{primary:!0,get tooltip(){return a(i)},$$events:{click:l},children:(N,b)=>{var P=mt(),g=q(P,!0);h(P),D(x=>R(g,x),[()=>(c(Y),m(()=>je()))],W),f(N,P)},$$slots:{default:!0}}),h(t);var $=T(t,2);nt($,{keyCombination:n,$$events:{action:l}}),f(d,u)},$$slots:{default:!0}}),G()}var _t=_('<div class="d-flex flex-row w-100"><!> <div class="arrow-container svelte-ng49hq"><!></div> <!></div> <!>',1);function yt(o,e){H(e,!1);const[s,l]=ne(),n=()=>X(i,"$notetypes",s),d=()=>X($,"$info",s),r=z(),u=z();let t=k(e,"state",8);const i=t().notetypes,$=t().info;let N=z(n().findIndex(b=>b.current));E(()=>n(),()=>{S(r,Array.from(n(),b=>b.name))}),E(()=>(a(r),a(N)),()=>{S(u,a(r)[a(N)])}),E(()=>(c(t()),a(N)),()=>{t().setTargetNotetypeIndex(a(N))}),Z(),J(),Ze(o,{class:"justify-content-between",wrap:!1,children:(b,P)=>{var g=_t(),x=L(g),v=q(x);oe(v,{get label(){return d(),m(()=>d().oldNotetypeName)},value:1,list:[1],disabled:!0});var p=T(v,2),F=q(p);{var C=w=>{le(w,{get icon(){return et}})},I=w=>{le(w,{get icon(){return tt}})};K(F,w=>{m(()=>window.getComputedStyle(document.body).direction=="rtl")?w(C):w(I,!1)})}h(p);var y=T(p,2);oe(y,{get list(){return a(r)},get label(){return a(u)},get value(){return a(N)},set value(w){S(N,w)},$$legacy:!0}),h(x);var O=T(x,2);ht(O,{get state(){return t()}}),f(b,g)},$$slots:{default:!0}}),G(),l()}var $t=_('<div class="clickable svelte-18ivrjn" role="button" tabindex="0"><!> </div>'),Nt=_("<div> <!></div>"),wt=_("<li> </li>"),bt=_("<ul></ul>"),xt=_('<div class="alert alert-warning"><!> <!></div>');function It(o,e){H(e,!1);const s=z(),l=z();let n=k(e,"unused",8),d=k(e,"ctx",8),r=z();const u=3;let t=z(!0);E(()=>(c(d()),Y),()=>{S(r,d()===B.Field?Ae():Me())}),E(()=>(a(t),Y),()=>{S(s,a(t)?qe():De())}),E(()=>(a(t),ve),()=>{S(l,a(t)?st:ve)}),Z(),J();var i=xt(),$=q(i);{var N=v=>{var p=$t(),F=Ke(()=>rt(()=>S(t,!a(t)))),C=q(p);at(C,{iconSize:80,children:(y,O)=>{le(y,{get icon(){return a(l)}})},$$slots:{default:!0}});var I=T(C);h(p),D(()=>{var y;xe(p,"aria-expanded",!a(t)),R(I,` ${(y=a(s))!=null?y:""}`)}),ce("click",p,()=>S(t,!a(t))),ce("keydown",p,function(...y){var O;(O=a(F))==null||O.apply(this,y)}),f(v,p)};K($,v=>{c(n()),m(()=>n().length>u)&&v(N)})}var b=T($),P=T(b);{var g=v=>{var p=Nt(),F=q(p),C=T(F);{var I=y=>{var O=Ie();D(()=>{var w;return R(O,`... (+${(w=(c(n()),m(()=>n().length-u)))!=null?w:""})`)}),f(y,O)};K(C,y=>{c(n()),m(()=>n().length>u)&&y(I)})}h(p),D(y=>R(F,`${y!=null?y:""} `),[()=>(c(n()),m(()=>n().slice(0,u).join(", ")))],W),f(v,p)},x=v=>{var p=bt();Se(p,5,n,Pe,(F,C)=>{var I=wt(),y=q(I,!0);h(I),D(()=>R(y,a(C))),f(F,I)}),h(p),f(v,p)};K(P,v=>{a(t)?v(g):v(x,!1)})}h(i),D(()=>{var v;return R(b,` ${(v=a(r))!=null?v:""} `)}),ge(1,i,()=>he),ge(2,i,()=>he),f(o,i),G()}var Ct=_("<b> </b>"),St=_("<b> </b>"),Pt=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),kt=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Tt=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Ft=_("<!> <!>",1);function we(o,e){H(e,!1);const[s,l]=ne(),n=()=>X(a(d),"$info",s),d=z(),r=z();let u=k(e,"state",8),t=k(e,"ctx",8);E(()=>c(u()),()=>{Ce(S(d,u().info),"$info",s)}),E(()=>(n(),c(t()),B),()=>{S(r,n().isCloze&&t()===B.Template?[]:n().unusedItems(t()))}),Z(),J();var i=Ft(),$=L(i);{var N=g=>{It(g,{get unused(){return a(r)},get ctx(){return t()}})};K($,g=>{a(r),m(()=>a(r).length>0)&&g(N)})}var b=T($,2);{var P=g=>{var x=Tt(),v=L(x);M(v,()=>({"--gutter-inline":"0.5rem","--gutter-block":"0.2rem"})),ie(v.lastChild,{children:(p,F)=>{var C=kt(),I=L(C);M(I,()=>({"--cols":2})),Q(I.lastChild,{children:(y,O)=>{var w=Pt(),U=L(w);M(U,()=>({"--col-size":1})),re(U.lastChild,{children:(te,V)=>{var A=Ct(),se=q(A,!0);h(A),D(ae=>R(se,ae),[()=>(c(Y),m(()=>Re()))],W),f(te,A)},$$slots:{default:!0}}),h(U);var ee=T(U,2);M(ee,()=>({"--col-size":1})),re(ee.lastChild,{children:(te,V)=>{var A=St(),se=q(A,!0);h(A),D(ae=>R(se,ae),[()=>(c(Y),m(()=>We()))],W),f(te,A)},$$slots:{default:!0}}),h(ee),f(y,w)},$$slots:{default:!0}}),h(I),f(p,C)},$$slots:{default:!0}}),h(v),f(g,x)};K(b,g=>{n(),c(t()),c(B),m(()=>n().templates||t()===B.Field)&&g(P)})}f(o,i),G(),l()}var Ot=_("<!> <!>",1),zt=_("<div><!></div>"),Bt=_("<!> <!>",1),Et=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),Lt=_('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function jt(o,e){H(e,!1);const[s,l]=ne(),n=()=>X(a(d),"$info",s),d=z();let r=k(e,"state",8);E(()=>c(r()),()=>{Ce(S(d,r().info),"$info",s)}),Z(),J();var u=Lt(),t=L(u);M(t,()=>({"--gutter-block":"0.5rem","--gutter-inline":"0.25rem","--sticky-borders":"0 0 1px"})),Xe(t.lastChild,{breakpoint:"sm",children:($,N)=>{yt($,{get state(){return r()}})},$$slots:{default:!0}}),h(t);var i=T(t,2);M(i,()=>({"--gutter-inline":"0.25rem","--gutter-block":"0.75rem"})),ie(i.lastChild,{breakpoint:"sm",children:($,N)=>{var b=Et(),P=L(b);M(P,()=>({"--cols":2})),Q(P.lastChild,{children:(x,v)=>{const p=W(()=>(c(Y),m(()=>He())));fe(x,{get title(){return a(p)},children:(F,C)=>{Q(F,{children:(I,y)=>{var O=Ot(),w=L(O);we(w,{get state(){return r()},get ctx(){return c(B),m(()=>B.Field)}});var U=T(w,2);Ne(U,{get state(){return r()},get ctx(){return c(B),m(()=>B.Field)}}),f(I,O)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),h(P);var g=T(P,2);M(g,()=>({"--cols":2})),Q(g.lastChild,{children:(x,v)=>{const p=W(()=>(c(Y),m(()=>Ge())));fe(x,{get title(){return a(p)},children:(F,C)=>{Q(F,{children:(I,y)=>{var O=Bt(),w=L(O);we(w,{get state(){return r()},get ctx(){return c(B),m(()=>B.Template)}});var U=T(w,2);{var ee=V=>{Ne(V,{get state(){return r()},get ctx(){return c(B),m(()=>B.Template)}})},te=V=>{var A=zt(),se=q(A);Ue(se,()=>(c(pe),c(Y),m(()=>pe(Ve())))),h(A),f(V,A)};K(U,V=>{n(),m(()=>n().templates)?V(ee):V(te,!1)})}f(I,O)},$$slots:{default:!0}})},$$slots:{default:!0}})},$$slots:{default:!0}}),h(g),f($,b)},$$slots:{default:!0}}),h(i),f(o,u),G(),l()}function as(o,e){H(e,!1);let s=k(e,"data",8);J(),jt(o,{get state(){return c(s()),m(()=>s().state)}}),G()}export{as as component,rs as universal};

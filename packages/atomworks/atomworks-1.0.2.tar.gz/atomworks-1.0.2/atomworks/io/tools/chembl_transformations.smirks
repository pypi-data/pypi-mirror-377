// Transformations taken from the ChEMBL cleaning and standardization pipeline
//  for biomolecules. These transformations are useful to fix various issues, 
//  mostly related to incorrect valences, when loading molecules from the PDB.
//  See: https://github.com/chembl/ChEMBL_Structure_Pipeline/blob/master/chembl_structure_pipeline/standardizer.py#L33C1-L73C15
// Commands with the prefix "CUSTOM:" are custom and not part of the original ChEMBL pipeline.

//	Name	SMIRKS

// Standardizes the representation of nitro groups
Nitro to N+(O-)=O	[N;X3:1](=[O:2])=[O:3]>>[*+1:1]([*-1:2])=[*:3]

// Add a positive charge to diazonium N (to fix valence errors)
Diazonium N	[*:1]-[N;X2:2]#[N;X1:3]>>[*:1]-[*+1:2]#[*:3]

// Add a positive charge to quaternary N (to fix valence errors)
Quaternary N	[N;X4;v4;+0:1]>>[*+1:1]

// Add a positive charge to trivalent O (to fix valence errors)
Trivalent O	[*:1]=[O;X2;v3;+0:2]-[#6:3]>>[*:1]=[*+1:2]-[*:3]

// Standardize sulfoxide representation
Sulfoxide to -S+(O-)	[!O:1][S+0;D3:2](=[O:3])[!O:4]>>[*:1][S+1:2]([O-:3])[*:4]

// Standardize the sulfoxide representation where there is an extra hydrogen 
// (this form addresses a pathological case that came up a few times in testing):
Sulfoxide to -S+(O-) 2	[!O:1][SH1+1;D3:2](=[O:3])[!O:4]>>[*:1][S+1:2]([O-:3])[*:4]

// Add a positive charge to trivalent S (to fix valence errors)
Trivalent S	[O:1]=[S;D2;+0:2]-[#6:3]>>[*:1]=[*+1:2]-[*:3]

// Note that the next one doesn't work propertly because repeated appplications
// don't carry the cations from the previous rounds through. This should be
// fixed by implementing single-molecule transformations, but that's a longer-term
// project
//Alkaline oxide to ions	[Li,Na,K;+0:1]-[O+0:2]>>([*+1:1].[O-:2])

// Fix a bad amide tautomer by moving a hydrogen from the oxygen to the nitrogen
Bad amide tautomer1	[C:1]([OH1;D1:2])=;!@[NH1:3]>>[C:1](=[OH0:2])-[NH2:3]

// Fix a bad amide tautomer by moving a hydrogen from the oxygen to the nitrogen
Bad amide tautomer2	[C:1]([OH1;D1:2])=;!@[NH0:3]>>[C:1](=[OH0:2])-[NH1:3]

// Add a negative charge to halogens with no neighbors
Halogen with no neighbors	[F,Cl,Br,I;X0;+0:1]>>[*-1:1]

// Standardize the pyridine/pyridazine oxide structure by redistributing charge
Odd pyridine/pyridazine oxide structure	[C,N;-;D2,D3:1]-[N+2;D3:2]-[O-;D1:3]>>[*-0:1]=[*+1:2]-[*-:3]

// Standardize the representation of azides
Odd azide	[*:1][N-:2][N+:3]#[N:4]>>[*:1][N+0:2]=[N+:3]=[N-:4]

// CUSTOM: Set charge on any 4-valent nitrogen to +1
Four-valent N	[N;v4:1]>>[N+1:1]
# Registry/Owner mit ENV-Fallbacks
registry: ${env("REGISTRY","")}
owner: ${env("OWNER", env("GITHUB_REPOSITORY_OWNER",""))}

platforms: ["linux/amd64"]
push: false
check: auto  # auto|local|remote

hash:
  tag_length: 8

# ---- Targets ---------------------------------------------------
# Funktionen im tag-Expression:
#  - env("VAR","def")                  -> ENV
#  - readFile("path")                  -> Dateiinhalt (stripped)
#  - checksum("path1","path2",...)     -> sha256 von Datei-Inhalten
#  - currentChecksum()                 -> Hash laut hash_mode des Targets (self oder self+deps)
#  - concat(a,b,...)                   -> String-Verkettung
#  - depChecksum("targetName")         -> Hash (laut hash_mode) eines anderen Targets
#  - gitShortSha()                     -> `git rev-parse --short HEAD` (falls git da)
# Ergebnis wird zu einem Docker-Tag normalisiert ([A-Za-z0-9_.-], sonst -> '-')
#
# tag interpolations:
# tag: ${readFile("container-version.txt")}
# tag: ${readFile("container-version.txt")}-${currentChecksum()}
# tag: ${env("REL_TAG","dev")}-${gitShortSha()}
# tag: ${depChecksum("builder-ui")}-${currentChecksum()}
# tag: ${depChecksum8("builder-ui")}-${currentChecksum8()}

targets:
  base:
    dockerfile: docker/base/Dockerfile
    context: .
    deps: []
    hash_mode: self
    image: base
    latest: true

  dev:
    dockerfile: docker/dev/Dockerfile
    context: .
    deps:
      - base
    hash_mode: self
    image: dev
    latest: true

  release:
    dockerfile: docker/release/Dockerfile
    context: .
    deps:
      - base
      - dev
    hash_mode: self+deps
    image: release
    latest: true

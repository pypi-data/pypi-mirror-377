(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[805],{41010:function(e,t,a){Promise.resolve().then(a.bind(a,67595))},97500:function(e,t,a){"use strict";async function r(e,t){let{arg:a}=t,r=localStorage.getItem("auth"),i={"Content-Type":"application/json"};r&&(i.Authorization="Basic ".concat(r));let n=await fetch(""+e,{method:"POST",headers:i,body:JSON.stringify(a)});if(!(n.status>=200&&n.status<300))throw Error(await n.text());let o=await n.json();if(!n.ok)throw Error(o.message);return o}a.d(t,{_i:function(){return i},gz:function(){return s},hw:function(){return o},sj:function(){return n},wG:function(){return r}});let i=async function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];let r=localStorage.getItem("auth"),i=t[1]||{},n=i.headers||{};if(r){let e={};n instanceof Headers?n.forEach((t,a)=>{e[a]=t}):e=Array.isArray(n)?Object.fromEntries(n):{...n},e.Authorization="Basic ".concat(r);let a=await fetch(""+t[0],{...i,headers:e});if(!a.ok)throw Error(await a.text());return a.json()}let o=await fetch(""+t[0],{...i,headers:n});if(!o.ok)throw Error(await o.text());return o.json()},n=async(e,t)=>{let a=localStorage.getItem("auth"),r=t||{},i=r.headers||{};if(a){let t={};i instanceof Headers?i.forEach((e,a)=>{t[a]=e}):t=Array.isArray(i)?Object.fromEntries(i):{...i},t.Authorization="Basic ".concat(a);let n=await fetch(""+e,{...r,headers:t});if(!n.ok)throw Error(await n.text());return n}let n=await fetch(""+e,{...r,headers:i});if(!n.ok)throw Error(await n.text());return n};async function o(e,t){let{arg:a}=t,r=localStorage.getItem("auth"),i={};r&&(i.Authorization="Basic ".concat(r));let n=await fetch("".concat("").concat(e,"/").concat(a),{method:"DELETE",headers:i});if(!n.ok)throw Error(await n.text());return n}async function s(e,t){let{arg:a}=t,r=localStorage.getItem("auth"),i={"Content-Type":"application/json"};r&&(i.Authorization="Basic ".concat(r));let n=await fetch("".concat("").concat(e),{method:"PUT",headers:i,body:JSON.stringify(a)});if(!n.ok)throw Error(await n.text());return n}},21659:function(e,t,a){"use strict";a.d(t,{Bf:function(){return s},JB:function(){return l},ZP:function(){return o}});var r=a(85323),i=a(97500),n=a(2265);function o(){let{data:e,error:t,isLoading:a}=(0,r.ZP)("/v1/streamers",i._i);return{isLoading:a,streamers:e}}function s(){let{data:e,error:t,isLoading:a}=(0,r.ZP)("/v1/users",i._i),[o,s]=(0,n.useState)([]);return(0,n.useEffect)(()=>{if(!e||0===e.length)return;let t=async e=>{try{var t;let a=await (0,i._i)("/bili/space/myinfo?user=".concat(e.value),void 0),r=await (0,i.sj)("/bili/proxy?url=".concat(null===(t=a.data)||void 0===t?void 0:t.face)),n=await r.blob();return{...e,name:a.data.name,face:URL.createObjectURL(n)}}catch(r){console.error(r);let t=await (0,i.sj)("/bili/proxy?url=https://i0.hdslb.com/bfs/face/member/noface.jpg"),a=await t.blob();return{...e,name:"Cookie已失效",face:URL.createObjectURL(a)}}};Promise.all(e.map(t)).then(s)},[e]),{isLoading:a,isError:t,biliUsers:o}}function l(){var e;let{data:t,error:a,isLoading:n}=(0,r.ZP)("/bili/archive/pre",i._i);return{isLoading:n,isError:a,typeTree:null==t?void 0:null===(e=t.data)||void 0===e?void 0:e.typelist.map(e=>({label:e.name,value:e.id,children:e.children}))}}},67595:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return A}});var r=a(57437),i=a(76301),n=a(20604),o=a(78401),s=a(62146),l=a(2265),c=a(27648),d=a(81854),u=a(23298),h=a(84747),m=a(97500),x=a(85323),f=a(99376),g=a(97349),y=a(445),p=a.n(y),v=e=>{let{abbr:t,label:a,value:n,onRemove:o,url:s}=e;return(0,r.jsxs)("div",{className:p().components,children:[(0,r.jsx)(i.qE,{size:"small",src:s,children:t}),(0,r.jsxs)("div",{className:p().info,children:[(0,r.jsx)("div",{className:p().name,children:a}),(0,r.jsx)("div",{className:p().email,children:n})]}),(0,r.jsx)(i.gn,{title:"确定是否要删除？",content:"此操作将不可逆",onConfirm:o,children:(0,r.jsx)(i.zx,{className:p()["semi-icon-close"],type:"danger",theme:"borderless",icon:(0,r.jsx)(g.Z,{})})})]},a)},j=a(65582),b=a(21659),w=a(35398),C=e=>{let{onSuccess:t}=e,[a,n]=(0,l.useState)("");return((0,l.useEffect)(()=>{let e=new AbortController,a=e.signal;return a.addEventListener("abort",()=>{console.log("aborted!")}),(async()=>{let e=await (0,m._i)("/v1/get_qrcode",void 0);n(e.data.url),console.log(e.data.url);let r=await (0,m.sj)("/v1/login_by_qrcode",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:a});if(!(r.status>=200&&r.status<300))throw Error(await r.text());let i=await r.json();if(!r.ok)throw Error(i.message);t(i.filename)})().catch(e=>{console.log(e),i.P_.error({title:"QRcode",content:(0,r.jsx)(i.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}})}),()=>{e.abort("qrcode exit")}},[t]),""===a)?(0,r.jsx)(i.yC,{}):(0,r.jsx)("div",{style:{marginTop:30,marginLeft:"auto",marginRight:"auto",width:"max-content"},children:(0,r.jsx)(w.tv,{value:a})})},_=a(50196),k=e=>{let{onCancel:t,visible:a}=e,{trigger:n}=(0,j.Z)("/v1/users",m.wG),{trigger:o}=(0,j.Z)("/v1/users",m.hw),{biliUsers:c}=(0,b.Bf)(),[d,u]=(0,l.useState)(!1),[h,x]=(0,l.useState)(!1),{width:f}=(0,_.Z)(),g=async e=>{x(!0);try{let t=await (0,m._i)("/bili/space/myinfo?user=".concat(e),void 0);if(t.code)throw Error(t.message);await n({id:0,name:e,value:e,platform:"bilibili-cookies"}),u(!1),i.FN.success("创建成功")}catch(t){let e=t.message;try{e=JSON.parse(e).error}catch(e){console.log(e)}return i.P_.error({title:"创建失败",content:(0,r.jsx)(i.Typography.Paragraph,{style:{maxWidth:450},children:e}),style:{width:"min-content"}})}finally{x(!1)}},y=async()=>{var e;let t=await (null===(e=w.current)||void 0===e?void 0:e.validate());await g(null==t?void 0:t.value)},p=async e=>{try{await o(e),i.FN.success("删除成功")}catch(e){i.P_.error({title:"删除失败",content:(0,r.jsx)(i.Typography.Paragraph,{style:{maxWidth:450},children:e.message}),style:{width:"min-content"}})}},w=(0,l.useRef)(),[k,S]=(0,l.useState)(),[E,A]=(0,l.useState)((0,r.jsx)(r.Fragment,{}));return(0,r.jsxs)(i.Uu,{title:(0,r.jsx)(i.Typography.Title,{heading:4,children:"用户管理"}),visible:a,width:Math.min(448,null!=f?f:Number.MIN_VALUE),footer:(0,r.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,r.jsx)(i.zx,{onClick:()=>{u(!0)},icon:(0,r.jsx)(s.Z,{size:"large"}),style:{marginRight:4,backgroundColor:"rgba(var(--semi-indigo-0), 1)"},children:"新增"})}),headerStyle:{borderBottom:"1px solid var(--semi-color-border)"},bodyStyle:{borderBottom:"1px solid var(--semi-color-border)"},onCancel:t,children:[(0,r.jsx)(i.aV,{className:"component-list-demo-booklist",dataSource:c,split:!1,size:"small",style:{flexBasis:"100%",flexShrink:0},renderItem:e=>(0,r.jsx)(v,{url:e.face,abbr:e.name,label:e.name,value:e.value,onRemove:async()=>await p(e.id)})}),(0,r.jsxs)(i.u_,{title:"新建",visible:d,onOk:y,style:{width:"min(600px, 90vw)"},afterClose:()=>{console.log("After Close callback executed")},onCancel:()=>{u(!1),console.log("Cancel button clicked")},closeOnEsc:!0,confirmLoading:h,okButtonProps:{disabled:2===k},bodyStyle:{overflow:"auto",maxHeight:"calc(100vh - 320px)",paddingLeft:10,paddingRight:10},children:[(0,r.jsx)(i.X2,{type:"flex",justify:"center",children:(0,r.jsxs)(i.FX,{type:"button",buttonSize:"large",onChange:e=>{S(e.target.value),2===e.target.value&&A((0,r.jsx)(C,{onSuccess:g})),1===e.target.value&&A((0,r.jsx)(i.Form,{getFormApi:e=>w.current=e,children:(0,r.jsx)(i.Form.Input,{field:"value",label:"Cookie路径",trigger:"blur",placeholder:"cookies.json",rules:[{required:!0}]})}))},value:k,children:[(0,r.jsx)(i.Y8,{value:1,children:"cookie文件"}),(0,r.jsx)(i.Y8,{value:2,children:"扫码登录"})]})}),(0,r.jsx)(i.X2,{children:E})]})]})},S=a(34595),E=a(61255);function A(){let{Meta:e}=i.Card,{Paragraph:t,Title:a,Text:g}=i.Typography,{Header:y,Content:p}=i.Layout,[v,w]=(0,l.useState)(!1),C=(0,f.useRouter)(),{trigger:_}=(0,j.Z)("/v1/upload/streamers",m.hw),{data:A,error:z,isLoading:P}=(0,x.ZP)("/v1/upload/streamers",m._i),{biliUsers:Z}=(0,b.Bf)(),T=()=>{w(!v)},N=async e=>{await _(e)},[O,R]=(0,l.useState)(!1),[I,B]=(0,l.useState)([]),[L,U]=(0,l.useState)(),W=e=>{U(e),R(!0)},F=async()=>{await (0,m.wG)("/v1/uploads",{arg:{files:I,params:L}}),R(!1)},{data:G}=(0,x.ZP)("/v1/videos",m._i),q=null==G?void 0:G.map(e=>({label:e.name,value:e.name,disabled:!1,key:e.key})),[J,V]=(0,l.useState)([]);return(0,r.jsx)(S.a,{children:(0,r.jsxs)(E.Z,{children:[(0,r.jsx)(k,{visible:v,onCancel:T}),(0,r.jsx)(i.u_,{size:"medium",title:"文件选择",okText:"上传",style:{width:"min(600px, 90vw)"},visible:O,onOk:F,afterClose:()=>{console.log("After Close callback executed")},onCancel:()=>{R(!1),console.log("Cancel button clicked")},bodyStyle:{overflow:"auto"},closeOnEsc:!0,children:(0,r.jsx)(i.FE,{style:{height:416},dataSource:q,draggable:!0,value:J,onChange:(e,t)=>{B(e),V(e)}})}),(0,r.jsx)(y,{style:{backgroundColor:"var(--semi-color-bg-1)"},children:(0,r.jsxs)("div",{style:{display:"flex",paddingLeft:"25px",paddingRight:"25px",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",boxShadow:"0 1px 2px 0 rgb(0 0 0 / 0.05)",height:"60px"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:10,justifyContent:"center",alignItems:"center",flexWrap:"wrap"},children:[(0,r.jsx)(n.Z,{style:{backgroundColor:"rgba(var(--semi-violet-4), 1)",borderRadius:"var(--semi-border-radius-large)",color:"var(--semi-color-bg-0)",padding:"6px"},size:"large"}),(0,r.jsx)("h4",{style:{margin:0},children:"投稿管理"})]}),(0,r.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:6},children:[(0,r.jsx)(i.zx,{onClick:T,type:"tertiary",icon:(0,r.jsx)(o.Z,{}),style:{borderRadius:"var(--semi-border-radius-circle)",marginRight:"12px"}}),(0,r.jsx)(c.default,{href:"/upload-manager/add",onClick:e=>{0===Z.length&&(e.preventDefault(),T(),i.P_.info({title:"用户列表为空",position:"top",content:"请先在右侧点击新增用户",duration:3}))},children:(0,r.jsx)(i.zx,{icon:(0,r.jsx)(s.Z,{}),theme:"solid",style:{marginRight:10},children:"新建"})})]})]})}),(0,r.jsx)(p,{style:{padding:"24px",backgroundColor:"var(--semi-color-bg-0)"},children:(0,r.jsx)(i.aV,{grid:{gutter:12,xs:24,sm:24,md:12,lg:8,xl:6,xxl:4},dataSource:A,renderItem:t=>(0,r.jsx)(i.aV.Item,{children:(0,r.jsxs)(i.Card,{shadows:"hover",style:{maxWidth:360,margin:"8px 2px",flexGrow:1},bodyStyle:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,r.jsx)(e,{title:(0,r.jsx)(g,{ellipsis:{showTooltip:!0,pos:"middle"},style:{maxWidth:150},children:t.template_name})}),(0,r.jsxs)(i.hE,{style:{minWidth:100},theme:"borderless",children:[(0,r.jsx)(i.zx,{icon:(0,r.jsx)(d.Z,{}),onClick:()=>W(t)}),(0,r.jsx)(i.zx,{icon:(0,r.jsx)(u.Z,{}),onClick:()=>{C.push("/upload-manager/edit?id=".concat(t.id))}}),(0,r.jsx)(i.gn,{title:"确定是否要删除？",content:"此操作将不可逆",margin:50,onConfirm:async()=>await N(t.id),children:(0,r.jsx)(i.zx,{theme:"borderless",icon:(0,r.jsx)(h.Z,{})})})]})]})})})})]})})}},445:function(e){e.exports={components:"AvatarCard_components__heTwn","semi-icon-close":"AvatarCard_semi-icon-close__9hwya",info:"AvatarCard_info__Gzwh8",name:"AvatarCard_name__mOADG",email:"AvatarCard_email__ncXyR"}}},function(e){e.O(0,[916,737,877,623,290,852,191,147,429,212,597,326,301,25,469,323,431,789,971,117,744],function(){return e(e.s=41010)}),_N_E=e.O()}]);
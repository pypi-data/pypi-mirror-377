(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30],{9435:function(e,t,o){Promise.resolve().then(o.bind(o,49209))},49209:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return u}});var l=o(57437),n=o(2265),r=o(76301),s=o(70787);let i=(0,o(87565).A)(function(e){return n.createElement("svg",Object.assign({viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",focusable:!1,"aria-hidden":!0},e),n.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 4v16c0 1.1.9 2 2 2h16a2 2 0 0 0 2-2V8.41a1 1 0 0 0-.3-.7l-5.4-5.42a1 1 0 0 0-.71-.29H4a2 2 0 0 0-2 2Zm8 0v3h2V4h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h3ZM7 19a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H7Z",fill:"currentColor"}))},"save");var a=o(79901),c=o(41421),d=o(34595),g=o(61255);let h=e=>{let{logs:t,logContainerRef:o,isLoading:s}=e;if(s)return(0,l.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:(0,l.jsx)(r.yC,{size:"large"})});let i=()=>{let e=document.getElementsByClassName("log-container");if(0===e.length)return!1;let t=e[0];return t.scrollHeight-t.scrollTop-t.clientHeight<=50},a=()=>{let e=document.getElementsByClassName("log-container");if(e.length>0){let t=e[0];t.scrollTop=t.scrollHeight}};return(0,n.useEffect)(()=>{t.length>0&&i()&&(console.log("自动滚动到底部"),a())},[t]),(0,l.jsx)("div",{className:"log-container",ref:o,style:{height:"calc(100% - 40px)",maxHeight:"calc(100vh - 180px)",overflow:"auto",padding:12,backgroundColor:"var(--semi-color-bg-1)",borderRadius:4,whiteSpace:"pre-wrap",wordBreak:"break-all"},children:t.length>0?t.map((e,t)=>(0,l.jsx)("div",{style:{marginBottom:2},children:e},t)):(0,l.jsx)("div",{style:{color:"var(--semi-color-text-2)",textAlign:"center",marginTop:20},children:"暂无日志内容"})})};function u(){let{Header:e,Content:t}=r.Layout,[o,s]=(0,n.useState)([]),[i,a]=(0,n.useState)(!1),[c,h]=(0,n.useState)(!0),[u,x]=(0,n.useState)("ds_update"),f=(0,n.useRef)(null),p=(0,n.useRef)(null);return(0,l.jsx)(d.a,{children:(0,l.jsx)(g.Z,{children:(0,l.jsx)(m,{logs:o,setLogs:s,isConnected:i,setIsConnected:a,isLoading:c,setIsLoading:h,activeTab:u,setActiveTab:x,wsRef:f,logContainerRef:p})})})}function m(e){let{logs:t,setLogs:o,isConnected:d,setIsConnected:g,isLoading:u,setIsLoading:m,activeTab:x,setActiveTab:f,wsRef:p,logContainerRef:b}=e,{Header:y,Content:v}=r.Layout,j=()=>{m(!0),o([]),p.current&&p.current.close();let e="https:"===window.location.protocol?"wss:":"ws:",t="".concat(e,"//").concat(window.location.host),l=localStorage.getItem("auth"),n=new WebSocket(l?"".concat(t,"/ws/logs?file=").concat(x,".log&authorization=Basic%20").concat(encodeURIComponent(l)):"".concat(t,"/ws/logs?file=").concat(x,".log"));p.current=n,n.onopen=()=>{g(!0),m(!1),r.FN.success("日志连接已建立")},n.onmessage=e=>{o(t=>[...t,e.data])},n.onerror=e=>{console.error("WebSocket错误:",e),n.readyState===WebSocket.CLOSED||n.readyState===WebSocket.CLOSING?console.log("WebSocket在连接建立前已关闭"):r.FN.error("连接错误，请重试"),m(!1)},n.onclose=()=>{g(!1),console.log("WebSocket连接已关闭")}};return(0,n.useEffect)(()=>(j(),()=>{p.current&&(console.log("主动关闭WebSocket连接"),p.current.close())}),[x]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(y,{style:{backgroundColor:"var(--semi-color-bg-1)"},children:(0,l.jsx)(r.JL,{style:{border:"none"},header:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{style:{backgroundColor:"rgba(var(--semi-blue-4), 1)",borderRadius:"var(--semi-border-radius-large)",color:"var(--semi-color-bg-0)",display:"flex",padding:"6px"},children:(0,l.jsx)(s.Z,{size:"large"})}),(0,l.jsx)("h4",{style:{marginLeft:"12px"},children:"实时日志"})]}),mode:"horizontal"})}),(0,l.jsx)(v,{style:{padding:12,backgroundColor:"var(--semi-color-bg-0)",height:"calc(100vh - 60px)",display:"flex",flexDirection:"column"},children:(0,l.jsx)(r.Card,{style:{flex:1,overflow:"hidden"},bodyStyle:{height:"100%",overflow:"hidden",boxSizing:"border-box"},children:(0,l.jsxs)(r.mQ,{type:"line",style:{marginTop:-20,marginBottom:-20},activeKey:x,onChange:e=>{f(e)},tabBarExtraContent:(0,l.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,l.jsx)(r.zx,{icon:(0,l.jsx)(i,{}),onClick:()=>window.location.href="/static/".concat(x,".log"),type:"primary",theme:"solid",size:"small",children:"下载"}),(0,l.jsx)(r.zx,{icon:(0,l.jsx)(a.Z,{}),onClick:()=>{j()},theme:"light",size:"small",children:"刷新"}),(0,l.jsx)(r.zx,{icon:(0,l.jsx)(c.Z,{}),onClick:()=>{o([])},theme:"light",size:"small",children:"清空"}),(0,l.jsx)(r.Typography.Text,{type:d?"success":"danger",style:{marginLeft:8,display:"flex",alignItems:"center"},children:d?"已连接":"未连接"})]}),children:[(0,l.jsx)(r.Jm,{tab:"主程序运行日志",itemKey:"ds_update",children:(0,l.jsx)(h,{logs:t,logContainerRef:b,isLoading:u})}),(0,l.jsx)(r.Jm,{tab:"stream-gears下载日志",itemKey:"download",children:(0,l.jsx)(h,{logs:t,logContainerRef:b,isLoading:u})}),(0,l.jsx)(r.Jm,{tab:"biliup-rs上传日志",itemKey:"upload",children:(0,l.jsx)(h,{logs:t,logContainerRef:b,isLoading:u})})]})})})]})}}},function(e){e.O(0,[916,737,877,623,290,852,191,147,429,597,326,301,25,469,789,971,117,744],function(){return e(e.s=9435)}),_N_E=e.O()}]);
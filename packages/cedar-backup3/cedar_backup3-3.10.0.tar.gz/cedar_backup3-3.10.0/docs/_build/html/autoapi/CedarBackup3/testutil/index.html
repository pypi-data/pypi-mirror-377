<!DOCTYPE html>

<html lang="en" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>CedarBackup3.testutil &#8212; cedar-backup3 3.10.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=6625fa76" />
    <link rel="stylesheet" type="text/css" href="../../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css?v=ec641305" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <script src="../../../_static/documentation_options.js?v=f8d09eac"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="CedarBackup3.tools" href="../tools/index.html" />
    <link rel="prev" title="CedarBackup3.scripts" href="../scripts/index.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-CedarBackup3.testutil">
<span id="cedarbackup3-testutil"></span><h1>CedarBackup3.testutil<a class="headerlink" href="#module-CedarBackup3.testutil" title="Link to this heading">¶</a></h1>
<p>Provides unit-testing utilities.</p>
<p>These utilities are kept here, separate from util.py, because they provide
common functionality that I do not want exported “publicly” once Cedar Backup
is installed on a system.  They are only used for unit testing, and are only
useful within the source tree.</p>
<p>Many of these functions are in here because they are “good enough” for unit
test work but are not robust enough to be real public functions.  Others (like
<a class="reference internal" href="#CedarBackup3.testutil.removedir" title="CedarBackup3.testutil.removedir"><code class="xref any py py-func docutils literal notranslate"><span class="pre">removedir</span></code></a>) do what they are supposed to, but I don’t want responsibility for
making them available to others.</p>
<dl class="field-list simple">
<dt class="field-odd">author<span class="colon">:</span></dt>
<dd class="field-odd"><p>Kenneth J. Pronovici &lt;<a class="reference external" href="mailto:pronovic&#37;&#52;&#48;ieee&#46;org">pronovic<span>&#64;</span>ieee<span>&#46;</span>org</a>&gt;</p>
</dd>
</dl>
<section id="module-contents">
<h2>Module Contents<a class="headerlink" href="#module-contents" title="Link to this heading">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.setupDebugLogger">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">setupDebugLogger</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.setupDebugLogger" title="Link to this definition">¶</a></dt>
<dd><p>Sets up a screen logger for debugging purposes.</p>
<p>Normally, the CLI functionality configures the logger so that
things get written to the right place.  However, for debugging
it’s sometimes nice to just get everything – debug information
and output – dumped to the screen.  This function takes care
of that.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.configureLogging">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">configureLogging</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.configureLogging" title="Link to this definition">¶</a></dt>
<dd><p>Optionally disable system logging based on configuration in the environment.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.setupOverrides">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">setupOverrides</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.setupOverrides" title="Link to this definition">¶</a></dt>
<dd><p>Set up any platform-specific overrides that might be required.</p>
<p>When packages are built, this is done manually (hardcoded) in customize.py
and the overrides are set up in cli.cli().  This way, no runtime checks need
to be done.  This is safe, because the package maintainer knows exactly
which platform (Debian or not) the package is being built for.</p>
<p>Unit tests are different, because they might be run anywhere.  So, we
attempt to make a guess about plaform using platformDebian(), and use that
to set up the custom overrides so that platform-specific unit tests continue
to work.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.findResources">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">findResources</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">resources</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataDirs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.findResources" title="Link to this definition">¶</a></dt>
<dd><p>Returns a dictionary of locations for various resources.
:param resources: List of required resources
:param dataDirs: List of data directories to search within for resources</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Dictionary mapping resource name to resource path</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>Exception</strong> – If some resource cannot be found</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.commandAvailable">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">commandAvailable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">command</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.commandAvailable" title="Link to this definition">¶</a></dt>
<dd><p>Indicates whether a command is available on $PATH somewhere.
This should work on both Windows and UNIX platforms.
:param command: Commang to search for</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Boolean true/false depending on whether command is available</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.buildPath">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">buildPath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">components</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.buildPath" title="Link to this definition">¶</a></dt>
<dd><p>Builds a complete path from a list of components.
For instance, constructs <code class="docutils literal notranslate"><span class="pre">&quot;/a/b/c&quot;</span></code> from <code class="docutils literal notranslate"><span class="pre">[&quot;/a&quot;,</span> <span class="pre">&quot;b&quot;,</span> <span class="pre">&quot;c&quot;]</span></code>.
:param components: List of components</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>String path constructed from components</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If a path cannot be encoded properly</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.removedir">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">removedir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tree</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.removedir" title="Link to this definition">¶</a></dt>
<dd><p>Recursively removes an entire directory.
This is basically taken from an example on python.com.
:param tree: Directory tree to remove</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If a path cannot be encoded properly</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.extractTar">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">extractTar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tmpdir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filepath</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.extractTar" title="Link to this definition">¶</a></dt>
<dd><p>Extracts the indicated tar file to the indicated tmpdir.
:param tmpdir: Temp directory to extract to
:param filepath: Path to tarfile to extract</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>ValueError</strong> – If a path cannot be encoded properly</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.changeFileAge">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">changeFileAge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">subtract</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.changeFileAge" title="Link to this definition">¶</a></dt>
<dd><p>Changes a file age using the <code class="docutils literal notranslate"><span class="pre">os.utime</span></code> function.</p>
<p><em>Note:</em> Some platforms don’t seem to be able to set an age precisely.  As a
result, whereas we might have intended to set an age of 86400 seconds, we
actually get an age of 86399.375 seconds.  When util.calculateFileAge()
looks at that the file, it calculates an age of 0.999992766204 days, which
then gets truncated down to zero whole days.  The tests get very confused.
To work around this, I always subtract off one additional second as a fudge
factor.  That way, the file age will be <em>at least</em> as old as requested
later on.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> – File to operate on</p></li>
<li><p><strong>subtract</strong> – Number of seconds to subtract from the current time</p></li>
</ul>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ValueError</strong> – If a path cannot be encoded properly</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.getMaskAsMode">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">getMaskAsMode</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.getMaskAsMode" title="Link to this definition">¶</a></dt>
<dd><p>Returns the user’s current umask inverted to a mode.
A mode is mostly a bitwise inversion of a mask, i.e. mask 002 is mode 775.
:returns: Umask converted to a mode, as an integer</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.getLogin">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">getLogin</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.getLogin" title="Link to this definition">¶</a></dt>
<dd><p>Returns the name of the currently-logged in user.  This might fail under
some circumstances - but if it does, our tests would fail anyway.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.randomFilename">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">randomFilename</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">length</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">suffix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.randomFilename" title="Link to this definition">¶</a></dt>
<dd><p>Generates a random filename with the given length.
&#64;return Random filename</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.failUnlessAssignRaises">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">failUnlessAssignRaises</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">testCase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">exception</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prop</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.failUnlessAssignRaises" title="Link to this definition">¶</a></dt>
<dd><p>Equivalent of <code class="docutils literal notranslate"><span class="pre">failUnlessRaises</span></code>, but used for property assignments instead.</p>
<p>It’s nice to be able to use <code class="docutils literal notranslate"><span class="pre">failUnlessRaises</span></code> to check that a method call
raises the exception that you expect.  Unfortunately, this method can’t be
used to check Python propery assignments, even though these property
assignments are actually implemented underneath as methods.</p>
<p>This function (which can be easily called by unit test classes) provides an
easy way to wrap the assignment checks.  It’s not pretty, or as intuitive as
the original check it’s modeled on, but it does work.</p>
<p>Let’s assume you make this method call:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">testCase</span><span class="o">.</span><span class="n">failUnlessAssignRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="n">collectDir</span><span class="p">,</span> <span class="s2">&quot;absolutePath&quot;</span><span class="p">,</span> <span class="n">absolutePath</span><span class="p">)</span>
</pre></div>
</div>
<p>If you do this, a test case failure will be raised unless the assignment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">collectDir</span><span class="o">.</span><span class="n">absolutePath</span> <span class="o">=</span> <span class="n">absolutePath</span>
</pre></div>
</div>
<p>fails with a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> exception.  The failure message differentiates
between the case where no exception was raised and the case where the wrong
exception was raised.</p>
<p><em>Note:</em> Internally, the <code class="docutils literal notranslate"><span class="pre">missed</span></code> and <code class="docutils literal notranslate"><span class="pre">instead</span></code> variables are used rather
than directly calling <code class="docutils literal notranslate"><span class="pre">testCase.fail</span></code> upon noticing a problem because the
act of “failure” itself generates an exception that would be caught by the
general <code class="docutils literal notranslate"><span class="pre">except</span></code> clause.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>testCase</strong> – PyUnit test case object (i.e. self)</p></li>
<li><p><strong>exception</strong> – Exception that is expected to be raised</p></li>
<li><p><strong>obj</strong> – Object whose property is to be assigned to</p></li>
<li><p><strong>prop</strong> – Name of the property, as a string</p></li>
<li><p><strong>value</strong> – Value that is to be assigned to the property</p></li>
</ul>
</dd>
</dl>
<p>&#64;see: <code class="docutils literal notranslate"><span class="pre">unittest.TestCase.failUnlessRaises</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.captureOutput">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">captureOutput</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">c</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.captureOutput" title="Link to this definition">¶</a></dt>
<dd><p>Captures the output (stdout, stderr) of a function or a method.</p>
<p>Some of our functions don’t do anything other than just print output.  We
need a way to test these functions (at least nominally) but we don’t want
any of the output spoiling the test suite output.</p>
<p>This function just creates a dummy file descriptor that can be used as a
target by the callable function, rather than <code class="docutils literal notranslate"><span class="pre">stdout</span></code> or <code class="docutils literal notranslate"><span class="pre">stderr</span></code>.</p>
<p><em>Note:</em> This method assumes that <code class="docutils literal notranslate"><span class="pre">callable</span></code> doesn’t take any arguments
besides keyword argument <code class="docutils literal notranslate"><span class="pre">fd</span></code> to specify the file descriptor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>c</strong> – Callable function or method</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output of function, as one big string</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.platformDebian">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">platformDebian</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.platformDebian" title="Link to this definition">¶</a></dt>
<dd><p>Returns boolean indicating whether this is the Debian platform.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.platformMacOsX">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">platformMacOsX</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.platformMacOsX" title="Link to this definition">¶</a></dt>
<dd><p>Returns boolean indicating whether this is the Mac OS X platform.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.platformWindows">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">platformWindows</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.platformWindows" title="Link to this definition">¶</a></dt>
<dd><p>Returns boolean indicating whether this is the Windows platform.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.platformSupportsLinks">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">platformSupportsLinks</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.platformSupportsLinks" title="Link to this definition">¶</a></dt>
<dd><p>Whether the platform supports soft links</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="CedarBackup3.testutil.availableLocales">
<span class="sig-prename descclassname"><span class="pre">CedarBackup3.testutil.</span></span><span class="sig-name descname"><span class="pre">availableLocales</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#CedarBackup3.testutil.availableLocales" title="Link to this definition">¶</a></dt>
<dd><p>Returns a list of available locales on the system
:returns: List of string locale names</p>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">cedar-backup3</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=pronovic&repo=cedar-backup3&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>






<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">API Reference</a><ul>
  <li><a href="../index.html">CedarBackup3</a><ul>
      <li>Previous: <a href="../scripts/index.html" title="previous chapter">CedarBackup3.scripts</a></li>
      <li>Next: <a href="../tools/index.html" title="next chapter">CedarBackup3.tools</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;(c) Kenneth J. Pronovici.
      
    </div>

    
    <a href="https://github.com/pronovic/cedar-backup3" class="github">
        <img src="../../../_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
  </body>
</html>
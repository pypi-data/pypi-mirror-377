# -*- coding: UTF-8 -*-
"""
{{project_name}} é¡¹ç›®é…ç½®æ–‡ä»¶ï¼ˆæ¸©å’Œç‰ˆï¼‰
=============================
åŸºäº Crawlo æ¡†æ¶çš„æ¸©å’Œçˆ¬è™«é¡¹ç›®é…ç½®ã€‚
é€‚åˆå¯¹ç›®æ ‡ç½‘ç«™å‹å¥½çš„ä½è´Ÿè½½çˆ¬å–ã€‚
"""
import os
from crawlo.config import CrawloConfig

# ============================== é¡¹ç›®åŸºæœ¬ä¿¡æ¯ ==============================
PROJECT_NAME = '{{project_name}}'

# ============================== æ¸©å’Œæ¨¡å¼é…ç½®è¯´æ˜ ==============================
# 
# æœ¬æ¨¡æ¿ä¸“ä¸ºå¯¹ç›®æ ‡ç½‘ç«™å‹å¥½çš„ä½è´Ÿè½½çˆ¬å–è®¾è®¡ï¼Œé€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š
# - éœ€è¦é¿å…å¯¹ç›®æ ‡ç½‘ç«™é€ æˆè¿‡å¤§å‹åŠ›
# - é•¿æ—¶é—´è¿è¡Œçš„ç›‘æ§ç±»çˆ¬è™«
# - å¯¹ç›®æ ‡ç½‘ç«™æœ‰å‹å¥½æ€§è¦æ±‚çš„é¡¹ç›®
# 
# è¿è¡Œæ¨¡å¼ç‰¹ç‚¹ï¼š
# - RUN_MODE = 'standalone'ï¼ˆå•æœºæ¨¡å¼ï¼‰
# - QUEUE_TYPE = 'memory'ï¼ˆä½¿ç”¨å†…å­˜é˜Ÿåˆ—ï¼‰
# - FILTER_CLASS = 'crawlo.filters.memory_filter.MemoryFilter'ï¼ˆå†…å­˜è¿‡æ»¤å™¨ï¼‰
# - DEFAULT_DEDUP_PIPELINE = 'crawlo.pipelines.memory_dedup_pipeline.MemoryDedupPipeline'ï¼ˆå†…å­˜å»é‡ï¼‰
# 
# é…ç½®ç‰¹ç‚¹ï¼š
# - ä½å¹¶å‘ï¼šCONCURRENCY = 2
# - é«˜å»¶è¿Ÿï¼šDOWNLOAD_DELAY = 3.0ç§’
# - éšæœºåŒ–ï¼šå¯ç”¨RANDOMNESSå¢åŠ éšæœºæ€§
# - è¿æ¥æ± é™åˆ¶ï¼šå‡å°‘è¿æ¥æ•°é¿å…ç»™æœåŠ¡å™¨é€ æˆå‹åŠ›
# 
# æ‰©å±•å»ºè®®ï¼š
# - å¦‚éœ€è·¨ä¼šè¯å»é‡ï¼Œå¯å°†FILTER_CLASSå’ŒDEFAULT_DEDUP_PIPELINEæ”¹ä¸ºRediså®ç°
# - å¯æ ¹æ®ç›®æ ‡ç½‘ç«™ç‰¹æ€§è°ƒæ•´DOWNLOAD_DELAYå’ŒRANDOM_RANGEå‚æ•°
#
# ğŸ¯ æœ€ä½³ä½¿ç”¨æ–¹å¼ï¼š
# æ¨èä½¿ç”¨é…ç½®å·¥å‚æ–¹å¼åˆ›å»ºæ¸©å’Œæ¨¡å¼é…ç½®ï¼š
# from crawlo.config import CrawloConfig
# config = CrawloConfig.presets().gentle()
# process = CrawlerProcess(settings=config.to_dict())

# ============================== æ¸©å’Œæ¨¡å¼é…ç½® ==============================
# ä½¿ç”¨é…ç½®å·¥å‚åˆ›å»ºæ¸©å’Œæ¨¡å¼é…ç½®
CONFIG = CrawloConfig.presets().gentle()

# è·å–é…ç½®
locals().update(CONFIG.to_dict())

# ============================== ç½‘ç»œè¯·æ±‚é…ç½® ==============================
DOWNLOADER = "crawlo.downloader.httpx_downloader.HttpXDownloader"
DOWNLOAD_TIMEOUT = 60
VERIFY_SSL = True

# ============================== ä½å¹¶å‘é…ç½® ==============================
CONCURRENCY = 2
MAX_RUNNING_SPIDERS = 1
DOWNLOAD_DELAY = 3.0
RANDOMNESS = True
RANDOM_RANGE = (2.0, 5.0)

# ============================== è¿æ¥æ± é…ç½® ==============================
CONNECTION_POOL_LIMIT = 10
CONNECTION_POOL_LIMIT_PER_HOST = 5

# ============================== é‡è¯•é…ç½® ==============================
MAX_RETRY_TIMES = 3
RETRY_HTTP_CODES = [408, 429, 500, 502, 503, 504, 522, 524]
IGNORE_HTTP_CODES = [403, 404]

# ============================== é˜Ÿåˆ—é…ç½® ==============================
SCHEDULER_MAX_QUEUE_SIZE = 1000
QUEUE_MAX_RETRIES = 3
QUEUE_TIMEOUT = 300

# ============================== æ•°æ®å­˜å‚¨é…ç½® ==============================
# MySQL é…ç½®
MYSQL_HOST = os.getenv('MYSQL_HOST', '127.0.0.1')
MYSQL_PORT = int(os.getenv('MYSQL_PORT', 3306))
MYSQL_USER = os.getenv('MYSQL_USER', 'root')
MYSQL_PASSWORD = os.getenv('MYSQL_PASSWORD', '123456')
MYSQL_DB = os.getenv('MYSQL_DB', '{{project_name}}')
MYSQL_TABLE = '{{project_name}}_data'

# MongoDB é…ç½®
MONGO_URI = os.getenv('MONGO_URI', 'mongodb://localhost:27017')
MONGO_DATABASE = '{{project_name}}_db'
MONGO_COLLECTION = '{{project_name}}_items'

# ============================== å»é‡é…ç½® ==============================
# æ˜ç¡®æŒ‡å®šæ¸©å’Œæ¨¡å¼ä¸‹ä½¿ç”¨å†…å­˜å»é‡ç®¡é“
DEFAULT_DEDUP_PIPELINE = 'crawlo.pipelines.memory_dedup_pipeline.MemoryDedupPipeline'
FILTER_CLASS = 'crawlo.filters.memory_filter.MemoryFilter'
REDIS_TTL = 0
CLEANUP_FP = 0
FILTER_DEBUG = True

# ============================== ä¸­é—´ä»¶ä¸ç®¡é“ ==============================
MIDDLEWARES = [
    'crawlo.middleware.request_ignore.RequestIgnoreMiddleware',
    'crawlo.middleware.download_delay.DownloadDelayMiddleware',
    'crawlo.middleware.default_header.DefaultHeaderMiddleware',
    'crawlo.middleware.retry.RetryMiddleware',
    'crawlo.middleware.response_code.ResponseCodeMiddleware',
]

PIPELINES = [
    'crawlo.pipelines.console_pipeline.ConsolePipeline',
    # '{{project_name}}.pipelines.DatabasePipeline',
]

# æ˜ç¡®æ·»åŠ å†…å­˜å»é‡ç®¡é“åˆ°ç®¡é“åˆ—è¡¨å¼€å¤´
PIPELINES.insert(0, DEFAULT_DEDUP_PIPELINE)

# ============================== æ‰©å±•ç»„ä»¶ ==============================
EXTENSIONS = [
    'crawlo.extension.log_interval.LogIntervalExtension',
    'crawlo.extension.log_stats.LogStats',
    'crawlo.extension.logging_extension.CustomLoggerExtension',
]

# ============================== æ—¥å¿—é…ç½® ==============================
LOG_LEVEL = 'INFO'
LOG_FILE = f'logs/{{project_name}}.log'
STATS_DUMP = True

# ============================== è‡ªå®šä¹‰é…ç½® ==============================
# åœ¨æ­¤å¤„æ·»åŠ é¡¹ç›®ç‰¹å®šçš„é…ç½®é¡¹
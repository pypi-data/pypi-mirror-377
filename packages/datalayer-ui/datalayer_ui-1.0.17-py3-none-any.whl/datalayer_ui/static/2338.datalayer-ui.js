"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[2338],{12338:(e,t,n)=>{n.d(t,{g:()=>de});var o=n(18683),r=n(75987),s=n(22462),i=n(11796),a=n(98754),c=n(9387),l=n(45222),d=n(17402),h=function(e,t){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},h(e,t)};function u(e,t){function n(){this.constructor=e}h(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function p(e){return"function"==typeof e}var b=!1,_={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack,b=e},get useDeprecatedSynchronousErrorHandling(){return b}};function f(e){setTimeout(function(){throw e},0)}var y={closed:!0,next:function(e){},error:function(e){if(_.useDeprecatedSynchronousErrorHandling)throw e;f(e)},complete:function(){}},m=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function g(e){return null!==e&&"object"==typeof e}var x=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),k=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,o=n._parentOrParents,r=n._ctorUnsubscribe,s=n._unsubscribe,i=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,o instanceof e)o.remove(this);else if(null!==o)for(var a=0;a<o.length;++a)o[a].remove(this);if(p(s)){r&&(this._unsubscribe=void 0);try{s.call(this)}catch(e){t=e instanceof x?v(e.errors):[e]}}if(m(i)){a=-1;for(var c=i.length;++a<c;){var l=i[a];if(g(l))try{l.unsubscribe()}catch(e){t=t||[],e instanceof x?t=t.concat(v(e.errors)):t.push(e)}}}if(t)throw new x(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var o=n;(n=new e)._subscriptions=[o]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function v(e){return e.reduce(function(e,t){return e.concat(t instanceof x?t.errors:t)},[])}var w=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),C=function(e){function t(n,o,r){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=y;break;case 1:if(!n){s.destination=y;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new S(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new S(s,n,o,r)}return s}return u(t,e),t.prototype[w]=function(){return this},t.create=function(e,n,o){var r=new t(e,n,o);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(k),S=function(e){function t(t,n,o,r){var s,i=e.call(this)||this;i._parentSubscriber=t;var a=i;return p(n)?s=n:n&&(s=n.next,o=n.error,r=n.complete,n!==y&&(p((a=Object.create(n)).unsubscribe)&&i.add(a.unsubscribe.bind(a)),a.unsubscribe=i.unsubscribe.bind(i))),i._context=a,i._next=s,i._error=o,i._complete=r,i}return u(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;_.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=_.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):f(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;f(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};_.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),_.useDeprecatedSynchronousErrorHandling)throw e;f(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!_.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return _.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(f(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(C),P=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function E(e){return e}var M=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var o=this.operator,r=function(e,t,n){if(e){if(e instanceof C)return e;if(e[w])return e[w]()}return e||t||n?new C(e,t,n):new C(y)}(e,t,n);if(o?r.add(o.call(r,this.source)):r.add(this.source||_.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),_.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){_.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,o=t.destination,r=t.isStopped;if(n||r)return!1;e=o&&o instanceof C?o:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=T(t))(function(t,o){var r;r=n.subscribe(function(t){try{e(t)}catch(e){o(e),r&&r.unsubscribe()}},o,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[P]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:(0===(n=e).length?E:1===n.length?n[0]:function(e){return n.reduce(function(e,t){return t(e)},e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=T(e))(function(e,n){var o;t.subscribe(function(e){return o=e},function(e){return n(e)},function(){return e(o)})})},e.create=function(t){return new e(t)},e}();function T(e){if(e||(e=_.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var j,N=n(50059),O=n(42968);n(72490),function(e){e.Disconnected="disconnected",e.Connecting="connecting",e.Connected="connected",e.Error="error"}(j||(j={}));var D=n(60531),K=n(14809);K.x0;var A=n(1290),F=n(62097),H=n(37706),I=n(71784),R=n(89492),z=n(67004),L=n(14377),U=n(55047),W=n(47501),J=n(83303),V=n(30574),G=n(39756),B=n(29028),Y=n(47798),$=n(89915),X=n(53054),Q=n(38921),q=n(16950),Z=n(45458),ee=n(66698),te=n(94247),ne=n(35663),oe=n(70639);class re extends oe.p{_nbformat;_readonly;constructor(e){super(e),this._nbformat=e.nbformat,this._readonly=e.readonly}createNew(e){if(this._nbformat){this._nbformat.cells.forEach(e=>{e.metadata.editable=!this._readonly});const e=new i.x;return e.fromJSON(this._nbformat),e}{const t=super.createNew(e);return t.readOnly=this._readonly,t}}}var se=n(71791);class ie{_boxPanel;_commands;_contentFactory;_context;_documentRegistry;_iPyWidgetsManager;_id;_kernel;_kernelConnection;_kernelClients;_kernelTransfer;_lite;_mimeTypeService;_nbformat;_notebookModelFactory;_notebookPanel;_onSessionConnection;_path;_readonly;_renderers;_rendermime;_serverless;_serviceManager;_tracker;_url;constructor(e){console.log("Creating a new Notebook Adapter."),this._id=e.id,this._kernel=e.kernel,this._kernelClients=e.kernelClients,this._lite=e.lite,this._nbformat=e.nbformat,this._path=e.path,this._readonly=e.readonly,this._renderers=e.renderers,this._serverless=e.serverless,this._serviceManager=e.serviceManager,this._url=e.url,this._kernelTransfer=e.kernelTransfer,this._onSessionConnection=e.onSessionConnection,this._boxPanel=new K.e6,this._boxPanel.addClass("dla-Jupyter-Notebook"),this._boxPanel.spacing=0,this._commands=new q.J,e.url?this.loadFromUrl(e.url).then(e=>{this._nbformat=e,this.setupAdapter()}):this.setupAdapter()}async loadFromUrl(e){return fetch(e).then(e=>e.text()).then(e=>JSON.parse(e))}notebookKeydownListener=e=>{this._commands?.processKeydownEvent(e)};setupCompleter(e){const t=e.content.activeCell&&e.content.activeCell.editor,n=e.context.sessionContext,o=new F.X,r=new H.A({editor:t,model:o}),s=new I.G,i=new R.C({context:{widget:e,editor:t,session:n.session},providers:[s],timeout:1e3}),a=new z.$({completer:r,reconciliator:i});return n.ready.then(()=>{const e=new I.G,o=new R.C({context:{widget:this._notebookPanel,editor:t,session:n.session},providers:[e],timeout:1e3});a.reconciliator=o}),a.editor=t,e.content.activeCellChanged.connect((e,t)=>{t&&t.ready.then(()=>{a.editor=t&&t.editor})}),r.hide(),K.x0.attach(r,document.body),a}initializeContext(){const e=void 0===this._path||""===this._path;this._context=new L.o({manager:this._serviceManager,factory:this._notebookModelFactory,path:this._path??".datalayer/ping.ipynb",kernelPreference:{id:this._kernel?.id,shouldStart:!1,canStart:!1,autoStartDefault:!1,shutdownOnDispose:!1}}),this._iPyWidgetsManager=new Z.SS(this._context,this._rendermime,{saveState:!1});const t={safe:!0,mimeTypes:["application/vnd.jupyter.widget-view+json"],defaultRank:1,createRenderer:e=>new ee.X(e,this._iPyWidgetsManager)};if(this._rendermime.addFactory(t,1),this._kernelClients?.map(e=>{this._iPyWidgetsManager?.registerWithKernel(e)}),this._context.sessionContext._initialize=async()=>{const e=this._context.sessionContext.sessionManager;await e.ready,await e.refreshRunning();const t=(0,Q.find)(e.running(),e=>e.kernel?.id===this._kernel?.id);if(t)try{const n=e.connectTo({model:{...t,path:this._path??t.path,name:this._path??t.name},kernelConnectionOptions:{handleComms:!0}});this._context.sessionContext._handleNewSession(n),this._kernel?.connection?.dispose()}catch(e){return this._context.sessionContext._handleSessionError(e),Promise.reject(e)}return await this._context.sessionContext._startIfNecessary()},e&&(this._context._populate=async()=>{if(this._context._isPopulated=!0,this._context._isReady=!0,this._context._populatedPromise.resolve(void 0),this._context.isDisposed)return;const e=this._context._model.defaultKernelName||this._context.sessionContext.kernelPreference.name;this._context.sessionContext.kernelPreference={...this._context.sessionContext.kernelPreference,name:e,language:this._context._model.defaultKernelLanguage},this._context.sessionContext.initialize().then(e=>{e&&this._context._dialogs.selectKernel(this._context.sessionContext.sessionContext)})},this._context.initialize=async e=>{this._context.model.dirty=!1;const t=(new Date).toISOString(),n={path:this._id,name:this._id,type:"notebook",content:void 0,writable:!0,created:t,last_modified:t,mimetype:"application/x-ipynb+json",format:"json"};this._context._updateContentsModel(n),await this._context._populate(),this._context.model.sharedModel.clearUndoHistory()}),this._context.sessionContext.sessionChanged.connect((e,t)=>{const n=t.newValue;if(console.log("Current Jupyter Session Connection.",n),this._onSessionConnection&&n){this._onSessionConnection(n),this._iPyWidgetsManager?.registerWithKernel(n.kernel);const e=this._notebookPanel?.model;e&&this._iPyWidgetsManager?.restoreWidgets(e)}}),this._context.sessionContext.kernelChanged.connect((e,t)=>{const n=t.newValue;this._kernelConnection=n,console.log("Current Jupyter Kernel Connection.",n),n&&!n.handleComms&&(console.log("Updating the current Kernel Connection to enforce Comms support.",n.handleComms),n.handleComms=!0)}),this._context.sessionContext.ready.then(()=>{this._onSessionConnection&&this._onSessionConnection(this._context?.sessionContext.session??void 0);const e=this._context?.sessionContext.session?.kernel;this._kernelConnection=e,this._kernelTransfer&&e&&e.connectionStatusChanged.connect((t,n)=>{"connected"===n&&this._kernelTransfer.transfer(e)})}),!this._notebookPanel){const e=this._documentRegistry?.getWidgetFactory("Notebook");this._notebookPanel=e?.createNew(this._context)}const n=this.setupCompleter(this._notebookPanel);if(!this._readonly)try{(0,se.VV)(this._commands,n,this._tracker,this._path)}catch{}this._boxPanel.addWidget(this._notebookPanel),K.e6.setStretch(this._notebookPanel,0),window.addEventListener("resize",()=>{this._notebookPanel?.update()}),this._context.initialize(e).then(()=>{e&&this._notebookPanel?.model?.fromJSON(this._nbformat)})}setupAdapter(){document.addEventListener("keydown",this.notebookKeydownListener,!0);const e=$.dn.filter(e=>"text/javascript"!==e.mimeTypes[0]);e.push(J.rendererFactory),e.push(W.rendererFactory),this._renderers.map(t=>e.push(t));const t=new A.T9;for(const e of A.T9.getDefaultLanguages())t.addLanguage(e);t.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>(await Promise.all([n.e(6636),n.e(9946),n.e(2899),n.e(5949)]).then(n.bind(n,15949))).markdown({codeLanguages:e=>t.findBest(e)})}),this._rendermime=new X.K({initialFactories:e,latexTypesetter:new V.p,markdownParser:(0,ne.H)(t)}),this._documentRegistry=new U.p({}),this._mimeTypeService=new A.mN(t);const o=new A.k8;for(const e of A.k8.getDefaultThemes())o.addTheme(e);const r=new A.Ez({extensions:(()=>{const e=new A.AG;for(const t of A.AG.getDefaultExtensions({themes:o}))e.addExtension(t);return e.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return A.AG.createImmutableExtension((0,A.rX)({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),e})(),languages:t}),s={factoryService:r,mimeTypeService:this._mimeTypeService},i=s.factoryService.newInlineEditor;this._contentFactory=new te.KQ({editorFactory:i}),this._tracker=new G.G({namespace:this._id});const a=new B.k({name:"Notebook",label:"Notebook",modelName:"notebook",fileTypes:["notebook"],defaultFor:["notebook"],preferKernel:!0,autoStartDefault:!1,canStartKernel:!1,shutdownOnClose:!1,rendermime:this._rendermime,contentFactory:this._contentFactory,mimeTypeService:s.mimeTypeService,notebookConfig:{...Y.a.defaultNotebookConfig,recordTiming:!0}});a.widgetCreated.connect((e,t)=>{t.context.pathChanged.connect(()=>{this._tracker?.save(t)}),this._tracker?.add(t)}),this._documentRegistry.addWidgetFactory(a),this._notebookModelFactory=new re({nbformat:this._nbformat,readonly:this._readonly}),this._documentRegistry.addModelFactory(this._notebookModelFactory),this.initializeContext()}get id(){return this._id}get readonly(){return this._readonly}get serverless(){return this._serverless}get lite(){return this._lite}get path(){return this._path}get url(){return this._url}get nbformat(){return this._nbformat}get kernel(){return this._kernel}get kernelConnection(){return this._kernelConnection}get notebookPanel(){return this._notebookPanel}get context(){return this._context}set notebookPanel(e){this._notebookPanel=e}get panel(){return this._boxPanel}get commands(){return this._commands}get serviceManager(){return this._serviceManager}setNbformat(e){if(!e)throw new Error("The nbformat should first be set via the constructor of NotebookAdapter");this._nbformat!==e&&(this._nbformat=e,this._notebookPanel?.model?.fromJSON(e))}setServiceManager(e,t){this._lite=t,this._serviceManager=e,this._nbformat=this._notebookPanel?.model?.toJSON()}setKernel(e){this._kernel!==e&&(this._kernel=e,this.initializeContext())}setReadonly(e){if(this._readonly!==e){this._readonly=e,this._notebookPanel?.content.widgets.forEach(t=>{t.syncEditable=!0,t.model.sharedModel.setMetadata("editable",!e)});const t=this._context?.model.cells;t&&Array.from(t).forEach(t=>{t.setMetadata("editable",!e)}),this._notebookPanel?.content.widgets.forEach(e=>{e.saveEditableState()})}}setServerless(e){this._serverless!==e&&(this._serverless=e)}setPath(e){this._path!==e&&(this._path=e,this.initializeContext())}assignKernel(e){this._kernel=e,this._context?.sessionContext.changeKernel({id:e.id})}setDefaultCellType=e=>{this._notebookPanel.content.notebookConfig.defaultCell=e};changeCellType=e=>{const t=this._notebookPanel.content,n=t.model.sharedModel;t.widgets.forEach((o,r)=>{if(t.isSelectedOrActive(o)){if(o.model.type!==e){const t=o.model.toJSON();n.transact(()=>{n.deleteCell(r);const o=n.insertCell(r,{cell_type:e,source:t.source,metadata:t.metadata});t.attachments&&["markdown","raw"].includes(e)&&(o.attachments=t.attachments)})}"markdown"===e&&((o=t.widgets[r]).rendered=!1)}}),t.deselectAll()};insertAbove=e=>{const t=this._notebookPanel.content,n=this._notebookPanel.context.model,o=t.activeCell?t.activeCellIndex:0;n.sharedModel.insertCell(o,{cell_type:t.notebookConfig.defaultCell,source:e,metadata:"code"===t.notebookConfig.defaultCell?{trusted:!0}:{}}),t.activeCellIndex=o,t.deselectAll()};insertBelow=e=>{const t=this._notebookPanel.content,n=this._notebookPanel.context.model,o=t.activeCell?t.activeCellIndex+1:0;n.sharedModel.insertCell(o,{cell_type:t.notebookConfig.defaultCell,source:e,metadata:"code"===t.notebookConfig.defaultCell?{trusted:!0}:{}}),t.activeCellIndex=o,t.deselectAll()};dispose=()=>{document.removeEventListener("keydown",this.notebookKeydownListener,!0),this._context?.dispose(),this._notebookPanel?.dispose(),this._boxPanel.dispose()}}var ae=n(16476),ce=n(90117);const le=s.DU`
  .dla-Box-Notebook .jp-Cell .dla-CellSidebar-Container {
    display: none;
  }
  .dla-Box-Notebook .jp-Cell.jp-mod-active .dla-CellSidebar-Container {
    display: block;
  }
`,de=e=>{const{serviceManager:t,defaultKernel:n,lite:s}=(0,O.PD)({lite:e.lite,serverless:e.serverless,serviceManager:e.serviceManager,startDefaultKernel:e.startDefaultKernel,useRunningKernelId:e.useRunningKernelId,useRunningKernelIndex:e.useRunningKernelIndex}),{Toolbar:h,collaborationProvider:u,extensions:p,height:b,maxHeight:_,nbformat:f,path:y,readonly:m,serverless:g,url:x}=e,[k,v]=(0,c.useState)(e.id||(0,d.YG)()),[w,C]=(0,c.useState)(),[S,P]=(0,c.useState)(!1),[E,T]=(0,c.useState)(new Array),K=e.kernel??n,A=(0,ae.Gx)(),F=A.selectNotebookPortals(k);console.log("Notebook render - adapter:",w,"isLoading:",S,"adapter.panel:",w?.panel);const H=async(t,n)=>{console.log("bootstrapAdapter called with kernel:",n);const r=new ie({...e,id:k,lite:s,kernel:n,serviceManager:t});console.log("Created adapter:",r),C(r),p.forEach(e=>{e.init({notebookId:k,commands:r.commands,panel:r.notebookPanel,adapter:r}),e.createNew(r.notebookPanel,r.context),T(E.concat(e.component??(0,o.jsx)(o.Fragment,{})))}),A.update({id:k,state:{adapter:r}}),r.notebookPanel?.content.modelChanged.connect((e,t)=>{e.model&&A.changeModel({id:k,notebookModel:e.model})}),r.notebookPanel?.content.activeCellChanged.connect((e,t)=>{null===t?A.activeCellChange({id:k,cellModel:void 0}):A.activeCellChange({id:k,cellModel:t})}),r.notebookPanel?.sessionContext.statusChanged.connect((e,t)=>{A.changeKernelStatus({id:k,kernelStatus:t})}),r.serviceManager.ready.then(()=>{if(!m){const t=r.notebookPanel.content.activeCell;t&&A.activeCellChange({id:k,cellModel:t}),(e=r.notebookPanel.content.activeCellChanged,new M(t=>{function n(e,n){t.next(n)}return e.connect(n),()=>{e.disconnect(n)}})).subscribe(e=>{A.activeCellChange({id:k,cellModel:e});const t=document.getElementById("right-panel-id");if(t){const n=(0,o.jsx)(a.A,{mt:3,children:(0,o.jsx)(D.r,{cellModel:e.model})}),r=(0,l.createPortal)(n,t);A.setPortalDisplay({id:k,portalDisplay:{portal:r,pinned:!1}})}})}var e})},I=(e,t)=>{t?t.ready.then(()=>{H(e,t)}):H(e,t)},R=()=>{w?.notebookPanel?.disposed.connect((e,t)=>{w&&(A.dispose(k),C(void 0))}),w?.notebookPanel?.dispose()};return(0,c.useEffect)(()=>{(t&&g||t&&K)&&I(t,K)},[t,K]),(0,c.useEffect)(()=>{let n=null,o=!0,s=null;return u&&(async()=>{if(w?.notebookPanel&&o&&(u&&(n=u),n))try{s=new r.Xn;const a=(e,t)=>{if(t===j.Connected&&w?.notebookPanel){const e=new i.x({collaborationEnabled:!0,disableDocumentWideUndoRedo:!0,sharedModel:s}),t=w.notebookPanel.content.model;try{w.notebookPanel.content.model=e,A.changeModel({id:k,notebookModel:e}),w.notebookPanel.update(),t&&t!==e&&t.dispose(),console.log("Notebook model updated with collaboration. Cell count:",e.cells?.length)}catch(e){console.error("Error updating notebook model:",e),t&&!t.isDisposed&&(w.notebookPanel.content.model=t)}}},c=(e,t)=>{console.error("Collaboration error:",t),t.message.includes("session expired")&&o&&n&&s&&n.connect(s,k).catch(console.error)};n.events.statusChanged.connect(a),n.events.errorOccurred.connect(c),await n.connect(s,k,{serviceManager:t,path:e.path}),console.log("Collaboration is setup with provider:",n.type)}catch(e){console.error("Failed to setup collaboration:",e),P(!1)}})().catch(e=>{console.error("Failed to setup collaboration connection.",e)}).finally(()=>{}),()=>{o=!1,n?.dispose(),s?.dispose()}},[w?.notebookPanel,u]),(0,c.useEffect)(()=>{w&&w.kernel!==K&&w.setKernel(K)},[K]),(0,c.useEffect)(()=>{w&&w.readonly!==m&&w.setReadonly(m)},[m]),(0,c.useEffect)(()=>{w&&w.serverless!==g&&w.setServerless(g)},[g]),(0,c.useEffect)(()=>{w&&w.nbformat!==f&&w.setNbformat(f)},[f]),(0,c.useEffect)(()=>{w&&y&&w.path!==y&&(R(),I(t))},[y]),(0,c.useEffect)(()=>{w&&x&&w.url!==x&&(R(),I(t))},[x]),(0,c.useEffect)(()=>()=>{R()},[]),(0,o.jsxs)(a.A,{style:{height:b,width:"100%",position:"relative"},id:"dla-Jupyter-Notebook",children:[h&&(0,o.jsx)(h,{notebookId:k}),(0,o.jsxs)(a.A,{className:"dla-Box-Notebook",sx:{"& .dla-Jupyter-Notebook":{height:b,maxHeight:_,width:"100%",overflowY:"hidden"},"& .datalayer-NotebookPanel-header":{minHeight:"50px"},"& .jp-Notebook":{flex:"1 1 auto !important",height:"100%",overflowY:"scroll"},"& .jp-NotebookPanel":{height:"100% !important",width:"100% !important"},"& .jp-Toolbar":{display:"none",zIndex:0},"& .jp-Toolbar .jp-HTMLSelect.jp-DefaultStyle select":{fontSize:"14px"},"& .jp-Toolbar > .jp-Toolbar-responsive-opener":{display:"none"},"& .jp-Toolbar-kernelName":{display:"none"},"& .jp-Cell":{width:`calc(100% - ${e.cellSidebarMargin}px)`},"& .jp-Notebook-footer":{width:`calc(100% - ${e.cellSidebarMargin+82}px)`},"& .jp-CodeMirrorEditor":{cursor:"text !important"},".dla-Box-Notebook":{position:"relative"}},children:[(0,o.jsx)(o.Fragment,{children:F?.map(e=>e)}),(0,o.jsx)(le,{}),(0,o.jsx)(a.A,{children:E.map((e,t)=>(0,o.jsx)(a.A,{children:e},`${e}-${t}`))}),S?(0,o.jsx)(ce.a,{}):(0,o.jsx)(a.A,{children:w?(0,o.jsx)(N.j,{id:k,children:w.panel}):(0,o.jsx)("div",{children:"No adapter available"})})]})]})};de.defaultProps={cellMetadataPanel:!1,cellSidebarMargin:120,collaborative:void 0,extensions:[],height:"100vh",kernelClients:[],maxHeight:"100vh",nbgrader:!1,readonly:!1,renderId:0,renderers:[],serverless:!1,startDefaultKernel:!1}}}]);
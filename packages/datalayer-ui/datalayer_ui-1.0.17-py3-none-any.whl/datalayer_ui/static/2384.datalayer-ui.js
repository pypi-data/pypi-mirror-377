"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[2384],{17523:(e,t,n)=>{n.d(t,{WS:()=>d});var r=n(88037),s=n(41630),a=n(98754),i=n(18683);function o(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l extends r._Q{constructor(e){super(),o(this,"_rows",void 0),o(this,"_mimeType",void 0),this._mimeType=e.mimeType,this._rows=[]}renderModel(e){const t=e.data[this._mimeType].split("\n").map(e=>e.split(";"));return this._rows=t,Promise.resolve()}render(){return 0===(this._rows.length>0?this._rows[0].length:0)?(0,i.jsx)("div",{children:"No data found!"}):(0,i.jsx)(s.NP,{children:this._rows.map(e=>(0,i.jsx)(a.A,{mt:3,children:e}))})}}const d={safe:!0,mimeTypes:["application/vnd.datalayer.csv"],createRenderer:e=>new l(e)}},22062:(e,t,n)=>{n.d(t,{H:()=>D});var r=n(14809),s=n(20568),a=n(88037),i=n(52982),o=n(9387),l=n(17310),d=n(41630),c=n(98754),u=n(70985),m=n(58875),p=n(11029),h=n(48824),x=n(99180),v=n(34429),f=n(38621),g=n(56944),j=n(10069),b=n(4116),y=n(18683);function k(e){const{createAIAgent:t}=(0,g.w)(),{aiAgents:n,addAIAgent:r}=(0,j.Ks)(),{cell:s,extensionProps:a}=e,{notebookId:i}=a,[k,C]=(0,o.useState)(!1),[S,w]=(0,o.useState)(),[_,A]=(0,o.useState)({prompt:""}),[N,M]=(0,o.useState)({prompt:void 0});(0,o.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===t.key&&S)for(const e of s.model.sharedModel.getMetadata("datalayer")?.ai?.messages??[])if(e.parent_id===S){w(void 0);break}};return s.model.sharedModel.metadataChanged.connect(e),()=>{s.model?.sharedModel.metadataChanged.disconnect(e)}},[s,S]),(0,o.useEffect)(()=>{S||C(!1)},[S]),(0,o.useEffect)(()=>{M({...N,prompt:void 0===_.prompt?void 0:_.prompt.length>0})},[_]);const P=(0,o.useCallback)(async()=>{const e=a.panel.context.sessionContext.session?.kernel,o=e?.serverSettings,l=e?.id;n.find(e=>e.documentId===i&&e.runtimeId===l)||(await t(i,"notebook_persist",o?.baseUrl,o?.token,l),r({documentId:i,runtimeId:l}));const d=(0,b.f)();!function(e,t,n){const r=e.model.getMetadata("datalayer")??{},s=r.ai??{prompts:[],messages:[]},a=s.prompts??[];a.push({id:t,prompt:n,username:void 0,timestamp:Date.now()}),s.prompts=a,r.ai=s,e.model.setMetadata("datalayer",r)}(s,d,_.prompt),w(d)},[n,s,a.panel.context.sessionContext.session?.kernel,_.prompt,i,t]),I=(0,o.useCallback)(e=>{e.ctrlKey&&"Enter"===e.key&&P()},[P]);return(0,y.jsx)(d.NP,{children:(0,y.jsx)(c.A,{display:"flex",style:{justifyContent:"right"},children:(0,y.jsx)(c.A,{className:"dla-Cell-ai-agent-button",children:(0,y.jsxs)(u.W,{open:k,onOpenChange:e=>C(e),children:[(0,y.jsx)(u.W.Anchor,{id:"custom-anchor-id",children:(0,y.jsx)(m.K,{icon:f.SD8,variant:"invisible","aria-label":"AI Agents menu"})}),(0,y.jsx)(u.W.Overlay,{width:"large",children:(0,y.jsxs)(c.A,{as:"form",m:3,children:[(0,y.jsxs)(p.A,{children:[(0,y.jsx)(p.A.Label,{visuallyHidden:!0}),(0,y.jsx)(h.Ay,{block:!0,value:_.prompt,onChange:e=>{A(t=>({...t,prompt:e.target.value}))},disabled:!!S,onKeyDown:I})]}),(0,y.jsxs)(c.A,{sx:{display:"flex",width:"100%",gap:"2px",marginTop:"var(--stack-gap-normal)"},children:[(0,y.jsx)(c.A,{flexGrow:1}),(0,y.jsx)(x.Q,{onClick:e=>C(!1),variant:"default",children:"Cancel"}),(0,y.jsx)(x.Q,{leadingVisual:l.A,onClick:P,disabled:!N.prompt||!!S,variant:"primary",children:S?(0,y.jsx)(v.A,{size:"small"}):"Ask AI"})]})]})})]})})})})}var C=n(34447),S=n(87324),w=n(94247),_=n(35903);const A=e=>{const{cell:t}=e,{datasources:n}=(0,_.Gr)(),[r,s]=(0,o.useState)(),[a,l]=(0,o.useState)("df");(0,o.useEffect)(()=>{const e=(e,t)=>{if("datalayer"===(t?.key??"datalayer")){const t=(e=>{const t=e.getMetadata("datalayer");if(t){const e=t.datasource;if(e)return e.id}})(e);if(t)for(const e of n)if(t===e.id){s(t);break}}};return e(t.model),t.model.metadataChanged.connect(e),()=>{t.model?.metadataChanged.disconnect(e)}},[t,n]);const c=e=>{const n=t.model.getMetadata("datalayer");e?(t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{id:e.id,variant:e.variant,name:e.name,description:e.description,database:e.database,outputBucket:e.outputBucket,destinationVar:a??"df"}}),s(e.id),t.editor.model.mimeType=w.bd):(t.model.setMetadata("datalayer",{...n,sql:!1,datasource:{}}),s(void 0),t.editor.model.mimeType=w.dC)};return(0,y.jsx)(d.NP,{children:(0,y.jsx)(i.az,{display:"flex",style:{justifyContent:"right"},children:(0,y.jsx)(i.az,{className:"dla-Cell-datasource-button",children:(0,y.jsxs)(u.W,{children:[(0,y.jsx)(u.W.Anchor,{id:"custom-anchor-id",children:(0,y.jsx)(m.K,{icon:f.bN0,variant:"invisible","aria-label":"Open Datasources menu"})}),(0,y.jsx)(u.W.Overlay,{width:"medium",children:(0,y.jsx)(C.l,{selectionVariant:"single",showDividers:!0,children:(0,y.jsxs)(C.l.Group,{children:[(0,y.jsx)(C.l.GroupHeading,{children:"Datasources"}),0===n.length&&(0,y.jsxs)(C.l.Item,{onSelect:()=>{},children:["No Datasource available",(0,y.jsx)(C.l.Description,{variant:"block",children:"Create a new Datasource to connect your cell."})]}),n.map(e=>(0,y.jsxs)(C.l.Item,{onSelect:()=>c(e),selected:e.id===r,children:[e.name,(0,y.jsx)(C.l.Description,{variant:"block",children:e.description})]},e.id)),(0,y.jsx)(C.l.Divider,{}),(0,y.jsx)(C.l.Item,{onSelect:e=>{e.preventDefault()},children:(0,y.jsxs)(p.A,{children:[(0,y.jsx)(p.A.Label,{children:"Destination variable"}),(0,y.jsx)(S.A,{size:"small",value:a,disabled:!r,onChange:e=>(e=>{l(e);const n=t.model.getMetadata("datalayer");t.model.setMetadata("datalayer",{...n,sql:!0,datasource:{...n.datasource,destinationVar:e??"df"}})})(e.target.value)})]})}),(0,y.jsx)(C.l.Divider,{}),(0,y.jsx)(C.l.Item,{variant:"danger",onSelect:()=>c(void 0),children:"None"})]})})})]})})})})};function N(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const M="dla-CellToolbar-Container";class P extends a._Q{constructor(e,t){super(),N(this,"_cell",void 0),N(this,"_props",void 0),this._cell=e,this._props=t,this.addClass(M)}render(){return(0,y.jsxs)(i.az,{display:"flex",children:[(0,y.jsx)(i.az,{flexGrow:1}),(0,y.jsxs)(s.fS,{initialEntries:["/"],children:[(0,y.jsx)(s.BV,{children:(0,y.jsx)(s.qh,{path:"*",element:(0,y.jsx)(k,{cell:this._cell,extensionProps:this._props})})}),(0,y.jsx)(A,{cell:this._cell,extensionProps:this._props})]})]})}}function I(e,t,n){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class z extends r.x0{constructor(e,t){super(),I(this,"_panel",void 0),I(this,"_props",void 0),this._panel=e,this._props=t,this.updateConnectedCell=this.updateConnectedCell.bind(this);const n=()=>{const e=this._panel.content.model?.cells;if(e){e.changed.connect(this.updateConnectedCell);for(let t=0;t<e.length;++t)this._registerCellChanges(e.get(t))}};n(),this._panel.content.modelChanged.connect(()=>{n()})}updateConnectedCell(e,t){t.oldValues.forEach(this._deregisterCellChanges.bind(this)),t.newValues.forEach(this._registerCellChanges.bind(this))}_deregisterCellChanges(e){}_registerCellChanges(e){const t=this._getCodeCell(e);t?(t.displayChanged.connect(()=>{this._updateCodeCell(t)}),t.inViewportChanged.connect(()=>{this._updateCodeCell(t)}),this._updateCodeCell(t)):"code"===e.type&&console.error(`Could not find code cell for model: ${e}`)}_getCodeCell(e){return"code"===e.type?this._panel.content.widgets.find(t=>t.model===e):null}_updateCodeCell(e){if(e.inputArea){const t=e.layout;if(t){const n=t;n.widgets[1].hasClass(M)||n.insertWidget(1,new P(e,this._props))}}}}class D{constructor(){var e,t,n;e=this,n=void 0,(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t="_props"))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}init(e){this._props=e}createNew(e,t){new z(e,this._props)}get component(){return null}}},52384:(e,t,n)=>{n.a(e,async(e,r)=>{try{n.r(t),n.d(t,{NotebookEdit:()=>me,default:()=>pe});var s=n(9387),a=n(20568),i=n(97789),o=n(16950),l=n(17781),d=n(34447),c=n(81461),u=n(21538),m=n(72533),p=n(48824),h=n(93054),x=n(70985),v=n(11029),f=n(87324),g=n(54617),j=n(99180),b=n(58875),y=n(38621),k=n(32916),C=n(34477),S=n(2606),w=n(5700),_=n(73553),A=n(42389),N=n(2159),M=n(16476),P=n(27446),I=n(14551),z=n(52982),D=n(3188),U=n(46871),T=n(98970),$=n(6543),L=n(68652),E=n(75345),O=n(83051),R=n(56944),V=n(34279),W=n(60105),F=n(17788),K=n(66210),B=n(41273),G=n(99179),H=n(10069),J=n(9570),Q=n(35903),q=n(26127),X=n(14178),Y=n(92131),Z=n(83626),ee=n(6417),te=n(26480),ne=n(17523),re=n(1162),se=n(74349),ae=n(22062),ie=n(53537),oe=n(60294),le=n(18683),de=e([re]),ce=de.then?(await de)():de;re=ce[0];const ue=new A.Od;function me(){const{notebookId:e}=(0,a.g)();if(!e)return(0,le.jsx)(le.Fragment,{});const t=(0,G.J)(),r=(0,l.S)(),A=(0,F.Z)(),de=(0,K.G)(e),{checkIsPlatformFeaturesPreviewer:ce}=(0,V.x)(),me=ce(t),{configuration:pe}=(0,J._O)(),{credits:he,token:xe}=(0,q.Y)(),{configuration:ve,multiServiceManager:fe,runtimeModels:ge}=(0,Y.c6)(),{jupyterLabAdapter:je}=(0,C.Hf)(),[be,ye]=(0,s.useState)(ue),[ke,Ce]=(0,s.useState)(void 0),[Se,we]=(0,s.useState)(),[_e,Ae]=(0,s.useState)(!1),[Ne,Me]=(0,s.useState)(),[Pe,Ie]=(0,s.useState)(!1),[ze,De]=(0,s.useState)(!0),[Ue,Te]=(0,s.useState)(""),[$e,Le]=(0,s.useState)(null),[Ee,Oe]=(0,s.useState)(),[Re,Ve]=(0,s.useState)(),[We,Fe]=(0,s.useState)(),[Ke,Be]=(0,s.useState)(),[Ge,He]=(0,s.useState)({name:"",nameConfirm:"",description:""}),[Je,Qe]=(0,s.useState)({name:void 0,nameConfirm:void 0,description:void 0}),{enqueueToast:qe,trackAsyncTask:Xe}=(0,B.d)(),{selectNotebookModel:Ye,reset:Ze}=(0,M.Gx)(),{screenCapture:et,space:tt,hideBackdrop:nt,setItem:rt,setScreenCapture:st,showBackdrop:at,showScreenshot:it,triggerItemsRefresh:ot}=(0,X.l5)(),{cloneNotebook:lt,deleteItem:dt,getDatasources:ct,getNotebook:ut,refreshDatasources:mt,refreshNotebook:pt,updateNotebook:ht,updateNotebookModel:xt}=(0,W.E)(),{updateDatasources:vt}=(0,Q.Gr)(),{updateAIAgent:ft}=(0,H.Ks)(),{patchAIAgent:gt}=(0,R.w)(),jt=(0,s.useMemo)(()=>{const e=pe?.runUrl;if(e&&xe)return new D.k({runUrl:e,token:xe})},[pe,e,xe]),bt=(0,s.useMemo)(()=>[new ae.H,new N._({factory:w.N})],[]),yt=(0,s.useMemo)(()=>new o.J,[]),kt=(0,s.useMemo)(()=>[ne.WS],[]),Ct=(0,s.useMemo)(()=>(0,Z.Kp)(),[]);(0,s.useEffect)(()=>{(0,re.wj)()},[]),(0,s.useEffect)(()=>{if(ge&&ge.length>0&&!Ne){const e=ge[0];wt({runtimeDesc:{name:e.environment_name,language:"",location:"remote",displayName:e.given_name,kernelId:e.id,burningRate:e.burning_rate,podName:e.pod_name},runtimeModel:e})}},[ge]),(0,s.useEffect)(()=>{$e&&$e.sharedModel.awareness.setLocalStateField("user",{username:t.id,name:t.handle,display_name:t.displayName,initials:`${t.firstName[0]?.toLocaleUpperCase()??"?"}${t.lastName[0]?.toLocaleUpperCase()||"?"}`,color:Ct,avatar_url:t.avatarUrl})},[$e,t,Ct]),(0,s.useEffect)(()=>(at(),pt(e).then(t=>{if(nt(),t.success){const t=ut(e);t?(Oe(t),Ve(t.nbformat),rt(t),He({name:t.name,nameConfirm:"",description:t.description})):A("/")}else qe(t.message,{variant:"error"})}).finally(()=>{nt()}),()=>{be.dispose(),Oe(void 0),Ze(),rt(void 0)}),[e]),(0,s.useEffect)(()=>{mt().then(e=>{if(e.success){const e=ct();vt(e)}})},[e]),(0,s.useEffect)(()=>{de&&Ue&&de.runtimeId!==ke&&(gt(e,be.serverSettings.baseUrl,be.serverSettings.token,ke),ft(e,ke))},[de,ke,e,Ue,be]),(0,s.useEffect)(()=>{Qe({...Je,name:void 0===Ge.name?void 0:Ge.name.length>2,nameConfirm:Ge.nameConfirm===Ee?.name,description:void 0===Ge.description?void 0:Ge.description.length>2})},[Ge]);const St=(0,s.useCallback)(async()=>{at(),ht(e,Ge.name,Ge.description).then(e=>{e.success&&(qe("The notebook is successfully updated.",{variant:"success"}),ot(),Oe({...Ee,name:Ge.name,description:Ge.description}))}).finally(()=>{nt()})},[e,Ge.name,Ge.description,Ee]),wt=(0,s.useCallback)(async({runtimeDesc:r,runtimeModel:s,transferState:a})=>{const o=Ye(e);o?.model&&Ve(o.model.toJSON()),we(r);const l=r?.location;switch(Te(""),l){case void 0:Ce(void 0),De(!0),Ae(!1),ye(ue);break;case"browser":if(fe?.browser){if(je){if(!je.jupyterLab.hasPlugin("@jupyterlite/pyodide-kernel-extension:kernel")){const e=await Promise.all([n.e(484),n.e(5378)]).then(n.bind(n,28924));je.jupyterLab.registerPluginModule(e)}je.jupyterLab.isPluginActivated("@jupyterlite/pyodide-kernel-extension:kernel")||await je.jupyterLab.activatePlugin("@jupyterlite/pyodide-kernel-extension:kernel")}Ce(void 0),De(!1),Ae(!0),ye(fe.browser)}else console.error("Unable to use browser kernel. No service manager for it.");break;case"remote":{if(!fe?.remote){console.error("Unable to use a remote runtime. No service manager for it.");break}let n;if(a&&be&&be===fe?.browser&&Ne?.kernel)try{at();let e=!0;const t=Ne.kernel.id,r=`pyodide-${t}`,s=(0,te.T)({connection:Ne.kernel,metadata:{filename:`${r}.data`},onUploadProgress:()=>{e&&(e=!1,(0,ee.Ay)().then(e=>{n=e.find(e=>e.name===r)}))}});if(Xe(s,{error:{message:e=>`Failed to save the browser kernel state. ${e}`},pending:{message:"Saving the browser kernel stateâ€¦"},success:{message:()=>"Browser kernel state saved."}}),await s,!n)throw Error("Unable to find snapshot for pyodide state.");await fe.browser.kernels.shutdown(t)}finally{nt()}if(!s){const{name:e,displayName:a,params:i}=r,o=await(fe?.remote?.runtimesManager.startNew({environmentName:e,type:"notebook",givenName:a,creditsLimit:i?.creditsLimit??(he?.available??0)/Math.max(ve.maxCellRuntimes-ge.filter(e=>"cell"!==e.type).length,1),capabilities:i?.capabilities,snapshot:n?.id},{username:t?.handle,handleComms:!0}));s=await fe.remote.runtimesManager.findById(o.id),o.dispose()}Ae(!1),Ce(s.id),De(!1),Te(s.pod_name);const o=fe.remote.runtimesManager.getServices(s.pod_name),l=new i.ServiceManager({contents:o?.contents,kernels:o?.kernels,kernelspecs:o?.kernelspecs,serverSettings:o?.serverSettings,sessions:o?.sessions,events:{dispose:()=>{}},terminals:{connectionFailure:{connect:()=>{}},dispose:()=>{},isAvailable:()=>!1}});ye(l),Fe("storage");const d=o?.serverSettings.baseUrl.replace("/jupyter/server","/mcp")+"/mcp";fetch(d+"/../api/connect",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({provider:"datalayer",runtime_url:o?.serverSettings.baseUrl,runtime_id:s.id,runtime_token:o?.serverSettings.token,document_url:pe.spacerRunUrl,document_id:e,document_token:xe})}).then(e=>{qe("Jupyter MCP Server connected successfully.",{variant:"success"}),Fe("ai-agents"),Be(d)})}}_t(void 0)},[ve,he,je,e,fe,ge,be,Ne]),_t=(0,s.useCallback)(e=>{Me(e||void 0)},[]),At=(0,s.useCallback)(async()=>{r({title:"Are you sure?",content:"Please confirm you want to clone this notebook in your private library."}).then(t=>{t&&(at(),lt(e).then(e=>{nt(),e.success&&(qe(e.message,{variant:"success"}),ot(),A("/my-library"))}))})},[r,Ee]),Nt=(0,s.useCallback)(e=>{Le(e)},[]),Mt=(0,s.useCallback)(()=>{if(!ze&&$e?.cells){at("Saving the notebook...");const t=$e.toJSON();xt(e,t).then(n=>{n.success&&(qe("The notebook is successfully updated.",{variant:"success"}),Oe({...Ee,id:e,nbformat:t}))}).finally(()=>{nt()})}},[e,$e,ze]),Pt=(0,s.useCallback)(()=>{Fe("storage"!==We&&be&&be!==ue?"storage":void 0)},[We,be]);return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)(g.z,{"aria-label":Ee?.name,children:[(0,le.jsx)(g.z.TitleArea,{variant:"subtitle",children:(0,le.jsx)(g.z.Title,{children:Ee?.name})}),(0,le.jsx)(g.z.Actions,{children:Ee&&tt&&(0,le.jsxs)(z.az,{sx:{flex:"0 0 auto",display:"flex",alignItems:"center"},children:[fe?.remote&&Ne&&Ne.kernel&&(0,le.jsx)(T.m,{kernelId:Ne.kernel.id,serviceManager:fe.remote,onClick:()=>{A("/runtimes")}},"credits-indicator"),(0,le.jsx)(U.P,{assignRuntime:wt,sessionConnection:Ne},"runtime-picker"),(0,le.jsx)($.C,{connection:Ne?.kernel??void 0,multiServiceManager:fe,podName:Ue,disabled:void 0===Se?.location,children:"Snapshots"}),(0,le.jsx)(j.Q,{title:"Browse content on the Remote Runtime",variant:"invisible",size:"small",disabled:!be||be===ue,leadingVisual:()=>(0,le.jsx)(I.Cx,{type:"content"}),onClick:Pt,children:"Storage"},"content"),(0,le.jsx)(E.E,{commandRegistry:yt,runtimeDesc:Se,save:Mt,sessionConnection:Ne},"toolbar"),(0,le.jsx)(j.Q,{variant:"invisible",size:"small",leadingVisual:y.tSI,onClick:e=>Fe("ai-agents"===We?void 0:"ai-agents"),children:"AI Agent"},"clone"),(0,le.jsxs)(x.W,{children:[(0,le.jsx)(x.W.Anchor,{children:(0,le.jsx)(b.K,{variant:"invisible",icon:y.tno,"aria-label":"Open menu"})}),(0,le.jsx)(x.W.Overlay,{width:"medium",children:(0,le.jsxs)(d.l,{children:[(0,le.jsxs)(d.l.Item,{onSelect:()=>At(),children:[(0,le.jsx)(d.l.LeadingVisual,{children:(0,le.jsx)(y.Nc$,{})}),"Duplicate"]}),me&&(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(d.l.Divider,{}),(0,le.jsxs)(d.l.Item,{onSelect:()=>{it()},children:[(0,le.jsx)(d.l.LeadingVisual,{children:(0,le.jsx)(y.rVi,{})}),"Capture Screen"]}),(0,le.jsxs)(d.l.Item,{onSelect:()=>Ie(!Pe),children:[(0,le.jsx)(d.l.LeadingVisual,{children:(0,le.jsx)(I.Cx,{type:"share"})}),"Share"]}),(0,le.jsxs)(d.l.Item,{onSelect:()=>A(`/new/page/notebook/${e}`),children:[(0,le.jsx)(d.l.LeadingVisual,{children:(0,le.jsx)(I.Cx,{type:"page"})}),"Publish"]})]}),(0,le.jsx)(d.l.Divider,{}),(0,le.jsxs)(d.l.Item,{onSelect:()=>Fe("mcp-server"===We?void 0:"mcp-server"),children:[(0,le.jsx)(d.l.LeadingVisual,{children:(0,le.jsx)(k.A,{})}),"MCP Server"]}),(0,le.jsx)(d.l.Divider,{}),(0,le.jsxs)(d.l.Item,{onSelect:()=>Fe("properties"===We?void 0:"properties"),children:[(0,le.jsx)(d.l.LeadingVisual,{children:(0,le.jsx)(y.L64,{})}),"Properties"]})]})})]}),"datalayer"===jt?.type&&$e&&(0,le.jsx)(O.P,{awareness:$e.sharedModel.awareness,currentUserHandle:t.handle},"peers")]})})]}),(0,le.jsxs)(h.O7,{children:[(0,le.jsxs)(h.O7.Content,{"aria-label":"Notebook Editor",width:"full",padding:"none",children:[et&&(0,le.jsx)(z.az,{mt:3,children:(0,le.jsxs)(z.az,{display:"flex",children:[(0,le.jsx)(z.az,{children:(0,le.jsx)("img",{src:et})}),(0,le.jsx)(z.az,{children:(0,le.jsx)(u.A,{href:"javascript: return false;",onClick:e=>st(void 0),children:(0,le.jsx)(y.uv5,{})})})]})}),Pe&&(0,le.jsx)(z.az,{sx:{flexGrow:1},children:(0,le.jsx)(se.a,{})}),Re&&jt&&(void 0===Se?.location?(0,le.jsx)(z.az,{sx:{"& .jp-Cell":{marginTop:30}},children:(0,le.jsx)(S.j,{nbformat:Re,outputs:!0})}):(0,le.jsx)(z.az,{children:(0,le.jsx)(_.k,{commands:yt,extensions:bt,id:e,collaborationProvider:jt,nbformat:Re,readonly:ze,renderers:kt,kernelId:ke,serviceManager:be,startDefaultKernel:_e,height:"calc(100vh - 150px)",maxHeight:"calc(100vh - 150px)",cellSidebarMargin:32,onNotebookModelChanged:Nt,onSessionConnection:_t})}))]}),We&&(0,le.jsxs)(h.O7.Pane,{"aria-label":"Notebook Sidebar",position:"start",width:"large",children:["storage"===We&&be.contents&&(0,le.jsx)(L.XV,{contents:be.contents,documentRegistry:je?.jupyterLab.docRegistry}),"properties"===We&&(0,le.jsxs)(z.az,{as:"form",sx:{label:{marginTop:2}},children:[(0,le.jsxs)(v.A,{children:[(0,le.jsx)(v.A.Label,{children:"Name"}),(0,le.jsx)(f.A,{block:!0,value:Ge.name,onChange:e=>{He(t=>({...t,name:e.target.value}))}}),!1===Je.name&&(0,le.jsx)(v.A.Validation,{variant:"error",children:"Name must have more than 2 characters."})]}),(0,le.jsxs)(v.A,{children:[(0,le.jsx)(v.A.Label,{children:"Description"}),(0,le.jsx)(p.Ay,{block:!0,value:Ge.description,onChange:e=>{He(t=>({...t,description:e.target.value}))}}),!1===Je.description&&(0,le.jsx)(v.A.Validation,{variant:"error",children:"Description must have more than 2 characters."})]}),(0,le.jsx)(v.A,{children:(0,le.jsx)(j.Q,{variant:"primary",disabled:!Je.name||!Je.description,style:{marginTop:2},onClick:St,children:"Update Notebook Properties"})}),(0,le.jsx)(z.az,{mt:3}),(0,le.jsx)(P.R,{variant:"default",data:Re,fileName:`notebook-${e}`,extension:"ipynb"}),(0,le.jsxs)(z.az,{sx:{marginTop:3},children:[(0,le.jsx)(c.A,{as:"h2",sx:{fontSize:4,fontWeight:"normal",color:"danger.fg",mb:2},children:"Danger zone"}),(0,le.jsxs)(z.az,{sx:{border:"1px solid",borderColor:"danger.emphasis",borderRadius:2,p:3,alignItems:"center",justifyContent:"space-between",gap:3},children:[(0,le.jsxs)(z.az,{sx:{display:"grid",gap:1},children:[(0,le.jsx)(m.A,{sx:{fontSize:1,fontWeight:"bold",color:"danger.fg"},children:"Confirm the notebook name to delete"}),(0,le.jsx)(v.A,{children:(0,le.jsx)(f.A,{block:!0,value:Ge.nameConfirm,onChange:e=>{He(t=>({...t,nameConfirm:e.target.value}))}})}),(0,le.jsx)(m.A,{sx:{fontSize:1,color:"fg.muted"},children:"This operation is not reversible."})]}),(0,le.jsx)(j.Q,{variant:"danger",disabled:!Je.nameConfirm,onClick:async()=>{at("Deleting the notebook..."),dt(Ee.id).then(e=>{e.success&&(qe("The notebook is successfully deleted.",{variant:"success"}),A("/my-library"))}).finally(()=>{nt()})},children:"Delete notebook"})]})]})]}),"ai-agents"===We&&Ke&&(0,le.jsx)(ie.z,{mcpServerUrl:Ke}),"mcp-server"===We&&jt&&Ne&&Ne.kernel&&(0,le.jsx)(oe.m,{documentServer:{baseURL:pe.spacerRunUrl,token:xe,documentName:e,type:jt.type},runtimeId:Ne.kernel.id,runtimeSettings:Ne.serverSettings})]})]})]})}const pe=me;r()}catch(he){r(he)}})},53537:(e,t,n)=>{n.d(t,{z:()=>a});var r=n(35769),s=n(18683);const a=e=>{const{mcpServerUrl:t}=e;return(0,s.jsx)(s.Fragment,{children:t?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(r.n,{mcpServerUrl:t,height:"calc(100vh - 245px)"})}):(0,s.jsx)(s.Fragment,{})})}},60294:(e,t,n)=>{n.d(t,{m:()=>d});var r=n(81461),s=n(72533),a=n(32916),i=n(52982),o=n(45077),l=n(18683);const d=e=>{const{documentServer:t,runtimeId:n,runtimeSettings:d}=e;return(0,l.jsxs)(i.az,{children:[(0,l.jsxs)(r.A,{children:[(0,l.jsx)(a.A,{})," MCP Server"]}),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(i.az,{children:[(0,l.jsx)(s.A,{children:"Start a Jupyter MCP Server"}),(0,l.jsx)(o.O,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --document-url ${t.baseURL}   --document-id ${t.documentName}   --document-token ${t.token}   --runtime-url ${d.baseUrl}   --start-new-runtime false   --runtime-id ${n}   --runtime-token ${d.token}   --port 4040\n`})]}),(0,l.jsxs)(i.az,{sx:{mb:2},children:[(0,l.jsx)(s.A,{children:"Connect a running Jupyter MCP Server"}),(0,l.jsx)(o.O,{code:`jupyter-mcp-server start   --transport streamable-http   --provider datalayer   --start-new-runtime false\n \njupyter-mcp-server connect   --provider datalayer   --document-url ${t.baseURL}   --document-id ${t.documentName}   --document-token ${t.token}   --runtime-url ${d.baseUrl}   --runtime-id ${n}   --runtime-token ${d.token}   --jupyter-mcp-server-url http://localhost:4040\n`})]}),(0,l.jsxs)(i.az,{sx:{mb:2},children:[(0,l.jsx)(s.A,{children:"Run Code on the Runtime"}),(0,l.jsx)(o.O,{code:`import os\n\nfrom platform import node\nfrom jupyter_kernel_client import KernelClient\n\nkernel = KernelClient(\n  server_url="${d.baseUrl}",\n  kernel_id="${n}",\n  token="${d.token}"\n)\nkernel.start()\ncode = """import os\nfrom platform import node\nx=f"Hey {os.environ.get('USER', 'Foo Bar')} from {node()}."\nprint(x)\n"""\nreply = kernel.execute(code)\nprint(reply)\nassert reply["execution_count"] > 1\nassert reply["status"] == "ok"\nassert len(reply["outputs"]) > 0\n\n`})]}),(0,l.jsxs)(i.az,{children:[(0,l.jsx)(s.A,{children:"Connect to the Room, add a Cell and run it."}),(0,l.jsx)(o.O,{code:`from jupyter_nbmodel_client import NbModelClient, get_notebook_websocket_url\n\nws_url = get_notebook_websocket_url(\n  server_url = "${t.baseURL}",\n  path = "${t.documentName}",\n  token = "${t.token}",\n  provider = "datalayer"\n)\n\nasync with NbModelClient(ws_url) as notebook:\n    cell_index = notebook.add_code_cell("1+1")\n    results = notebook.execute_cell(cell_index, kernel)\n    print(results)\n    assert results["status"] == "ok"\n    assert len(results["outputs"]) > 0\n\n`})]})]})]})}}}]);
"use strict";(self.webpackChunk_datalayer_ui=self.webpackChunk_datalayer_ui||[]).push([[9895],{9895:(e,t,o)=>{o.r(t),o.d(t,{azure:()=>re,createAzure:()=>ae});var n=o(82100),s=o(18371),i=o(66097),a=o(39717);function r({id:e,model:t,created:o}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=o?new Date(1e3*o):void 0}}function l(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var u=i.Ik({logitBias:i.g1(a.qG(i.rS,undefined),i.ai()).optional(),logprobs:i.KC([i.zM(),i.ai()]).optional(),parallelToolCalls:i.zM().optional(),user:i.Yj().optional(),reasoningEffort:i.k5(["low","medium","high"]).optional(),maxCompletionTokens:i.ai().optional(),store:i.zM().optional(),metadata:i.g1(i.Yj().max(64),i.Yj().max(512)).optional(),prediction:i.g1(i.Yj(),i.bz()).optional(),structuredOutputs:i.zM().optional(),serviceTier:i.k5(["auto","flex","priority"]).optional(),strictJsonSchema:i.zM().optional()}),p=i.Ik({error:i.Ik({message:i.Yj(),type:i.Yj().nullish(),param:i.bz().nullish(),code:i.KC([i.Yj(),i.ai()]).nullish()})}),d=(0,s.createJsonErrorResponseHandler)({errorSchema:p,errorToMessage:e=>e.error.message}),c=i.Ik({key:i.Yj(),type:i.k5(["eq","ne","gt","gte","lt","lte"]),value:i.KC([i.Yj(),i.ai(),i.zM()])}),m=i.Ik({type:i.k5(["and","or"]),filters:i.YO(i.KC([c,i.RZ(()=>m)]))}),h=i.KC([c,m]),g=i.Ik({vectorStoreIds:i.YO(i.Yj()).optional(),maxNumResults:i.ai().optional(),ranking:i.Ik({ranker:i.k5(["auto","default-2024-08-21"]).optional()}).optional(),filters:h.optional()}),f=((0,s.createProviderDefinedToolFactory)({id:"openai.file_search",name:"file_search",inputSchema:i.Ik({query:i.Yj()})}),i.Ik({searchContextSize:i.k5(["low","medium","high"]).optional(),userLocation:i.Ik({type:i.eu("approximate"),country:i.Yj().optional(),city:i.Yj().optional(),region:i.Yj().optional(),timezone:i.Yj().optional()}).optional()}));(0,s.createProviderDefinedToolFactory)({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:i.Ik({})});var y=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:o,topP:i,topK:a,frequencyPenalty:r,presencePenalty:l,stopSequences:p,responseFormat:d,seed:c,tools:m,toolChoice:h,providerOptions:y}){var v,_,k,I;const x=[],j=null!=(v=await(0,s.parseProviderOptions)({provider:"openai",providerOptions:y,schema:u}))?v:{},Y=null==(_=j.structuredOutputs)||_;null!=a&&x.push({type:"unsupported-setting",setting:"topK"}),"json"!==(null==d?void 0:d.type)||null==d.schema||Y||x.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{messages:T,warnings:q}=function({prompt:e,systemMessageMode:t="system"}){const o=[],i=[];for(const{role:a,content:r}of e)switch(a){case"system":switch(t){case"system":o.push({role:"system",content:r});break;case"developer":o.push({role:"developer",content:r});break;case"remove":i.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${t}`)}break;case"user":if(1===r.length&&"text"===r[0].type){o.push({role:"user",content:r[0].text});break}o.push({role:"user",content:r.map((e,t)=>{var o,i,a;switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){const t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${(0,s.convertToBase64)(e.data)}`,detail:null==(i=null==(o=e.providerOptions)?void 0:o.openai)?void 0:i.imageDetail}}}if(!e.mediaType.startsWith("audio/")){if("application/pdf"===e.mediaType){if(e.data instanceof URL)throw new n.b8({functionality:"PDF file parts with URLs"});return{type:"file",file:{filename:null!=(a=e.filename)?a:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${(0,s.convertToBase64)(e.data)}`}}}throw new n.b8({functionality:`file part media type ${e.mediaType}`})}if(e.data instanceof URL)throw new n.b8({functionality:"audio file parts with URLs"});switch(e.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:(0,s.convertToBase64)(e.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:(0,s.convertToBase64)(e.data),format:"mp3"}};default:throw new n.b8({functionality:`audio content parts with media type ${e.mediaType}`})}}})});break;case"assistant":{let e="";const t=[];for(const o of r)switch(o.type){case"text":e+=o.text;break;case"tool-call":t.push({id:o.toolCallId,type:"function",function:{name:o.toolName,arguments:JSON.stringify(o.input)}})}o.push({role:"assistant",content:e,tool_calls:t.length>0?t:void 0});break}case"tool":for(const e of r){const t=e.output;let n;switch(t.type){case"text":case"error-text":n=t.value;break;case"content":case"json":case"error-json":n=JSON.stringify(t.value)}o.push({role:"tool",tool_call_id:e.toolCallId,content:n})}break;default:throw new Error(`Unsupported role: ${a}`)}return{messages:o,warnings:i}}({prompt:e,systemMessageMode:b(this.modelId)});x.push(...q);const O=null!=(k=j.strictJsonSchema)&&k,C={model:this.modelId,logit_bias:j.logitBias,logprobs:!0===j.logprobs||"number"==typeof j.logprobs||void 0,top_logprobs:"number"==typeof j.logprobs?j.logprobs:"boolean"==typeof j.logprobs&&j.logprobs?0:void 0,user:j.user,parallel_tool_calls:j.parallelToolCalls,max_tokens:t,temperature:o,top_p:i,frequency_penalty:r,presence_penalty:l,response_format:"json"===(null==d?void 0:d.type)?Y&&null!=d.schema?{type:"json_schema",json_schema:{schema:d.schema,strict:O,name:null!=(I=d.name)?I:"response",description:d.description}}:{type:"json_object"}:void 0,stop:p,seed:c,max_completion_tokens:j.maxCompletionTokens,store:j.store,metadata:j.metadata,prediction:j.prediction,reasoning_effort:j.reasoningEffort,service_tier:j.serviceTier,messages:T};var S;w(this.modelId)?(null!=C.temperature&&(C.temperature=void 0,x.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=C.top_p&&(C.top_p=void 0,x.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=C.frequency_penalty&&(C.frequency_penalty=void 0,x.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=C.presence_penalty&&(C.presence_penalty=void 0,x.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=C.logit_bias&&(C.logit_bias=void 0,x.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=C.logprobs&&(C.logprobs=void 0,x.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=C.top_logprobs&&(C.top_logprobs=void 0,x.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=C.max_tokens&&(null==C.max_completion_tokens&&(C.max_completion_tokens=C.max_tokens),C.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=C.temperature&&(C.temperature=void 0,x.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),"flex"!==j.serviceTier||(S=this.modelId).startsWith("o3")||S.startsWith("o4-mini")||(x.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3 and o4-mini models"}),C.service_tier=void 0),"priority"!==j.serviceTier||function(e){return e.startsWith("gpt-4")||e.startsWith("o3")||e.startsWith("o4-mini")}(this.modelId)||(x.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (GPT-4, o3, o4-mini) and requires Enterprise access"}),C.service_tier=void 0);const{tools:M,toolChoice:R,toolWarnings:E}=function({tools:e,toolChoice:t,structuredOutputs:o,strictJsonSchema:s}){const i=[];if(null==(e=(null==e?void 0:e.length)?e:void 0))return{tools:void 0,toolChoice:void 0,toolWarnings:i};const a=[];for(const t of e)switch(t.type){case"function":a.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,strict:o?s:void 0}});break;case"provider-defined":switch(t.id){case"openai.file_search":{const e=g.parse(t.args);a.push({type:"file_search",vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker}:void 0,filters:e.filters});break}case"openai.web_search_preview":{const e=f.parse(t.args);a.push({type:"web_search_preview",search_context_size:e.searchContextSize,user_location:e.userLocation});break}default:i.push({type:"unsupported-tool",tool:t})}break;default:i.push({type:"unsupported-tool",tool:t})}if(null==t)return{tools:a,toolChoice:void 0,toolWarnings:i};const r=t.type;switch(r){case"auto":case"none":case"required":return{tools:a,toolChoice:r,toolWarnings:i};case"tool":return{tools:a,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:i};default:{const e=r;throw new n.b8({functionality:`tool choice type: ${e}`})}}}({tools:m,toolChoice:h,structuredOutputs:Y,strictJsonSchema:O});return{args:{...C,tools:M,tool_choice:R},warnings:[...x,...E]}}async doGenerate(e){var t,o,n,i,a,u,p,c,m,h,g,f,y;const{args:v,warnings:k}=await this.getArgs(e),{responseHeaders:w,value:b,rawValue:I}=await(0,s.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:v,failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)(_),abortSignal:e.abortSignal,fetch:this.config.fetch}),x=b.choices[0],j=[],Y=x.message.content;null!=Y&&Y.length>0&&j.push({type:"text",text:Y});for(const e of null!=(t=x.message.tool_calls)?t:[])j.push({type:"tool-call",toolCallId:null!=(o=e.id)?o:(0,s.generateId)(),toolName:e.function.name,input:e.function.arguments});const T=null==(n=b.usage)?void 0:n.completion_tokens_details,q=null==(i=b.usage)?void 0:i.prompt_tokens_details,O={openai:{}};return null!=(null==T?void 0:T.accepted_prediction_tokens)&&(O.openai.acceptedPredictionTokens=null==T?void 0:T.accepted_prediction_tokens),null!=(null==T?void 0:T.rejected_prediction_tokens)&&(O.openai.rejectedPredictionTokens=null==T?void 0:T.rejected_prediction_tokens),null!=(null==(a=x.logprobs)?void 0:a.content)&&(O.openai.logprobs=x.logprobs.content),{content:j,finishReason:l(x.finish_reason),usage:{inputTokens:null!=(p=null==(u=b.usage)?void 0:u.prompt_tokens)?p:void 0,outputTokens:null!=(m=null==(c=b.usage)?void 0:c.completion_tokens)?m:void 0,totalTokens:null!=(g=null==(h=b.usage)?void 0:h.total_tokens)?g:void 0,reasoningTokens:null!=(f=null==T?void 0:T.reasoning_tokens)?f:void 0,cachedInputTokens:null!=(y=null==q?void 0:q.cached_tokens)?y:void 0},request:{body:v},response:{...r(b),headers:w,body:I},warnings:k,providerMetadata:O}}async doStream(e){const{args:t,warnings:o}=await this.getArgs(e),i={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:u}=await(0,s.postJsonToApi)({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:i,failedResponseHandler:d,successfulResponseHandler:(0,s.createEventSourceResponseHandler)(k),abortSignal:e.abortSignal,fetch:this.config.fetch}),p=[];let c="unknown";const m={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let h=!0,g=!1;const f={openai:{}};return{stream:u.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){var i,a,u,d,y,v,_,k,w,b,I,x,j,Y,T,q,O,C,S,M,R,E,H,P;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return c="error",void o.enqueue({type:"error",error:t.error});const N=t.value;if("error"in N)return c="error",void o.enqueue({type:"error",error:N.error});h&&(h=!1,o.enqueue({type:"response-metadata",...r(N)})),null!=N.usage&&(m.inputTokens=null!=(i=N.usage.prompt_tokens)?i:void 0,m.outputTokens=null!=(a=N.usage.completion_tokens)?a:void 0,m.totalTokens=null!=(u=N.usage.total_tokens)?u:void 0,m.reasoningTokens=null!=(y=null==(d=N.usage.completion_tokens_details)?void 0:d.reasoning_tokens)?y:void 0,m.cachedInputTokens=null!=(_=null==(v=N.usage.prompt_tokens_details)?void 0:v.cached_tokens)?_:void 0,null!=(null==(k=N.usage.completion_tokens_details)?void 0:k.accepted_prediction_tokens)&&(f.openai.acceptedPredictionTokens=null==(w=N.usage.completion_tokens_details)?void 0:w.accepted_prediction_tokens),null!=(null==(b=N.usage.completion_tokens_details)?void 0:b.rejected_prediction_tokens)&&(f.openai.rejectedPredictionTokens=null==(I=N.usage.completion_tokens_details)?void 0:I.rejected_prediction_tokens));const A=N.choices[0];if(null!=(null==A?void 0:A.finish_reason)&&(c=l(A.finish_reason)),null!=(null==(x=null==A?void 0:A.logprobs)?void 0:x.content)&&(f.openai.logprobs=A.logprobs.content),null==(null==A?void 0:A.delta))return;const $=A.delta;if(null!=$.content&&(g||(o.enqueue({type:"text-start",id:"0"}),g=!0),o.enqueue({type:"text-delta",id:"0",delta:$.content})),null!=$.tool_calls)for(const e of $.tool_calls){const t=e.index;if(null==p[t]){if("function"!==e.type)throw new n.xn({data:e,message:"Expected 'function' type."});if(null==e.id)throw new n.xn({data:e,message:"Expected 'id' to be a string."});if(null==(null==(j=e.function)?void 0:j.name))throw new n.xn({data:e,message:"Expected 'function.name' to be a string."});o.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),p[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(Y=e.function.arguments)?Y:""},hasFinished:!1};const i=p[t];null!=(null==(T=i.function)?void 0:T.name)&&null!=(null==(q=i.function)?void 0:q.arguments)&&(i.function.arguments.length>0&&o.enqueue({type:"tool-input-delta",id:i.id,delta:i.function.arguments}),(0,s.isParsableJson)(i.function.arguments)&&(o.enqueue({type:"tool-input-end",id:i.id}),o.enqueue({type:"tool-call",toolCallId:null!=(O=i.id)?O:(0,s.generateId)(),toolName:i.function.name,input:i.function.arguments}),i.hasFinished=!0));continue}const i=p[t];i.hasFinished||(null!=(null==(C=e.function)?void 0:C.arguments)&&(i.function.arguments+=null!=(M=null==(S=e.function)?void 0:S.arguments)?M:""),o.enqueue({type:"tool-input-delta",id:i.id,delta:null!=(R=e.function.arguments)?R:""}),null!=(null==(E=i.function)?void 0:E.name)&&null!=(null==(H=i.function)?void 0:H.arguments)&&(0,s.isParsableJson)(i.function.arguments)&&(o.enqueue({type:"tool-input-end",id:i.id}),o.enqueue({type:"tool-call",toolCallId:null!=(P=i.id)?P:(0,s.generateId)(),toolName:i.function.name,input:i.function.arguments}),i.hasFinished=!0))}},flush(e){g&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:c,usage:m,...null!=f?{providerMetadata:f}:{}})}})),request:{body:i},response:{headers:a}}}},v=i.Ik({prompt_tokens:i.ai().nullish(),completion_tokens:i.ai().nullish(),total_tokens:i.ai().nullish(),prompt_tokens_details:i.Ik({cached_tokens:i.ai().nullish()}).nullish(),completion_tokens_details:i.Ik({reasoning_tokens:i.ai().nullish(),accepted_prediction_tokens:i.ai().nullish(),rejected_prediction_tokens:i.ai().nullish()}).nullish()}).nullish(),_=i.Ik({id:i.Yj().nullish(),created:i.ai().nullish(),model:i.Yj().nullish(),choices:i.YO(i.Ik({message:i.Ik({role:i.eu("assistant").nullish(),content:i.Yj().nullish(),tool_calls:i.YO(i.Ik({id:i.Yj().nullish(),type:i.eu("function"),function:i.Ik({name:i.Yj(),arguments:i.Yj()})})).nullish()}),index:i.ai(),logprobs:i.Ik({content:i.YO(i.Ik({token:i.Yj(),logprob:i.ai(),top_logprobs:i.YO(i.Ik({token:i.Yj(),logprob:i.ai()}))})).nullish()}).nullish(),finish_reason:i.Yj().nullish()})),usage:v}),k=i.KC([i.Ik({id:i.Yj().nullish(),created:i.ai().nullish(),model:i.Yj().nullish(),choices:i.YO(i.Ik({delta:i.Ik({role:i.k5(["assistant"]).nullish(),content:i.Yj().nullish(),tool_calls:i.YO(i.Ik({index:i.ai(),id:i.Yj().nullish(),type:i.eu("function").nullish(),function:i.Ik({name:i.Yj().nullish(),arguments:i.Yj().nullish()})})).nullish()}).nullish(),logprobs:i.Ik({content:i.YO(i.Ik({token:i.Yj(),logprob:i.ai(),top_logprobs:i.YO(i.Ik({token:i.Yj(),logprob:i.ai()}))})).nullish()}).nullish(),finish_reason:i.Yj().nullish(),index:i.ai()})),usage:v}),p]);function w(e){return e.startsWith("o")}function b(e){var t,o;return w(e)?null!=(o=null==(t=I[e])?void 0:t.systemMessageMode)?o:"developer":"system"}var I={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}},x=i.Ik({echo:i.zM().optional(),logitBias:i.g1(i.Yj(),i.ai()).optional(),suffix:i.Yj().optional(),user:i.Yj().optional(),logprobs:i.KC([i.zM(),i.ai()]).optional()}),j=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:o,topP:i,topK:a,frequencyPenalty:r,presencePenalty:l,stopSequences:u,responseFormat:p,tools:d,toolChoice:c,seed:m,providerOptions:h}){const g=[],f={...await(0,s.parseProviderOptions)({provider:"openai",providerOptions:h,schema:x}),...await(0,s.parseProviderOptions)({provider:this.providerOptionsName,providerOptions:h,schema:x})};null!=a&&g.push({type:"unsupported-setting",setting:"topK"}),(null==d?void 0:d.length)&&g.push({type:"unsupported-setting",setting:"tools"}),null!=c&&g.push({type:"unsupported-setting",setting:"toolChoice"}),null!=p&&"text"!==p.type&&g.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:y,stopSequences:v}=function({prompt:e,user:t="user",assistant:o="assistant"}){let s="";"system"===e[0].role&&(s+=`${e[0].content}\n\n`,e=e.slice(1));for(const{role:i,content:a}of e)switch(i){case"system":throw new n.M3({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":s+=`${t}:\n${a.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("")}\n\n`;break;case"assistant":s+=`${o}:\n${a.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new n.b8({functionality:"tool-call messages"})}}).join("")}\n\n`;break;case"tool":throw new n.b8({functionality:"tool messages"});default:throw new Error(`Unsupported role: ${i}`)}return s+=`${o}:\n`,{prompt:s,stopSequences:[`\n${t}:`]}}({prompt:e}),_=[...null!=v?v:[],...null!=u?u:[]];return{args:{model:this.modelId,echo:f.echo,logit_bias:f.logitBias,logprobs:!0===(null==f?void 0:f.logprobs)?0:!1===(null==f?void 0:f.logprobs)||null==f?void 0:f.logprobs,suffix:f.suffix,user:f.user,max_tokens:t,temperature:o,top_p:i,frequency_penalty:r,presence_penalty:l,seed:m,prompt:y,stop:_.length>0?_:void 0},warnings:g}}async doGenerate(e){var t,o,n;const{args:i,warnings:a}=await this.getArgs(e),{responseHeaders:u,value:p,rawValue:c}=await(0,s.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:i,failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)(T),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=p.choices[0],h={openai:{}};return null!=m.logprobs&&(h.openai.logprobs=m.logprobs),{content:[{type:"text",text:m.text}],usage:{inputTokens:null==(t=p.usage)?void 0:t.prompt_tokens,outputTokens:null==(o=p.usage)?void 0:o.completion_tokens,totalTokens:null==(n=p.usage)?void 0:n.total_tokens},finishReason:l(m.finish_reason),request:{body:i},response:{...r(p),headers:u,body:c},providerMetadata:h,warnings:a}}async doStream(e){const{args:t,warnings:o}=await this.getArgs(e),n={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await(0,s.postJsonToApi)({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:n,failedResponseHandler:d,successfulResponseHandler:(0,s.createEventSourceResponseHandler)(q),abortSignal:e.abortSignal,fetch:this.config.fetch});let u="unknown";const p={openai:{}},c={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let m=!0;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return u="error",void o.enqueue({type:"error",error:t.error});const n=t.value;if("error"in n)return u="error",void o.enqueue({type:"error",error:n.error});m&&(m=!1,o.enqueue({type:"response-metadata",...r(n)}),o.enqueue({type:"text-start",id:"0"})),null!=n.usage&&(c.inputTokens=n.usage.prompt_tokens,c.outputTokens=n.usage.completion_tokens,c.totalTokens=n.usage.total_tokens);const s=n.choices[0];null!=(null==s?void 0:s.finish_reason)&&(u=l(s.finish_reason)),null!=(null==s?void 0:s.logprobs)&&(p.openai.logprobs=s.logprobs),null!=(null==s?void 0:s.text)&&s.text.length>0&&o.enqueue({type:"text-delta",id:"0",delta:s.text})},flush(e){m||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:u,providerMetadata:p,usage:c})}})),request:{body:n},response:{headers:i}}}},Y=i.Ik({prompt_tokens:i.ai(),completion_tokens:i.ai(),total_tokens:i.ai()}),T=i.Ik({id:i.Yj().nullish(),created:i.ai().nullish(),model:i.Yj().nullish(),choices:i.YO(i.Ik({text:i.Yj(),finish_reason:i.Yj(),logprobs:i.Ik({tokens:i.YO(i.Yj()),token_logprobs:i.YO(i.ai()),top_logprobs:i.YO(i.g1(i.Yj(),i.ai())).nullish()}).nullish()})),usage:Y.nullish()}),q=i.KC([i.Ik({id:i.Yj().nullish(),created:i.ai().nullish(),model:i.Yj().nullish(),choices:i.YO(i.Ik({text:i.Yj(),finish_reason:i.Yj().nullish(),index:i.ai(),logprobs:i.Ik({tokens:i.YO(i.Yj()),token_logprobs:i.YO(i.ai()),top_logprobs:i.YO(i.g1(i.Yj(),i.ai())).nullish()}).nullish()})),usage:Y.nullish()}),p]),O=i.Ik({dimensions:i.ai().optional(),user:i.Yj().optional()}),C=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:o,providerOptions:i}){var a;if(e.length>this.maxEmbeddingsPerCall)throw new n.Ch({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const r=null!=(a=await(0,s.parseProviderOptions)({provider:"openai",providerOptions:i,schema:O}))?a:{},{responseHeaders:l,value:u,rawValue:p}=await(0,s.postJsonToApi)({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:r.dimensions,user:r.user},failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)(S),abortSignal:o,fetch:this.config.fetch});return{embeddings:u.data.map(e=>e.embedding),usage:u.usage?{tokens:u.usage.prompt_tokens}:void 0,response:{headers:l,body:p}}}},S=i.Ik({data:i.YO(i.Ik({embedding:i.YO(i.ai())})),usage:i.Ik({prompt_tokens:i.ai()}).nullish()}),M={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},R=new Set(["gpt-image-1"]),E=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get maxImagesPerCall(){var e;return null!=(e=M[this.modelId])?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:o,aspectRatio:n,seed:i,providerOptions:a,headers:r,abortSignal:l}){var u,p,c,m;const h=[];null!=n&&h.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=i&&h.push({type:"unsupported-setting",setting:"seed"});const g=null!=(c=null==(p=null==(u=this.config._internal)?void 0:u.currentDate)?void 0:p.call(u))?c:new Date,{value:f,responseHeaders:y}=await(0,s.postJsonToApi)({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),r),body:{model:this.modelId,prompt:e,n:t,size:o,...null!=(m=a.openai)?m:{},...R.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)(H),abortSignal:l,fetch:this.config.fetch});return{images:f.data.map(e=>e.b64_json),warnings:h,response:{timestamp:g,modelId:this.modelId,headers:y},providerMetadata:{openai:{images:f.data.map(e=>e.revised_prompt?{revisedPrompt:e.revised_prompt}:null)}}}}},H=i.Ik({data:i.YO(i.Ik({b64_json:i.Yj(),revised_prompt:i.Yj().optional()}))}),P=i.Ik({include:i.YO(i.Yj()).optional(),language:i.Yj().optional(),prompt:i.Yj().optional(),temperature:i.ai().min(0).max(1).default(0).optional(),timestampGranularities:i.YO(i.k5(["word","segment"])).default(["segment"]).optional()}),N={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},A=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:o}){const n=await(0,s.parseProviderOptions)({provider:"openai",providerOptions:o,schema:P}),i=new FormData,a=e instanceof Uint8Array?new Blob([e]):new Blob([(0,s.convertBase64ToUint8Array)(e)]);if(i.append("model",this.modelId),i.append("file",new File([a],"audio",{type:t})),n){const e={include:n.include,language:n.language,prompt:n.prompt,temperature:n.temperature,timestamp_granularities:n.timestampGranularities};for(const[t,o]of Object.entries(e))null!=o&&i.append(t,String(o))}return{formData:i,warnings:[]}}async doGenerate(e){var t,o,n,i,a,r;const l=null!=(n=null==(o=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:o.call(t))?n:new Date,{formData:u,warnings:p}=await this.getArgs(e),{value:c,responseHeaders:m,rawValue:h}=await(0,s.postFormDataToApi)({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),formData:u,failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)($),abortSignal:e.abortSignal,fetch:this.config.fetch}),g=null!=c.language&&c.language in N?N[c.language]:void 0;return{text:c.text,segments:null!=(a=null==(i=c.words)?void 0:i.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?a:[],language:g,durationInSeconds:null!=(r=c.duration)?r:void 0,warnings:p,response:{timestamp:l,modelId:this.modelId,headers:m,body:h}}}},$=i.Ik({text:i.Yj(),language:i.Yj().nullish(),duration:i.ai().nullish(),words:i.YO(i.Ik({word:i.Yj(),start:i.ai(),end:i.ai()})).nullish()}),z=i.Ik({instructions:i.Yj().nullish(),speed:i.ai().min(.25).max(4).default(1).nullish()}),J=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:e,voice:t="alloy",outputFormat:o="mp3",speed:n,instructions:i,language:a,providerOptions:r}){const l=[],u=await(0,s.parseProviderOptions)({provider:"openai",providerOptions:r,schema:z}),p={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:n,instructions:i};if(o&&(["mp3","opus","aac","flac","wav","pcm"].includes(o)?p.response_format=o:l.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${o}. Using mp3 instead.`})),u){const e={};for(const t in e){const o=e[t];void 0!==o&&(p[t]=o)}}return a&&l.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${a}" was ignored.`}),{requestBody:p,warnings:l}}async doGenerate(e){var t,o,n;const i=null!=(n=null==(o=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:o.call(t))?n:new Date,{requestBody:a,warnings:r}=await this.getArgs(e),{value:l,responseHeaders:u,rawValue:p}=await(0,s.postJsonToApi)({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:a,failedResponseHandler:d,successfulResponseHandler:(0,s.createBinaryResponseHandler)(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:l,warnings:r,request:{body:JSON.stringify(a)},response:{timestamp:i,modelId:this.modelId,headers:u,body:p}}}},W=i.Ik({itemId:i.Yj().nullish(),reasoningEncryptedContent:i.Yj().nullish()});function U({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var V=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:o,topP:i,topK:a,presencePenalty:r,frequencyPenalty:l,seed:u,prompt:p,providerOptions:d,tools:c,toolChoice:m,responseFormat:h}){var f,y;const v=[],_=function(e){return e.startsWith("o")||e.startsWith("codex-")||e.startsWith("computer-use")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1}}(this.modelId);null!=a&&v.push({type:"unsupported-setting",setting:"topK"}),null!=u&&v.push({type:"unsupported-setting",setting:"seed"}),null!=r&&v.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=l&&v.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=o&&v.push({type:"unsupported-setting",setting:"stopSequences"});const{messages:k,warnings:w}=await async function({prompt:e,systemMessageMode:t}){var o,i,a,r,l,u;const p=[],d=[];for(const{role:c,content:m}of e)switch(c){case"system":switch(t){case"system":p.push({role:"system",content:m});break;case"developer":p.push({role:"developer",content:m});break;case"remove":d.push({type:"other",message:"system messages are removed for this model"});break;default:throw new Error(`Unsupported system message mode: ${t}`)}break;case"user":p.push({role:"user",content:m.map((e,t)=>{var o,s,i;switch(e.type){case"text":return{type:"input_text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){const t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"input_image",image_url:e.data instanceof URL?e.data.toString():`data:${t};base64,${e.data}`,detail:null==(s=null==(o=e.providerOptions)?void 0:o.openai)?void 0:s.imageDetail}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)throw new n.b8({functionality:"PDF file parts with URLs"});return{type:"input_file",filename:null!=(i=e.filename)?i:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${e.data}`}}throw new n.b8({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{const e={};for(const t of m)switch(t.type){case"text":p.push({role:"assistant",content:[{type:"output_text",text:t.text}],id:null!=(a=null==(i=null==(o=t.providerOptions)?void 0:o.openai)?void 0:i.itemId)?a:void 0});break;case"tool-call":if(t.providerExecuted)break;p.push({type:"function_call",call_id:t.toolCallId,name:t.toolName,arguments:JSON.stringify(t.input),id:null!=(u=null==(l=null==(r=t.providerOptions)?void 0:r.openai)?void 0:l.itemId)?u:void 0});break;case"tool-result":d.push({type:"other",message:"tool result parts in assistant messages are not supported for OpenAI responses"});break;case"reasoning":{const o=await(0,s.parseProviderOptions)({provider:"openai",providerOptions:t.providerOptions,schema:W}),n=null==o?void 0:o.itemId;if(null!=n){const s=e[n],i=[];t.text.length>0?i.push({type:"summary_text",text:t.text}):void 0!==s&&d.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(t)}.`}),void 0===s?(e[n]={type:"reasoning",id:n,encrypted_content:null==o?void 0:o.reasoningEncryptedContent,summary:i},p.push(e[n])):s.summary.push(...i)}else d.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(t)}.`});break}}break}case"tool":for(const e of m){const t=e.output;let o;switch(t.type){case"text":case"error-text":o=t.value;break;case"content":case"json":case"error-json":o=JSON.stringify(t.value)}p.push({type:"function_call_output",call_id:e.toolCallId,output:o})}break;default:throw new Error(`Unsupported role: ${c}`)}return{messages:p,warnings:d}}({prompt:p,systemMessageMode:_.systemMessageMode});v.push(...w);const b=await(0,s.parseProviderOptions)({provider:"openai",providerOptions:d,schema:ie}),I=null!=(f=null==b?void 0:b.strictJsonSchema)&&f,x={model:this.modelId,input:k,temperature:t,top_p:i,max_output_tokens:e,..."json"===(null==h?void 0:h.type)&&{text:{format:null!=h.schema?{type:"json_schema",strict:I,name:null!=(y=h.name)?y:"response",description:h.description,schema:h.schema}:{type:"json_object"}}},metadata:null==b?void 0:b.metadata,parallel_tool_calls:null==b?void 0:b.parallelToolCalls,previous_response_id:null==b?void 0:b.previousResponseId,store:null==b?void 0:b.store,user:null==b?void 0:b.user,instructions:null==b?void 0:b.instructions,service_tier:null==b?void 0:b.serviceTier,include:null==b?void 0:b.include,..._.isReasoningModel&&(null!=(null==b?void 0:b.reasoningEffort)||null!=(null==b?void 0:b.reasoningSummary))&&{reasoning:{...null!=(null==b?void 0:b.reasoningEffort)&&{effort:b.reasoningEffort},...null!=(null==b?void 0:b.reasoningSummary)&&{summary:b.reasoningSummary}}},..._.requiredAutoTruncation&&{truncation:"auto"}};var j;_.isReasoningModel?(null!=x.temperature&&(x.temperature=void 0,v.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=x.top_p&&(x.top_p=void 0,v.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):(null!=(null==b?void 0:b.reasoningEffort)&&v.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),null!=(null==b?void 0:b.reasoningSummary)&&v.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),"flex"!==(null==b?void 0:b.serviceTier)||(j=this.modelId).startsWith("o3")||j.startsWith("o4-mini")||(v.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3 and o4-mini models"}),delete x.service_tier),"priority"!==(null==b?void 0:b.serviceTier)||function(e){return e.startsWith("gpt-4")||e.startsWith("o3")||e.startsWith("o4-mini")}(this.modelId)||(v.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (GPT-4, o3, o4-mini) and requires Enterprise access"}),delete x.service_tier);const{tools:Y,toolChoice:T,toolWarnings:q}=function({tools:e,toolChoice:t,strictJsonSchema:o}){const s=[];if(null==(e=(null==e?void 0:e.length)?e:void 0))return{tools:void 0,toolChoice:void 0,toolWarnings:s};const i=[];for(const t of e)switch(t.type){case"function":i.push({type:"function",name:t.name,description:t.description,parameters:t.inputSchema,strict:o});break;case"provider-defined":switch(t.id){case"openai.file_search":{const e=g.parse(t.args);i.push({type:"file_search",vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker}:void 0,filters:e.filters});break}case"openai.web_search_preview":i.push({type:"web_search_preview",search_context_size:t.args.searchContextSize,user_location:t.args.userLocation});break;default:s.push({type:"unsupported-tool",tool:t})}break;default:s.push({type:"unsupported-tool",tool:t})}if(null==t)return{tools:i,toolChoice:void 0,toolWarnings:s};const a=t.type;switch(a){case"auto":case"none":case"required":return{tools:i,toolChoice:a,toolWarnings:s};case"tool":return{tools:i,toolChoice:"file_search"===t.toolName?{type:"file_search"}:"web_search_preview"===t.toolName?{type:"web_search_preview"}:{type:"function",name:t.toolName},toolWarnings:s};default:{const e=a;throw new n.b8({functionality:`tool choice type: ${e}`})}}}({tools:c,toolChoice:m,strictJsonSchema:I});return{args:{...x,tools:Y,tool_choice:T},warnings:[...v,...q]}}async doGenerate(e){var t,o,a,r,l,u,p,c,m;const{args:h,warnings:g}=await this.getArgs(e),f=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:y,value:v,rawValue:_}=await(0,s.postJsonToApi)({url:f,headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:h,failedResponseHandler:d,successfulResponseHandler:(0,s.createJsonResponseHandler)(i.Ik({id:i.Yj(),created_at:i.ai(),error:i.Ik({code:i.Yj(),message:i.Yj()}).nullish(),model:i.Yj(),output:i.YO(i.gM("type",[i.Ik({type:i.eu("message"),role:i.eu("assistant"),id:i.Yj(),content:i.YO(i.Ik({type:i.eu("output_text"),text:i.Yj(),annotations:i.YO(i.Ik({type:i.eu("url_citation"),start_index:i.ai(),end_index:i.ai(),url:i.Yj(),title:i.Yj()}))}))}),i.Ik({type:i.eu("function_call"),call_id:i.Yj(),name:i.Yj(),arguments:i.Yj(),id:i.Yj()}),i.Ik({type:i.eu("web_search_call"),id:i.Yj(),status:i.Yj().optional()}),i.Ik({type:i.eu("computer_call"),id:i.Yj(),status:i.Yj().optional()}),i.Ik({type:i.eu("reasoning"),id:i.Yj(),encrypted_content:i.Yj().nullish(),summary:i.YO(i.Ik({type:i.eu("summary_text"),text:i.Yj()}))})])),incomplete_details:i.Ik({reason:i.Yj()}).nullable(),usage:D})),abortSignal:e.abortSignal,fetch:this.config.fetch});if(v.error)throw new n.hL({message:v.error.message,url:f,requestBodyValues:h,statusCode:400,responseHeaders:y,responseBody:_,isRetryable:!1});const k=[];for(const e of v.output)switch(e.type){case"reasoning":0===e.summary.length&&e.summary.push({type:"summary_text",text:""});for(const o of e.summary)k.push({type:"reasoning",text:o.text,providerMetadata:{openai:{itemId:e.id,reasoningEncryptedContent:null!=(t=e.encrypted_content)?t:null}}});break;case"message":for(const t of e.content){k.push({type:"text",text:t.text,providerMetadata:{openai:{itemId:e.id}}});for(const e of t.annotations)k.push({type:"source",sourceType:"url",id:null!=(r=null==(a=(o=this.config).generateId)?void 0:a.call(o))?r:(0,s.generateId)(),url:e.url,title:e.title})}break;case"function_call":k.push({type:"tool-call",toolCallId:e.call_id,toolName:e.name,input:e.arguments,providerMetadata:{openai:{itemId:e.id}}});break;case"web_search_call":k.push({type:"tool-call",toolCallId:e.id,toolName:"web_search_preview",input:"",providerExecuted:!0}),k.push({type:"tool-result",toolCallId:e.id,toolName:"web_search_preview",result:{status:e.status||"completed"},providerExecuted:!0});break;case"computer_call":k.push({type:"tool-call",toolCallId:e.id,toolName:"computer_use",input:"",providerExecuted:!0}),k.push({type:"tool-result",toolCallId:e.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:e.status||"completed"},providerExecuted:!0})}return{content:k,finishReason:U({finishReason:null==(l=v.incomplete_details)?void 0:l.reason,hasToolCalls:k.some(e=>"tool-call"===e.type)}),usage:{inputTokens:v.usage.input_tokens,outputTokens:v.usage.output_tokens,totalTokens:v.usage.input_tokens+v.usage.output_tokens,reasoningTokens:null!=(p=null==(u=v.usage.output_tokens_details)?void 0:u.reasoning_tokens)?p:void 0,cachedInputTokens:null!=(m=null==(c=v.usage.input_tokens_details)?void 0:c.cached_tokens)?m:void 0},request:{body:h},response:{id:v.id,timestamp:new Date(1e3*v.created_at),modelId:v.model,headers:y,body:_},providerMetadata:{openai:{responseId:v.id}},warnings:g}}async doStream(e){const{args:t,warnings:o}=await this.getArgs(e),{responseHeaders:n,value:i}=await(0,s.postJsonToApi)({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:(0,s.combineHeaders)(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:d,successfulResponseHandler:(0,s.createEventSourceResponseHandler)(oe),abortSignal:e.abortSignal,fetch:this.config.fetch}),a=this;let r="unknown";const l={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let u=null;const p={};let c=!1;const m={};return{stream:i.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(t,o){var n,i,d,h,g,f,y,v,_,k,w,b,I;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:t.rawValue}),!t.success)return r="error",void o.enqueue({type:"error",error:t.error});const x=t.value;if(se(x))"function_call"===x.item.type?(p[x.output_index]={toolName:x.item.name,toolCallId:x.item.call_id},o.enqueue({type:"tool-input-start",id:x.item.call_id,toolName:x.item.name})):"web_search_call"===x.item.type?(p[x.output_index]={toolName:"web_search_preview",toolCallId:x.item.id},o.enqueue({type:"tool-input-start",id:x.item.id,toolName:"web_search_preview"})):"computer_call"===x.item.type?(p[x.output_index]={toolName:"computer_use",toolCallId:x.item.id},o.enqueue({type:"tool-input-start",id:x.item.id,toolName:"computer_use"})):"message"===x.item.type?o.enqueue({type:"text-start",id:x.item.id,providerMetadata:{openai:{itemId:x.item.id}}}):function(e){return se(e)&&"reasoning"===e.item.type}(x)&&(m[x.item.id]={encryptedContent:x.item.encrypted_content,summaryParts:[0]},o.enqueue({type:"reasoning-start",id:`${x.item.id}:0`,providerMetadata:{openai:{itemId:x.item.id,reasoningEncryptedContent:null!=(n=x.item.encrypted_content)?n:null}}}));else if(ne(x)){if("function_call"===x.item.type)p[x.output_index]=void 0,c=!0,o.enqueue({type:"tool-input-end",id:x.item.call_id}),o.enqueue({type:"tool-call",toolCallId:x.item.call_id,toolName:x.item.name,input:x.item.arguments,providerMetadata:{openai:{itemId:x.item.id}}});else if("web_search_call"===x.item.type)p[x.output_index]=void 0,c=!0,o.enqueue({type:"tool-input-end",id:x.item.id}),o.enqueue({type:"tool-call",toolCallId:x.item.id,toolName:"web_search_preview",input:"",providerExecuted:!0}),o.enqueue({type:"tool-result",toolCallId:x.item.id,toolName:"web_search_preview",result:{type:"web_search_tool_result",status:x.item.status||"completed"},providerExecuted:!0});else if("computer_call"===x.item.type)p[x.output_index]=void 0,c=!0,o.enqueue({type:"tool-input-end",id:x.item.id}),o.enqueue({type:"tool-call",toolCallId:x.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),o.enqueue({type:"tool-result",toolCallId:x.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:x.item.status||"completed"},providerExecuted:!0});else if("message"===x.item.type)o.enqueue({type:"text-end",id:x.item.id});else if(function(e){return ne(e)&&"reasoning"===e.item.type}(x)){const e=m[x.item.id];for(const t of e.summaryParts)o.enqueue({type:"reasoning-end",id:`${x.item.id}:${t}`,providerMetadata:{openai:{itemId:x.item.id,reasoningEncryptedContent:null!=(i=x.item.encrypted_content)?i:null}}});delete m[x.item.id]}}else if(function(e){return"response.function_call_arguments.delta"===e.type}(x)){const e=p[x.output_index];null!=e&&o.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:x.delta})}else!function(e){return"response.created"===e.type}(x)?function(e){return"response.output_text.delta"===e.type}(x)?o.enqueue({type:"text-delta",id:x.item_id,delta:x.delta}):function(e){return"response.reasoning_summary_part.added"===e.type}(x)?x.summary_index>0&&(null==(d=m[x.item_id])||d.summaryParts.push(x.summary_index),o.enqueue({type:"reasoning-start",id:`${x.item_id}:${x.summary_index}`,providerMetadata:{openai:{itemId:x.item_id,reasoningEncryptedContent:null!=(g=null==(h=m[x.item_id])?void 0:h.encryptedContent)?g:null}}})):function(e){return"response.reasoning_summary_text.delta"===e.type}(x)?o.enqueue({type:"reasoning-delta",id:`${x.item_id}:${x.summary_index}`,delta:x.delta,providerMetadata:{openai:{itemId:x.item_id}}}):function(e){return"response.completed"===e.type||"response.incomplete"===e.type}(x)?(r=U({finishReason:null==(f=x.response.incomplete_details)?void 0:f.reason,hasToolCalls:c}),l.inputTokens=x.response.usage.input_tokens,l.outputTokens=x.response.usage.output_tokens,l.totalTokens=x.response.usage.input_tokens+x.response.usage.output_tokens,l.reasoningTokens=null!=(v=null==(y=x.response.usage.output_tokens_details)?void 0:y.reasoning_tokens)?v:void 0,l.cachedInputTokens=null!=(k=null==(_=x.response.usage.input_tokens_details)?void 0:_.cached_tokens)?k:void 0):function(e){return"response.output_text.annotation.added"===e.type}(x)?o.enqueue({type:"source",sourceType:"url",id:null!=(I=null==(b=(w=a.config).generateId)?void 0:b.call(w))?I:(0,s.generateId)(),url:x.annotation.url,title:x.annotation.title}):function(e){return"error"===e.type}(x)&&o.enqueue({type:"error",error:x}):(u=x.response.id,o.enqueue({type:"response-metadata",id:x.response.id,timestamp:new Date(1e3*x.response.created_at),modelId:x.response.model}))},flush(e){e.enqueue({type:"finish",finishReason:r,usage:l,providerMetadata:{openai:{responseId:u}}})}})),request:{body:t},response:{headers:n}}}},D=i.Ik({input_tokens:i.ai(),input_tokens_details:i.Ik({cached_tokens:i.ai().nullish()}).nullish(),output_tokens:i.ai(),output_tokens_details:i.Ik({reasoning_tokens:i.ai().nullish()}).nullish()}),K=i.Ik({type:i.eu("response.output_text.delta"),item_id:i.Yj(),delta:i.Yj()}),B=i.Ik({type:i.eu("error"),code:i.Yj(),message:i.Yj(),param:i.Yj().nullish(),sequence_number:i.ai()}),F=i.Ik({type:i.k5(["response.completed","response.incomplete"]),response:i.Ik({incomplete_details:i.Ik({reason:i.Yj()}).nullish(),usage:D})}),L=i.Ik({type:i.eu("response.created"),response:i.Ik({id:i.Yj(),created_at:i.ai(),model:i.Yj()})}),G=i.Ik({type:i.eu("response.output_item.added"),output_index:i.ai(),item:i.gM("type",[i.Ik({type:i.eu("message"),id:i.Yj()}),i.Ik({type:i.eu("reasoning"),id:i.Yj(),encrypted_content:i.Yj().nullish()}),i.Ik({type:i.eu("function_call"),id:i.Yj(),call_id:i.Yj(),name:i.Yj(),arguments:i.Yj()}),i.Ik({type:i.eu("web_search_call"),id:i.Yj(),status:i.Yj()}),i.Ik({type:i.eu("computer_call"),id:i.Yj(),status:i.Yj()})])}),Z=i.Ik({type:i.eu("response.output_item.done"),output_index:i.ai(),item:i.gM("type",[i.Ik({type:i.eu("message"),id:i.Yj()}),i.Ik({type:i.eu("reasoning"),id:i.Yj(),encrypted_content:i.Yj().nullish()}),i.Ik({type:i.eu("function_call"),id:i.Yj(),call_id:i.Yj(),name:i.Yj(),arguments:i.Yj(),status:i.eu("completed")}),i.Ik({type:i.eu("web_search_call"),id:i.Yj(),status:i.eu("completed")}),i.Ik({type:i.eu("computer_call"),id:i.Yj(),status:i.eu("completed")})])}),Q=i.Ik({type:i.eu("response.function_call_arguments.delta"),item_id:i.Yj(),output_index:i.ai(),delta:i.Yj()}),X=i.Ik({type:i.eu("response.output_text.annotation.added"),annotation:i.Ik({type:i.eu("url_citation"),url:i.Yj(),title:i.Yj()})}),ee=i.Ik({type:i.eu("response.reasoning_summary_part.added"),item_id:i.Yj(),summary_index:i.ai()}),te=i.Ik({type:i.eu("response.reasoning_summary_text.delta"),item_id:i.Yj(),summary_index:i.ai(),delta:i.Yj()}),oe=i.KC([K,F,L,G,Z,Q,X,ee,te,B,i.Ik({type:i.Yj()}).loose()]);function ne(e){return"response.output_item.done"===e.type}function se(e){return"response.output_item.added"===e.type}var ie=i.Ik({metadata:i.bz().nullish(),parallelToolCalls:i.zM().nullish(),previousResponseId:i.Yj().nullish(),store:i.zM().nullish(),user:i.Yj().nullish(),reasoningEffort:i.Yj().nullish(),strictJsonSchema:i.zM().nullish(),instructions:i.Yj().nullish(),reasoningSummary:i.Yj().nullish(),serviceTier:i.k5(["auto","flex","priority"]).nullish(),include:i.YO(i.k5(["reasoning.encrypted_content","file_search_call.results"])).nullish()});function ae(e={}){var t;const o=()=>({"api-key":(0,s.loadApiKey)({apiKey:e.apiKey,environmentVariableName:"AZURE_API_KEY",description:"Azure OpenAI"}),...e.headers}),n=null!=(t=e.apiVersion)?t:"preview",i=({path:t,modelId:o})=>{var i;const a=null!=(i=e.baseURL)?i:`https://${(0,s.loadSetting)({settingValue:e.resourceName,settingName:"resourceName",environmentVariableName:"AZURE_RESOURCE_NAME",description:"Azure OpenAI resource name"})}.openai.azure.com/openai`,r=new URL(`${a}/v1${t}`);return r.searchParams.set("api-version",n),r.toString()},a=t=>new y(t,{provider:"azure.chat",url:i,headers:o,fetch:e.fetch}),r=t=>new C(t,{provider:"azure.embeddings",headers:o,url:i,fetch:e.fetch}),l=t=>new E(t,{provider:"azure.image",url:i,headers:o,fetch:e.fetch}),u=function(e){if(new.target)throw new Error("The Azure OpenAI model function cannot be called with the new keyword.");return a(e)};return u.languageModel=a,u.chat=a,u.completion=t=>new j(t,{provider:"azure.completion",url:i,headers:o,fetch:e.fetch}),u.embedding=r,u.image=l,u.imageModel=l,u.textEmbedding=r,u.textEmbeddingModel=r,u.responses=t=>new V(t,{provider:"azure.responses",url:i,headers:o,fetch:e.fetch}),u.transcription=t=>new A(t,{provider:"azure.transcription",url:i,headers:o,fetch:e.fetch}),u.speech=t=>new J(t,{provider:"azure.speech",url:i,headers:o,fetch:e.fetch}),u}var re=ae()}}]);
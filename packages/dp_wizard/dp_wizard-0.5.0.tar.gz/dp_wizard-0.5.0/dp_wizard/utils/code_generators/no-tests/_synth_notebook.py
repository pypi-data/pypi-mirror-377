# # TITLE
#
# This is a demonstration of how the [OpenDP Library](https://docs.opendp.org/)
# can be used to create a differentially private release of synthetic data.
# It was generated by [DP Wizard](https://github.com/opendp/dp-wizard).
#
# Jump ahead:
# - [Results](#Results)
#
# ## Prerequisites
#
# First install and import the required dependencies:
# WINDOWS_NOTE

# +
# %pip install DEPENDENCIES
# -

# +
IMPORTS_BLOCK
# -

# Then define some utility functions to handle dataframes and plot results:

# +
UTILS_BLOCK
# -

# ### Context
#
# Next, we'll define our Context. This is where we set the privacy budget,
# and the columns that will be part of the synthetic dataset.

# +
SYNTH_CONTEXT_BLOCK
# -

# A note on `utf8-lossy`: CSVs can use different "character encodings" to
# represent characters outside the plain ascii character set, but out of the box
# the Polars library only supports UTF8. Specifying `utf8-lossy` preserves as
# much information as possible, and any unrecognized characters will be replaced
# by "ï¿½". If this is not sufficient, you will need to preprocess your data to
# reencode it as UTF8.
#
# ## Results
#
# Finally, we release a contingency table, and then generate synthetic data
# from the contingency table

SYNTH_QUERY_BLOCK

# If we try to run more queries at this point, it will error. Once the privacy budget
# is consumed, the library prevents you from running any more queries.
#
# If there are lots of null values, it may mean that the OpenDP library was not able to
# collect enough information to describe your dataset within the privacy budget.
# You might try:
# - Increasing your privacy budget
# - Selecting fewer columns
# - Filling in the "keys" kwarg
# - Preprocess to combine keys which occur a small number of times

# # Coda
# The code below produces a summary report.

# +
SYNTH_REPORTS_BLOCK
# -

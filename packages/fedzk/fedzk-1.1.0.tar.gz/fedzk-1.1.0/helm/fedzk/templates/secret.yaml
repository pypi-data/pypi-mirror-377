apiVersion: v1
kind: Secret
metadata:
  name: {{ include "fedzk.fullname" . }}-secrets
  labels:
    {{- include "fedzk.labels" . | nindent 4 }}
type: Opaque
data:
  # MPC API Keys
  {{- range $index, $apiKey := .Values.config.mpc.apiKeys }}
  {{- if $apiKey }}
  MPC_API_KEY_{{ $index }}: {{ $apiKey | b64enc }}
  {{- end }}
  {{- end }}

  # Default MPC API Keys (if none provided)
  {{- if not .Values.config.mpc.apiKeys }}
  MPC_API_KEY_DEFAULT: "dGVzdF9rZXlfMTIz"  # test_key_123
  {{- end }}

---
{{- if or .Values.postgresql.enabled .Values.externalDatabase.host }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "fedzk.fullname" . }}-db
  labels:
    {{- include "fedzk.labels" . | nindent 4 }}
type: Opaque
data:
  {{- if .Values.postgresql.enabled }}
  database-url: {{ printf "postgresql://%s:%s@%s-postgresql:5432/%s" .Values.postgresql.auth.username .Values.postgresql.auth.password (include "fedzk.fullname" .) .Values.postgresql.auth.database | b64enc }}
  {{- else if .Values.externalDatabase.host }}
  database-url: {{ printf "postgresql://%s:%s@%s:%s/%s" .Values.externalDatabase.username .Values.externalDatabase.password .Values.externalDatabase.host (.Values.externalDatabase.port | toString) .Values.externalDatabase.database | b64enc }}
  {{- end }}
---
{{- end }}

{{- if or .Values.redis.enabled .Values.externalRedis.host }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "fedzk.fullname" . }}-redis
  labels:
    {{- include "fedzk.labels" . | nindent 4 }}
type: Opaque
data:
  redis-password: {{ .Values.redis.auth.password | default "fedzk-redis-password" | b64enc }}
---
{{- end }}


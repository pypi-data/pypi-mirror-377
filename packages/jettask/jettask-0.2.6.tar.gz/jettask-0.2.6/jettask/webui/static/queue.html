<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é˜Ÿåˆ—è¯¦æƒ… - Jettask Monitor</title>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Ant Design -->
    <link rel="stylesheet" href="https://unpkg.com/antd@4.24.13/dist/antd.min.css" />
    <script src="https://unpkg.com/moment@2.29.4/moment.js"></script>
    <script src="https://unpkg.com/antd@4.24.13/dist/antd.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #177ddc;
            --primary-gradient: linear-gradient(135deg, #1f1f1f 0%, #434343 100%);
            --success-color: #49aa19;
            --warning-color: #d89614;
            --error-color: #a61d24;
            --info-color: #177ddc;
            --bg-primary: #000000;
            --bg-secondary: #141414;
            --bg-card: #1f1f1f;
            --text-primary: #rgba(255, 255, 255, 0.85);
            --text-secondary: rgba(255, 255, 255, 0.65);
            --border-color: rgba(255, 255, 255, 0.12);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #000000;
            min-height: 100vh;
            position: relative;
            color: rgba(255, 255, 255, 0.85);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(23, 125, 220, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(73, 170, 25, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(216, 150, 20, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        #root {
            position: relative;
            z-index: 1;
        }

        .app-container {
            min-height: 100vh;
            backdrop-filter: blur(10px);
            background: rgba(0, 0, 0, 0.5);
        }


        .main-content {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .gradient-text {
            background: linear-gradient(135deg, #177ddc 0%, #69c0ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Ant Design æš—è‰²ä¸»é¢˜è¦†ç›– */
        .ant-card {
            background: rgba(31, 31, 31, 0.95) !important;
            border-color: rgba(255, 255, 255, 0.08) !important;
        }

        .ant-statistic-title {
            color: rgba(255, 255, 255, 0.65) !important;
        }

        .ant-table {
            background: transparent !important;
        }

        .ant-table-thead > tr > th {
            background: rgba(255, 255, 255, 0.04) !important;
            border-bottom-color: rgba(255, 255, 255, 0.08) !important;
        }

        .ant-table-tbody > tr > td {
            border-bottom-color: rgba(255, 255, 255, 0.08) !important;
        }

        .ant-table-tbody > tr:hover > td {
            background: rgba(255, 255, 255, 0.04) !important;
        }

        .ant-modal-content {
            background: rgba(31, 31, 31, 0.95) !important;
        }

        .ant-modal-header {
            background: transparent !important;
            border-bottom-color: rgba(255, 255, 255, 0.08) !important;
        }

        .ant-modal-title {
            color: rgba(255, 255, 255, 0.85) !important;
        }

        /* ä¿®å¤å¯¼èˆªæŒ‰é’®æ ·å¼ */
        .ant-btn-text {
            color: rgba(255, 255, 255, 0.65) !important;
        }

        .ant-btn-text:hover {
            color: rgba(255, 255, 255, 0.85) !important;
            background: rgba(255, 255, 255, 0.08) !important;
        }

        .ant-btn-primary {
            background: #177ddc !important;
            border-color: #177ddc !important;
        }

        .ant-btn-primary:hover {
            background: #1890ff !important;
            border-color: #1890ff !important;
        }

        /* åˆ†é¡µå™¨æ ·å¼ */
        .ant-pagination-item {
            background: rgba(255, 255, 255, 0.08) !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
        }

        .ant-pagination-item a {
            color: rgba(255, 255, 255, 0.85) !important;
        }

        .ant-pagination-item-active {
            background: #177ddc !important;
            border-color: #177ddc !important;
        }

        /* Inputè¾“å…¥æ¡†æ ·å¼ */
        .ant-input {
            background: rgba(255, 255, 255, 0.08) !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
            color: rgba(255, 255, 255, 0.85) !important;
        }

        .ant-input::placeholder {
            color: rgba(255, 255, 255, 0.45) !important;
        }

        /* Selectä¸‹æ‹‰æ¡†æ ·å¼ */
        .ant-select-selector {
            background: rgba(255, 255, 255, 0.08) !important;
            border-color: rgba(255, 255, 255, 0.12) !important;
            color: rgba(255, 255, 255, 0.85) !important;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .main-content {
                padding: 16px;
            }
        }

        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }

    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;
        const { Card, Row, Col, Statistic, Table, Input, Select, Button, Tag, Modal, Descriptions, Space, Divider, Pagination, Spin, message, BackTop, ConfigProvider } = antd;
        // Icons (using span with text as fallback)
        const SearchIcon = () => React.createElement('span', null, 'ğŸ”');
        const ReloadIcon = () => React.createElement('span', null, 'ğŸ”„');
        const ArrowLeftIcon = () => React.createElement('span', null, 'â†');
        const MonitorIcon = () => React.createElement('span', null, 'ğŸ“º');
        const LineChartIcon = () => React.createElement('span', null, 'ğŸ“ˆ');
        
        function QueueDetail() {
            // ä»URLè·å–é˜Ÿåˆ—åç§°
            const urlParams = new URLSearchParams(window.location.search);
            const queueName = urlParams.get('name') || '';
            
            // çŠ¶æ€ç®¡ç†
            const [loading, setLoading] = useState(false);
            const [taskSearch, setTaskSearch] = useState('');
            const [statusFilter, setStatusFilter] = useState('');
            const [timeRange, setTimeRange] = useState('1h');
            const [showAllStats, setShowAllStats] = useState(true);
            const [currentPage, setCurrentPage] = useState(1);
            const [pageSize, setPageSize] = useState(50);
            const [totalTasks, setTotalTasks] = useState(0);
            const [taskDetailVisible, setTaskDetailVisible] = useState(false);
            const [selectedTask, setSelectedTask] = useState(null);
            
            // æ•°æ®çŠ¶æ€
            const [queueStats, setQueueStats] = useState({
                messages: 0,
                messages_ready: 0, 
                messages_unacknowledged: 0,
                consumers: 0,
                length: 0
            });
            
            const [messageStats, setMessageStats] = useState({
                publish: 0,
                deliver_get: 0,
                ack: 0
            });
            
            const [workerSummary, setWorkerSummary] = useState({
                total_success_count: 0,
                total_failed_count: 0,
                total_running_tasks: 0,
                avg_processing_time: 0
            });
            
            const [workers, setWorkers] = useState([]);
            const [tasks, setTasks] = useState([]);
            
            const chartRef = useRef(null);
            const trendChart = useRef(null);
            
            // è®¡ç®—å±æ€§
            const onlineWorkers = useMemo(() => 
                workers.filter(w => w.is_alive).length, [workers]
            );
            
            const filteredTasks = useMemo(() => {
                let filtered = tasks;
                
                if (taskSearch) {
                    filtered = filtered.filter(task => 
                        (task.task_name || '').toLowerCase().includes(taskSearch.toLowerCase()) ||
                        (task.event_id || '').toLowerCase().includes(taskSearch.toLowerCase())
                    );
                }
                
                if (statusFilter) {
                    filtered = filtered.filter(task => {
                        const status = task.parsed_status?.status || '';
                        return status.includes(statusFilter);
                    });
                }
                
                const start = (currentPage - 1) * pageSize;
                const end = start + pageSize;
                setTotalTasks(filtered.length);
                return filtered.slice(start, end);
            }, [tasks, taskSearch, statusFilter, currentPage, pageSize]);
            
            // è¾…åŠ©å‡½æ•°
            const formatTime = (seconds) => {
                if (!seconds || seconds === 0) return '-';
                if (seconds < 1) return `${Math.round(seconds * 1000)}ms`;
                if (seconds < 60) return `${seconds.toFixed(2)}s`;
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = (seconds % 60).toFixed(1);
                return `${minutes}m${remainingSeconds}s`;
            };
            
            const formatDateTime = (timestamp) => {
                if (!timestamp) return '-';
                return new Date(parseFloat(timestamp) * 1000).toLocaleString('zh-CN');
            };
            
            const getStatusType = (status) => {
                if (!status) return 'default';
                if (status.includes('completed') || status.includes('æˆåŠŸ')) return 'success';
                if (status.includes('failed') || status.includes('å¤±è´¥')) return 'error';
                if (status.includes('running') || status.includes('æ‰§è¡Œ')) return 'warning';
                return 'default';
            };
            
            const getStatusText = (status) => {
                if (!status) return 'æœªçŸ¥';
                if (status.includes('completed') || status.includes('æˆåŠŸ')) return 'å·²å®Œæˆ';
                if (status.includes('failed') || status.includes('å¤±è´¥')) return 'å¤±è´¥';
                if (status.includes('running') || status.includes('æ‰§è¡Œ')) return 'æ‰§è¡Œä¸­';
                if (status.includes('pending') || status.includes('ç­‰å¾…')) return 'ç­‰å¾…ä¸­';
                return status;
            };
            
            const goBack = () => {
                window.location.href = '/';
            };
            
            const viewTaskDetail = (task) => {
                setSelectedTask(task);
                setTaskDetailVisible(true);
            };
            
            // æ•°æ®åŠ è½½å‡½æ•°
            const loadQueueStats = async () => {
                try {
                    const response = await fetch(`/api/queue/${encodeURIComponent(queueName)}/stats`);
                    if (response.ok) {
                        const stats = await response.json();
                        setQueueStats(stats);
                        setMessageStats(stats.message_stats || {});
                    }
                } catch (error) {
                    console.error('åŠ è½½é˜Ÿåˆ—ç»Ÿè®¡å¤±è´¥:', error);
                }
            };
            
            const loadWorkers = async () => {
                try {
                    const [workersResponse, summaryResponse] = await Promise.all([
                        fetch(`/api/queue/${encodeURIComponent(queueName)}/workers`),
                        fetch(`/api/queue/${encodeURIComponent(queueName)}/worker-summary`)
                    ]);
                    
                    if (workersResponse.ok) {
                        const data = await workersResponse.json();
                        setWorkers(data.workers || []);
                    }
                    
                    if (summaryResponse.ok) {
                        const summaryData = await summaryResponse.json();
                        setWorkerSummary(summaryData.summary || {});
                    }
                } catch (error) {
                    console.error('åŠ è½½Workerså¤±è´¥:', error);
                }
            };
            
            const loadTasks = async () => {
                try {
                    setLoading(true);
                    const response = await fetch(`/api/queue/${encodeURIComponent(queueName)}/tasks?limit=1000`);
                    if (response.ok) {
                        const data = await response.json();
                        setTasks(data.tasks || []);
                    }
                } catch (error) {
                    console.error('åŠ è½½ä»»åŠ¡å¤±è´¥:', error);
                    message.error('åŠ è½½ä»»åŠ¡å¤±è´¥');
                } finally {
                    setLoading(false);
                }
            };
            
            const refreshData = async () => {
                await Promise.all([
                    loadQueueStats(),
                    loadWorkers(),
                    loadTasks()
                ]);
            };
            
            const initChart = () => {
                if (chartRef.current && !trendChart.current) {
                    const ctx = chartRef.current.getContext('2d');
                    trendChart.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({length: 12}, (_, i) => `${i * 2}:00`),
                            datasets: [
                                {
                                    label: 'æˆåŠŸä»»åŠ¡',
                                    data: Array.from({length: 12}, () => Math.floor(Math.random() * 50)),
                                    borderColor: '#52c41a',
                                    backgroundColor: 'rgba(82, 196, 26, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                },
                                {
                                    label: 'å¤±è´¥ä»»åŠ¡',
                                    data: Array.from({length: 12}, () => Math.floor(Math.random() * 10)),
                                    borderColor: '#f5222d',
                                    backgroundColor: 'rgba(245, 34, 45, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'top',
                                    labels: {
                                        color: 'rgba(255, 255, 255, 0.85)'
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.08)'
                                    },
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.65)'
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.08)'
                                    },
                                    ticks: {
                                        color: 'rgba(255, 255, 255, 0.65)'
                                    }
                                }
                            }
                        }
                    });
                }
            };
            
            // ç”Ÿå‘½å‘¨æœŸ
            useEffect(() => {
                if (!queueName) {
                    message.error('é˜Ÿåˆ—åç§°ä¸èƒ½ä¸ºç©º');
                    return;
                }
                
                refreshData();
                setTimeout(initChart, 100);
                
                return () => {
                    if (trendChart.current) {
                        trendChart.current.destroy();
                    }
                };
            }, []);
            
            // è¡¨æ ¼åˆ—å®šä¹‰
            const columns = [
                {
                    title: 'ä»»åŠ¡ID',
                    dataIndex: 'event_id',
                    key: 'event_id',
                    width: 200,
                    render: (text) => (
                        <code style={{fontSize: '0.75rem', background: '#f7fafc', padding: '4px 8px', borderRadius: '4px'}}>
                            {text ? text.substring(0, 16) + '...' : 'N/A'}
                        </code>
                    ),
                },
                {
                    title: 'ä»»åŠ¡åç§°',
                    dataIndex: 'task_name',
                    key: 'task_name',
                    minWidth: 120,
                    render: (text) => (
                        <div style={{display: 'flex', alignItems: 'center'}}>
                            <Tag color="blue" size="small" style={{marginRight: '8px'}}>T</Tag>
                            <strong>{text || 'unknown'}</strong>
                        </div>
                    ),
                },
                {
                    title: 'æ¶ˆè´¹è€…',
                    dataIndex: 'consumer',
                    key: 'consumer',
                    width: 150,
                    render: (text) => <code style={{fontSize: '0.7rem'}}>{text || '-'}</code>,
                },
                {
                    title: 'çŠ¶æ€',
                    dataIndex: 'parsed_status',
                    key: 'status',
                    width: 100,
                    align: 'center',
                    render: (parsed_status) => (
                        <Tag color={getStatusType(parsed_status?.status)} size="small">
                            {getStatusText(parsed_status?.status)}
                        </Tag>
                    ),
                },
                {
                    title: 'åˆ›å»ºæ—¶é—´',
                    dataIndex: 'trigger_time',
                    key: 'trigger_time',
                    width: 160,
                    render: (text) => formatDateTime(text),
                },
                {
                    title: 'å‚æ•°',
                    dataIndex: 'params_str',
                    key: 'params_str',
                    minWidth: 150,
                    render: (text) => {
                        const content = text || 'æ— å‚æ•°';
                        return (
                            <span style={{fontSize: '0.8rem', color: '#718096'}} title={content}>
                                {content.length > 20 ? content.substring(0, 20) + '...' : content}
                            </span>
                        );
                    },
                },
                {
                    title: 'æ“ä½œ',
                    key: 'action',
                    width: 120,
                    align: 'center',
                    render: (_, record) => (
                        <Button 
                            type="primary" 
                            size="small" 
                            onClick={() => viewTaskDetail(record)}
                            style={{borderRadius: '6px'}}
                        >
                            è¯¦æƒ…
                        </Button>
                    ),
                },
            ];
            
            return (
                <ConfigProvider>
                    <div className="app-container">
                    {/* å¯¼èˆªæ  */}
                    <div style={{
                        background: 'rgba(20, 20, 20, 0.8)',
                        backdropFilter: 'blur(20px)',
                        borderBottom: '1px solid rgba(255, 255, 255, 0.08)',
                        padding: '16px 0',
                        position: 'sticky',
                        top: 0,
                        zIndex: 1000
                    }}>
                        <div style={{
                            maxWidth: 1400,
                            margin: '0 auto',
                            padding: '0 30px',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'space-between'
                        }}>
                            <div style={{
                                color: 'white',
                                fontSize: '1.5rem',
                                fontWeight: 700,
                                display: 'flex',
                                alignItems: 'center',
                                gap: 12
                            }}>
                                <i className="fas fa-rocket" style={{fontSize: '1.5rem'}} />
                                Jettask Monitor
                            </div>
                            <Space size="large">
                                <Button type="text" size="large" onClick={() => window.location.href = '/'}>
                                    æ¦‚è§ˆ
                                </Button>
                                <Button type="primary" size="large">
                                    é˜Ÿåˆ—
                                </Button>
                                <Button type="text" size="large" onClick={() => window.location.href = '/workers.html'}>
                                    Workers
                                </Button>
                            </Space>
                        </div>
                    </div>
                    
                    {/* é˜Ÿåˆ—æ ‡é¢˜ */}
                    <div style={{
                        background: 'rgba(20, 20, 20, 0.5)',
                        padding: '20px 0',
                        textAlign: 'center'
                    }}>
                        <h1 style={{
                            color: 'white',
                            fontSize: '2rem',
                            fontWeight: 700,
                            margin: 0
                        }}>
                            ğŸ“Š é˜Ÿåˆ—è¯¦æƒ… - {queueName}
                        </h1>
                        <div style={{
                            color: 'rgba(255, 255, 255, 0.65)',
                            marginTop: 8,
                            fontSize: '0.9rem'
                        }}>
                            å®æ—¶ç›‘æ§é˜Ÿåˆ—çŠ¶æ€å’Œä»»åŠ¡æ‰§è¡Œæƒ…å†µ
                        </div>
                    </div>
                    
                    {/* ä¸»å†…å®¹åŒºåŸŸ */}
                    <div className="main-content">
                        <Row gutter={[24, 24]}>
                            {/* å·¦ä¾§ç»Ÿè®¡é¢æ¿ */}
                            <Col xs={24} lg={8}>
                                <Space direction="vertical" size="large" style={{width: '100%'}}>
                                    {/* é˜Ÿåˆ—æ¦‚è§ˆ */}
                                    <Card 
                                        title={
                                            <span style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontSize: '1.2rem', fontWeight: 700}}>
                                                ğŸ“Š é˜Ÿåˆ—æ¦‚è§ˆ
                                            </span>
                                        }
                                        style={{
                                            background: 'rgba(255, 255, 255, 0.95)',
                                            backdropFilter: 'blur(20px)',
                                            borderRadius: '16px',
                                            border: '1px solid rgba(255, 255, 255, 0.3)'
                                        }}
                                    >
                                        <Row gutter={[12, 12]}>
                                            <Col span={12}>
                                                <Statistic title="é˜Ÿåˆ—åç§°" value={queueName} />
                                            </Col>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="æ¶ˆæ¯æ€»æ•°" 
                                                    value={queueStats.messages || 0} 
                                                    valueStyle={{color: '#1890ff'}}
                                                />
                                            </Col>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="å°±ç»ªæ¶ˆæ¯" 
                                                    value={queueStats.messages_ready || 0}
                                                    valueStyle={{color: '#52c41a'}}
                                                />
                                            </Col>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="æœªç¡®è®¤æ¶ˆæ¯" 
                                                    value={queueStats.messages_unacknowledged || 0}
                                                    valueStyle={{color: '#faad14'}}
                                                />
                                            </Col>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="æ¶ˆè´¹è€…æ•°é‡" 
                                                    value={queueStats.consumers || 0}
                                                    valueStyle={{color: '#722ed1'}}
                                                />
                                            </Col>
                                        </Row>
                                        
                                        <Divider>æ¶ˆæ¯ç»Ÿè®¡</Divider>
                                        <Row gutter={[12, 12]}>
                                            <Col span={8}>
                                                <Statistic 
                                                    title="å‘å¸ƒæ•°" 
                                                    value={messageStats.publish || 0}
                                                    valueStyle={{color: '#9b59b6'}}
                                                />
                                            </Col>
                                            <Col span={8}>
                                                <Statistic 
                                                    title="æ¶ˆè´¹æ•°" 
                                                    value={messageStats.deliver_get || 0}
                                                    valueStyle={{color: '#3498db'}}
                                                />
                                            </Col>
                                            <Col span={8}>
                                                <Statistic 
                                                    title="ç¡®è®¤æ•°" 
                                                    value={messageStats.ack || 0}
                                                    valueStyle={{color: '#27ae60'}}
                                                />
                                            </Col>
                                        </Row>
                                        
                                        <Divider>ä»»åŠ¡ç»Ÿè®¡</Divider>
                                        <Row gutter={[12, 12]}>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="æˆåŠŸæ•°" 
                                                    value={workerSummary.total_success_count || 0}
                                                    valueStyle={{color: '#52c41a'}}
                                                />
                                            </Col>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="å¤±è´¥æ•°" 
                                                    value={workerSummary.total_failed_count || 0}
                                                    valueStyle={{color: '#f5222d'}}
                                                />
                                            </Col>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="æ‰§è¡Œä¸­" 
                                                    value={workerSummary.total_running_tasks || 0}
                                                    valueStyle={{color: '#faad14'}}
                                                />
                                            </Col>
                                            <Col span={12}>
                                                <Statistic 
                                                    title="å¹³å‡è€—æ—¶" 
                                                    value={formatTime(workerSummary.avg_processing_time)}
                                                />
                                            </Col>
                                        </Row>
                                    </Card>
                                    
                                    {/* Workersä¿¡æ¯ */}
                                    <Card 
                                        title={
                                            <span style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontSize: '1.2rem', fontWeight: 700}}>
                                                ğŸ‘¥ Workers ({onlineWorkers}/{workers.length})
                                            </span>
                                        }
                                        style={{
                                            background: 'rgba(255, 255, 255, 0.95)',
                                            backdropFilter: 'blur(20px)',
                                            borderRadius: '16px',
                                            border: '1px solid rgba(255, 255, 255, 0.3)'
                                        }}
                                    >
                                        {workers.length === 0 ? (
                                            <div style={{textAlign: 'center', color: '#999', padding: '20px'}}>
                                                æš‚æ— Worker
                                            </div>
                                        ) : (
                                            <Space direction="vertical" size="small" style={{width: '100%'}}>
                                                {workers.slice(0, 5).map(worker => (
                                                    <div 
                                                        key={worker.consumer_id}
                                                        style={{
                                                            padding: '12px',
                                                            background: 'rgba(255, 255, 255, 0.5)',
                                                            borderRadius: '8px',
                                                            border: '1px solid rgba(255, 255, 255, 0.3)'
                                                        }}
                                                    >
                                                        <div style={{display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '8px'}}>
                                                            <div style={{display: 'flex', alignItems: 'center'}}>
                                                                <Tag color={worker.is_alive ? 'success' : 'error'} size="small" style={{marginRight: '8px'}}>
                                                                    {worker.is_alive ? 'åœ¨çº¿' : 'ç¦»çº¿'}
                                                                </Tag>
                                                                <code style={{fontSize: '0.7rem', background: '#f7fafc', padding: '2px 6px', borderRadius: '3px'}}>
                                                                    {(worker.consumer_id || 'unknown').substring(0, 12)}...
                                                                </code>
                                                            </div>
                                                        </div>
                                                        <div style={{fontSize: '0.75rem', color: '#718096'}}>
                                                            {worker.host} | æˆåŠŸ: {worker.success_count || 0} | å¤±è´¥: {worker.failed_count || 0}
                                                        </div>
                                                    </div>
                                                ))}
                                                {workers.length > 5 && (
                                                    <Button type="link" size="small">
                                                        æŸ¥çœ‹å…¨éƒ¨ {workers.length} ä¸ªWorkers
                                                    </Button>
                                                )}
                                            </Space>
                                        )}
                                    </Card>
                                    
                                    {/* ä»»åŠ¡è¶‹åŠ¿å›¾ */}
                                    <Card 
                                        title={
                                            <span style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontSize: '1.2rem', fontWeight: 700}}>
                                                ğŸ“ˆ ä»»åŠ¡è¶‹åŠ¿
                                            </span>
                                        }
                                        style={{
                                            background: 'rgba(255, 255, 255, 0.95)',
                                            backdropFilter: 'blur(20px)',
                                            borderRadius: '16px',
                                            border: '1px solid rgba(255, 255, 255, 0.3)'
                                        }}
                                    >
                                        <div style={{height: '250px'}}>
                                            <canvas ref={chartRef}></canvas>
                                        </div>
                                    </Card>
                                </Space>
                            </Col>
                            
                            {/* å³ä¾§ä»»åŠ¡åˆ—è¡¨ */}
                            <Col xs={24} lg={16}>
                                <Card
                                    title={
                                        <span style={{background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', WebkitBackgroundClip: 'text', WebkitTextFillColor: 'transparent', fontSize: '1.5rem', fontWeight: 700}}>
                                            ğŸ“ ä»»åŠ¡åˆ—è¡¨
                                        </span>
                                    }
                                    extra={
                                        <Space>
                                            <Input
                                                placeholder="æœç´¢ä»»åŠ¡..."
                                                prefix={<SearchIcon />}
                                                value={taskSearch}
                                                onChange={(e) => setTaskSearch(e.target.value)}
                                                style={{width: 200}}
                                            />
                                            <Select 
                                                placeholder="çŠ¶æ€ç­›é€‰" 
                                                value={statusFilter}
                                                onChange={setStatusFilter}
                                                style={{width: 120}}
                                                allowClear
                                            >
                                                <Select.Option value="">å…¨éƒ¨</Select.Option>
                                                <Select.Option value="pending">ç­‰å¾…ä¸­</Select.Option>
                                                <Select.Option value="running">æ‰§è¡Œä¸­</Select.Option>
                                                <Select.Option value="completed">å·²å®Œæˆ</Select.Option>
                                                <Select.Option value="failed">å¤±è´¥</Select.Option>
                                            </Select>
                                            <Button.Group>
                                                <Button 
                                                    type={timeRange === '1h' ? 'primary' : 'default'}
                                                    onClick={() => setTimeRange('1h')}
                                                >
                                                    1å°æ—¶
                                                </Button>
                                                <Button 
                                                    type={timeRange === '24h' ? 'primary' : 'default'}
                                                    onClick={() => setTimeRange('24h')}
                                                >
                                                    24å°æ—¶
                                                </Button>
                                                <Button 
                                                    type={timeRange === '7d' ? 'primary' : 'default'}
                                                    onClick={() => setTimeRange('7d')}
                                                >
                                                    7å¤©
                                                </Button>
                                            </Button.Group>
                                            <Button 
                                                type="primary" 
                                                icon={<ReloadIcon />}
                                                loading={loading}
                                                onClick={refreshData}
                                            >
                                                åˆ·æ–°
                                            </Button>
                                        </Space>
                                    }
                                    style={{
                                        background: 'rgba(255, 255, 255, 0.95)',
                                        backdropFilter: 'blur(20px)',
                                        borderRadius: '20px',
                                        border: '1px solid rgba(255, 255, 255, 0.3)'
                                    }}
                                >
                                    <Table
                                        columns={columns}
                                        dataSource={filteredTasks}
                                        rowKey="event_id"
                                        loading={loading}
                                        pagination={false}
                                        scroll={{y: 500}}
                                        size="middle"
                                    />
                                    
                                    <div style={{padding: '16px 0', display: 'flex', justifyContent: 'center'}}>
                                        <Pagination
                                            current={currentPage}
                                            pageSize={pageSize}
                                            total={totalTasks}
                                            showSizeChanger
                                            showQuickJumper
                                            showTotal={(total, range) => `ç¬¬ ${range[0]}-${range[1]} æ¡ï¼Œå…± ${total} æ¡`}
                                            pageSizeOptions={['20', '50', '100', '200']}
                                            onChange={(page, size) => {
                                                setCurrentPage(page);
                                                setPageSize(size);
                                            }}
                                        />
                                    </div>
                                </Card>
                            </Col>
                        </Row>
                    </div>
                    
                    {/* ä»»åŠ¡è¯¦æƒ…æ¨¡æ€æ¡† */}
                    <Modal
                        title="ä»»åŠ¡è¯¦æƒ…"
                        open={taskDetailVisible}
                        onCancel={() => {
                            setTaskDetailVisible(false);
                            setSelectedTask(null);
                        }}
                        footer={null}
                        width="60%"
                    >
                        {selectedTask && (
                            <>
                                <Descriptions title="åŸºæœ¬ä¿¡æ¯" column={2} bordered>
                                    <Descriptions.Item label="ä»»åŠ¡ID">
                                        <code>{selectedTask.event_id}</code>
                                    </Descriptions.Item>
                                    <Descriptions.Item label="ä»»åŠ¡åç§°">
                                        {selectedTask.task_name}
                                    </Descriptions.Item>
                                    <Descriptions.Item label="çŠ¶æ€">
                                        <Tag color={getStatusType(selectedTask.parsed_status?.status)}>
                                            {getStatusText(selectedTask.parsed_status?.status)}
                                        </Tag>
                                    </Descriptions.Item>
                                    <Descriptions.Item label="æ¶ˆè´¹è€…">
                                        {selectedTask.consumer}
                                    </Descriptions.Item>
                                    <Descriptions.Item label="åˆ›å»ºæ—¶é—´">
                                        {formatDateTime(selectedTask.trigger_time)}
                                    </Descriptions.Item>
                                    <Descriptions.Item label="é˜Ÿåˆ—">
                                        {selectedTask.queue}
                                    </Descriptions.Item>
                                </Descriptions>
                                
                                <Divider>å‚æ•°è¯¦æƒ…</Divider>
                                <pre style={{
                                    background: '#f5f5f5', 
                                    padding: '16px', 
                                    borderRadius: '8px', 
                                    overflowX: 'auto', 
                                    fontSize: '0.9rem'
                                }}>
                                    {selectedTask.params_str || 'æ— å‚æ•°'}
                                </pre>
                            </>
                        )}
                    </Modal>
                    
                    <BackTop />
                </div>
                </ConfigProvider>
            );
        }
        
        // ä¸»åº”ç”¨ç»„ä»¶
        function App() {
            return React.createElement(QueueDetail);
        }
        
        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>

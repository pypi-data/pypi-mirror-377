"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[7471],{49852:(e,t,s)=>{s.r(t),s.d(t,{DocumentManager:()=>M,DocumentWidgetManager:()=>b,IDocumentManager:()=>F,IDocumentWidgetOpener:()=>I,IRecentsManager:()=>N,PathStatus:()=>S,RecentsManager:()=>L,SaveHandler:()=>f,SavingStatus:()=>A,isValidFileName:()=>d,renameDialog:()=>l,renameFile:()=>h,shouldOverwrite:()=>c});var i,n=s(18504),a=s(62246),o=s(90182),r=s(80281);function l(e,t,s){const i=(s=s||o.nullTranslator).load("jupyterlab"),a=t.localPath.split("/").pop()||t.localPath;return(0,n.showDialog)({title:i.__("Rename File"),body:new u(a),focusNodeSelector:"input",buttons:[n.Dialog.cancelButton(),n.Dialog.okButton({label:i.__("Rename"),ariaLabel:i.__("Rename File")})]}).then(e=>e.value?d(e.value)?t.rename(e.value):((0,n.showErrorMessage)(i.__("Rename Error"),Error(i.__('"%1" is not a valid name for a file. Names must have nonzero length, and cannot include "/", "\\", or ":"',e.value))),null):null)}function h(e,t,s){return e.rename(t,s).catch(i=>{if(409!==i.response.status)throw i;return c(s).then(i=>i?e.overwrite(t,s):Promise.reject("File not renamed"))})}function c(e,t){const s=(t=t||o.nullTranslator).load("jupyterlab"),i={title:s.__("Overwrite file?"),body:s.__('"%1" already exists, overwrite?',e),buttons:[n.Dialog.cancelButton(),n.Dialog.warnButton({label:s.__("Overwrite"),ariaLabel:s.__("Overwrite Existing File")})]};return(0,n.showDialog)(i).then(e=>Promise.resolve(e.button.accept))}function d(e){return e.length>0&&!/[\/\\:]/.test(e)}class u extends r.Widget{constructor(e){super({node:i.createRenameNode(e)}),this.addClass("jp-FileDialog");const t=a.PathExt.extname(e),s=this.inputNode.value=a.PathExt.basename(e);this.inputNode.setSelectionRange(0,s.length-t.length)}get inputNode(){return this.node.getElementsByTagName("input")[0]}getValue(){return this.inputNode.value}}!function(e){e.createRenameNode=function(e,t){const s=(t=t||o.nullTranslator).load("jupyterlab"),i=document.createElement("div"),n=document.createElement("label");n.textContent=s.__("File Path");const a=document.createElement("span");a.textContent=e;const r=document.createElement("label");r.textContent=s.__("New Name"),r.className="jp-new-name-title";const l=document.createElement("input");return i.appendChild(n),i.appendChild(a),i.appendChild(r),i.appendChild(l),i}}(i||(i={}));var g=s(54006),_=s(45945),p=s(68211),m=s(76231),v=s(30427);class f{constructor(e){this._autosaveTimer=-1,this._minInterval=-1,this._interval=-1,this._isActive=!1,this._inDialog=!1,this._isDisposed=!1,this._multiplier=10,this._context=e.context,this._isConnectedCallback=e.isConnectedCallback||(()=>!0);const t=e.saveInterval||120;this._minInterval=1e3*t,this._interval=this._minInterval,this._context.fileChanged.connect(this._setTimer,this),this._context.disposed.connect(this.dispose,this)}get saveInterval(){return this._interval/1e3}set saveInterval(e){this._minInterval=this._interval=1e3*e,this._isActive&&this._setTimer()}get isActive(){return this._isActive}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,clearTimeout(this._autosaveTimer),v.Signal.clearData(this))}start(){this._isActive=!0,this._setTimer()}stop(){this._isActive=!1,clearTimeout(this._autosaveTimer)}_setTimer(){clearTimeout(this._autosaveTimer),this._isActive&&(this._autosaveTimer=window.setTimeout(()=>{this._isConnectedCallback()?this._save():this._setTimer()},this._interval))}_save(){var e;const t=this._context;if(this._setTimer(),!t)return;if(null!==(e=t.canSave)&&void 0!==e&&!e||!t.model.dirty||this._inDialog)return;const s=(new Date).getTime();t.save().then(()=>{if(this.isDisposed)return;const e=(new Date).getTime()-s;this._interval=Math.max(this._multiplier*e,this._minInterval),this._setTimer()}).catch(e=>{const{name:t}=e;"ModalCancelError"!==t&&"ModalDuplicateError"!==t&&console.error("Error in Auto-Save",e.message)})}}var y,w,D=s(49711),C=s(60731);class b{constructor(e){this._activateRequested=new v.Signal(this),this._confirmClosingTab=!1,this._isDisposed=!1,this._stateChanged=new v.Signal(this),this._registry=e.registry,this.translator=e.translator||o.nullTranslator,this._recentsManager=e.recentsManager||null}get activateRequested(){return this._activateRequested}get confirmClosingDocument(){return this._confirmClosingTab}set confirmClosingDocument(e){if(this._confirmClosingTab!==e){const t=this._confirmClosingTab;this._confirmClosingTab=e,this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,v.Signal.disconnectReceiver(this))}createWidget(e,t){const s=e.createNew(t);return this._initializeWidget(s,e,t),s}_initializeWidget(e,t,s){y.factoryProperty.set(e,t);const i=new D.DisposableSet;for(const n of this._registry.widgetExtensions(t.name)){const t=n.createNew(e,s);t&&i.add(t)}y.disposablesProperty.set(e,i),e.disposed.connect(this._onWidgetDisposed,this),this.adoptWidget(s,e),s.fileChanged.connect(this._onFileChanged,this),s.pathChanged.connect(this._onPathChanged,this),s.ready.then(()=>{this.setCaption(e)})}adoptWidget(e,t){y.widgetsProperty.get(e).push(t),C.MessageLoop.installMessageHook(t,this),t.addClass("jp-Document"),t.title.closable=!0,t.disposed.connect(this._widgetDisposed,this),y.contextProperty.set(t,e)}findWidget(e,t){const s=y.widgetsProperty.get(e);if(s)return(0,_.find)(s,e=>{const s=y.factoryProperty.get(e);return!!s&&s.name===t})}contextForWidget(e){return y.contextProperty.get(e)}cloneWidget(e){const t=y.contextProperty.get(e);if(!t)return;const s=y.factoryProperty.get(e);if(!s)return;const i=s.createNew(t,e);return this._initializeWidget(i,s,t),i}closeWidgets(e){const t=y.widgetsProperty.get(e);return Promise.all(t.map(e=>this.onClose(e))).then(()=>{})}deleteWidgets(e){const t=y.widgetsProperty.get(e);return Promise.all(t.map(e=>this.onDelete(e))).then(()=>{})}messageHook(e,t){switch(t.type){case"close-request":return this.onClose(e),!1;case"activate-request":{const t=e,s=this.contextForWidget(t);s&&(s.ready.then(()=>{this._recordAsRecentlyOpened(t,s.contentsModel)}).catch(()=>{console.warn("Could not record the recents status for",s)}),this._activateRequested.emit(s.path));break}}return!0}async setCaption(e){const t=this.translator.load("jupyterlab"),s=y.contextProperty.get(e);if(!s)return;const i=s.contentsModel;if(i)return s.listCheckpoints().then(n=>{if(e.isDisposed)return;const o=n[n.length-1],r=o?a.Time.format(o.last_modified):"None";let l=t.__("Name: %1\nPath: %2\n",i.name,i.path);s.model.readOnly?l+=t.__("Read-only"):l+=t.__("Last Saved: %1\n",a.Time.format(i.last_modified))+t.__("Last Checkpoint: %1",r),e.title.caption=l});e.title.caption=""}async onClose(e){var t;const[s,i]=await this._maybeClose(e,this.translator);if(e.isDisposed)return!0;if(s){const s=y.contextProperty.get(e);if(!i){if(!s)return!0;(null===(t=s.contentsModel)||void 0===t?void 0:t.writable)?await s.save():await s.saveAs()}if(s&&("timeout"===await Promise.race([s.ready,new Promise(e=>setTimeout(e,3e3,"timeout"))])?console.warn("Could not record the widget as recently closed because the context did not become ready in 3 seconds"):this._recordAsRecentlyClosed(e,s.contentsModel)),e.isDisposed)return!0;e.dispose()}return s}onDelete(e){return e.dispose(),Promise.resolve(void 0)}_recordAsRecentlyOpened(e,t){var s;const i=this._recentsManager;if(!i)return;const n=t.path,a=this._registry.getFileTypeForModel(t).contentType,o=null===(s=y.factoryProperty.get(e))||void 0===s?void 0:s.name;if(i.addRecent({path:n,contentType:a,factory:o},"opened"),"directory"!==a){const e=n.lastIndexOf("/")>0?n.slice(0,n.lastIndexOf("/")):"";i.addRecent({path:e,contentType:"directory"},"opened")}}_recordAsRecentlyClosed(e,t){var s;const i=this._recentsManager;if(!i)return;const n=t.path,a=this._registry.getFileTypeForModel(t).contentType,o=null===(s=y.factoryProperty.get(e))||void 0===s?void 0:s.name;i.addRecent({path:n,contentType:a,factory:o},"closed")}async _maybeClose(e,t){var s,i;const a=(t=t||o.nullTranslator).load("jupyterlab"),r=y.contextProperty.get(e);if(!r)return Promise.resolve([!0,!0]);let l=y.widgetsProperty.get(r);if(!l)return Promise.resolve([!0,!0]);l=l.filter(e=>{const t=y.factoryProperty.get(e);return!!t&&!1===t.readOnly});const h=e.title.label,c=y.factoryProperty.get(e),d=r.model.dirty&&l.length<=1&&!(null===(s=null==c?void 0:c.readOnly)||void 0===s||s);if(this.confirmClosingDocument){const e=[n.Dialog.cancelButton(),n.Dialog.okButton({label:d?a.__("Close and save"):a.__("Close"),ariaLabel:d?a.__("Close and save Document"):a.__("Close Document")})];d&&e.splice(1,0,n.Dialog.warnButton({label:a.__("Close without saving"),ariaLabel:a.__("Close Document without saving")}));const t=await(0,n.showDialog)({title:a.__("Confirmation"),body:a.__('Please confirm you want to close "%1".',h),checkbox:d?null:{label:a.__("Do not ask me again."),caption:a.__("If checked, no confirmation to close a document will be asked in the future.")},buttons:e});return t.isChecked&&(this.confirmClosingDocument=!1),Promise.resolve([t.button.accept,!d||"warn"===t.button.displayType])}{if(!d)return Promise.resolve([!0,!0]);const e=(null===(i=r.contentsModel)||void 0===i?void 0:i.writable)?a.__("Save"):a.__("Save as"),t=await(0,n.showDialog)({title:a.__("Save your work"),body:a.__('Save changes in "%1" before closing?',h),buttons:[n.Dialog.cancelButton(),n.Dialog.warnButton({label:a.__("Discard"),ariaLabel:a.__("Discard changes to file")}),n.Dialog.okButton({label:e})]});return[t.button.accept,"warn"===t.button.displayType]}}_widgetDisposed(e){const t=y.contextProperty.get(e);if(!t)return;const s=y.widgetsProperty.get(t);s&&(_.ArrayExt.removeFirstOf(s,e),s.length||t.dispose())}_onWidgetDisposed(e){y.disposablesProperty.get(e).dispose()}_onFileChanged(e){const t=y.widgetsProperty.get(e);for(const e of t)this.setCaption(e)}_onPathChanged(e){const t=y.widgetsProperty.get(e);for(const e of t)this.setCaption(e)}}!function(e){e.contextProperty=new m.AttachedProperty({name:"context",create:()=>{}}),e.factoryProperty=new m.AttachedProperty({name:"factory",create:()=>{}}),e.widgetsProperty=new m.AttachedProperty({name:"widgets",create:()=>[]}),e.disposablesProperty=new m.AttachedProperty({name:"disposables",create:()=>new D.DisposableSet})}(y||(y={}));class M{constructor(e){var t;this._activateRequested=new v.Signal(this),this._contexts=[],this._isDisposed=!1,this._autosave=!0,this._autosaveInterval=120,this._lastModifiedCheckMargin=500,this._renameUntitledFileOnSave=!0,this._stateChanged=new v.Signal(this),this.translator=e.translator||o.nullTranslator,this.registry=e.registry,this.services=e.manager,this._dialogs=null!==(t=e.sessionDialogs)&&void 0!==t?t:new n.SessionContextDialogs({translator:e.translator}),this._isConnectedCallback=e.isConnectedCallback||(()=>!0),this._opener=e.opener,this._when=e.when||e.manager.ready;const s=new b({registry:this.registry,translator:this.translator,recentsManager:e.recentsManager});s.activateRequested.connect(this._onActivateRequested,this),s.stateChanged.connect(this._onWidgetStateChanged,this),this._widgetManager=s,this._setBusy=e.setBusy}get activateRequested(){return this._activateRequested}get autosave(){return this._autosave}set autosave(e){if(this._autosave!==e){const t=this._autosave;this._autosave=e,this._contexts.forEach(t=>{const s=w.saveHandlerProperty.get(t);s&&(!0!==e||s.isActive?!1===e&&s.isActive&&s.stop():s.start())}),this._stateChanged.emit({name:"autosave",oldValue:t,newValue:e})}}get autosaveInterval(){return this._autosaveInterval}set autosaveInterval(e){if(this._autosaveInterval!==e){const t=this._autosaveInterval;this._autosaveInterval=e,this._contexts.forEach(t=>{const s=w.saveHandlerProperty.get(t);s&&(s.saveInterval=e||120)}),this._stateChanged.emit({name:"autosaveInterval",oldValue:t,newValue:e})}}get confirmClosingDocument(){return this._widgetManager.confirmClosingDocument}set confirmClosingDocument(e){if(this._widgetManager.confirmClosingDocument!==e){const t=this._widgetManager.confirmClosingDocument;this._widgetManager.confirmClosingDocument=e,this._stateChanged.emit({name:"confirmClosingDocument",oldValue:t,newValue:e})}}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){if(this._lastModifiedCheckMargin!==e){const t=this._lastModifiedCheckMargin;this._lastModifiedCheckMargin=e,this._contexts.forEach(t=>{t.lastModifiedCheckMargin=e}),this._stateChanged.emit({name:"lastModifiedCheckMargin",oldValue:t,newValue:e})}}get renameUntitledFileOnSave(){return this._renameUntitledFileOnSave}set renameUntitledFileOnSave(e){if(this._renameUntitledFileOnSave!==e){const t=this._renameUntitledFileOnSave;this._renameUntitledFileOnSave=e,this._stateChanged.emit({name:"renameUntitledFileOnSave",oldValue:t,newValue:e})}}get stateChanged(){return this._stateChanged}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,v.Signal.clearData(this),this._contexts.forEach(e=>this._widgetManager.closeWidgets(e)),this._widgetManager.dispose(),this._contexts.length=0)}cloneWidget(e){return this._widgetManager.cloneWidget(e)}closeAll(){return Promise.all(this._contexts.map(e=>this._widgetManager.closeWidgets(e))).then(()=>{})}closeFile(e){const t=this._contextsForPath(e).map(e=>this._widgetManager.closeWidgets(e));return Promise.all(t).then(e=>{})}contextForWidget(e){return this._widgetManager.contextForWidget(e)}copy(e,t){return this.services.contents.copy(e,t)}createNew(e,t="default",s){return this._createOrOpenDocument("create",e,t,s)}deleteFile(e){return this.services.sessions.stopIfNeeded(e).then(()=>this.services.contents.delete(e)).then(()=>(this._contextsForPath(e).forEach(e=>this._widgetManager.deleteWidgets(e)),Promise.resolve(void 0)))}duplicate(e){const t=a.PathExt.dirname(e);return this.services.contents.copy(e,t)}findWidget(e,t="default"){const s=a.PathExt.normalize(e);let i=[t];if("default"===t){const e=this.registry.defaultWidgetFactory(s);if(!e)return;i=[e.name]}else null===t&&(i=this.registry.preferredWidgetFactories(s).map(e=>e.name));for(const e of this._contextsForPath(s))for(const t of i)if(null!==t){const s=this._widgetManager.findWidget(e,t);if(s)return s}}newUntitled(e){return"file"===e.type&&(e.ext=e.ext||".txt"),this.services.contents.newUntitled(e)}open(e,t="default",s,i){return this._createOrOpenDocument("open",e,t,s,i)}openOrReveal(e,t="default",s,i){const n=this.findWidget(e,t);return n?(this._opener.open(n,{type:t,...i}),n):this.open(e,t,s,null!=i?i:{})}overwrite(e,t){const s=`${t}.${p.UUID.uuid4()}`,i=()=>this.rename(s,t);return this.rename(e,s).then(()=>this.deleteFile(t)).then(i,i)}rename(e,t){return this.services.contents.rename(e,t)}_findContext(e,t){const s=this.services.contents.normalize(e);return(0,_.find)(this._contexts,e=>e.path===s&&e.factoryName===t)}_contextsForPath(e){const t=this.services.contents.normalize(e);return this._contexts.filter(e=>e.path===t)}_createContext(e,t,s,i){const n=new g.Context({opener:(e,t)=>{this._widgetManager.adoptWidget(n,e),this._opener.open(e,t)},manager:this.services,factory:t,path:e,kernelPreference:s,setBusy:this._setBusy,sessionDialogs:this._dialogs,lastModifiedCheckMargin:this._lastModifiedCheckMargin,translator:this.translator,contentProviderId:i}),a=new f({context:n,isConnectedCallback:this._isConnectedCallback,saveInterval:this.autosaveInterval});return w.saveHandlerProperty.set(n,a),n.ready.then(()=>{this.autosave&&a.start()}),n.disposed.connect(this._onContextDisposed,this),this._contexts.push(n),n}_onContextDisposed(e){_.ArrayExt.removeFirstOf(this._contexts,e)}_widgetFactoryFor(e,t){const{registry:s}=this;if("default"===t){const i=s.defaultWidgetFactory(e);if(!i)return;t=i.name}return s.getWidgetFactory(t)}_createOrOpenDocument(e,t,s="default",i,n){const a=this._widgetFactoryFor(t,s);if(!a)return;const o=a.modelName||"text",r=this.registry.getModelFactory(o);if(!r)return;const l=this.registry.getKernelPreference(t,a.name,i);let h,c=Promise.resolve(void 0);if("open"===e)h=this._findContext(t,r.name)||null,h||(h=this._createContext(t,r,l,a.contentProviderId),c=this._when.then(()=>h.initialize(!1)));else{if("create"!==e)throw new Error(`Invalid argument 'which': ${e}`);h=this._createContext(t,r,l,a.contentProviderId),c=this._when.then(()=>h.initialize(!0))}const d=this._widgetManager.createWidget(a,h);return this._opener.open(d,{type:a.name,...n}),c.catch(e=>{console.error(`Failed to initialize the context with '${r.name}' for ${t}`,e),d.close()}),d}_onActivateRequested(e,t){this._activateRequested.emit(t)}_onWidgetStateChanged(e,t){"confirmClosingDocument"===t.name&&this._stateChanged.emit(t)}}!function(e){e.saveHandlerProperty=new m.AttachedProperty({name:"saveHandler",create:()=>{}})}(w||(w={}));var x=s(43154),E=s(64530),P=s(95870),T=s.n(P);function R(e){return T().createElement(x.TextItem,{source:e.name,title:e.fullPath})}class S extends E.VDomRenderer{constructor(e){super(new S.Model(e.docManager)),this.node.title=this.model.path}render(){return T().createElement(R,{fullPath:this.model.path,name:this.model.name})}}function k(e){return T().createElement(x.TextItem,{source:e.fileStatus})}!function(e){class t extends E.VDomModel{constructor(e){super(),this._onTitleChange=e=>{const t=this._getAllState();this._name=e.label,this._triggerChange(t,this._getAllState())},this._onPathChange=(e,t)=>{const s=this._getAllState();this._path=t,this._name=a.PathExt.basename(t),this._triggerChange(s,this._getAllState())},this._path="",this._name="",this._widget=null,this._docManager=e}get path(){return this._path}get name(){return this._name}get widget(){return this._widget}set widget(e){const t=this._widget;if(null!==t){const e=this._docManager.contextForWidget(t);e?e.pathChanged.disconnect(this._onPathChange):t.title.changed.disconnect(this._onTitleChange)}const s=this._getAllState();if(this._widget=e,null===this._widget)this._path="",this._name="";else{const e=this._docManager.contextForWidget(this._widget);e?(this._path=e.path,this._name=a.PathExt.basename(e.path),e.pathChanged.connect(this._onPathChange)):(this._path="",this._name=this._widget.title.label,this._widget.title.changed.connect(this._onTitleChange))}this._triggerChange(s,this._getAllState())}_getAllState(){return[this._path,this._name]}_triggerChange(e,t){e[0]===t[0]&&e[1]===t[1]||this.stateChanged.emit(void 0)}}e.Model=t}(S||(S={}));class A extends E.VDomRenderer{constructor(e){super(new A.Model(e.docManager));const t=(e.translator||o.nullTranslator).load("jupyterlab");this._statusMap={completed:t.__("Saving completed"),started:t.__("Saving started"),failed:t.__("Saving failed")}}render(){return null===this.model||null===this.model.status?null:T().createElement(k,{fileStatus:this._statusMap[this.model.status]})}}!function(e){class t extends E.VDomModel{constructor(e){super(),this._onStatusChange=(e,t)=>{this._status=t,"completed"===this._status?(setTimeout(()=>{this._status=null,this.stateChanged.emit(void 0)},2e3),this.stateChanged.emit(void 0)):this.stateChanged.emit(void 0)},this._status=null,this._widget=null,this._status=null,this.widget=null,this._docManager=e}get status(){return this._status}get widget(){return this._widget}set widget(e){var t,s;const i=this._widget;if(null!==i){const e=this._docManager.contextForWidget(i);e?e.saveState.disconnect(this._onStatusChange):(null===(t=this._widget.content)||void 0===t?void 0:t.saveStateChanged)&&this._widget.content.saveStateChanged.disconnect(this._onStatusChange)}if(this._widget=e,null===this._widget)this._status=null;else{const e=this._docManager.contextForWidget(this._widget);e?e.saveState.connect(this._onStatusChange):(null===(s=this._widget.content)||void 0===s?void 0:s.saveStateChanged)&&this._widget.content.saveStateChanged.connect(this._onStatusChange)}}}e.Model=t}(A||(A={}));const F=new p.Token("@jupyterlab/docmanager:IDocumentManager","A service for the manager for all\n  documents used by the application. Use this if you want to open and close documents,\n  create and delete files, and otherwise interact with the file system."),I=new p.Token("@jupyterlab/docmanager:IDocumentWidgetOpener","A service to open a widget."),N=new p.Token("@jupyterlab/docmanager:IRecentsManager","A service providing information about recently opened and closed documents");var O,W=s(86049);class L{constructor(e){this._recentsChanged=new v.Signal(this),this._recents={opened:[],closed:[]},this._isDisposed=!1,this._maxRecentsLength=10,this._saveDebouncer=new W.Debouncer(this._save.bind(this),500),this._stateDB=e.stateDB,this._contentsManager=e.contents,this.updateRootDir(),this._loadRecents().catch(e=>{console.error(`Failed to load recent list from state:\n${e}`)})}get isDisposed(){return this._isDisposed}get recentlyOpened(){return(this._recents.opened||[]).filter(e=>e.root===this._serverRoot)}get recentlyClosed(){return(this._recents.closed||[]).filter(e=>e.root===this._serverRoot)}get changed(){return this._recentsChanged}get maximalRecentsLength(){return this._maxRecentsLength}set maximalRecentsLength(e){this._maxRecentsLength=Math.round(Math.max(1,e));let t=!1;for(const e of["opened","closed"])this._recents[e].length>this._maxRecentsLength&&(this._recents[e].length=this._maxRecentsLength,t=!0);t&&this._recentsChanged.emit(void 0)}dispose(){this.isDisposed||(this._isDisposed=!0,v.Signal.clearData(this),this._saveDebouncer.dispose())}addRecent(e,t){const s={...e,root:this._serverRoot},i=this._recents[t],n=i.findIndex(t=>t.path===e.path);n>=0&&i.splice(n,1),i.unshift(s),this._setRecents(i,t),this._recentsChanged.emit(void 0)}clearRecents(){this._setRecents([],"opened"),this._setRecents([],"closed"),this._recentsChanged.emit(void 0)}removeRecent(e,t){this._removeRecent(e.path,[t])}async validate(e){const t=await this._isValid(e);return t||this._removeRecent(e.path),t}updateRootDir(){this._serverRoot=a.PageConfig.getOption("serverRoot")}_removeRecent(e,t=["opened","closed"]){let s=!1;for(const i of t){const t=this._recents[i],n=t.filter(t=>e!==t.path);t.length!==n.length&&(this._setRecents(n,i),s=!0)}s&&this._recentsChanged.emit(void 0)}async _isValid(e){var t;try{await this._contentsManager.get(e.path,{content:!1})}catch(e){if(404===(null===(t=e.response)||void 0===t?void 0:t.status))return!1}return!0}_setRecents(e,t){this._recents[t]=e.slice(0,this.maximalRecentsLength).sort((e,t)=>e.root===t.root?0:e.root!==this._serverRoot?1:-1),this._saveDebouncer.invoke().catch(console.warn)}async _loadRecents(){const e=await this._stateDB.fetch(O.stateDBKey)||{opened:[],closed:[]},t=[...e.opened,...e.closed],s=new Set(await this._getInvalidPaths(t));for(const t of["opened","closed"])this._setRecents(e[t].filter(e=>!s.has(e.path)),t);this._recentsChanged.emit(void 0)}async _getInvalidPaths(e){return(await Promise.all(e.map(async e=>await this._isValid(e)?null:e.path))).filter(e=>"string"==typeof e)}async _save(){try{await this._stateDB.save(O.stateDBKey,this._recents)}catch(e){console.log("Saving recents failed",e)}}}!function(e){e.stateDBKey="docmanager:recents"}(O||(O={}))},86049:(e,t,s)=>{s.r(t),s.d(t,{Debouncer:()=>l,Poll:()=>o,RateLimiter:()=>r,Throttler:()=>h});var i,n=s(68211),a=s(30427);class o{constructor(e){var t;this._disposed=new a.Signal(this),this._lingered=0,this._tick=new n.PromiseDelegate,this._ticked=new a.Signal(this),this._factory=e.factory,this._linger=null!==(t=e.linger)&&void 0!==t?t:i.DEFAULT_LINGER,this._standby=e.standby||i.DEFAULT_STANDBY,this._state={...i.DEFAULT_STATE,timestamp:(new Date).getTime()};const s=e.frequency||{},o=Math.max(s.interval||0,s.max||0,i.DEFAULT_FREQUENCY.max);this.frequency={...i.DEFAULT_FREQUENCY,...s,max:o},this.name=e.name||i.DEFAULT_NAME,"auto"in e&&!e.auto||setTimeout(()=>this.start())}get disposed(){return this._disposed}get frequency(){return this._frequency}set frequency(e){if(this.isDisposed||n.JSONExt.deepEqual(e,this.frequency||{}))return;let{backoff:t,interval:s,max:i}=e;if(s=Math.round(s),i=Math.round(i),"number"==typeof t&&t<1)throw new Error("Poll backoff growth factor must be at least 1");if((s<0||s>i)&&s!==o.NEVER)throw new Error("Poll interval must be between 0 and max");if(i>o.MAX_INTERVAL&&i!==o.NEVER)throw new Error(`Max interval must be less than ${o.MAX_INTERVAL}`);this._frequency={backoff:t,interval:s,max:i}}get isDisposed(){return"disposed"===this.state.phase}get standby(){return this._standby}set standby(e){this.isDisposed||this.standby===e||(this._standby=e)}get state(){return this._state}get tick(){return this._tick.promise}get ticked(){return this._ticked}async*[Symbol.asyncIterator](){for(;!this.isDisposed;)yield this.state,await this.tick.catch(()=>{})}dispose(){this.isDisposed||(this._state={...i.DISPOSED_STATE,timestamp:(new Date).getTime()},this._tick.promise.catch(e=>{}),this._tick.reject(new Error(`Poll (${this.name}) is disposed.`)),this._disposed.emit(void 0),a.Signal.clearData(this))}refresh(){return this.schedule({cancel:({phase:e})=>"refreshed"===e,interval:o.IMMEDIATE,phase:"refreshed"})}async schedule(e={}){if(this.isDisposed)return;if(e.cancel&&e.cancel(this.state))return;const t=this._tick,s=new n.PromiseDelegate,i={interval:this.frequency.interval,payload:null,phase:"standby",timestamp:(new Date).getTime(),...e};this._state=i,this._tick=s,clearTimeout(this._timeout),this._ticked.emit(this.state),t.resolve(this),await t.promise,i.interval!==o.NEVER?this._timeout=setTimeout(()=>{this.isDisposed||this.tick!==s.promise||this._execute()},i.interval):this._timeout=void 0}start(){return this.schedule({cancel:({phase:e})=>"constructed"!==e&&"standby"!==e&&"stopped"!==e,interval:o.IMMEDIATE,phase:"started"})}stop(){return this.schedule({cancel:({phase:e})=>"stopped"===e,interval:o.NEVER,phase:"stopped"})}get hidden(){return i.hidden}_execute(){let e="function"==typeof this.standby?this.standby():this.standby;if("never"===e?e=!1:"when-hidden"===e&&(this.hidden?e=++this._lingered>this._linger:(this._lingered=0,e=!1)),e)return void this.schedule();const t=this.tick;this._factory(this.state).then(e=>{this.isDisposed||this.tick!==t||this.schedule({payload:e,phase:"rejected"===this.state.phase?"reconnected":"resolved"})}).catch(e=>{this.isDisposed||this.tick!==t||this.schedule({interval:i.sleep(this.frequency,this.state),payload:e,phase:"rejected"})})}}!function(e){e.IMMEDIATE=0,e.MAX_INTERVAL=2147483647,e.NEVER=1/0}(o||(o={})),function(e){e.DEFAULT_BACKOFF=3,e.DEFAULT_FREQUENCY={backoff:!0,interval:1e3,max:3e4},e.DEFAULT_LINGER=1,e.DEFAULT_NAME="unknown",e.DEFAULT_STANDBY="when-hidden",e.DEFAULT_STATE={interval:o.NEVER,payload:null,phase:"constructed",timestamp:new Date(0).getTime()},e.DISPOSED_STATE={interval:o.NEVER,payload:null,phase:"disposed",timestamp:new Date(0).getTime()},e.sleep=function(t,s){const{backoff:i,interval:n,max:a}=t;if(n===o.NEVER)return n;const r=!0===i?e.DEFAULT_BACKOFF:!1===i?1:i,l=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}(n,s.interval*r);return Math.min(a,l)},e.hidden="undefined"!=typeof document&&(document.addEventListener("visibilitychange",()=>{e.hidden="hidden"===document.visibilityState}),document.addEventListener("pagehide",()=>{e.hidden="hidden"===document.visibilityState}),"hidden"===document.visibilityState)}(i||(i={}));class r{constructor(e,t=500){this.args=void 0,this.payload=null,this.limit=t,this.poll=new o({auto:!1,factory:async()=>{const{args:t}=this;return this.args=void 0,e(...t)},frequency:{backoff:!1,interval:o.NEVER,max:o.NEVER},standby:"never"}),this.payload=new n.PromiseDelegate,this.poll.ticked.connect((e,t)=>{const{payload:s}=this;return"resolved"===t.phase?(this.payload=new n.PromiseDelegate,void s.resolve(t.payload)):"rejected"===t.phase||"stopped"===t.phase?(this.payload=new n.PromiseDelegate,s.promise.catch(e=>{}),void s.reject(t.payload)):void 0},this)}get isDisposed(){return null===this.payload}dispose(){this.isDisposed||(this.args=void 0,this.payload=null,this.poll.dispose())}async stop(){return this.poll.stop()}}class l extends r{invoke(...e){return this.args=e,this.poll.schedule({interval:this.limit,phase:"invoked"}),this.payload.promise}}class h extends r{constructor(e,t){super(e,"number"==typeof t?t:t&&t.limit),this._trailing=!1,"number"!=typeof t&&t&&"trailing"===t.edge&&(this._trailing=!0),this._interval=this._trailing?this.limit:o.IMMEDIATE}invoke(...e){const t="invoked"!==this.poll.state.phase;return(t||this._trailing)&&(this.args=e),t&&this.poll.schedule({interval:this._interval,phase:"invoked"}),this.payload.promise}}}}]);
"use strict";(self.webpackChunk_jupytercad_jupytercad_lab=self.webpackChunk_jupytercad_jupytercad_lab||[]).push([[484],{484:(e,t,a)=>{a.r(t),a.d(t,{default:()=>f});var o=a(209),r=a(367),n=a(201),d=a(630),i=a(517),s=a(690),l=a(498),c=a(436),u=a(230),g=a(256),h=a(173),p=a(428),y=a(397),m=a(980),C=a(10);const M="@jupytercad/jupytercad-core:jupytercad-settings";class j extends h.JupyterYModel{}class k extends g.Panel{constructor(e){super(),this.onResize=()=>{this._jcadWidget&&u.MessageLoop.sendMessage(this._jcadWidget,g.Widget.ResizeMessage.UnknownSize)},this._buildWidget=e=>{const{commands:t,workerRegistry:a,model:r,externalCommands:n,tracker:d}=e,i=new o.JupyterCadPanel({model:r,workerRegistry:a});let s;r.filePath&&(s=new o.ToolbarWidget({commands:t,model:r,externalCommands:(null==n?void 0:n.getCommands())||[]})),this._jcadWidget=new o.JupyterCadOutputWidget({model:r,content:i,toolbar:s}),this.addWidget(this._jcadWidget),null==d||d.add(this._jcadWidget)};const{model:t}=e;this.addClass("jupytercad-notebook-widget"),this._buildWidget(e),t.sharedModel.changed.connect((t,a)=>{a.stateChange&&a.stateChange.forEach(t=>{var a;"path"===t.name&&(null===(a=this.layout)||void 0===a||a.removeWidget(this._jcadWidget),this._jcadWidget.dispose(),this._buildWidget(e))})})}get jcadWidget(){return this._jcadWidget}}const W={id:"jupytercad:yjswidget-plugin",autoStart:!0,requires:[r.IJCadWorkerRegistryToken],optional:[r.IJCadExternalCommandRegistryToken,r.IJupyterCadDocTracker,h.IJupyterYWidgetManager,l.ICollaborativeDrive,C.ISettingRegistry],activate:async(e,t,a,o,n,d,i)=>{let s=null;if(i)try{s=await i.load(M),console.log(`Loaded settings for ${M}`,s)}catch(e){console.warn(`Failed to load settings for ${M}`,e)}n?n.registerWidget("@jupytercad:widget",class extends j{async initialize(t){const{path:a,format:o,contentType:n}=t,s=o;if(!d)throw(0,c.showErrorMessage)("Error using the JupyterCAD Python API","You cannot use the JupyterCAD Python API without a collaborative drive. You need to install a package providing collaboration features (e.g. jupyter-collaboration)."),new Error("Failed to create the YDoc without a collaborative drive");let l="";const u=e.shell.currentWidget;(u instanceof m.NotebookPanel||u instanceof p.ConsolePanel)&&(l=u.sessionContext.path);let g="";if(a){g=y.PathExt.join(y.PathExt.dirname(l),a);try{await e.serviceManager.contents.get(g)}catch(t){await e.serviceManager.contents.save(g,{content:btoa("{}"),format:"base64"})}}else g=y.PathExt.join(y.PathExt.dirname(l),"unsaved_project");const C=d.sharedModelFactory.createNew({path:g,format:s,contentType:n,collaborative:!0});this.jupyterCADModel=new r.JupyterCadModel({sharedModel:C,settingRegistry:i}),this.jupyterCADModel.contentsManager=e.serviceManager.contents,this.jupyterCADModel.filePath=g,this.ydoc=this.jupyterCADModel.sharedModel.ydoc,this.sharedModel=new h.JupyterYDoc(t,this.ydoc)}},class{constructor(r,n){this.yModel=r,this.node=n;const d=new k({commands:e.commands,externalCommands:a,model:r.jupyterCADModel,workerRegistry:t,tracker:o});u.MessageLoop.sendMessage(d,g.Widget.Msg.BeforeAttach),n.appendChild(d.node),u.MessageLoop.sendMessage(d,g.Widget.Msg.AfterAttach)}}):console.error("Missing IJupyterYWidgetManager token!")}};var v=a(590);const w="jupytercad",f=[{id:"jupytercad:lab:main-menu",autoStart:!0,requires:[r.IJupyterCadDocTracker,r.IJCadFormSchemaRegistryToken,r.IJCadWorkerRegistryToken],optional:[i.IMainMenu,s.ITranslator,d.ICompletionProviderManager],activate:(e,t,a,r,n,d,i)=>{console.log("jupytercad:lab:main-menu is activated!"),d=null!=d?d:s.nullTranslator;(0,o.addCommands)(e,t,d,a,r,i),n&&function(e,t){e.fileMenu.addItem({command:o.CommandIDs.exportJcad}),e.editMenu.undoers.redo.add({id:o.CommandIDs.redo,isEnabled:t}),e.editMenu.undoers.undo.add({id:o.CommandIDs.undo,isEnabled:t})}(n,()=>null!==t.currentWidget&&t.currentWidget===e.shell.currentWidget)}},{id:"jupytercad:lab:controlpanel",autoStart:!0,requires:[n.ILayoutRestorer,r.IJupyterCadDocTracker,r.IAnnotationToken,r.IJCadFormSchemaRegistryToken],optional:[l.ICollaborativeDrive,v.IForkManagerToken],activate:(e,t,a,r,n,d,i)=>{const s=new o.ControlPanelModel({tracker:a}),l=new o.LeftPanelWidget({model:s,tracker:a,formSchemaRegistry:n});l.id="jupytercad::leftControlPanel",l.title.caption="JupyterCad Control Panel",l.title.icon=o.logoIcon;const c=new o.RightPanelWidget({model:s,tracker:a,annotationModel:r,forkManager:i,collaborativeDrive:d});c.id="jupytercad::rightControlPanel",c.title.caption="JupyterCad Control Panel",c.title.icon=o.logoIcon,t&&(t.add(l,`${w}-left`),t.add(c,`${w}-right`)),e.shell.add(l,"left",{rank:2e3}),e.shell.add(c,"right",{rank:2e3,activate:!1})}},W]}}]);
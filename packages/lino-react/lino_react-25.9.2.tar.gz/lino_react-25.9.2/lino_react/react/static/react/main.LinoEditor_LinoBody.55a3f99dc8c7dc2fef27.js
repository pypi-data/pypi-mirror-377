"use strict";(self.webpackChunklino_react=self.webpackChunklino_react||[]).push([[5375],{2983:(e,t,n)=>{n.r(t),n.d(t,{LinoEditor:()=>A,name:()=>k});var a=n(467),l=n(4467),r=n(3029),o=n(2901),i=n(6822),s=n(5501),c=n(3954),u=n(991),m=n(4756),d=n.n(m),p=n(6540),f=n(6606),b=n(7970),g=n(2756);n(1151);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,l.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(y=function(){return!!e})()}function h(e,t,n,a){var l=(0,u.A)((0,c.A)(1&a?e.prototype:e),t,n);return 2&a&&"function"==typeof l?function(e){return l.apply(n,e)}:l}var q,k="LinoEditor";q={AbortController:n.e(4166).then(n.t.bind(n,5568,23)),prButton:Promise.all([n.e(1927),n.e(5573),n.e(7335),n.e(9685),n.e(7801)]).then(n.bind(n,9119)),prEditor:Promise.all([n.e(8026),n.e(5573)]).then(n.bind(n,5937)),prDialog:Promise.all([n.e(6190),n.e(5573),n.e(7335),n.e(6836),n.e(1960)]).then(n.bind(n,2955)),i18n:Promise.all([n.e(1304),n.e(8605),n.e(7211)]).then(n.bind(n,2292))};(0,f.RegisterImportPool)(q);var A=function(e){function t(e){var n,a,l,o;return(0,r.A)(this,t),a=this,l=t,o=[e],l=(0,c.A)(l),(n=(0,i.A)(a,y()?Reflect.construct(l,o||[],(0,c.A)(a).constructor):l.apply(a,o))).state=v(v({},n.state),{},{plain:"plain"===e.elem.field_options.format}),n.closeEditor=n.closeEditor.bind(n),n.onGlobalKeyDown=n.onGlobalKeyDown.bind(n),n}return(0,s.A)(t,e),(0,o.A)(t,[{key:"prepare",value:(n=(0,a.A)(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h(t,"prepare",this,3)([]);case 2:this.controller=new this.ex.AbortController.default,this.ex.i18n=this.ex.i18n.default;case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"onReady",value:function(){window.addEventListener("keydown",this.onGlobalKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.onGlobalKeyDown)}},{key:"onGlobalKeyDown",value:function(e){"Escape"==e.code&&this.closeEditor(e)}},{key:"closeEditor",value:function(e){var t=this.c,n=function(){t.history.pushPath({pathname:"/api/".concat(t.value.packId,"/").concat(t.value.actorId,"/").concat(t.value.pk),params:t.actionHandler.defaultStaticParams()})};t.isModified()?t.actionHandler.discardModDConfirm({agree:n}):n()}},{key:"headerExtend",value:function(){var e=this;return p.createElement(p.Fragment,null,b.PH.commonHeader(this),p.createElement("span",{className:"ql-formats"},p.createElement("button",{type:"button",onClick:function(t){return e.c.actionHandler.submit({})},"aria-label":"Submit changes"},p.createElement("i",{className:"pi pi-save"})),p.createElement("button",{type:"button",onClick:this.closeEditor,"aria-label":"Close window"},p.createElement("i",{className:"pi pi-times"}))))}},{key:"render",value:function(){var e=this;return this.state.ready?p.createElement(f.URLContextType.Consumer,null,(function(t){var n=t.controller.APP,a=(0,b.tA)(n,t.controller.actionHandler.silentFetch,t.controller.signal,t.controller.mentionValues);return p.createElement("div",{className:"l-editor",spellCheck:!n.state.site_data.disable_spell_check,onKeyDown:function(t){(t.ctrlKey||t.metaKey)&&"KeyS"===t.code?(t.stopPropagation(),t.preventDefault(),e.c.actionHandler.submit({})):t.ctrlKey&&t.shiftKey&&"KeyL"==t.code?(t.stopPropagation(),t.preventDefault(),(0,b.TY)(e)):"Escape"!==t.code&&t.stopPropagation()}},p.createElement(e.ex.prEditor.Editor,{headerTemplate:e.headerExtend(),modules:a,onLoad:function(t){e.quill=e.inputEl.getQuill(),(0,b.a7)(e,e.quill),(0,b.kA)(e.quill)},onTextChange:function(t){return(0,b.xB)(e,t)},ref:function(t){return e.inputEl=t},style:{background:"#ffffff"},value:e.context.data[t.fieldName]}))})):null}}]);var n}(g.LeafComponentInput);A.requiredModules=["AbortController","prButton","prEditor","prDialog","i18n"].concat(g.LeafComponentInput.requiredModules),A.iPool=Object.assign(q,g.LeafComponentInput.iPool.copy())},7970:(e,t,n)=>{n.d(t,{PH:()=>q,TY:()=>y,Zn:()=>h,a7:()=>d,kA:()=>b,tA:()=>f,xB:()=>p});var a=n(4467),l=n(296),r=(n(1480),n(8162),n(2047)),o=n(537),i=n(194),s=n(6540),c=n(6606);n(5065);r.default.register("modules/imageDropAndPaste",o.A),r.default.register("modules/blotFormatter2",i.Ay);var u,m=o.A.ImageData;u={queryString:Promise.all([n.e(4166),n.e(2298)]).then(n.bind(n,8091))};(0,c.RegisterImportPool)(u);var d=function(e,t){t.keyboard.addBinding({key:"Home"},(function(e,n){var a=t.getLine(e.index),r=(0,l.A)(a,2),o=r[0];r[1];return!o||"LI"!==o.domNode.tagName||(t.setSelection(o.offset(t.scroll),0,"user"),!1)}))},p=function(e,t){console.log("onTextChange",t);var n=t.textValue.slice(0,-1),l=(e.state.plain?n:t.htmlValue)||"";e.update((0,a.A)({},e.dataKey,l))},f=function(e,t,n,a){var l={mention:E({silentFetch:t,signal:n,mentionValues:a}),blotFormatter2:{debug:!0}};return e.state.site_data.installed_plugins.includes("uploads")&&(l.imageDropAndPaste={handler:g}),l},b=function(e){!function(e){u.quill=e}(e),e.getModule("toolbar").addHandler("image",(function(e){var t;e&&((t=document.createElement("input")).setAttribute("type","file"),t.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),t.classList.add("ql-image"),t.addEventListener("change",(function(e){var n,a=e.target.files;if(a.length>0){var l=(n=a[0]).type,r=new FileReader;r.onload=function(e){var a=e.target.result;g(a,l,new m(a,l,n.name)),t.value=""},r.readAsDataURL(n)}})),t.click())}))},g=function(e,t,n){var a=u.quill,l=(a.getSelection()||{}).index;(void 0===l||l<0)&&(l=a.getLength()),a.insertEmbed(l,"image",e)},E=function(e){var t=e.silentFetch,n=e.signal,a=e.mentionValues;return{allowedChars:/^[A-Za-z0-9\s]*$/,mentionDenotationChars:window.App.state.site_data.suggestors,source:function(e,l,r){if(0===e.length){var o=a[r];l(o,e)}else u.resolve(["queryString"]).then((function(a){var o=a.queryString;t({path:"suggestions?".concat(o.default.stringify({query:e,trigger:r})),signal:n}).then((function(t){return l(t.suggestions,e)}))}))},listItemClass:"ql-mention-list-item",mentionContainerClass:"ql-mention-list-container",mentionListClass:"ql-mention-list",dataAttributes:["value","link","title","denotationChar"]}},v=s.createElement(s.Fragment,null,s.createElement("span",{className:"ql-formats"},s.createElement("select",{className:"ql-header",defaultValue:"0"},s.createElement("option",{value:"1"},"Heading"),s.createElement("option",{value:"2"},"Subheading"),s.createElement("option",{value:"0"},"Normal")),s.createElement("select",{className:"ql-font"},s.createElement("option",{defaultValue:!0}),s.createElement("option",{value:"serif"}),s.createElement("option",{value:"monospace"}))),s.createElement("span",{className:"ql-formats"},s.createElement("select",{className:"ql-size"},s.createElement("option",{value:"small"}),s.createElement("option",{defaultValue:!0}),s.createElement("option",{value:"large"}),s.createElement("option",{value:"huge"}))),s.createElement("span",{className:"ql-formats"},s.createElement("button",{className:"ql-script",value:"sub"}),s.createElement("button",{className:"ql-script",value:"super"})),s.createElement("span",{className:"ql-formats"},s.createElement("button",{type:"button",className:"ql-bold","aria-label":"Bold"}),s.createElement("button",{type:"button",className:"ql-italic","aria-label":"Italic"}),s.createElement("button",{type:"button",className:"ql-underline","aria-label":"Underline"})),s.createElement("span",{className:"ql-formats"},s.createElement("select",{className:"ql-color"}),s.createElement("select",{className:"ql-background"})),s.createElement("span",{className:"ql-formats"},s.createElement("button",{type:"button",className:"ql-list",value:"ordered","aria-label":"Ordered List"}),s.createElement("button",{type:"button",className:"ql-list",value:"bullet","aria-label":"Unordered List"}),s.createElement("select",{className:"ql-align"},s.createElement("option",{defaultValue:!0}),s.createElement("option",{value:"center"}),s.createElement("option",{value:"right"}),s.createElement("option",{value:"justify"}))),s.createElement("span",{className:"ql-formats"},s.createElement("button",{type:"button",className:"ql-link","aria-label":"Insert Link"}),s.createElement("button",{type:"button",className:"ql-image","aria-label":"Insert Image"}),s.createElement("button",{type:"button",className:"ql-code-block","aria-label":"Insert Code Block"})),s.createElement("span",{className:"ql-formats"},s.createElement("button",{type:"button",className:"ql-clean","aria-label":"Remove Styles"}))),y=function(e){var t=e.props.urlParams.controller.APP.URLContext,n=(e.quill.getSelection()||{}).index;(void 0===n||n<0)&&(n=e.quill.getLength()),t.actionHandler.runAction({action_full_name:t.actionHandler.findUniqueAction("insert_reference").full_name,actorId:"about.About",response_callback:function(t){t.success&&e.quill.insertText(n,t.message)}})},h=function(e){return e.c.APP.state.site_data.installed_plugins.includes("memo")?s.createElement("span",{className:"ql-formats"},s.createElement("button",{type:"button",onClick:function(t){return y(e)},"aria-label":"Open link dialog"},s.createElement("i",{className:"pi pi-link"}))):null},q={header:v,commonHeader:function(e){return s.createElement(s.Fragment,null,v,h(e))}}}}]);
//# sourceMappingURL=main.LinoEditor_LinoBody.55a3f99dc8c7dc2fef27.js.map
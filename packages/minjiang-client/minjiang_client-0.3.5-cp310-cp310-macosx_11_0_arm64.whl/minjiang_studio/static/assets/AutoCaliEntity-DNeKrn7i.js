import{d as q,C as v,x as L,k as e,a2 as B,f as s,Y as oe,z as O,b as le,r as _,F as ie,e as E,h as $,i as u,a1 as ue,w as o,a3 as re,a4 as z,a5 as Q,p as ce,t as _e,a0 as T,aN as de,a6 as pe,J as Y,ab as fe,aQ as me,aU as M,ad as S,o as ve,b1 as ge}from"./index-J5_wuFzQ.js";import{d as ye,e as he,f as be}from"./autoCali-V979FCPC.js";import{_ as ke}from"./LogView.vue_vue_type_script_setup_true_lang-BpGNpv03.js";import{u as j}from"./useInterval-DNMuo5vf.js";import{u as xe}from"./autoCali-d2cqxQAW.js";import{a as H,b as P}from"./Tabs-CR38P_Kp.js";import"./dayjs.min-B00idBTO.js";import"./Add-C8P6H80E.js";import"./debounce-COzzVebV.js";const F=q({__name:"EntityLog",props:{logs:{}},setup(K){return(r,d)=>e(B)(r.logs)?L("",!0):(s(),v(ke,{key:0,logs:r.logs},null,8,["logs"]))}}),Ce={class:"flex ml-5"},J=120,Ne=q({__name:"EntitiesView",props:{entities:{}},setup(K){const r=xe(),d=oe(),N=O(),{t:R}=le(),p=_(),g=_(),a=_(0),b=_(),w=_(0),l=_(!1),i=_(),A=K,W=ie(()=>{const n=A.entities.length;return Array(n<J?J:n).fill(0).map((t,f)=>A.entities[f])}),X=n=>{n&&(i.value||(i.value=!0,p.value=n,g.value=[],b.value=[],a.value=0,w.value=0,l.value=!0,I.value==0?V():U()))},U=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await ye({session_id:+N.query.session_id,entity:p.value});i.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(w.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(b.value=[...b.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(w.value=(y=t.data)==null?void 0:y.last_record_id),M(()=>{var h,x;!G.value&&((h=r.sessionInfo)==null?void 0:h.status)===S.RUNNING&&Z(),((x=r.sessionInfo)==null?void 0:x.status)!==S.RUNNING&&(ee(),G.value&&U())}))},{start:Z,stop:ee,runing:G}=j(U,{isManual:!0,duration:3e3}),V=async()=>{var f,k,m,c,y;l.value=!0;const[n,t]=await he({session_id:+N.query.session_id,entity:p.value,last_record_id:a.value});i.value=!1,l.value=!1,!n&&(t==null?void 0:t.status)===0&&(a.value!==((f=t.data)==null?void 0:f.last_record_id)&&((k=t.data)!=null&&k.last_record_id)&&(g.value=[...g.value||[],...(m=t.data)==null?void 0:m.logs]),(c=t.data)!=null&&c.last_record_id&&(a.value=(y=t.data)==null?void 0:y.last_record_id),M(()=>{var h,x;!D.value&&((h=r.sessionInfo)==null?void 0:h.status)===S.RUNNING&&te(),((x=r.sessionInfo)==null?void 0:x.status)!==S.RUNNING&&(ae(),D.value&&V())}))},{start:te,stop:ae,runing:D}=j(V,{isManual:!0,duration:3e3}),I=_(0),se=n=>{I.value=n,p.value&&(n===0?V():U())};return(n,t)=>{const f=pe,k=re,m=ue,c=fe,y=me,h=P,x=H;return s(),E("div",Ce,[$("div",null,[u(m,{style:{height:"calc(100vh - 310px)"}},{default:o(()=>[u(k,{cols:10,style:{width:"560px"}},{default:o(()=>[(s(!0),E(z,null,Q(e(W),(C,ne)=>(s(),v(f,{key:ne,class:de(["border min-w-14 min-h-14 flex items-center justify-center p-1",[C?"cursor-pointer":""]]),style:T({borderColor:e(d).dividerColor,backgroundColor:e(p)===C&&e(p)?"#00B42A":"inherit",color:e(p)===C?"#fff":"inherit"}),onClick:()=>X(C)},{default:o(()=>[ce(_e(C),1)]),_:2},1032,["style","class","onClick"]))),128))]),_:1})]),_:1})]),u(x,{animated:"",class:"!h-full flex-1 !w-auto ml-8",value:e(I),"onUpdate:value":t[0]||(t[0]=C=>Y(I)?I.value=C:null),onUpdateValue:se},{default:o(()=>[u(h,{name:0,key:"0",tab:e(R)("groupDetail.autoCali.caliLog"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[u(m,{style:T({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(i)?(s(),v(c,{key:0})):(s(),E(z,{key:1},[u(F,{logs:e(g)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):L("",!0),e(B)(e(g))?(s(),v(y,{key:1,class:"mt-32"})):L("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"]),u(h,{name:1,key:"1",tab:e(R)("groupDetail.autoCali.caliRecord"),class:"!pl-0","display-directive":"show:lazy"},{default:o(()=>[u(m,{style:T({padding:"15px",height:"calc(100vh - 345px)",backgroundColor:e(d).baseColor})},{default:o(()=>[e(i)?(s(),v(c,{key:0})):(s(),E(z,{key:1},[u(F,{logs:e(b)},null,8,["logs"]),e(l)?(s(),v(c,{key:0})):L("",!0),e(B)(e(b))?(s(),v(y,{key:1,class:"mt-32"})):L("",!0)],64))]),_:1},8,["style"])]),_:1},8,["tab"])]),_:1},8,["value"])])}}}),Be=q({__name:"AutoCaliEntity",setup(K){const r=O(),d=_(),N=_(),R=async()=>{const[g,a]=await be({device_group_name:r.query.device_group_name,space_id:+r.query.space_id});!g&&(a==null?void 0:a.status)===0&&(N.value=a.data,d.value=Object.keys(a.data)[0])},p=()=>{};return ve(()=>{R()}),(g,a)=>{const b=P,w=H;return s(),E("div",null,[u(w,{type:"card",animated:"",size:"small",placement:"left",class:"!h-full !w-auto",value:e(d),"onUpdate:value":a[0]||(a[0]=l=>Y(d)?d.value=l:null),onUpdateValue:p,"tab-class":"w-[128px]"},ge({suffix:o(()=>[a[2]||(a[2]=$("div",null,null,-1))]),default:o(()=>[(s(!0),E(z,null,Q(e(N),(l,i)=>(s(),v(b,{name:i,key:i,tab:i},{default:o(()=>[u(Ne,{"active-key":i,entities:l},null,8,["active-key","entities"])]),_:2},1032,["name","tab"]))),128))]),_:2},[e(B)(e(N))?void 0:{name:"prefix",fn:o(()=>[a[1]||(a[1]=$("div",null,null,-1))]),key:"0"}]),1032,["value"])])}}});export{Be as default};

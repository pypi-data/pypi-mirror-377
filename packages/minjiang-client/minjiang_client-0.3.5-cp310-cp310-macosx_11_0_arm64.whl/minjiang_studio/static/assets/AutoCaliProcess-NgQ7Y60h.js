import{C as Y}from"./CommingSoon-D4lnxNbH.js";import{d as $,e as d,f as n,h,Y as H,b as J,z as Q,r as v,F as W,aL as X,a2 as j,aU as M,ad as Z,a4 as S,a5 as ee,x as z,a0 as F,k as e,i as f,t as y,w as R,p as I,a8 as g,a7 as te,j as se,N as oe,C as A,ab as ae,a1 as ne}from"./index-J5_wuFzQ.js";import{b as re,c as le}from"./autoCali-V979FCPC.js";import{u as P}from"./useInterval-DNMuo5vf.js";import{_ as ie}from"./LogView.vue_vue_type_script_setup_true_lang-BpGNpv03.js";import"./dayjs.min-B00idBTO.js";const ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},de=$({name:"ChevronDown",render:function(B,m){return n(),d("svg",ce,m[0]||(m[0]=[h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"48",d:"M112 184l144 144l144-144"},null,-1)]))}}),ue={class:"flex p-5"},_e={class:"pr-10"},fe=["onClick"],me={class:"flex-1 break-all"},pe={key:0,class:"flex items-center justify-between pt-2"},ve={class:"flex flex-1 items-center flex-col"},ge={key:0,class:"flex gap-2 items-center mb-5 text-lg"},Ce=$({__name:"AutoCaliProcess",setup(q){const B=H(),{t:m}=J(),U=Q(),k=v(),l=v(),i=W(()=>{var o;return(o=k.value)==null?void 0:o.find(a=>a.node_id===l.value)}),T=v(!1),c=v(),w=v(!1),p=v(0),N=async()=>{var u,_,x,r,b,s,C;T.value=!0;const o={node_id:l.value,session_id:+U.query.session_id,last_record_id:p.value},[a,t]=await re(o);w.value=!1,!a&&(t==null?void 0:t.status)===0&&(((_=(u=t.data)==null?void 0:u.logs)==null?void 0:_.find(G=>{if(typeof G.msg=="string")return G.msg.includes("COMPLETE")}))?(E(),p.value!==t.data.last_record_id&&t.data.last_record_id&&(c.value=[...c.value||[],...(x=t.data)==null?void 0:x.logs]),t.data.last_record_id&&(p.value=t.data.last_record_id),((r=i.value)==null?void 0:r.status)==="RUNNING"&&V()):(p.value!==t.data.last_record_id&&t.data.last_record_id&&(c.value=[...c.value||[],...(b=t.data)==null?void 0:b.logs]),t.data.last_record_id&&(p.value=t.data.last_record_id),!L.value&&((s=i.value)==null?void 0:s.status)==="RUNNING"&&D(),((C=i.value)==null?void 0:C.status)!=="RUNNING"&&L.value&&(E(),N()))),T.value=!1},V=async()=>{var t,u,_;const[o,a]=await le({session_id:+U.query.session_id});!o&&(a==null?void 0:a.status)===0&&(k.value=a.data,(t=a.data)!=null&&t.find(r=>r.node_id===l.value)||(l.value=(u=a.data[0])==null?void 0:u.node_id,M(()=>{N()})),(_=a.data)!=null&&_.find(r=>r.status=="RUNNING")||K())},{start:D,stop:E,runing:L}=P(N,{isManual:!0,duration:3e3}),{stop:K}=P(V,{duration:10*1e3});X(i,o=>{j(o)||M(()=>{o.status===Z.RUNNING&&!L.value&&D()})});const O=o=>{w.value||(w.value=!0,c.value=void 0,l.value=o,p.value=0,N())};return(o,a)=>{const t=te,u=se,_=oe,x=Y,r=ae,b=ne;return n(),d("div",ue,[h("div",_e,[(n(!0),d(S,null,ee(e(k),(s,C)=>(n(),d("div",{key:s.node_id,class:"cursor-pointer"},[h("div",{class:"px-2 pb-2 pt-2.5 w-full max-w-96 border text-center min-w-72 flex items-center",style:F({borderTopLeftRadius:"40px",borderBottomLeftRadius:"40px",borderTopRightRadius:"100px",borderBottomRightRadius:"100px",backgroundColor:e(l)===s.node_id?"rgba(0, 180, 42, 0.15)":"inherit",borderColor:e(l)===s.node_id?"rgb(0, 180, 42)":"#999A9B",color:e(l)===s.node_id?e(B).primaryColor:"inherit"}),onClick:()=>O(s.node_id)},[h("span",me,y(s.node_name),1),f(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full !w-20 !flex !items-center !justify-center",color:{color:e(g)[s.status].color}},{default:R(()=>[I(y(e(m)(e(g)[s.status].text)),1)]),_:2},1032,["color"])],12,fe),C<e(k).length-1?(n(),d("div",pe,[h("div",ve,[f(u,{class:"!h-10 !bg-[#999A9B]",vertical:""}),f(_,{class:"-mt-2",color:"#999A9B",component:e(de)},null,8,["component"])]),f(t,{size:"tiny",round:"",class:"!h-[22.4px] !rounded-full invisible !w-20",color:{color:e(g)[s.status].color}},{default:R(()=>[I(y(e(m)(e(g)[s.status].text)),1)]),_:2},1032,["color"])])):z("",!0)]))),128))]),h("div",{class:"border-l pl-10 flex-1",style:F({borderColor:e(B).dividerColor})},[f(b,{style:{height:"calc(100vh - 335px)"}},{default:R(()=>{var s;return[e(j)(e(i))?z("",!0):(n(),d("div",ge,[I(y((s=e(i))==null?void 0:s.node_name)+" ",1),f(t,{size:"tiny",color:{color:e(g)[e(i).status].color}},{default:R(()=>[I(y(e(m)(e(g)[e(i).status].text)),1)]),_:1},8,["color"])])),Array.isArray(e(c))&&e(c).length===0?(n(),A(x,{key:1,class:"h-full"})):(n(),d(S,{key:2},[e(w)?(n(),A(r,{key:1,show:""})):(n(),d(S,{key:0},[f(ie,{logs:e(c)},null,8,["logs"]),e(T)?(n(),A(r,{key:0,size:"medium"})):z("",!0)],64))],64))]}),_:1})],4)])}}});export{Ce as default};

import{d as E,e as y,f as d,h as o,b as Z,z as ee,r as c,aL as te,i as u,w as r,q as ae,B as ne,k as n,J as $,a4 as O,a5 as N,C as A,T as se,t as R,ab as oe,a1 as le,x as re,p as F,I as ie,aV as H,a2 as J,aU as ue,H as ce}from"./index-J5_wuFzQ.js";import{b as pe,d as de,e as _e,f as me}from"./task-B0ue0H1_.js";import{l as fe}from"./exp-CY-VG9oB.js";import{_ as ve}from"./DynamicForm.vue_vue_type_script_setup_true_lang-ERKaPvUp.js";import{a as ge,b as he}from"./Tabs-CR38P_Kp.js";const we={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},xe=E({name:"CloseCircleOutline",render:function(q,i){return d(),y("svg",we,i[0]||(i[0]=[o("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192s192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M320 320L192 192"},null,-1),o("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M192 320l128-128"},null,-1)]))}}),ye={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Ie=E({name:"Duplicate",render:function(q,i){return d(),y("svg",ye,i[0]||(i[0]=[o("path",{d:"M408 112H184a72 72 0 0 0-72 72v224a72 72 0 0 0 72 72h224a72 72 0 0 0 72-72V184a72 72 0 0 0-72-72zm-32.45 200H312v63.55c0 8.61-6.62 16-15.23 16.43A16 16 0 0 1 280 376v-64h-63.55c-8.61 0-16-6.62-16.43-15.23A16 16 0 0 1 216 280h64v-63.55c0-8.61 6.62-16 15.23-16.43A16 16 0 0 1 312 216v64h64a16 16 0 0 1 16 16.77c-.42 8.61-7.84 15.23-16.45 15.23z",fill:"currentColor"},null,-1),o("path",{d:"M395.88 80A72.12 72.12 0 0 0 328 32H104a72 72 0 0 0-72 72v224a72.12 72.12 0 0 0 48 67.88V160a80 80 0 0 1 80-80z",fill:"currentColor"},null,-1)]))}}),be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Le=E({name:"RecordStop24Regular",render:function(q,i){return d(),y("svg",be,i[0]||(i[0]=[o("g",{fill:"none"},[o("path",{d:"M12 3.5a8.5 8.5 0 1 0 0 17a8.5 8.5 0 0 0 0-17zM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12zm6-2.5A1.5 1.5 0 0 1 9.5 8h5A1.5 1.5 0 0 1 16 9.5v5a1.5 1.5 0 0 1-1.5 1.5h-5A1.5 1.5 0 0 1 8 14.5v-5z",fill:"currentColor"})],-1)]))}}),ke={class:"absolute top-1 right-1"},Ce={class:"pl-5 h-full tpl-s-g"},Se={class:"mb-5"},Te={class:"text-xl"},qe={class:"text-sm opacity-80"},ze={class:"flex justify-end items-center gap-2 mt-2 mr-[20px]"},Re=E({__name:"ExpsTpl",setup(V,{expose:q}){const{t:i}=Z(),l=ee(),b=c(),g=c(!1),h=c(!1),_=c(!1),w=c(!1),P=()=>{w.value=!0},z=()=>{w.value=!1},p=c(),I=c(),L=c(),G=async()=>{const[a,e]=await pe();!a&&(e==null?void 0:e.status)===0&&(L.value=e.data,p.value=Object.keys(e.data)[0],M(p.value))},m=c(),B=c(),M=async a=>{const[e,t]=await de({template_group_name:a});!e&&(t==null?void 0:t.status)===0&&(I.value=t.data,m.value=Object.keys(t.data)[0],U(Object.keys(t.data)[0]))},U=async a=>{if(_.value)return;_.value=!0;const[e,t]=await _e({template_group_name:p.value,template_name:a,group_name:l.query.device_group_name,space_id:l.query.space_id});_.value=!1,!e&&(t==null?void 0:t.status)===0&&(B.value=t.data)},K=a=>{M(a)},Q=a=>{U(a)},W=async()=>{var f;if(g.value||!b.value)return;g.value=!0;let a={};try{a=await((f=b.value[0])==null?void 0:f.submit())}catch{g.value=!1;return}const e=H(a);if(J(e))return;const{device_group_name:t,space_id:k,task_id:C}=l.query,[x,s]=await me({setting:e,task_id:C,group_name:t,space_id:k,template_group:p.value,template_name:m.value});g.value=!1,!x&&(s==null?void 0:s.status)===0&&(s.data.exp.template=s.data.exp.template||`${p.value}/${m.value}`,ue(()=>{setTimeout(()=>{localStorage.setItem("t",JSON.stringify(s));const v=new URLSearchParams({device_group_name:l.query.device_group_name,task_id:l.query.task_id,task_title:l.query.task_title,space_id:l.query.space_id,create:"1"});window.open(`/experiment/waveforms?${v.toString()}`,"_blank")},100),z()}))},X=async()=>{var f;if(h.value||!b.value)return;h.value=!0;let a={};try{a=await((f=b.value[0])==null?void 0:f.submit())}catch{h.value=!1;return}const e=H(a);if(J(e))return;const{device_group_name:t,space_id:k,task_id:C}=l.query,[x,s]=await fe({setting:e,task_id:C,group_name:t,space_id:k,template_group:p.value,template_name:m.value});h.value=!1,!x&&(s==null?void 0:s.status)===0&&(setTimeout(()=>{const v=new URLSearchParams({device_group_name:l.query.device_group_name,task_id:l.query.task_id,task_title:l.query.task_title,space_id:l.query.space_id,exp_id:String(s.data.exp_id)});window.open(`/experiment/plotter?${v.toString()}`,"_blank")},100),z())};return te(w,a=>{a&&G()},{immediate:!0}),q({open:P,close:z}),(a,e)=>{const t=ne,k=le,C=oe,x=he,s=ge,f=se,v=ae,Y=ie;return d(),y("div",null,[u(Y,{show:n(w),"onUpdate:show":e[2]||(e[2]=S=>$(w)?w.value=S:null),size:"huge"},{default:r(()=>[u(v,{style:{"min-height":"700px",height:"calc(100vh - 100px)","box-sizing":"border-box",overflow:"hidden",width:"80vw","min-width":"600px",padding:"12px",position:"relative"},"content-class":"!pb-0"},{default:r(()=>[o("div",ke,[u(t,{type:"primary",onClick:z,size:"small",circle:""},{icon:r(()=>[u(n(xe))]),_:1})]),u(s,{type:"card",placement:"left",animated:"",onUpdateValue:K,value:n(p),"onUpdate:value":e[1]||(e[1]=S=>$(p)?p.value=S:null),style:{height:"calc(100vh - 160px)"}},{default:r(()=>[(d(!0),y(O,null,N(n(L),(S,j)=>(d(),A(x,{key:j,name:j,tab:S.title,disabled:n(_)},{default:r(()=>[u(f,{style:{height:"100%","padding-top":"10px","box-sizing":"border-box"}},{default:r(()=>[u(s,{type:"line",placement:"left",value:n(m),"onUpdate:value":e[0]||(e[0]=T=>$(m)?m.value=T:null),onUpdateValue:Q,style:{height:"100%"}},{default:r(()=>[(d(!0),y(O,null,N(n(I),(T,D)=>(d(),A(x,{key:D,name:D,tab:T.title,disabled:n(_)},{default:r(()=>[o("div",Ce,[o("div",Se,[o("div",Te,R(T.title),1),o("div",qe,R(T.desc),1)]),u(C,{show:n(_)},{default:r(()=>[u(k,{style:{"padding-right":"20px"}},{default:r(()=>[n(B)&&!n(_)?(d(),A(ve,{key:0,cfgs:n(B),ref_for:!0,ref_key:"dynamicFormRef",ref:b},null,8,["cfgs"])):re("",!0)]),_:1}),o("div",ze,[u(t,{loading:n(h),disabled:n(g),type:"primary",onClick:X},{default:r(()=>[F(R(n(i)("groupDetail.exps.createsubmit")),1)]),_:1},8,["loading","disabled"]),u(t,{loading:n(g),disabled:n(h),type:"primary",onClick:W},{default:r(()=>[F(R(n(i)("groupDetail.exps.createExpBtn")),1)]),_:1},8,["loading","disabled"])])]),_:1},8,["show"])])]),_:2},1032,["name","tab","disabled"]))),128))]),_:1},8,["value"])]),_:1})]),_:2},1032,["name","tab","disabled"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["show"])])}}}),Me=ce(Re,[["__scopeId","data-v-f121fd30"]]);export{Ie as D,Me as E,Le as R};

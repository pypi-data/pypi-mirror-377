import{d as V,e as T,f as p,h as i,Q as A,Y as Z,Z as W,$ as dt,a0 as mt,a1 as pt,b as gt,C as ft,c as vt,a2 as yt,a3 as ht,r as w,R as F,o as wt,a4 as kt,E as k,w as a,i as e,W as bt,T as Ct,B as Et,t as c,l as s,N as St,a5 as G,s as m,a6 as It,a7 as Tt,a8 as Dt,a9 as J,aa as Lt,ab as zt,v as Rt,z as P,ac as qt,ad as K,ae as Nt,af as Mt,j as Ot,ag as Bt,ah as Q,ai as b,V as $t,M as jt,X as At,aj as Ft,K as Pt}from"./index-BRYl8bDl.js";import{a as Vt}from"./task-BwxkgRNB.js";import{s as Ut,g as xt,a as Ht}from"./exp-CxwoNyZY.js";import{u as Wt}from"./useInterval-QgGh-qun.js";import{R as Gt,D as Jt,E as Kt}from"./ExpsTpl-g5wPVyLm.js";import{c as Qt}from"./index-DxlcEGoi.js";import{C as Xt}from"./ChevronBack-X0HuupRi.js";import{A as X}from"./Add-Dv4svlyJ.js";import"./DynamicForm.vue_vue_type_script_setup_true_lang-YeY4OKEW.js";import"./json-editor-vue-BmtN2Xe8.js";import"./debounce-Ck29JPS5.js";import"./InputNumber-Dhok4X06.js";import"./Add-Cx9clA42.js";import"./Switch-Djz7O8eH.js";import"./Tabs-BbQfpjxR.js";const Yt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Zt=V({name:"Timer24Regular",render:function(E,l){return p(),T("svg",Yt,l[0]||(l[0]=[i("g",{fill:"none"},[i("path",{d:"M12 5a8.5 8.5 0 1 1 0 17a8.5 8.5 0 0 1 0-17zm0 1.5a7 7 0 1 0 0 14a7 7 0 0 0 0-14zM12 8a.75.75 0 0 1 .743.648l.007.102v4.5a.75.75 0 0 1-1.493.102l-.007-.102v-4.5A.75.75 0 0 1 12 8zm7.147-2.886l.083.06l1.158.964a.75.75 0 0 1-.877 1.212l-.082-.06l-1.159-.964a.75.75 0 0 1 .877-1.212zM14.25 2.5a.75.75 0 0 1 .102 1.493L14.25 4h-4.5a.75.75 0 0 1-.102-1.493L9.75 2.5h4.5z",fill:"currentColor"})],-1)]))}}),te={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ee=V({name:"Eye",render:function(E,l){return p(),T("svg",te,l[0]||(l[0]=[i("circle",{cx:"256",cy:"256",r:"64",fill:"currentColor"},null,-1),i("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96c-42.52 0-84.33 12.15-124.27 36.11c-40.73 24.43-77.63 60.12-109.68 106.07a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416c46.71 0 93.81-14.43 136.2-41.72c38.46-24.77 72.72-59.66 99.08-100.92a32.2 32.2 0 0 0-.1-34.76zM256 352a96 96 0 1 1 96-96a96.11 96.11 0 0 1-96 96z",fill:"currentColor"},null,-1)]))}}),Y=(C,E)=>{var D;if(!C.length)return;const l=document.createEvent("MouseEvents");l.initEvent("click",!0,!0);const u=C.map(f=>A(Z,{width:100,src:f}));let g=document.querySelector("#preview-image");if(!g){const f=document.createElement("div");f.id="preview-image",document.body.appendChild(f),g=f}u.length>1?W(A(mt,{},[A(dt,{},u)]),g):W(u[0],g),(D=g==null?void 0:g.querySelectorAll(".n-image img")[E])==null||D.dispatchEvent(l)},se={class:"flex items-center mb-5 text-xl gap-2"},ae={class:"inline-flex gap-2"},ne={class:"flex justify-between"},oe={class:"text-lg flex items-center gap-1.5"},ie={class:"break-keep font-bold"},le={class:"flex items-center gap-1.5 opacity-75 text-xs mt-2"},re={class:"flex gap-2"},ce={key:2,class:"bg-gray-500 w-20 h-20 rounded text-center leading-4 text-xs flex items-center justify-center text-white"},ue={class:"flex gap-2 flex-col"},_e={class:"flex items-center gap-1"},de={class:"flex justify-around items-center gap-1"},me=V({__name:"ExperimentList",setup(C){const E=pt(),{t:l}=gt(),u=ft(),g=vt(),D=yt(),f=ht(),L=w(),M=F({}),z=w(!1),tt=w(),U=w(),S=F({page:1,per_page:8,total:0}),x=(o,_={})=>{const n=new URLSearchParams({device_group_name:u.query.device_group_name,task_id:u.query.task_id,task_title:u.query.task_title,space_id:u.query.space_id,exp_id:String(o.exp_id),..._});window.open(`/experiment/waveforms?${n.toString()}`,E.expOpenForm)},R=w(),et=async(o,_)=>{const[n,r]=await Ht({exp_ids:o,group_name:u.query.device_group_name,create_timestamps:_});if(!n&&(r==null?void 0:r.status)===0)return r.data},O=async o=>{var v;if(!o){if(z.value)return;z.value=!0}const _=u.query.device_group_name;if(!_)return;const[n,r]=await Vt({...((v=tt.value)==null?void 0:v.searchParasm)||{},...At(S),task_id:u.query.task_id,device_group_name:_});if(o||(z.value=!1),!n&&r&&r.status===0){const y=[],I=Qt(r.data.list.map(d=>{if(M[d.exp_id]===void 0)return y.push(d.create_timestamp),d.exp_id;d.img=M[d.exp_id]}));if(I.length>0){const d=JSON.parse(JSON.stringify(r.data.list));et(I.join(","),y.join(",")).then(q=>{q&&(Ft(q,(N,j)=>{d.some(h=>{if(h.exp_id===+j)return h.img=N,[b.COMPLETE,b.ERROR,b.CANCELED,b.HOST_DOWNLOADED].includes(h.status)&&(M[h.exp_id]=N),!0})}),R.value=d)})}R.value=r.data.list,S.total=r.data.total}},st=()=>{g.push({name:"taskList",query:{device_group_name:u.query.device_group_name}})},at=async o=>{const[_,n]=await Ut({exp_id:o.exp_id});!_&&(n==null?void 0:n.status)===0&&f.success("实验终止成功")},nt=o=>{x(o,{dup:"1"})},ot=()=>{var o;(o=U.value)==null||o.open()},it=()=>{},{start:lt,stop:rt}=Wt(O,{initParams:!0,isManual:!0});wt(()=>{O(),L.value=setTimeout(()=>{lt()},5e3)}),kt(()=>{rt(),L.value!==null&&clearInterval(L.value),L.value=null});const B=w(),$=F({}),ct=async o=>{if($[String(o.exp_id)]){Y([$[String(o.exp_id)]],0);return}B.value=o.exp_id;const[_,n]=await xt({exp_id:o.exp_id,device_group_name:u.query.device_group_name,space_id:u.query.space_id});B.value=void 0,!_&&(n==null?void 0:n.status)===0&&(Y([n.data.big_picture_url],0),$[String(o.exp_id)]=n.data.big_picture_url)};return(o,_)=>{const n=St,r=Et,v=qt,y=Nt,I=Ot,d=Bt,q=Z,N=Rt,j=zt,h=Dt,H=It,ut=Ct,_t=bt;return p(),k(d,{show:s(z)},{default:a(()=>[e(_t,{"has-sider":""},{default:a(()=>[e(ut,{class:"min-h-[500px]"},{default:a(()=>[i("div",se,[e(r,{onClick:st,quaternary:""},{icon:a(()=>[e(n,{size:"26"},{default:a(()=>[e(s(Xt))]),_:1})]),default:a(()=>[i("span",null,c(s(l)("groupDetail.exps.back")),1)]),_:1}),i("span",{class:"flex-1 text-center",style:G({color:s(D).primaryColor})},c(s(l)("groupDetail.exps.taskTitle",{taskId:s(u).query.task_id,taskTitle:` " ${s(u).query.task_title} " `})),5),i("div",ae,[e(r,{type:"primary",onClick:ot},{default:a(()=>[e(n,null,{default:a(()=>[e(s(X))]),_:1}),m("  "+c(s(l)("groupDetail.exps.createFromTemplate")),1)]),_:1}),e(r,{type:"primary",onClick:it},{default:a(()=>[e(n,null,{default:a(()=>[e(s(X))]),_:1}),m("  "+c(s(l)("groupDetail.exps.createManualTask")),1)]),_:1})])]),e(H,{style:G({maxHeight:s(Tt)(s(R))?"200px":"calc(100vh - 350px)"})},{default:a(()=>[e(h,{cols:"4","x-gap":"20","y-gap":"20",class:"py-1 px-1.5"},{default:a(()=>[(p(!0),T(J,null,Lt(s(R),t=>(p(),k(j,{key:t.exp_id},{default:a(()=>[e(N,{rounded:"",style:{width:"100%"},"content-class":"!mb-0 !p-2",class:"hover:scale-103 hover:transform-gpu"},{default:a(()=>[i("div",ne,[i("div",null,[i("div",oe,[i("div",ie,c(t.exp_id),1),t!=null&&t.status?(p(),k(v,{key:0,color:{color:s(K)[t.status].color,textColor:"#fff"},bordered:!1,size:"small"},{default:a(()=>[m(c(s(l)(s(K)[t.status].text)),1)]),_:2},1032,["color"])):P("",!0),e(v,{size:"small",type:"info"},{default:a(()=>[m(c(t==null?void 0:t.progress),1)]),_:2},1024),t!=null&&t.source?(p(),k(v,{key:1,size:"small",type:"info"},{default:a(()=>[m(c(s(l)("groupDetail.exps.source"))+": "+c(t==null?void 0:t.source),1)]),_:2},1024)):P("",!0)]),i("div",le,[e(n,{component:s(Zt)},null,8,["component"]),e(y,{"line-clamp":1},{default:a(()=>[m(c(t==null?void 0:t.create_time),1)]),_:2},1024),t!=null&&t.user_name?(p(),T(J,{key:0},[e(n,{component:s(Mt),class:"ml-2"},null,8,["component"]),i("div",null,c(t==null?void 0:t.user_name),1)],64)):P("",!0)])])]),e(y,{style:{"max-width":"100%"},class:"text-lg mt-2"},{default:a(()=>[m(c(t==null?void 0:t.title),1)]),_:2},1024),e(I,{class:"!my-3"}),i("div",re,[i("div",null,[(t==null?void 0:t.img)===void 0?(p(),k(d,{key:0,show:!0,"content-class":"h-20"},{default:a(()=>_[1]||(_[1]=[i("div",{class:"w-20 h-20 rounded"},null,-1)])),_:1})):t!=null&&t.img?(p(),k(d,{key:1,show:s(B)===t.exp_id},{default:a(()=>[e(q,{class:"w-20 h-20 rounded cursor-pointer",src:t==null?void 0:t.img,"preview-disabled":!0,onClick:()=>ct(t)},null,8,["src","onClick"])]),_:2},1032,["show"])):(p(),T("div",ce,c(s(l)("groupDetail.exps.noresult")),1))]),i("div",ue,[i("div",_e,[e(v,{type:"warning",size:"small"},{default:a(()=>[m(c((t==null?void 0:t.template_name)==="-"?"No Template":t==null?void 0:t.template_name),1)]),_:2},1024)]),e(y,{style:{"max-width":"100%"},class:"opacity-75 text-xs","line-clamp":3},{default:a(()=>[m(c(t==null?void 0:t.description),1)]),_:2},1024)])]),e(I,{class:"!my-3"}),i("div",de,[e(r,{disabled:![s(b).RUNNING,s(b).HOST_DOWNLOADED].includes(t.status),type:"info",size:"small",class:"flex-1 !px-0.5",onClick:Q(()=>at(t),["stop"])},{icon:a(()=>[e(s(Gt))]),default:a(()=>[m(" "+c(s(l)("groupDetail.exps.stop")),1)]),_:2},1032,["disabled","onClick"]),e(r,{type:"info",size:"small",class:"flex-1",onClick:Q(()=>nt(t),["stop"]),disabled:(t==null?void 0:t.exp_mode)==="batch_circuit"},{icon:a(()=>[e(s(Jt))]),default:a(()=>[m(c(s(l)("expInfo.duplicate"))+" ",1)]),_:2},1032,["onClick","disabled"]),e(r,{type:"info",size:"small",class:"flex-1",disabled:(t==null?void 0:t.exp_mode)==="batch_circuit",onClick:()=>x(t)},{icon:a(()=>[e(s(ee))]),default:a(()=>[m(c(s(l)("groupDetail.exps.preview"))+" ",1)]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1},8,["style"]),e($t,{"page-info":s(S),"onUpdate:pageInfo":_[0]||(_[0]=t=>jt(S)?S.value=t:null),"page-sizes":[8,16,24],onUpdateList:O,class:"!pb-0"},null,8,["page-info"]),e(Kt,{ref_key:"expsTplRef",ref:U},null,512)]),_:1})]),_:1})]),_:1},8,["show"])}}}),Le=Pt(me,[["__scopeId","data-v-5be5e23d"]]);export{Le as default};

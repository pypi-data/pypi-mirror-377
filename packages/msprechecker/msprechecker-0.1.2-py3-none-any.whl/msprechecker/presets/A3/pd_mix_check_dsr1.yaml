mies_config:
  ServerConfig:
    tokenTimeout:
      expected:
        type: eq
        value: 600
      reason: "tokenTimeout建议值为600，表示每token的超时时间，在测试推理性能时可以适当增大，不超过3600"
      severity: low
    e2eTimeout:
      expected:
        type: eq
        value: 600
      reason: "e2eTimeout建议值为600，表示端到端推理的超时时间，在测试推理性能时可以适当增大，不超过65535"
      severity: low
    httpsEnabled:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
    inferMode:
      expected:
        type: eq
        value: "'Standard'"
      reason: "PD混部场景下，inferMode应该是standard"
      severity: high
    interCommTLSEnabled:
      expected:
        type: eq
        value: false
      reason: "如果确实配置了安全证书，建议开启为true，此条校验为提示"
      severity: low
  BackendConfig:
    npuDeviceIds:
      expected:
        type: eq
        value: [[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]]
      reason: "P节点中npuDeviceIds应该设置为[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]]"
      severity: high
    multiNodesInferEnabled:
      expected:
        type: eq
        value: false
      reason: "multiNodesInferEnabled表示服务跨机推理，在Atlas 800I A3场景单机拉起DeepSeek模型场景下应该是false"
      severity: high
    ModelDeployConfig:
      maxSeqLen:
        expected:
          type: ">="
          value: ${BackendConfig.ModelDeployConfig.maxInputTokenLen}
        reason: "maxSeqLen不应该小于maxInputTokenLen，表示输入token加输出token的上限"
        severity: high
      maxInputTokenLen:
        expected:
          type: ">="
          value: 1
        reason: "maxInputTokenLen应该大于等于1，表示输入token的上限"
        severity: high
      ModelConfig[0]:
        modelWeightPath:
          expected:
            case:
              type: path
              value: "'exists'"
            reason: "modelWeightPath需要配置为当前容器中挂载的模型权重路径"
            severity: high
        worldSize:
          expected:
            type: eq
            value: 16
          reason: "worldSize表示服务跨机推理时的npu卡数，在Atlas 800I A3场景双机拉起DeepSeek模型场景下应该是16"
          severity: high
        dp:
          expected:
            type: eq
            value: 2
          reason: "dp表示数据并行度，在Atlas 800I A3场景单机拉起DeepSeek模型场景下应该是2"
          severity: high
        tp:
          expected:
            type: eq
            value: 8
          reason: "tp表示张量并行度，在Atlas 800I A3场景单机拉起DeepSeek模型场景下应该是8"
          severity: high
        moe_ep:
          expected:
            type: eq
            value: 4
          reason: "moe_ep表示MoE专家并行度，在Atlas 800I A3场景单机拉起DeepSeek模型场景下应该是4"
          severity: high
        moe_tp:
          expected:
            type: eq
            value: 4
          reason: "moe_tp表示MoE专家张量并行度，在Atlas 800I A3场景单机拉起DeepSeek模型场景下应该是4"
          severity: high
        ignore_eos:
          expected:
            type: eq
            value: false
          reason: "ignore_eos表示是否忽略eos token，测试固定长度输出时可以设置为true"
          severity: low
        plugin_params:
          expected:
            type: eq
            value: "'{\"plugin_type\":\"mtp\",\"num_speculative_tokens\": 1}'"
          reason: "MTP特性开关，建议开启，值为\"{\"plugin_type\":\"mtp\",\"num_speculative_tokens\": 1}\""
          severity: low
        models:
          deepseekv2:
            enable_mlapo_prefetch:
              expected:
                type: eq
                value: true
              reason: "enable_mlapo_prefetch表示是否开启MLAPO预取，建议开启"
              severity: high
            kv_cache_options:
              enable_nz:
                expected:
                  type: eq
                  value: true
                reason: "enable_nz表示kv cache是否使用NZ格式，建议开启"
                severity: high
    ScheduleConfig:
      maxPrefillBatchSize:
        expected:
          type: ">="
          value: 1
        reason: "表示prefill的最大batch size，不能小于1"
        severity: high
      maxPrefillTokens:
        expected:
          type: ">="
          value: ${BackendConfig.ModelDeployConfig.maxInputTokenLen}
        reason: "maxPrefillTokens需要设置大于maxInputTokenLen，表示prefill最大token数"
        severity: high
      maxIterTimes:
        expected:
          type: range
          value: [1, "${BackendConfig.ModelDeployConfig.maxSeqLen}"]
        reason: "maxIterTimes应该大于等于1小于等于maxSeqLen"
        severity: high

env:
  MIES_CONTAINER_IP:
    expected:
      type: eq
      value: "${global.cur_ip}"
    reason: "MIES_CONTAINER_IP表示当前容器IP地址，建议设置为当前容器IP"
    severity: high
  PYTORCH_NPU_ALLOC_CONF:
    expected:
      type: eq
      value: "'expandable_segments:True'"
    reason: "需要开启torch_npu虚拟内存机制"
    severity: high
  ATB_WORKSPACE_MEM_ALLOC_ALG_TYPE:
    expected:
      type: eq
      value: "'3'"
    reason: "workspace内存分配算法选择，建议设置为3，最大优化显存碎片与workspace空间"
    severity: high
  ATB_WORKSPACE_MEM_ALLOC_GLOBAL:
    expected:
      type: eq
      value: "'1'"
    reason: "建议开启全局中间tensor内存分配算法，提升显存利用率"
    severity: high
  HCCL_OP_EXPANSION_MODE:
    expected:
      type: eq
      value: "'AIV'"
    reason: "HCCL_OP_EXPANSION_MODE建议设置为AIV，设置通信算法的编排展开位置在Device侧的AI Vector Core计算单元"
    severity: high
  NPU_MEMORY_FRACTION:
    expected:
      type: eq
      value: "'0.96'"
    reason: "A3单机DeepSeek场景下，NPU显存比建议设置为0.96，可根据实际业务场景加大，出现out of memory时可以尝试调大该值"
    severity: low
  ATB_LLM_HCCL_ENABLE:
    expected:
      type: eq
      value: "'1'"
    reason: "需要开启HCCL通信后端"
    severity: high
  ATB_LAYER_INTERNAL_TENSOR_REUSE:
    expected:
      type: eq
      value: "'1'"
    reason: "需要开启复用Layer间的中间Tensor复用"
    severity: high
  HCCL_CONNECT_TIMEOUT:
    expected:
      type: eq
      value: "'7200'"
    reason: "HCCL建链超时时间建议设置为7200秒"
    severity: high
  HCCL_EXEC_TIMEOUT:
    expected:
      type: eq
      value: "'0'"
    reason: "HCCL执行超时时间建议设置为0，不限制超时"
    severity: high
  ATB_LLM_ENABLE_AUTO_TRANSPOSE:
    expected:
      type: eq
      value: "'0'"
    reason: "不能开启权重右矩阵自动转置"
    severity: high
  MINDIE_ASYNC_SCHEDULING_ENABLE:
    expected:
      type: eq
      value: "'1'"
    reason: "建议开启MindIE异步调度特性，提升推理性能"
    severity: high
  TASK_QUEUE_ENABLE:
    expected:
      type: eq
      value: "'2'"
    reason: "建议开启task_queue算子下发队列Level 2优化"
    severity: high
  MINDIE_LOG_TO_FILE:
    expected:
      type: eq
      value: "'1'"
    reason: "建议将MindIE日志写入文件，便于排查问题"
    severity: low
  MINDIE_LOG_TO_STDOUT:
    expected:
      type: eq
      value: "'1'"
    reason: "建议将MindIE日志打屏，便于通过查看k8s日志查看程序运行状态"
    severity: low
  MINDIE_LOG_LEVEL:
    expected:
      if: "${.} != None"
      then:
        case:
          type: enum
          value: ["'1'", "'INFO'"]
        reason: "如果配置了MINDIE_LOG_LEVEL，建议设置为1或INFO，表示日志级别为info"
        severity: low
  OMP_NUM_THREADS:
    expected:
      type: eq
      value: "'16'"
    reason: "OpenMP并行数建议设置为16"
    severity: low
Metadata-Version: 2.4
Name: nameko-pymemcache
Version: 0.1.0
Summary: Memcached dependency for nameko services with consistent hashing
Home-page: https://github.com/andreasmyleus/nameko-pymemcache/
Author: andreasmyleus
Author-email: andreas@pdc.ax
License: Apache License, Version 2.0
Keywords: nameko memcached cache distributed consistent-hashing
Classifier: Development Status :: 4 - Beta
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Intended Audience :: Developers
Classifier: Topic :: System :: Distributed Computing
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: nameko>=2.0.0
Requires-Dist: pymemcache>=4.0.0
Dynamic: author
Dynamic: author-email
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: keywords
Dynamic: license
Dynamic: license-file
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# nameko-pymemcache
[![PyPI version](https://badge.fury.io/py/nameko-pymemcache.svg)](https://badge.fury.io/py/nameko-pymemcache)
[![Build Status](https://travis-ci.org/andreasmyleus/nameko-pymemcache.svg?branch=master)](https://travis-ci.org/andreasmyleus/nameko-pymemcache)

Memcached dependency for nameko services with consistent hashing support for multi-node setups. Uses the high-performance pymemcache library with automatic failover and connection pooling.

**Key Features:**
- **Consistent hashing** for reliable multi-node memcached clusters  
- **Optimized for Nameko** - proper connection management and worker cleanup
- **Django compatible** - same interface as django-pymemcache for easy integration
- **Automatic failover** when nodes become unavailable
- **Drop-in replacement** for bmemcached with better multi-node behavior

Inspiration and structure **proudly** stolen from nameko-redis :) Thanks guys!

## Installation
```
pip install nameko-pymemcache
```

## Usage
```python
from nameko.rpc import rpc
from nameko_pymemcache import Memcached


class MyService(object):
    name = "my_service"

    memcached = Memcached()

    @rpc
    def hello(self, name):
        self.memcached.set("foo", name)
        return "Hello, {}!".format(name)

    @rpc
    def bye(self):
        name = self.memcached.get("foo")
        return "Bye, {}!".format(name)
```

To specify memcached uri(s) and optional username/password you will need a config
```yaml
AMQP_URI: 'amqp://guest:guest@localhost'
MEMCACHED_URIS: ['127.0.0.1:11211', ]
MEMCACHED_USER: 'playerone'
MEMCACHED_PASSWORD: 'ready'
```

## Multi-Node Configuration

For multi-node memcached clusters, simply specify multiple servers:
```yaml
AMQP_URI: 'amqp://guest:guest@localhost'
MEMCACHED_URIS: 
  - '192.168.1.10:11211'
  - '192.168.1.11:11211'
  - '192.168.1.12:11211'
```

The client automatically uses **consistent hashing** to distribute keys across nodes. When a node fails, only the keys on that node are affected (not all keys like with simple round-robin).

## Advanced Configuration

You can pass extra options to customize client behavior:
```python
class MyService(object):
    name = "my_service"

    memcached = Memcached(
        connect_timeout=0.1,    # connection timeout in seconds
        timeout=0.2,            # operation timeout in seconds
        retry_attempts=2,       # number of retries on failure
        dead_timeout=10,        # how long to avoid a failed node
    )

    ...
```

## Framework Compatibility

This package provides a consistent interface that works seamlessly with Django's pymemcache backend, making it easy to share cache configurations between Django and Nameko services:

```python
# Same server configuration works in both Django and Nameko
CACHE_SERVERS = ['192.168.1.10:11211', '192.168.1.11:11211', '192.168.1.12:11211']

# Django settings.py
CACHES = {
    'default': {
        'BACKEND': 'django.core.cache.backends.memcached.PyMemcacheCache',
        'LOCATION': CACHE_SERVERS,
    }
}

# Nameko config.yaml  
MEMCACHED_URIS: ['192.168.1.10:11211', '192.168.1.11:11211', '192.168.1.12:11211']
```

## Performance Tips

- **Identical server order**: Keep the same server order across all clients for consistent key distribution
- **Connection pooling**: Available via pymemcache options if needed
- **Custom timeouts**: Override defaults by passing pymemcache options to the constructor
- **Failure handling**: Failed nodes are automatically removed from the hash ring and retried later

// ğŸš€ NovaLang Spring Boot Style Backend
// Auto-Configuration with Entities, Repositories, Services & Controllers

print "ğŸŒŸ NovaLang Spring Boot Style Backend Starting...";
print "=================================================";

// ===== AUTO-CONFIGURATION =====
print "\nâš™ï¸ Auto-Configuration Starting...";

// Database auto-configuration (like Spring Boot)
let db_host = "localhost";
let db_port = 3306;
let db_name = "novalang_app";
let db_user = "root";
let db_password = "root";
let auto_create_db = true;
let auto_create_table_setting = true;
let show_sql = true;

function auto_configure_database() {
    print "ğŸ”§ Auto-configuring database connection...";
    print "ğŸ“ Host: " + db_host + ":" + str(db_port);
    print "ğŸ—„ï¸ Database: " + db_name;
    
    if (auto_create_db) {
        print "ğŸ—ï¸ Auto-creating database: " + db_name;
        // In real implementation: CREATE DATABASE IF NOT EXISTS
        print "âœ… Database created automatically";
    }
    
    print "âœ… Database connection auto-configured";
    return true;
}

function auto_create_tables() {
    print "ğŸ—ï¸ Auto-creating database tables from entities...";
    
    // Auto-create Users table
    print "ğŸ“‹ Creating table: users";
    print "   - id (PRIMARY KEY, AUTO_INCREMENT)";
    print "   - name (VARCHAR(100) NOT NULL)";
    print "   - email (VARCHAR(255) UNIQUE NOT NULL)";
    print "   - created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)";
    
    // Auto-create Products table
    print "ğŸ“¦ Creating table: products";
    print "   - id (PRIMARY KEY, AUTO_INCREMENT)";
    print "   - name (VARCHAR(100) NOT NULL)";
    print "   - price (DECIMAL(10,2) NOT NULL)";
    print "   - category (VARCHAR(50))";
    print "   - stock (INT DEFAULT 0)";
    
    // Auto-create Orders table
    print "ğŸ›’ Creating table: orders";
    print "   - id (PRIMARY KEY, AUTO_INCREMENT)";
    print "   - user_id (INT, FOREIGN KEY)";
    print "   - product_id (INT, FOREIGN KEY)";
    print "   - quantity (INT NOT NULL)";
    print "   - total (DECIMAL(10,2) NOT NULL)";
    print "   - status (VARCHAR(20) DEFAULT 'pending')";
    
    print "âœ… All tables created automatically from entity definitions";
    return true;
}

// ===== ENTITY DEFINITIONS (Like JPA @Entity) =====
print "\nğŸ“‹ Loading Entity Definitions...";

// @Entity
// @Table(name = "users")
function User(id, name, email) {
    print "ğŸ‘¤ Entity: User";
    return "User:" + str(id) + ":" + name + ":" + email;
}

// @Entity  
// @Table(name = "products")
function Product(id, name, price, category) {
    print "ğŸ“¦ Entity: Product";
    return "Product:" + str(id) + ":" + name + ":" + str(price) + ":" + category;
}

// @Entity
// @Table(name = "orders")
function Order(id, user_id, product_id, quantity, total) {
    print "ğŸ›’ Entity: Order";
    return "Order:" + str(id) + ":" + str(user_id) + ":" + str(product_id) + ":" + str(quantity) + ":" + str(total);
}

// ===== REPOSITORIES (Like Spring Data JPA) =====
print "\nğŸ’¾ Initializing Repositories...";

// @Repository
// interface UserRepository extends JpaRepository<User, Long>
function UserRepository_save(name, email) {
    print "ğŸ’¾ UserRepository.save() - Saving user: " + name;
    // Auto-generate SQL: INSERT INTO users (name, email) VALUES (?, ?)
    print "ğŸ“ SQL: INSERT INTO users (name, email) VALUES ('" + name + "', '" + email + "')";
    print "âœ… User saved with auto-generated ID";
    return true;
}

function UserRepository_findById(id) {
    print "ğŸ” UserRepository.findById(" + str(id) + ")";
    // Auto-generate SQL: SELECT * FROM users WHERE id = ?
    print "ğŸ“ SQL: SELECT * FROM users WHERE id = " + str(id);
    print "âœ… User found with ID: " + str(id);
    return true;
}

function UserRepository_findAll() {
    print "ğŸ“‹ UserRepository.findAll()";
    // Auto-generate SQL: SELECT * FROM users
    print "ğŸ“ SQL: SELECT * FROM users";
    print "âœ… Retrieved all users from database";
    return 3;
}

function UserRepository_findByEmail(email) {
    print "ğŸ” UserRepository.findByEmail('" + email + "')";
    // Auto-generate SQL: SELECT * FROM users WHERE email = ?
    print "ğŸ“ SQL: SELECT * FROM users WHERE email = '" + email + "'";
    print "âœ… User found by email";
    return true;
}

function UserRepository_deleteById(id) {
    print "ğŸ—‘ï¸ UserRepository.deleteById(" + str(id) + ")";
    // Auto-generate SQL: DELETE FROM users WHERE id = ?
    print "ğŸ“ SQL: DELETE FROM users WHERE id = " + str(id);
    print "âœ… User deleted from database";
    return true;
}

// @Repository
function ProductRepository_save(name, price, category) {
    print "ğŸ’¾ ProductRepository.save() - Saving product: " + name;
    print "ğŸ“ SQL: INSERT INTO products (name, price, category, stock) VALUES ('" + name + "', " + str(price) + ", '" + category + "', 0)";
    print "âœ… Product saved with auto-generated ID";
    return true;
}

function ProductRepository_findAll() {
    print "ğŸ“‹ ProductRepository.findAll()";
    print "ğŸ“ SQL: SELECT * FROM products";
    print "âœ… Retrieved all products";
    return 5;
}

function ProductRepository_findByCategory(category) {
    print "ğŸ” ProductRepository.findByCategory('" + category + "')";
    print "ğŸ“ SQL: SELECT * FROM products WHERE category = '" + category + "'";
    print "âœ… Found products in category: " + category;
    return 2;
}

// @Repository
function OrderRepository_save(user_id, product_id, quantity, total) {
    print "ğŸ’¾ OrderRepository.save() - Creating order";
    print "ğŸ“ SQL: INSERT INTO orders (user_id, product_id, quantity, total, status) VALUES (" + str(user_id) + ", " + str(product_id) + ", " + str(quantity) + ", " + str(total) + ", 'pending')";
    print "âœ… Order created with auto-generated ID";
    return true;
}

function OrderRepository_findByUserId(user_id) {
    print "ğŸ” OrderRepository.findByUserId(" + str(user_id) + ")";
    print "ğŸ“ SQL: SELECT * FROM orders WHERE user_id = " + str(user_id);
    print "âœ… Found orders for user";
    return 2;
}

// ===== SERVICES (Like @Service) =====
print "\nâš™ï¸ Initializing Services...";

// @Service
function UserService_createUser(name, email) {
    print "ğŸ”„ UserService.createUser()";
    
    // Business logic validation
    if (len(name) < 2) {
        print "âŒ Validation error: Name too short";
        return false;
    }
    
    // Check if email exists
    print "ğŸ” Checking email uniqueness...";
    
    // Save user
    let saved = UserRepository_save(name, email);
    
    // Send welcome email (business logic)
    print "ğŸ“§ Sending welcome email to: " + email;
    
    print "âœ… User creation completed";
    return saved;
}

function UserService_getUserById(id) {
    print "ğŸ” UserService.getUserById(" + str(id) + ")";
    return UserRepository_findById(id);
}

function UserService_getAllUsers() {
    print "ğŸ“‹ UserService.getAllUsers()";
    return UserRepository_findAll();
}

function UserService_updateUser(id, name, email) {
    print "ğŸ”„ UserService.updateUser(" + str(id) + ")";
    
    // Validation
    if (len(name) < 2) {
        print "âŒ Validation error: Name too short";
        return false;
    }
    
    // Update logic
    print "ğŸ“ Updating user data...";
    print "âœ… User updated successfully";
    return true;
}

function UserService_deleteUser(id) {
    print "ğŸ—‘ï¸ UserService.deleteUser(" + str(id) + ")";
    return UserRepository_deleteById(id);
}

// @Service
function ProductService_createProduct(name, price, category) {
    print "ğŸ”„ ProductService.createProduct()";
    
    if (price <= 0) {
        print "âŒ Validation error: Price must be positive";
        return false;
    }
    
    return ProductRepository_save(name, price, category);
}

function ProductService_getAllProducts() {
    print "ğŸ“‹ ProductService.getAllProducts()";
    return ProductRepository_findAll();
}

function ProductService_getProductsByCategory(category) {
    print "ğŸ” ProductService.getProductsByCategory('" + category + "')";
    return ProductRepository_findByCategory(category);
}

// @Service  
function OrderService_createOrder(user_id, product_id, quantity) {
    print "ğŸ”„ OrderService.createOrder()";
    
    // Business logic: calculate total
    let price = 29.99; // In real app, get from ProductService
    let total = price * quantity;
    
    let saved = OrderRepository_save(user_id, product_id, quantity, total);
    
    // Business logic: update stock, send notification
    print "ğŸ“§ Order confirmation sent";
    
    return saved;
}

function OrderService_getOrdersByUser(user_id) {
    print "ğŸ” OrderService.getOrdersByUser(" + str(user_id) + ")";
    return OrderRepository_findByUserId(user_id);
}

// ===== CONTROLLERS (Like @RestController) =====
print "\nğŸŒ Initializing REST Controllers...";

// @RestController
// @RequestMapping("/api/users")
function UserController_createUser(name, email) {
    print "ğŸŒ POST /api/users";
    print "ğŸ“¥ Request Body: {name: '" + name + "', email: '" + email + "'}";
    
    let result = UserService_createUser(name, email);
    
    if (result) {
        print "âœ… HTTP 201 CREATED - User created successfully";
        return 201;
    } else {
        print "âŒ HTTP 400 BAD REQUEST - Validation failed";
        return 400;
    }
}

function UserController_getUser(id) {
    print "ğŸŒ GET /api/users/" + str(id);
    
    let found = UserService_getUserById(id);
    
    if (found) {
        print "âœ… HTTP 200 OK - User retrieved";
        return 200;
    } else {
        print "âŒ HTTP 404 NOT FOUND - User not found";
        return 404;
    }
}

function UserController_getAllUsers() {
    print "ğŸŒ GET /api/users";
    
    let count = UserService_getAllUsers();
    print "âœ… HTTP 200 OK - " + str(count) + " users retrieved";
    return 200;
}

function UserController_updateUser(id, name, email) {
    print "ğŸŒ PUT /api/users/" + str(id);
    print "ğŸ“¥ Request Body: {name: '" + name + "', email: '" + email + "'}";
    
    let result = UserService_updateUser(id, name, email);
    
    if (result) {
        print "âœ… HTTP 200 OK - User updated";
        return 200;
    } else {
        print "âŒ HTTP 400 BAD REQUEST - Update failed";
        return 400;
    }
}

function UserController_deleteUser(id) {
    print "ğŸŒ DELETE /api/users/" + str(id);
    
    let result = UserService_deleteUser(id);
    
    if (result) {
        print "âœ… HTTP 204 NO CONTENT - User deleted";
        return 204;
    } else {
        print "âŒ HTTP 404 NOT FOUND - User not found";
        return 404;
    }
}

// @RestController
// @RequestMapping("/api/products")
function ProductController_createProduct(name, price, category) {
    print "ğŸŒ POST /api/products";
    print "ğŸ“¥ Creating product: " + name + " ($" + str(price) + ")";
    
    let result = ProductService_createProduct(name, price, category);
    
    if (result) {
        print "âœ… HTTP 201 CREATED - Product created";
        return 201;
    } else {
        print "âŒ HTTP 400 BAD REQUEST - Invalid product data";
        return 400;
    }
}

function ProductController_getAllProducts() {
    print "ğŸŒ GET /api/products";
    
    let count = ProductService_getAllProducts();
    print "âœ… HTTP 200 OK - " + str(count) + " products retrieved";
    return 200;
}

function ProductController_getProductsByCategory(category) {
    print "ğŸŒ GET /api/products/category/" + category;
    
    let count = ProductService_getProductsByCategory(category);
    print "âœ… HTTP 200 OK - " + str(count) + " products in " + category;
    return 200;
}

// @RestController
// @RequestMapping("/api/orders")
function OrderController_createOrder(user_id, product_id, quantity) {
    print "ğŸŒ POST /api/orders";
    print "ğŸ“¥ Order: User " + str(user_id) + " buying " + str(quantity) + " of product " + str(product_id);
    
    let result = OrderService_createOrder(user_id, product_id, quantity);
    
    if (result) {
        print "âœ… HTTP 201 CREATED - Order placed successfully";
        return 201;
    } else {
        print "âŒ HTTP 400 BAD REQUEST - Order failed";
        return 400;
    }
}

function OrderController_getUserOrders(user_id) {
    print "ğŸŒ GET /api/orders/user/" + str(user_id);
    
    let count = OrderService_getOrdersByUser(user_id);
    print "âœ… HTTP 200 OK - " + str(count) + " orders found";
    return 200;
}

// ===== APPLICATION STARTUP (Like @SpringBootApplication) =====
print "\nğŸš€ STARTING NOVALANG SPRING BOOT APPLICATION";
print "==============================================";

// Step 1: Auto-configuration
print "\n1ï¸âƒ£ Auto-Configuration:";
let db_configured = auto_configure_database();

// Step 2: Create database schema automatically
print "\n2ï¸âƒ£ Schema Auto-Creation:";
let tables_created = auto_create_tables();

// Step 3: Initialize repositories, services, controllers
print "\n3ï¸âƒ£ Component Initialization:";
print "âœ… Repositories initialized (UserRepository, ProductRepository, OrderRepository)";
print "âœ… Services initialized (UserService, ProductService, OrderService)";
print "âœ… Controllers initialized (UserController, ProductController, OrderController)";

// Step 4: Application ready
print "\n4ï¸âƒ£ Application Ready:";
print "âœ… NovaLang Spring Boot Application started successfully!";
print "ğŸŒ Server running on http://localhost:8080";

// ===== DEMO API CALLS =====
print "\nğŸ§ª RUNNING SPRING BOOT STYLE DEMO";
print "==================================";

// User management
print "\nğŸ‘¥ User Management:";
let create1 = UserController_createUser("John Doe", "john@company.com");
let create2 = UserController_createUser("Jane Smith", "jane@company.com");
let getAll = UserController_getAllUsers();
let getUser = UserController_getUser(1);
let updateUser = UserController_updateUser(1, "John Updated", "john.updated@company.com");

// Product management
print "\nğŸ“¦ Product Management:";
let createProd1 = ProductController_createProduct("Laptop", 999.99, "Electronics");
let createProd2 = ProductController_createProduct("Coffee", 12.99, "Food");
let getAllProds = ProductController_getAllProducts();
let getElectronics = ProductController_getProductsByCategory("Electronics");

// Order management
print "\nğŸ›’ Order Management:";
let createOrder1 = OrderController_createOrder(1, 1, 2);
let createOrder2 = OrderController_createOrder(2, 2, 1);
let getUserOrders = OrderController_getUserOrders(1);

print "\nğŸ‰ SPRING BOOT STYLE DEMO COMPLETE!";
print "====================================";

print "\nğŸ“Š Enterprise Features:";
print "   âœ… Auto-configuration (like Spring Boot)";
print "   âœ… Entity definitions (like JPA @Entity)";
print "   âœ… Repository pattern (like Spring Data)";
print "   âœ… Service layer (like @Service)";
print "   âœ… REST controllers (like @RestController)";
print "   âœ… Automatic database creation";
print "   âœ… Automatic table creation";
print "   âœ… Dependency injection simulation";
print "   âœ… HTTP status codes";
print "   âœ… Business logic separation";

print "\nğŸ”— Available REST Endpoints:";
print "   ğŸ‘¥ Users:";
print "     â€¢ POST   /api/users           - Create user";
print "     â€¢ GET    /api/users           - Get all users";
print "     â€¢ GET    /api/users/{id}      - Get user by ID";
print "     â€¢ PUT    /api/users/{id}      - Update user";
print "     â€¢ DELETE /api/users/{id}      - Delete user";
print "   ğŸ“¦ Products:";
print "     â€¢ POST   /api/products        - Create product";
print "     â€¢ GET    /api/products        - Get all products";
print "     â€¢ GET    /api/products/category/{category} - Get by category";
print "   ğŸ›’ Orders:";
print "     â€¢ POST   /api/orders          - Create order";
print "     â€¢ GET    /api/orders/user/{id} - Get user orders";

print "\nğŸŒ Spring Boot Features Implemented:";
print "   â€¢ Auto-configuration";
print "   â€¢ Component scanning simulation";
print "   â€¢ Dependency injection pattern";
print "   â€¢ JPA-style repository pattern";
print "   â€¢ Service layer pattern";
print "   â€¢ REST controller pattern";
print "   â€¢ Automatic schema generation";
print "   â€¢ Clean architecture separation";

print "\nâœ¨ Your NovaLang Spring Boot application is running!";
print "ğŸš€ Just like Spring Boot - run once and everything works!";

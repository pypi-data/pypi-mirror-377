framework:
  name: safety_eval
  pkg_name: safety_eval
  full_name: Safety Harness
  description: Home for Safety evaluations
  url: null
  source: null
defaults:
  command: >-
    {% if target.api_endpoint.api_key is not none %}export API_KEY=${{target.api_endpoint.api_key}}  && {% endif %}
    {% if config.params.extra.judge.api_key is not none %}export JUDGE_API_KEY=${{config.params.extra.judge.api_key}} && {% endif %}
    safety-eval  --model-name  {{target.api_endpoint.model_id}} --model-url {{target.api_endpoint.url}} --model-type {{target.api_endpoint.type}} 
    --judge-url  {{config.params.extra.judge.url}}   --results-dir {{config.output_dir}}   --eval {{config.params.task}} 
    --mut-inference-params max_tokens={{config.params.max_new_tokens}},temperature={{config.params.temperature}},top_p={{config.params.top_p}},timeout={{config.params.request_timeout}},concurrency={{config.params.parallelism}},retries={{config.params.max_retries}}
    --judge-inference-params concurrency={{config.params.extra.judge.parallelism}},retries={{config.params.max_retries}} 
    {% if config.params.extra.dataset is defined and config.params.extra.dataset %} --dataset {{config.params.extra.dataset}}{% endif %}
    {% if config.type == "bbq" %}
    {% if config.params.extra.categories is defined and config.params.extra.categories %} --categories {{config.params.extra.categories}}{% endif %}
    {% endif %}
    {% if config.params.limit_samples is not none %} --limit {{config.params.limit_samples}} {% endif %}
    {% if config.params.extra.judge.model_id is not none %} --judge-model-name {{config.params.extra.judge.model_id}} {% endif %}
    {% if config.type == "aegis_v2_reasoning" %}
    {% if config.params.extra.evaluate_reasoning_traces  %} --evaluate-reasoning-traces {% endif %}
    {% endif %}
  config:
    supported_endpoint_types:
    - chat
    - completions
    # MUT - Model Under Test
    params:
      # Params below are for MUT endpoint
      limit_samples: null
      max_new_tokens: 6144
      temperature: 0.6
      top_p: 0.95
      parallelism: 8 # how many request to sent to the MUT endpoint in parallel. 
      max_retries: 5 # if request fails, how many times should the client try again
      request_timeout: 30
      extra:
        judge:
          # Params below are for the judge endpoint
          url: null
          model_id: null
          api_key: null
          parallelism: 32
          request_timeout: 60
          max_retries: 16
  target:
    api_endpoint: # required to add: url, model_id, type
      stream: false
evaluations:
  - name: aegis_v2 # task used by the NeMo Safety Toolkit
    description: Aegis V2 without evaluating reasoning traces. This version is used by the NeMo Safety Toolkit.
    defaults:
      config:
        type: "aegis_v2"
        params:
          task: "aegis_v2"
          extra:
            evaluate_reasoning_traces: false
  - name: aegis_v2_reasoning # task used in the MRC
    description: Aegis V2 with evaluating reasoning traces.
    defaults:
      config:
        type: "aegis_v2_reasoning"
        params:
          task: "aegis_v2"
          extra:
            evaluate_reasoning_traces: true
  - name: wildguard
    description: Wildguard
    defaults:
      config:
        type: "wildguard"
        params:
          task: "wildguard"
  - name: bbq_small
    description: Internal BBQ bias benchmark small version
    defaults:
      config:
        type: "bbq_small"
        params:
          task: "bbq"
          max_new_tokens: 1024
          extra:
            dataset: "small_ambig_clean.json"
            categories: null
  - name: bbq_full
    description: Internal BBQ bias benchmark
    defaults:
      config:
        type: "bbq_full"
        params:
          task: "bbq"
          max_new_tokens: 1024
          extra:
            dataset: "heegyu/bbq"
            categories: null
  - name: aegis_v2_hi
    description: Aegis V2 Hindi (hi)
    defaults:
      config:
        type: "aegis_v2_hi"
        params:
          task: "aegis_v2_hi"
  - name: aegis_v2_ar
    description: Aegis V2 Arabic
    defaults:
      config:
        type: "aegis_v2_ar"
        params:
          task: "aegis_v2_ar"
  - name: aegis_v2_es
    description: Aegis V2 Spanish
    defaults:
      config:
        type: "aegis_v2_es"
        params:
          task: "aegis_v2_es"
  - name: aegis_v2_fr
    description: Aegis V2 French
    defaults:
      config:
        type: "aegis_v2_fr"
        params:
          task: "aegis_v2_fr"
  - name: aegis_v2_de
    description: Aegis V2 German
    defaults:
      config:
        type: "aegis_v2_de"
        params:
          task: "aegis_v2_de"
  - name: aegis_v2_th
    description: Aegis V2 Thai
    defaults:
      config:
        type: "aegis_v2_th"
        params:
          task: "aegis_v2_th"
  - name: aegis_v2_ja
    description: Aegis V2 Japanese
    defaults:
      config:
        type: "aegis_v2_ja"
        params:
          task: "aegis_v2_ja"
  - name: aegis_v2_zh-CN
    description: Aegis V2 Chinese (Simplified)
    defaults:
      config:
        type: "aegis_v2_zh-CN"
        params:
          task: "aegis_v2_zh-CN"

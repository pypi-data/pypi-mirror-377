<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <record id="account_payment_order_form" model="ir.ui.view">
        <field name="name">account.payment.order.form</field>
        <field name="model">account.payment.order</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button
                        name="%(account_payment_line_create_action)d"
                        type="action"
                        string="Create Payment Lines from Journal Items"
                        invisible="state != 'draft'"
                        class="oe_highlight"
                        groups="account_payment_batch_oca.group_account_payment"
                    />
                    <button
                        name="draft2open"
                        type="object"
                        invisible="state != 'draft'"
                        string="Confirm Payments"
                        class="oe_highlight"
                        groups="account_payment_batch_oca.group_account_payment"
                    />
                    <button
                        name="open2generated"
                        type="object"
                        invisible="state != 'open'"
                        string="Generate Payment File"
                        class="oe_highlight"
                        groups="account_payment_batch_oca.group_account_payment"
                    />
                    <button
                        name="generated2uploaded"
                        type="object"
                        invisible="state != 'generated'"
                        string="File Successfully Uploaded"
                        class="oe_highlight"
                        groups="account_payment_batch_oca.group_account_payment"
                    />
                    <button
                        name="cancel2draft"
                        type="object"
                        invisible="state != 'cancel'"
                        string="Back to Draft"
                        groups="account_payment_batch_oca.group_account_payment"
                    />
                    <button
                        name="action_cancel"
                        type="object"
                        invisible="state == 'cancel'"
                        string="Cancel Payments"
                        confirm="Are you sure you want to cancel?"
                        groups="account_payment_batch_oca.group_account_payment"
                    />
                    <field
                        name="state"
                        widget="statusbar"
                        statusbar_visible="draft,open,generated,uploaded"
                    />
                </header>
                <div
                    class="alert alert-warning"
                    role="alert"
                    name="warning_untrusted_accounts"
                    invisible="not untrusted_bank_account_count"
                >
                        <field
                    name="untrusted_bank_account_count"
                /> bank account(s) is/are untrusted. Click on the button at the top to access it/them.
                </div>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button
                            class="oe_stat_button text-danger button-danger"
                            name="action_open_untrusted_accounts"
                            type="object"
                            icon="fa-bank"
                            bg_color="text-bg-danger"
                            invisible="not untrusted_bank_account_count"
                        >
                            <field
                                string="Untrusted Bank Accounts"
                                name="untrusted_bank_account_count"
                                widget="statinfo"
                            />
                        </button>

                        <button
                            class="oe_stat_button"
                            name="action_open_invoices"
                            type="object"
                            icon="fa-bars"
                            string="Invoices"
                        />

                        <button
                            class="oe_stat_button"
                            name="action_open_payments"
                            type="object"
                            icon="fa-bars"
                        >
                            <field
                                string="Payments"
                                name="payment_count"
                                widget="statinfo"
                            />
                        </button>
                    </div>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only" />
                        <h1>
                            <field name="name" />
                        </h1>
                    </div>
                    <group name="head" col="2">
                        <group name="head-left">
                            <field
                                name="payment_method_line_id"
                                readonly="state != 'draft'"
                            />
                            <field name="payment_method_code" invisible="1" />
                            <field name="allowed_journal_ids" invisible="1" />
                            <field name="journal_id" readonly="state != 'draft'" />
                            <field name="bank_account_link" invisible="1" />
                            <field name="company_partner_bank_id" />
                            <field
                                name="company_id"
                                groups="base.group_multi_company"
                            />
                            <field name="payment_type" invisible="1" />
                            <field name="mail_notif" invisible="1" />
                        </group>
                        <group name="head-right">
                            <field name="date_prefered" readonly="state != 'draft'" />
                            <!-- {'datepicker': {'warn_future': true}} works well... but there is
                            no 'warn_past' option in v18 unfortunately.
                            It would be useful for "date_scheduled" ! -->
                            <field
                                name="date_scheduled"
                                invisible="date_prefered != 'fixed'"
                                required="date_prefered == 'fixed'"
                                readonly="state != 'draft'"
                            />
                            <field
                                name="payment_file_datas"
                                filename="payment_file_name"
                                invisible="state not in ('generated', 'uploaded')"
                            />
                            <field name="payment_file_name" invisible="1" />
                            <field name="payment_file_id" invisible="1" />
                            <field
                                name="date_generated"
                                invisible="state not in ('generated', 'uploaded')"
                            />
                            <field
                                name="date_uploaded"
                                invisible="state != 'uploaded'"
                            />
                            <field name="description" />
                            <field
                                name="payment_lot_count"
                                invisible="state == 'draft'"
                            />
                            <field name="payment_count" invisible="state == 'draft'" />
                            <field name="total_company_currency" />
                            <field name="company_currency_id" invisible="1" />
                        </group>
                    </group>
                    <notebook>
                        <page name="payment-lines" string="Transactions">
                            <field
                                name="payment_line_ids"
                                readonly="state != 'draft'"
                                context="{'default_payment_type': payment_type, 'mail_notif': mail_notif}"
                            />
                        </page>
                        <page
                            name="payment-lines"
                            string="Payment Transactions"
                            invisible="state == 'draft'"
                        >
                            <field
                                name="payment_ids"
                                edit="0"
                                create="0"
                                context="{'list_view_ref': 'account_payment_batch_oca.view_account_payment_tree_payment_order'}"
                            />
                        </page>
                        <page
                            name="payment-lots"
                            string="Lots"
                            invisible="state == 'draft'"
                        >
                            <field name="payment_lot_ids" nolabel="1" colspan="2" />
                        </page>
                    </notebook>
                </sheet>
                <chatter />
            </form>
        </field>
    </record>
    <record id="account_payment_order_tree" model="ir.ui.view">
        <field name="name">account.payment.order.list</field>
        <field name="model">account.payment.order</field>
        <field name="arch" type="xml">
            <list>
                <field name="name" decoration-bf="1" />
                <field name="payment_method_line_id" />
                <field name="journal_id" />
                <field name="company_id" groups="base.group_multi_company" />
                <field name="date_uploaded" />
                <field name="description" optional="show" />
                <field
                    name="payment_lot_count"
                    optional="hide"
                    invisible="state == 'draft'"
                    string="Lots"
                />
                <field name="payment_count" optional="show" string="Transactions" />
                <field name="total_company_currency" sum="1" string="Amount" />
                <field name="company_currency_id" invisible="1" />
                <field name="payment_method_code" invisible="1" />
                <field
                    name="state"
                    decoration-info="state == 'draft'"
                    decoration-success="state == 'uploaded'"
                    decoration-warning="state == 'open'"
                    decoration-danger="state == 'generated'"
                    decoration-muted="state == 'cancel'"
                    widget="badge"
                />
            </list>
        </field>
    </record>
    <record id="account_payment_order_search" model="ir.ui.view">
        <field name="name">account.payment.order.search</field>
        <field name="model">account.payment.order</field>
        <field name="arch" type="xml">
            <search>
                <field
                    name="description"
                    filter_domain="['|', ('name', 'ilike', self), ('description', 'ilike', self)]"
                    string="Name or Description"
                />
                <field name="search_partner_id" />
                <field name="journal_id" />
                <filter
                    name="draft"
                    string="Draft"
                    domain="[('state', '=', 'draft')]"
                />
                <filter
                    name="open"
                    string="Confirmed"
                    domain="[('state', '=', 'open')]"
                />
                <filter
                    name="generated"
                    string="File Generated"
                    domain="[('state', '=', 'generated')]"
                />
                <filter
                    name="uploaded"
                    string="File Uploaded"
                    domain="[('state', '=', 'uploaded')]"
                />
                <group string="Group By" name="groupby">
                    <filter
                        name="payment_method_line_groupby"
                        string="Payment Method"
                        context="{'group_by': 'payment_method_line_id'}"
                    />
                    <filter
                        name="journal_groupby"
                        string="Bank Journal"
                        context="{'group_by': 'journal_id'}"
                    />
                    <filter
                        name="date_generated_groupby"
                        string="File Generation Date"
                        context="{'group_by': 'date_generated'}"
                    />
                    <filter
                        name="date_uploaded_groupby"
                        string="File Upload Date"
                        context="{'group_by': 'date_uploaded'}"
                    />
                    <filter
                        name="state_groupby"
                        string="State"
                        context="{'group_by': 'state'}"
                    />
                </group>
            </search>
        </field>
    </record>
    <record id="account_payment_order_graph" model="ir.ui.view">
        <field name="name">account.payment.order.graph</field>
        <field name="model">account.payment.order</field>
        <field name="arch" type="xml">
            <graph>
                <field name="date_uploaded" type="row" interval="month" />
                <field name="total_company_currency" type="measure" />
            </graph>
        </field>
    </record>
    <record id="account_payment_order_pivot" model="ir.ui.view">
        <field name="name">account.payment.order.pivot</field>
        <field name="model">account.payment.order</field>
        <field name="arch" type="xml">
            <pivot>
                <field name="date_uploaded" type="row" interval="month" />
                <field name="total_company_currency" type="measure" />
            </pivot>
        </field>
    </record>
    <record id="account_payment_order_outbound_action" model="ir.actions.act_window">
        <field name="name">Payment Orders</field>
        <field name="res_model">account.payment.order</field>
        <field name="view_mode">list,form,pivot,graph</field>
        <field name="domain">[('payment_type', '=', 'outbound')]</field>
        <field name="context">{'default_payment_type': 'outbound'}</field>
    </record>
    <record id="account_payment_order_inbound_action" model="ir.actions.act_window">
        <field name="name">Debit Orders</field>
        <field name="res_model">account.payment.order</field>
        <field name="view_mode">list,form,pivot,graph</field>
        <field name="domain">[('payment_type', '=', 'inbound')]</field>
        <field name="context">{'default_payment_type': 'inbound'}</field>
    </record>
    <menuitem
        id="account_payment_order_outbound_menu"
        action="account_payment_order_outbound_action"
        parent="account.menu_finance_payables"
        sequence="21"
    />
    <menuitem
        id="account_payment_order_inbound_menu"
        action="account_payment_order_inbound_action"
        parent="account.menu_finance_receivables"
        sequence="17"
    />
</odoo>

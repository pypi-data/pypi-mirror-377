<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2021 Hunki Enterprises BV
     License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl). -->
<odoo>

    <template id="portal_my_task" inherit_id="hr_timesheet.portal_my_task">
        <div t-if="timesheets and allow_timesheets" position="attributes">
            <attribute name="class" add="hr_timesheet_portal" separator=" " />
            <attribute name="t-att-data-project-id">task.project_id.id</attribute>
            <attribute
                name="t-att-data-account-id"
            >task.project_id.analytic_account_id.id</attribute>
            <attribute name="t-att-data-task-id">task.id</attribute>
        </div>
        <xpath
            expr="//div[@t-if='timesheets and allow_timesheets']//h5"
            position="inside"
        >
            <i
                class="fa fa-plus"
                groups="hr_timesheet_portal.group_hr_timesheet_portal"
            />
        </xpath>
        <div t-if="timesheets and allow_timesheets" position="after">
            <div
                t-if="not timesheets and task.project_id.allow_timesheets"
                class="container hr_timesheet_portal"
                t-att-data-project-id="task.project_id.id"
                t-att-data-account-id="task.project_id.analytic_account_id.id"
                t-att-data-task-id="task.id"
                groups="hr_timesheet_portal.group_hr_timesheet_portal"
            >
                <hr class="mt-4 mb-1" />
                <h5 class="mt-2 mb-2">Timesheets <i class="fa fa-plus" /></h5>
                <t t-call="hr_timesheet.portal_timesheet_table" />
            </div>
        </div>
    </template>
    <template
        id="portal_timesheet_table"
        inherit_id="hr_timesheet.portal_timesheet_table"
    >
        <tr t-foreach="timesheets" position="attributes">
            <attribute name="t-att-data-line-id">timesheet.id</attribute>
            <attribute
                name="t-att-class"
            >(timesheet.user_id == request.env.user and request.env.user.has_group('hr_timesheet_portal.group_hr_timesheet_portal')) and 'editable'</attribute>
        </tr>
        <xpath expr="//tr[@t-foreach='timesheets']/td" position="inside">
            <i t-if="timesheet.user_id == request.env.user" class="fa fa-edit" />
        </xpath>
        <xpath expr="//tr[@t-foreach='timesheets']/td[last()]" position="inside">
            <i t-if="timesheet.user_id == request.env.user" class="fa fa-remove" />
        </xpath>
        <xpath expr="//t[@t-esc='timesheet.name']/parent::td" position="attributes">
            <attribute name="data-field-name">name</attribute>
        </xpath>
        <xpath expr="//t[@t-esc='timesheet.date']/parent::td" position="attributes">
            <attribute name="data-field-name">date</attribute>
            <attribute name="data-field-type">date</attribute>
            <attribute name="t-att-data-field-value">timesheet.date</attribute>
        </xpath>
        <xpath
            expr="//span[@t-field='timesheet.unit_amount']/parent::td"
            position="attributes"
        >
            <attribute name="data-field-name">unit_amount</attribute>
            <attribute name="data-field-type">number</attribute>
            <attribute name="t-att-data-field-value">timesheet.unit_amount</attribute>
        </xpath>
    </template>

</odoo>

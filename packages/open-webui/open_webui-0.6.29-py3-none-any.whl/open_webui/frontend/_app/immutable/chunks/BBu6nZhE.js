const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DUWq5xNk.js","./C1FmrZbK.js","./G5mHU2ZO.js","./IHki7fMi.js","./Vcq4gwWv.js","./DmTNmOsd.js","./DecyplDM.js","./C7CLP60P.js","./CN4oNWyW.js","./DjBxNUjk.js","../assets/Toaster.DQwrSZtH.css"])))=>i.map(i=>d[i]);
import{_ as je}from"./C1FmrZbK.js";import{S as Re,i as ze,s as Ge,H as Pe,I as Je,e as h,C as ee,l as S,t as W,c as m,a as p,D as te,d as c,p as M,b as j,f as r,g as le,h as i,E as ne,G as pe,J as Ke,y as Qe,r as U,u as Xe,q,j as G,K as Ye,F as oe,v as Ze,k as et,n as $,L as ce,M as Ce}from"./G5mHU2ZO.js";import{h as tt,u as nt}from"./jYArkn2m.js";import"./IHki7fMi.js";import{g as ot}from"./CN4oNWyW.js";import{C as lt}from"./BeIFtFLj.js";import{B as st}from"./CLPmQZ7R.js";import{T as ke}from"./BOU1-HoI.js";import{C as at}from"./BzjHydOn.js";function He(t){t[30]=t[31].default}function it(t){let e,n,s,l,o;return n=new at({props:{strokeWidth:"2.5"}}),{c(){e=h("button"),ee(n.$$.fragment),this.h()},l(a){e=m(a,"BUTTON",{class:!0,type:!0});var _=p(e);te(n.$$.fragment,_),_.forEach(c),this.h()},h(){r(e,"class","w-full text-left text-sm py-1.5 px-1 rounded-lg dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-gray-850"),r(e,"type","button")},m(a,_){le(a,e,_),ne(n,e,null),s=!0,l||(o=pe(e,"click",t[15]),l=!0)},p:$,i(a){s||(q(n.$$.fragment,a),s=!0)},o(a){U(n.$$.fragment,a),s=!1},d(a){a&&c(e),oe(n),l=!1,o()}}}function rt(t){let e,n,s,l;return{c(){e=h("input"),this.h()},l(o){e=m(o,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){r(e,"class","w-full text-2xl font-medium bg-transparent outline-hidden font-primary"),r(e,"type","text"),r(e,"placeholder",n=t[9].t("Function Name")),e.required=!0},m(o,a){le(o,e,a),ce(e,t[0]),s||(l=pe(e,"input",t[16]),s=!0)},p(o,a){a[0]&512&&n!==(n=o[9].t("Function Name"))&&r(e,"placeholder",n),a[0]&1&&e.value!==o[0]&&ce(e,o[0])},d(o){o&&c(e),s=!1,l()}}}function ut(t){let e,n;return e=new ke({props:{className:"w-full",content:t[9].t("e.g. my_filter"),placement:"top-start",$$slots:{default:[ct]},$$scope:{ctx:t}}}),{c(){ee(e.$$.fragment)},l(s){te(e.$$.fragment,s)},m(s,l){ne(e,s,l),n=!0},p(s,l){const o={};l[0]&512&&(o.content=s[9].t("e.g. my_filter")),l[0]&532|l[1]&2&&(o.$$scope={dirty:l,ctx:s}),e.$set(o)},i(s){n||(q(e.$$.fragment,s),n=!0)},o(s){U(e.$$.fragment,s),n=!1},d(s){oe(e,s)}}}function ft(t){let e,n;return{c(){e=h("div"),n=W(t[2]),this.h()},l(s){e=m(s,"DIV",{class:!0});var l=p(e);n=j(l,t[2]),l.forEach(c),this.h()},h(){r(e,"class","text-sm text-gray-500 shrink-0")},m(s,l){le(s,e,l),i(e,n)},p(s,l){l[0]&4&&G(n,s[2])},i:$,o:$,d(s){s&&c(e)}}}function ct(t){let e,n,s,l;return{c(){e=h("input"),this.h()},l(o){e=m(o,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){r(e,"class","w-full text-sm disabled:text-gray-500 bg-transparent outline-hidden"),r(e,"type","text"),r(e,"placeholder",n=t[9].t("Function ID")),e.required=!0,e.disabled=t[4]},m(o,a){le(o,e,a),ce(e,t[2]),s||(l=pe(e,"input",t[17]),s=!0)},p(o,a){a[0]&512&&n!==(n=o[9].t("Function ID"))&&r(e,"placeholder",n),a[0]&16&&(e.disabled=o[4]),a[0]&4&&e.value!==o[2]&&ce(e,o[2])},d(o){o&&c(e),s=!1,l()}}}function dt(t){let e,n,s,l;return{c(){e=h("input"),this.h()},l(o){e=m(o,"INPUT",{class:!0,type:!0,placeholder:!0}),this.h()},h(){r(e,"class","w-full text-sm bg-transparent outline-hidden"),r(e,"type","text"),r(e,"placeholder",n=t[9].t("Function Description")),e.required=!0},m(o,a){le(o,e,a),ce(e,t[3].description),s||(l=pe(e,"input",t[18]),s=!0)},p(o,a){a[0]&512&&n!==(n=o[9].t("Function Description"))&&r(e,"placeholder",n),a[0]&8&&e.value!==o[3].description&&ce(e,o[3].description)},d(o){o&&c(e),s=!1,l()}}}function ht(t){return{c:$,l:$,m:$,p:$,i:$,o:$,d:$}}function mt(t){He(t);let e,n,s={value:t[1],lang:"python",boilerplate:t[11],onChange:t[19],onSave:t[20]};return e=new t[30]({props:s}),t[21](e),{c(){ee(e.$$.fragment)},l(l){te(e.$$.fragment,l)},m(l,o){ne(e,l,o),n=!0},p(l,o){He(l);const a={};o[0]&2&&(a.value=l[1]),o[0]&128&&(a.onChange=l[19]),o[0]&32&&(a.onSave=l[20]),e.$set(a)},i(l){n||(q(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){t[21](null),oe(e,l)}}}function pt(t){return{c:$,l:$,m:$,p:$,i:$,o:$,d:$}}function _t(t){let e,n,s,l=t[9].t("Please carefully review the following warnings:")+"",o,a,_,w,P=t[9].t("Functions allow arbitrary code execution.")+"",F,b,C,k=t[9].t("Do not install functions from sources you do not fully trust.")+"",I,R,v,y=t[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"",E;return{c(){e=h("div"),n=h("div"),s=h("div"),o=W(l),a=S(),_=h("ul"),w=h("li"),F=W(P),b=S(),C=h("li"),I=W(k),R=S(),v=h("div"),E=W(y),this.h()},l(D){e=m(D,"DIV",{class:!0});var g=p(e);n=m(g,"DIV",{class:!0});var x=p(n);s=m(x,"DIV",{});var A=p(s);o=j(A,l),A.forEach(c),a=M(x),_=m(x,"UL",{class:!0});var L=p(_);w=m(L,"LI",{});var T=p(w);F=j(T,P),T.forEach(c),b=M(L),C=m(L,"LI",{});var B=p(C);I=j(B,k),B.forEach(c),L.forEach(c),x.forEach(c),R=M(g),v=m(g,"DIV",{class:!0});var V=p(v);E=j(V,y),V.forEach(c),g.forEach(c),this.h()},h(){r(_,"class","mt-1 list-disc pl-4 text-xs"),r(n,"class","bg-yellow-500/20 text-yellow-700 dark:text-yellow-200 rounded-lg px-4 py-3"),r(v,"class","my-3"),r(e,"class","text-sm text-gray-500")},m(D,g){le(D,e,g),i(e,n),i(n,s),i(s,o),i(n,a),i(n,_),i(_,w),i(w,F),i(_,b),i(_,C),i(C,I),i(e,R),i(e,v),i(v,E)},p(D,g){g[0]&512&&l!==(l=D[9].t("Please carefully review the following warnings:")+"")&&G(o,l),g[0]&512&&P!==(P=D[9].t("Functions allow arbitrary code execution.")+"")&&G(F,P),g[0]&512&&k!==(k=D[9].t("Do not install functions from sources you do not fully trust.")+"")&&G(I,k),g[0]&512&&y!==(y=D[9].t("I acknowledge that I have read and I understand the implications of my action. I am aware of the risks associated with executing arbitrary code and I have verified the trustworthiness of the source.")+"")&&G(E,y)},d(D){D&&c(e)}}}function vt(t){let e,n,s,l,o,a,_,w,P,F,b,C,k,I,R,v,y,E,D,g,x,A,L,T,B,V,J,se=t[9].t("Warning:")+"",ie,de,f=t[9].t("Functions allow arbitrary code execution.")+"",_e,Ie,Ee,De,re,he=t[9].t("don't install random functions from sources you don't trust.")+"",ve,Fe,ae,me=t[9].t("Save")+"",ge,be,O,Ve,K,$e,Te;w=new ke({props:{content:t[9].t("Back"),$$slots:{default:[it]},$$scope:{ctx:t}}}),b=new ke({props:{content:t[9].t("e.g. My Filter"),placement:"top-start",$$slots:{default:[rt]},$$scope:{ctx:t}}}),I=new st({props:{type:"muted",content:t[9].t("Function")}});const Ne=[ft,ut],Q=[];function Se(d,u){return d[4]?0:1}y=Se(t),E=Q[y]=Ne[y](t),g=new ke({props:{className:"w-full self-center items-center flex",content:t[9].t("e.g. A filter to remove profanity from text"),placement:"top-start",$$slots:{default:[dt]},$$scope:{ctx:t}}});let N={ctx:t,current:null,token:null,hasCatch:!1,pending:pt,then:mt,catch:ht,value:31,blocks:[,,,]};tt(je(()=>import("./DUWq5xNk.js").then(d=>d.Q),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]),import.meta.url),N);function We(d){t[24](d)}let Me={$$slots:{default:[_t]},$$scope:{ctx:t}};return t[6]!==void 0&&(Me.show=t[6]),O=new lt({props:Me}),Pe.push(()=>Je(O,"show",We)),O.$on("confirm",t[25]),{c(){e=h("div"),n=h("div"),s=h("form"),l=h("div"),o=h("div"),a=h("div"),_=h("div"),ee(w.$$.fragment),P=S(),F=h("div"),ee(b.$$.fragment),C=S(),k=h("div"),ee(I.$$.fragment),R=S(),v=h("div"),E.c(),D=S(),ee(g.$$.fragment),x=S(),A=h("div"),N.block.c(),L=S(),T=h("div"),B=h("div"),V=h("div"),J=h("span"),ie=W(se),de=S(),_e=W(f),Ie=S(),Ee=h("br"),De=W(`—
							`),re=h("span"),ve=W(he),Fe=S(),ae=h("button"),ge=W(me),be=S(),ee(O.$$.fragment),this.h()},l(d){e=m(d,"DIV",{class:!0});var u=p(e);n=m(u,"DIV",{class:!0});var X=p(n);s=m(X,"FORM",{class:!0});var ue=p(s);l=m(ue,"DIV",{class:!0});var z=p(l);o=m(z,"DIV",{class:!0});var Y=p(o);a=m(Y,"DIV",{class:!0});var H=p(a);_=m(H,"DIV",{class:!0});var fe=p(_);te(w.$$.fragment,fe),fe.forEach(c),P=M(H),F=m(H,"DIV",{class:!0});var Ae=p(F);te(b.$$.fragment,Ae),Ae.forEach(c),C=M(H),k=m(H,"DIV",{});var Be=p(k);te(I.$$.fragment,Be),Be.forEach(c),H.forEach(c),R=M(Y),v=m(Y,"DIV",{class:!0});var we=p(v);E.l(we),D=M(we),te(g.$$.fragment,we),we.forEach(c),Y.forEach(c),x=M(z),A=m(z,"DIV",{class:!0});var Ue=p(A);N.block.l(Ue),Ue.forEach(c),L=M(z),T=m(z,"DIV",{class:!0});var ye=p(T);B=m(ye,"DIV",{class:!0});var qe=p(B);V=m(qe,"DIV",{class:!0});var Z=p(V);J=m(Z,"SPAN",{class:!0});var xe=p(J);ie=j(xe,se),xe.forEach(c),de=M(Z),_e=j(Z,f),Ie=M(Z),Ee=m(Z,"BR",{}),De=j(Z,`—
							`),re=m(Z,"SPAN",{class:!0});var Le=p(re);ve=j(Le,he),Le.forEach(c),Z.forEach(c),qe.forEach(c),Fe=M(ye),ae=m(ye,"BUTTON",{class:!0,type:!0});var Oe=p(ae);ge=j(Oe,me),Oe.forEach(c),ye.forEach(c),z.forEach(c),ue.forEach(c),X.forEach(c),u.forEach(c),be=M(d),te(O.$$.fragment,d),this.h()},h(){r(_,"class","shrink-0 mr-2"),r(F,"class","flex-1"),r(a,"class","flex w-full items-center"),r(v,"class","flex gap-2 px-1 items-center"),r(o,"class","w-full mb-2 flex flex-col gap-0.5"),r(A,"class","mb-2 flex-1 overflow-auto h-0 rounded-lg"),r(J,"class","font-semibold dark:text-gray-200"),r(re,"class","font-medium dark:text-gray-400"),r(V,"class","text-xs text-gray-500 line-clamp-2"),r(B,"class","flex-1 pr-3"),r(ae,"class","px-3.5 py-1.5 text-sm font-medium bg-black hover:bg-gray-900 text-white dark:bg-white dark:text-black dark:hover:bg-gray-100 transition rounded-full"),r(ae,"type","submit"),r(T,"class","pb-3 flex justify-between"),r(l,"class","flex flex-col flex-1 overflow-auto h-0 rounded-lg"),r(s,"class","flex flex-col max-h-[100dvh] h-full"),r(n,"class","mx-auto w-full md:px-0 h-full"),r(e,"class","flex flex-col justify-between w-full overflow-y-auto h-full")},m(d,u){le(d,e,u),i(e,n),i(n,s),i(s,l),i(l,o),i(o,a),i(a,_),ne(w,_,null),i(a,P),i(a,F),ne(b,F,null),i(a,C),i(a,k),ne(I,k,null),i(o,R),i(o,v),Q[y].m(v,null),i(v,D),ne(g,v,null),i(l,x),i(l,A),N.block.m(A,N.anchor=null),N.mount=()=>A,N.anchor=null,i(l,L),i(l,T),i(T,B),i(B,V),i(V,J),i(J,ie),i(V,de),i(V,_e),i(V,Ie),i(V,Ee),i(V,De),i(V,re),i(re,ve),i(T,Fe),i(T,ae),i(ae,ge),t[22](s),le(d,be,u),ne(O,d,u),K=!0,$e||(Te=pe(s,"submit",Ke(t[23])),$e=!0)},p(d,u){t=d;const X={};u[0]&512&&(X.content=t[9].t("Back")),u[1]&2&&(X.$$scope={dirty:u,ctx:t}),w.$set(X);const ue={};u[0]&512&&(ue.content=t[9].t("e.g. My Filter")),u[0]&513|u[1]&2&&(ue.$$scope={dirty:u,ctx:t}),b.$set(ue);const z={};u[0]&512&&(z.content=t[9].t("Function")),I.$set(z);let Y=y;y=Se(t),y===Y?Q[y].p(t,u):(Qe(),U(Q[Y],1,1,()=>{Q[Y]=null}),Xe(),E=Q[y],E?E.p(t,u):(E=Q[y]=Ne[y](t),E.c()),q(E,1),E.m(v,D));const H={};u[0]&512&&(H.content=t[9].t("e.g. A filter to remove profanity from text")),u[0]&520|u[1]&2&&(H.$$scope={dirty:u,ctx:t}),g.$set(H),nt(N,t,u),(!K||u[0]&512)&&se!==(se=t[9].t("Warning:")+"")&&G(ie,se),(!K||u[0]&512)&&f!==(f=t[9].t("Functions allow arbitrary code execution.")+"")&&G(_e,f),(!K||u[0]&512)&&he!==(he=t[9].t("don't install random functions from sources you don't trust.")+"")&&G(ve,he),(!K||u[0]&512)&&me!==(me=t[9].t("Save")+"")&&G(ge,me);const fe={};u[0]&512|u[1]&2&&(fe.$$scope={dirty:u,ctx:t}),!Ve&&u[0]&64&&(Ve=!0,fe.show=t[6],Ye(()=>Ve=!1)),O.$set(fe)},i(d){K||(q(w.$$.fragment,d),q(b.$$.fragment,d),q(I.$$.fragment,d),q(E),q(g.$$.fragment,d),q(N.block),q(O.$$.fragment,d),K=!0)},o(d){U(w.$$.fragment,d),U(b.$$.fragment,d),U(I.$$.fragment,d),U(E),U(g.$$.fragment,d);for(let u=0;u<3;u+=1){const X=N.blocks[u];U(X)}U(O.$$.fragment,d),K=!1},d(d){d&&(c(e),c(be)),oe(w),oe(b),oe(I),Q[y].d(),oe(g),N.block.d(),N.token=null,N=null,t[22](null),oe(O,d),$e=!1,Te()}}}function gt(t,e,n){let s;const l=Ze("i18n");et(t,l,f=>n(9,s=f));let o=null,a=!1,{onSave:_=()=>{}}=e,{edit:w=!1}=e,{clone:P=!1}=e,{id:F=""}=e,{name:b=""}=e,{meta:C={description:""}}=e,{content:k=""}=e,I="";const R=()=>{n(7,I=k)};let v,y=`"""
title: Example Filter
author: open-webui
author_url: https://github.com/open-webui
funding_url: https://github.com/open-webui
version: 0.1
"""

from pydantic import BaseModel, Field
from typing import Optional


class Filter:
    class Valves(BaseModel):
        priority: int = Field(
            default=0, description="Priority level for the filter operations."
        )
        max_turns: int = Field(
            default=8, description="Maximum allowable conversation turns for a user."
        )
        pass

    class UserValves(BaseModel):
        max_turns: int = Field(
            default=4, description="Maximum allowable conversation turns for a user."
        )
        pass

    def __init__(self):
        # Indicates custom file handling logic. This flag helps disengage default routines in favor of custom
        # implementations, informing the WebUI to defer file-related operations to designated methods within this class.
        # Alternatively, you can remove the files directly from the body in from the inlet hook
        # self.file_handler = True

        # Initialize 'valves' with specific configurations. Using 'Valves' instance helps encapsulate settings,
        # which ensures settings are managed cohesively and not confused with operational flags like 'file_handler'.
        self.valves = self.Valves()
        pass

    def inlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify the request body or validate it before processing by the chat completion API.
        # This function is the pre-processor for the API where various checks on the input can be performed.
        # It can also modify the request before sending it to the API.
        print(f"inlet:{__name__}")
        print(f"inlet:body:{body}")
        print(f"inlet:user:{__user__}")

        if __user__.get("role", "admin") in ["user", "admin"]:
            messages = body.get("messages", [])

            max_turns = min(__user__["valves"].max_turns, self.valves.max_turns)
            if len(messages) > max_turns:
                raise Exception(
                    f"Conversation turn limit exceeded. Max turns: {max_turns}"
                )

        return body

    def outlet(self, body: dict, __user__: Optional[dict] = None) -> dict:
        # Modify or analyze the response body after processing by the API.
        # This function is the post-processor for the API, which can be used to modify the response
        # or perform additional checks and analytics.
        print(f"outlet:{__name__}")
        print(f"outlet:body:{body}")
        print(f"outlet:user:{__user__}")

        return body
`;const E=async()=>{_({id:F,name:b,meta:C,content:k})},D=async()=>{if(v){n(1,k=I),await Ce();const f=await v.formatPythonCodeHandler();await Ce(),n(1,k=I),await Ce(),f&&(console.info("Code formatted successfully"),E())}},g=()=>{ot("/admin/functions")};function x(){b=this.value,n(0,b)}function A(){F=this.value,n(2,F),n(0,b),n(4,w),n(14,P)}function L(){C.description=this.value,n(3,C)}const T=f=>{n(7,I=f)},B=async()=>{o&&o.requestSubmit()};function V(f){Pe[f?"unshift":"push"](()=>{v=f,n(8,v)})}function J(f){Pe[f?"unshift":"push"](()=>{o=f,n(5,o)})}const se=()=>{w?D():n(6,a=!0)};function ie(f){a=f,n(6,a)}const de=()=>{D()};return t.$$set=f=>{"onSave"in f&&n(13,_=f.onSave),"edit"in f&&n(4,w=f.edit),"clone"in f&&n(14,P=f.clone),"id"in f&&n(2,F=f.id),"name"in f&&n(0,b=f.name),"meta"in f&&n(3,C=f.meta),"content"in f&&n(1,k=f.content)},t.$$.update=()=>{t.$$.dirty[0]&2&&k&&R(),t.$$.dirty[0]&16401&&b&&!w&&!P&&n(2,F=b.replace(/\s+/g,"_").toLowerCase())},[b,k,F,C,w,o,a,I,v,s,l,y,D,_,P,g,x,A,L,T,B,V,J,se,ie,de]}class $t extends Re{constructor(e){super(),ze(this,e,gt,vt,Ge,{onSave:13,edit:4,clone:14,id:2,name:0,meta:3,content:1},null,[-1,-1])}}export{$t as F};
//# sourceMappingURL=BBu6nZhE.js.map
